if(!Celigo.scheduled||!Celigo.scheduled.IntegratorManager){$.namespace("Celigo.bundleinstall.integrator");Celigo.bundleinstall.integrator.IntegratorBundleManager=function(a){Celigo.bundleinstall.integrator.IntegratorBundleManager.superclass.constructor.call(this,a);var b=this,a=a?a.testSuffix||"":"",c="Celigo"+a,e=a===""?$$.getContext().getBundleId()==="19172"?"20539":$$.getContext().getBundleId():"999999999"+a,f={},g={},h=function(a,b){log("createRecordIfNotExist "+a,b);if(!f[a]){f[a]={};for(var c=
$.search(a,null,null,"name"),e=0;c&&e<c.length;e++)f[a][c[e].getValue("name")]=!0;log("isRecordExisted",JSON.stringify(f))}f[a][b]||(log("creating "+a,b),c=$$.createRecord(a),c.setFieldValue("name",b),c=$$.submitRecord(c),log("creating "+a,c),f[a][b]=!0)},j=function(a,b,c){c&&c(a,b);if(_.isUndefined(a.version))a.version=1;if(_.isUndefined(b.version))b.version=1;log("sourceConfig",a);log("destinationConfig",b);if(a.version>b.version)a=Celigo.core.jsObject.ObjectMerger.mergeObjects([b,a]),a.__merged=
!0,log("mergedConfig",a),b=a.integration,c=a.useCase,b&&(log("integration",b),h("customrecord_celigo_integration",b)),c&&(log("useCase",c),h("customrecord_celigo_integration_usecase",c));return a},i=function(a,c,e){var k=a,f=$$.loadFile(a),i=f.getName(),g=null;try{g=$$.loadFile(c+"/"+i)}catch(h){if(h=Celigo.Error.convert(h),!h.getCode||h.getCode()!=="RCRD_DSNT_EXIST")throw h;}i={version:0};g&&(i=Celigo.JSON.parse(Celigo.util.FileUtil.decryptLoadedConfigFileIfEncrypted(g)));g=Celigo.JSON.parse(Celigo.util.FileUtil.decryptLoadedConfigFileIfEncryptedInStorm(f));
e=j(g,i,e);if(e.__merged)delete e.__merged,c=Celigo.core.file.FolderStructureManager.getFolder(c).internalId,k=Celigo.JSON.stringify(e),b.encryptConfigFiles()&&(k=Celigo.core.crypto.Encryptor.encrypt(k)),f=$$.createFile(f.getName(),f.getType(),k),f.setFolder(c),k=$$.submitFile(f);log("copyOrMergeFiles completed",a);return k},k=function(a,b){for(var c=0;b&&c<b.length;c++)if(b[c].getValue("custrecord_celigo_rt_export_recordtype")===a)return!0;return!1};this.createMissingFolders=function(){log("IntegratorBundleManager - createMissingFolders");
Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/Flows/Disabled");Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/Flows/Backup");Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/Global/Connections");Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/Global/Mappings");Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/Global/Message Schemas");b.getProductName()&&
(Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/"+b.getProductName()),Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/Flows/"+b.getProductName()),Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/Configuration/FlowsV2/"+b.getProductName()));Celigo.core.file.FolderStructureManager.createMissingFolders()};this.copyOrMergeConfigurationFiles=function(){log("IntegratorBundleManager - copyConfigurationFiles");if(b.getProductName()){i(this.getSuiteBundlesFolderName()+
"/Bundle "+e+"/"+b.getProductName()+"_Config.txt",c+"/Integrator/Configuration/Global");var a=Celigo.core.file.FolderStructureManager.getFolder(this.getSuiteBundlesFolderName()+"/Bundle "+e+"/"+b.getProductName()).internalId;log("IntegratorBundleManager - copyConfigurationFiles - flowConfigFolder",a);a=$.SearchUtil.searchFiles(null,a);log("IntegratorBundleManager - copyConfigurationFiles - flowConfigFileIds",JSON.stringify(a));for(var m=0;a&&m<a.length;m++)log("IntegratorBundleManager - copyConfigurationFiles - Copying flow config file",
a[m]),i(a[m],c+"/Integrator/Configuration/Flows/"+b.getProductName(),function(a,e){log("IntegratorBundleManager - copyConfigurationFiles - start sourceConfig",JSON.stringify(a));log("IntegratorBundleManager - copyConfigurationFiles - start destinationConfig",JSON.stringify(e));var m=Celigo.core.integrator.util.IntegratorUtil.isExportFlow(a)?"export":"import",k=a.useCase;m==="export"?Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/"+b.getProductName()+"/"+k+"/Outbound"):(Celigo.core.file.FolderStructureManager.addPath(c+
"/Integrator/"+b.getProductName()+"/"+k+"/Inbound"),Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/"+b.getProductName()+"/"+k+"/Errors"));Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/"+b.getProductName()+"/"+k+"/Backup");Celigo.core.file.FolderStructureManager.createMissingFolders();m==="export"?a.exportFolderId=Celigo.core.file.FolderStructureManager.getFolder(c+"/Integrator/"+b.getProductName()+"/"+k+"/Outbound").internalId:(a.importFolderId=Celigo.core.file.FolderStructureManager.getFolder(c+
"/Integrator/"+b.getProductName()+"/"+k+"/Inbound").internalId,a.errorFolderId=Celigo.core.file.FolderStructureManager.getFolder(c+"/Integrator/"+b.getProductName()+"/"+k+"/Errors").internalId);a.backupFolderId=Celigo.core.file.FolderStructureManager.getFolder(c+"/Integrator/"+b.getProductName()+"/"+k+"/Backup").internalId;log("IntegratorBundleManager - copyConfigurationFiles - modified sourceConfig",JSON.stringify(a));log("IntegratorBundleManager - copyConfigurationFiles - modified destinationConfig",
JSON.stringify(e))})}};this.copyOrMergeV2Mappings=function(){if(this.getProductName()){for(var a=this.getSuiteBundlesFolderName()+"/Bundle "+e+"/"+this.getProductName()+"_config/mappings",b=c+"/Integrator/Configuration/Global/Mappings",a=$.SearchUtil.searchFiles(null,Celigo.io.FolderStructureManager.getFolder(a).internalId),k=0;a&&k<a.length;k++)i(a[k],b);$$.logExecution("audit","v2","copied mapping files")}};this.createV2ConnectionRecordIfNotExist=function(a){if(a&&a.connector&&a.connector.credentialRef&&
a.connector.credentialRef.id){var b=a.connector.credentialRef.id;if(!g[b]){$$.logExecution("audit","v2","searching connection record "+b);var c=$$.searchRecord("customrecord_celigo_connection",null,new nlobjSearchFilter("custrecord_celigo_connection_id",null,"is",String(b)));if(!c||!c.length)return c=new Celigo.io.CredentialsManager({id:b}),c.setName(b),c.setUserName("user@celigo.com"),c.setPassword(""),c.setHost(a.host||""),c.setProtocol("other"),$$.logExecution("audit","v2","creating connection..."),
c.save()}}};this.copyOrMergeV2Configs=function(){if(this.getProductName()){var a=this.getSuiteBundlesFolderName()+"/Bundle "+e+"/"+this.getProductName()+"_config";$$.logExecution("audit","v2","config file source folder "+a);a=$.SearchUtil.searchFiles(null,Celigo.io.FolderStructureManager.getFolder(a).internalId);$$.logExecution("audit","v2","found config Files "+a);for(var k=0;a&&k<a.length;k++){$$.logExecution("audit","v2","copying config file "+a[k]);var f=Celigo.JSON.parse(Celigo.util.FileUtil.decryptLoadedConfigFileIfEncrypted($$.loadFile(a[k]))),
g;switch(f.celigo_classname){case "Celigo.integrator.batch.Export":case "Celigo.integrator.batch.Import":g=Celigo.integrator.batch.DataFlowMetadata;break;case "Celigo.integrator.realtime.Export":g=Celigo.integrator.realtime.ExportMetadata;break;case "Celigo.integrator.realtime.Import":g=Celigo.integrator.realtime.ImportMetadata;break;default:throw $$.createError("CELIGO_INSTALL_ERROR","Config file has invalid classname",JSON.stringify(f));}var i=$$.searchRecord(g.getFlowRecType(),null,[new nlobjSearchFilter("name",
g.getFlowFldIntegration(),"is",f.integration),new nlobjSearchFilter("name",g.getFlowFldUseCase(),"is",f.useCase)],[new nlobjSearchColumn(g.getFlowFldConfig()),new nlobjSearchColumn(g.getFlowFldConfiguration())]);if(i&&i.length>0){var r=i[0].getValue(g.getFlowFldConfiguration()),p=null;if(!r){p=i[0].getValue(g.getFlowFldConfig());if(!p)throw $$.createError("CELIGO_INSTALL_ERROR","Data flow record exists but both config and config file fields are empty",JSON.stringify(f));r=Celigo.util.FileUtil.decryptLoadedConfigFileIfEncrypted($$.loadFile(p))}r=
Celigo.JSON.parse(r);f=j(f,r);f.__merged?(delete f.__merged,i=$$.loadRecord(g.getFlowRecType(),i[0].getId()),i.setFieldValue(g.getFlowFldConfig(),null),i.setFieldValue(g.getFlowFldConfiguration(),Celigo.JSON.stringify(f)),b.performAdditionalModificationToDataFlowRecord(i,f),$$.submitRecord(i)):p&&(i=$$.loadRecord(g.getFlowRecType(),i[0].getId()),i.setFieldValue(g.getFlowFldConfig(),null),i.setFieldValue(g.getFlowFldConfiguration(),Celigo.JSON.stringify(r)),$$.submitRecord(i))}else{h("customrecord_celigo_integration",
f.integration);h("customrecord_celigo_integration_usecase",f.useCase);f.celigo_classname==="Celigo.integrator.batch.Import"&&Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/"+b.getProductName()+"/"+f.useCase+"/Errors");f.connector&&Celigo.core.file.FolderStructureManager.addPath(c+"/Integrator/"+b.getProductName()+"/"+f.useCase+"/Backup");Celigo.core.file.FolderStructureManager.createMissingFolders();if(f.celigo_classname==="Celigo.integrator.batch.Import")f.errorFolder=Celigo.core.file.FolderStructureManager.getFolder(c+
"/Integrator/"+b.getProductName()+"/"+f.useCase+"/Errors").internalId;if(f.connector)f.connector.messageBackupFolder=Celigo.core.file.FolderStructureManager.getFolder(c+"/Integrator/"+b.getProductName()+"/"+f.useCase+"/Backup").internalId;if(this.getSolutionId())f.hiddenConfig={flowFldSolutionId:this.getSolutionId(),flowFldLicensed:!0};Celigo.integrator.dataflow.Factory.createDataFlowRecord({config:f});this.createV2ConnectionRecordIfNotExist(f)}}}};this.generateIntegratorIOToken=function(){$$.logExecution("audit",
"integrator.io is being generated");var a=CeligoSecureHelper.generateAndEncryptIntegratorIoToken();$$.logExecution("audit","integrator.io token generated and encrypted",a);$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_iio_token",a)};this.updateClosureFiles=function(a,c){if(b.getClosureFiles()){$$.logExecution("audit","new bundle version",c);var e=c.substr(0,c.lastIndexOf(".")),k=$$.searchRecord("customrecord_celigo_closures",null,null,[new nlobjSearchColumn("name")])||
[],f={};_.each(k,function(a){f[a.getValue("name")]=a.getId()});_.each(b.getClosureFiles(),function(a){var b;f[a]?b=$$.loadRecord("customrecord_celigo_closures",f[a]):(b=$$.createRecord("customrecord_celigo_closures"),b.setFieldValue("name",a));b.setFieldValue("custrecord_celigo_closure_version",e);b=$$.submitRecord(b);$$.logExecution("audit","saved closure record "+a+" version "+e,b)});Celigo.BundleInstallGenerateCombinedClosure()}};this.afterInstallOrUpdate=function(a,c){Celigo.BatchProcess.isScheduledScript=
!1;var e=c.substr(0,c.lastIndexOf("."));b.getProductName()?b.getClosureFiles()&&b.updateClosureFiles(a,c):Celigo.BundleInstallGenerateCombinedClosure(e);if(!b.getProductName()){e=$$.searchRecord("customrecord_celigo_global_cache",null,null,null);if(!e||e.length<1)e=$$.createRecord("customrecord_celigo_global_cache"),e.setFieldValue("custrecord_celigo_gc_afl",1E3),$$.submitRecord(e,!0,!0);b.generateIntegratorIOToken();nlapiSubmitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_int_ver",
"1.7.4")}b.createMissingFolders();b.getProductName()||b.copySdkFiles();$$.logExecution("audit","points remaining 1",$$.getContext().getRemainingUsage());this.isDoV1Logic()&&b.copyOrMergeConfigurationFiles();$$.logExecution("audit","points remaining 2",$$.getContext().getRemainingUsage());this.isAllowUpdate()&&(this.copyOrMergeV2Mappings(),this.copyOrMergeV2Configs());$$.logExecution("audit","points remaining 3",$$.getContext().getRemainingUsage());if(!$$.lookupField("customrecord_celigo_global_cache",
1,"custrecord_celigo_gc_afl"))throw $$.createError("CELIGO_UNEXPECTED_ERROR","availableFlowLicenses not defined in gc");$$.logExecution("audit","points remaining 4",$$.getContext().getRemainingUsage())};this.createAllSystemFlowsAndRelatedRecords=function(){var a=[new nlobjSearchFilter("custrecord_celigo_integration_system",null,"is","T"),new nlobjSearchFilter("name",null,"is","SYSTEM")],a=$$.searchRecord("customrecord_celigo_integration",null,a,null);if(!a||a.length<1){var b=$$.createRecord("customrecord_celigo_integration");
b.setFieldValue("name","SYSTEM");b.setFieldValue("custrecord_celigo_integration_system","T");$$.submitRecord(b)}a=[new nlobjSearchFilter("name",null,"is","SYSTEM")];a=$$.searchRecord("customrecord_celigo_integration_usecase",null,a,null);if(!a||a.length<1)b=$$.createRecord("customrecord_celigo_integration_usecase"),b.setFieldValue("name","SYSTEM"),$$.submitRecord(b);a=[new nlobjSearchFilter("custrecord_celigo_rt_export_system",null,"is","T")];columns=[new nlobjSearchColumn("custrecord_celigo_rt_export_recordtype")];
(a=$$.searchRecord("customrecord_celigo_rt_export_flow",null,a,columns))||(a=[]);if(!k("customrecord_celigo_integration",a)){b=$$.createRecord("customrecord_celigo_rt_export_flow");b.setFieldValue("custrecord_celigo_rt_export_recordtype","customrecord_celigo_integration");b.setFieldTexts("custrecord_celigo_rt_export_eventtypes",["AfterSubmit"]);b.setFieldTexts("custrecord_celigo_rt_export_exectypes",["create","edit"]);b.setFieldTexts("custrecord_celigo_rt_export_env",["BETA","PRODUCTION","SANDBOX"]);
b.setFieldText("custrecord_celigo_rt_export_integration","SYSTEM");b.setFieldText("custrecord_celigo_rt_export_usecase","SYSTEM");b.setFieldValue("custrecord_celigo_rt_export_lic","T");b.setFieldValue("custrecord_celigo_rt_export_sid","Integrator (SYSTEM)");b.setFieldValue("custrecord_celigo_rt_export_system","T");b.setFieldValue("custrecord_celigo_rt_async","T");var c={async:!0,integration:"System",useCase:"System",celigo_classname:"Celigo.integrator.realtime.Export",connector:{celigo_classname:"Celigo.integrator.connectors.system.HttpConnector",
requestUrl:"https://api.integrator.io/netsuite/v1/integrations",requestHeader:{"Content-Type":"application/json"},method:"post"}};b.setFieldValue("custrecord_celigo_rt_export_conf",JSON.stringify(c));$$.submitRecord(b)}k("customrecord_celigo_connection",a)||(b=$$.createRecord("customrecord_celigo_rt_export_flow"),b.setFieldValue("custrecord_celigo_rt_export_recordtype","customrecord_celigo_connection"),b.setFieldTexts("custrecord_celigo_rt_export_eventtypes",["AfterSubmit"]),b.setFieldTexts("custrecord_celigo_rt_export_exectypes",
["create","edit"]),b.setFieldTexts("custrecord_celigo_rt_export_env",["BETA","PRODUCTION","SANDBOX"]),b.setFieldText("custrecord_celigo_rt_export_integration","SYSTEM"),b.setFieldText("custrecord_celigo_rt_export_usecase","SYSTEM"),b.setFieldValue("custrecord_celigo_rt_export_lic","T"),b.setFieldValue("custrecord_celigo_rt_export_sid","Integrator (SYSTEM)"),b.setFieldValue("custrecord_celigo_rt_export_system","T"),b.setFieldValue("custrecord_celigo_rt_async","T"),c={async:!0,integration:"System",
useCase:"System",celigo_classname:"Celigo.integrator.realtime.Export",connector:{celigo_classname:"Celigo.integrator.connectors.system.HttpConnector",requestUrl:"https://api.integrator.io/netsuite/v1/connections",requestHeader:{"Content-Type":"application/json"},method:"post"}},b.setFieldValue("custrecord_celigo_rt_export_conf",JSON.stringify(c)),$$.submitRecord(b));k("customrecord_celigo_batch_data_flow",a)||(b=$$.createRecord("customrecord_celigo_rt_export_flow"),b.setFieldValue("custrecord_celigo_rt_export_recordtype",
"customrecord_celigo_batch_data_flow"),b.setFieldTexts("custrecord_celigo_rt_export_eventtypes",["AfterSubmit"]),b.setFieldTexts("custrecord_celigo_rt_export_exectypes",["create","edit"]),b.setFieldTexts("custrecord_celigo_rt_export_env",["BETA","PRODUCTION","SANDBOX"]),b.setFieldText("custrecord_celigo_rt_export_integration","SYSTEM"),b.setFieldText("custrecord_celigo_rt_export_usecase","SYSTEM"),b.setFieldValue("custrecord_celigo_rt_export_lic","T"),b.setFieldValue("custrecord_celigo_rt_export_sid",
"Integrator (SYSTEM)"),b.setFieldValue("custrecord_celigo_rt_export_system","T"),b.setFieldValue("custrecord_celigo_rt_async","T"),c={async:!0,integration:"System",useCase:"System",celigo_classname:"Celigo.integrator.realtime.Export",connector:{celigo_classname:"Celigo.integrator.connectors.system.HttpConnector",requestUrl:"https://api.integrator.io/netsuite/v1/flows",requestHeader:{"Content-Type":"application/json"},method:"post"}},b.setFieldValue("custrecord_celigo_rt_export_conf",JSON.stringify(c)),
$$.submitRecord(b));k("customrecord_celigo_rt_export_flow",a)||(b=$$.createRecord("customrecord_celigo_rt_export_flow"),b.setFieldValue("custrecord_celigo_rt_export_recordtype","customrecord_celigo_rt_export_flow"),b.setFieldTexts("custrecord_celigo_rt_export_eventtypes",["AfterSubmit"]),b.setFieldTexts("custrecord_celigo_rt_export_exectypes",["create","edit"]),b.setFieldTexts("custrecord_celigo_rt_export_env",["BETA","PRODUCTION","SANDBOX"]),b.setFieldText("custrecord_celigo_rt_export_integration",
"SYSTEM"),b.setFieldText("custrecord_celigo_rt_export_usecase","SYSTEM"),b.setFieldValue("custrecord_celigo_rt_export_lic","T"),b.setFieldValue("custrecord_celigo_rt_export_sid","Integrator (SYSTEM)"),b.setFieldValue("custrecord_celigo_rt_export_system","T"),b.setFieldValue("custrecord_celigo_rt_async","T"),c={async:!0,integration:"System",useCase:"System",celigo_classname:"Celigo.integrator.realtime.Export",connector:{celigo_classname:"Celigo.integrator.connectors.system.HttpConnector",requestUrl:"https://api.integrator.io/netsuite/v1/flows",
requestHeader:{"Content-Type":"application/json"},method:"post"}},b.setFieldValue("custrecord_celigo_rt_export_conf",JSON.stringify(c)),$$.submitRecord(b));k("customrecord_celigo_rt_import_flow",a)||(b=$$.createRecord("customrecord_celigo_rt_export_flow"),b.setFieldValue("custrecord_celigo_rt_export_recordtype","customrecord_celigo_rt_import_flow"),b.setFieldTexts("custrecord_celigo_rt_export_eventtypes",["AfterSubmit"]),b.setFieldTexts("custrecord_celigo_rt_export_exectypes",["create","edit"]),b.setFieldTexts("custrecord_celigo_rt_export_env",
["BETA","PRODUCTION","SANDBOX"]),b.setFieldText("custrecord_celigo_rt_export_integration","SYSTEM"),b.setFieldText("custrecord_celigo_rt_export_usecase","SYSTEM"),b.setFieldValue("custrecord_celigo_rt_export_lic","T"),b.setFieldValue("custrecord_celigo_rt_export_sid","Integrator (SYSTEM)"),b.setFieldValue("custrecord_celigo_rt_export_system","T"),b.setFieldValue("custrecord_celigo_rt_async","T"),c={async:!0,integration:"System",useCase:"System",celigo_classname:"Celigo.integrator.realtime.Export",
connector:{celigo_classname:"Celigo.integrator.connectors.system.HttpConnector",requestUrl:"https://api.integrator.io/netsuite/v1/flows",requestHeader:{"Content-Type":"application/json"},method:"post"}},b.setFieldValue("custrecord_celigo_rt_export_conf",JSON.stringify(c)),$$.submitRecord(b))};this.checkAsyncRealtimeFlows=function(){for(var b=Celigo.integrator.realtime.ExportMetadata,a=$$.searchRecord(b.getFlowRecType(),null,new nlobjSearchFilter(b.getFlowFldExecutionContext(),null,"anyof","@NONE@"),
[new nlobjSearchColumn(b.getFlowFldConfig()),new nlobjSearchColumn(b.getFlowFldConfiguration())]),c=0;a&&c<a.length;c++){var e=a[c];try{var k=$$.loadRecord(b.getFlowRecType(),e.getId());k.setFieldValues(b.getFlowFldExecutionContext(),[1,2,3,4,5,6,7,8,9,10,11]);$$.submitRecord(k)}catch(f){$$.logExecution("error","async migration "+f.name,f.message)}}};this.beforeInstallOrUpdate=function(){if(!nlapiGetContext().getFeature("CUSTOMRECORDS")||!nlapiGetContext().getFeature("CUSTOMCODE")||!nlapiGetContext().getFeature("SERVERSIDESCRIPTING"))throw nlapiCreateError("CELIGO_REQUIRED_FEATURE",
'Features "Custom Records", "Client SuiteScript", and "Server SuiteScript" are required.');if(b.getProductName()){var a=nlapiSearchRecord("script",null,[new nlobjSearchFilter("scriptid",null,"is","customscript_celigo_sdk_bundle_installat")]);if(!a||!a.length)throw nlapiCreateError("CELIGO_REQUIRED_BUNDLE","Integrator bundle is required.");}};this.beforeInstall=function(b){this.beforeInstallOrUpdate(null,b)};this.afterInstall=function(b){this.afterInstallOrUpdate(null,b)};this.beforeUpdate=function(a,
c){this.beforeInstallOrUpdate(a,c);if(b.getProductName()){var e=nlapiLookupField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_int_ver");if(e!=="1.7.4")throw nlapiCreateError("CELIGO_INSTALL_ERROR","Lastest Integrator bundle required. Lastest version = 1.7.4. Installed version = "+e);}else if(c.indexOf("1.7.4")!==0)throw nlapiCreateError("CELIGO_INSTALL_ERROR","integratorBundleVersion mismatch : 1.7.4");};this.afterUpdate=function(a,c){this.afterInstallOrUpdate(a,c);this.checkAsyncRealtimeFlows();
if(!b.getProductName()){var e=$$.searchRecord("customrecord_celigo_rt_export_flow",null,[new nlobjSearchFilter("custrecord_celigo_rt_export_system",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_export_disabl",null,"is","F")]);if(e&&e.length===5)for(var k=0;e&&k<e.length;k++)$$.submitField("customrecord_celigo_rt_export_flow",e[k].getId(),"custrecord_celigo_rt_export_disabl","T");else if(e&&e.length>0)throw nlapiCreateError("CELIGO_UPDATE_ERROR","The number of System flows is not 5. This error is not critical. The update has completed successfully.");
}};this.beforeUninstall=function(){for(var a=b.getBundleInstallScriptIds(),c=[],e=nlapiSearchRecord("script",null,[new nlobjSearchFilter("scripttype",null,"anyof","BUNDLEINSTALLATION")],[new nlobjSearchColumn("scriptid")]),k=0;e&&k<e.length;k++){var f=a[e[k].getValue("scriptid").toLowerCase()];f&&c.push(f)}if(c.length>0)throw nlapiCreateError("CELIGO_UNINSTALL_ERROR","The Integrator bundle contains core records and scripts on which the Connector bundles operate. To uninstall the Integrator bundle, you need to first uninstall the following dependent bundles : "+
c.join(", "));};this.getProductName=function(){return null};this.getClosureFiles=function(){return null};this.getSolutionId=function(){return null};this.getBundleInstallScriptIds=function(){var a={customscript_celigo_mws_bundle_installat:"Amazon Seller Central Connector",customscript_celigo_amzscplus_bundle_ins:"Amazon Seller Central Connector Plus",customscript_celigo_ebay_bundle_install:"eBay Connector",customscript_celigo_etail_bundle_install:"eTail MarketReach",customscript_celigo_leanlog_bdle_ins:"LeanLogistics Connector",
customscript_celigo_lockbox_bundle_insta:"Lockbox Connector",customscript_celigo_mg_bundle_install:"Magento Connector",customscript_celigo_mg_plus_bundle_insta:" Magento Connector Plus",customscript_celigo_shipwire_bundle_inst:"Shipwire Connector",customscript_celigo_des_bundle_inst:"Descartes Connector",customscript_celigo_sfnc_bundle_install:"Salesforce Connector",customscript_cps_silverpop_bundle_instal:"Silverpop Connector"};if(b.getProductName()){if(!a[nlapiGetContext().getScriptId()])throw nlapiCreateError("CELIGO_INSTALL_ERROR",
"This is just a friendly reminder to inform the Integrator team to add the id of your bundle install script to this method.");}else return a};this.doV1Logic=!0;this.isDoV1Logic=function(){return!!this.doV1Logic};this.setDoV1Logic=function(b){this.doV1Logic=!!b};this.allowUpdate=!0;this.isAllowUpdate=function(){return!!this.allowUpdate};this.setAllowUpdate=function(b){this.allowUpdate=!!b};this.encryptConfigFiles=function(){return!1};this._forTestingOnly_getIntegratorBundleVersion=function(){return"1.7.4"};
this.performAdditionalModificationToDataFlowRecord=function(){}};Celigo.bundleinstall.integrator.IntegratorBundleManager.extend(Celigo.suitescript.bundleInstall.sdk.SdkBundleManager);$.namespace("Celigo.lang");Celigo.lang.RecordError=function(a){this._super(a);this.getRecordType=function(){return a.recordType};this.setRecordType=function(b){a.recordType=b};this.getRecordId=function(){return a.recordId};this.setRecordId=function(b){a.recordId=b};this.getDocumentIndex=function(){return a.documentIndex};
this.setDocumentIndex=function(b){a.documentIndex=b};this.getAllIndex=function(){return a.allIndex};this.setAllIndex=function(b){a.allIndex=b};this.getExternalId=function(){return a.externalId};this.setExternalId=function(b){a.externalId=b}};Celigo.lang.RecordError.className="Celigo.lang.RecordError";Celigo.lang.RecordError.extend(Celigo.lang.NetSuiteError);$.namespace("Celigo.integrator.batch");Celigo.integrator.batch.IntegrationBatchProcess=function(a){Celigo.integrator.batch.IntegrationBatchProcess.superclass.constructor.call(this,
a);var b=this,c=new Date(2012,3,18),e={integration:"integration",useCase:"useCase",integrationLoggerJobName:"integrationLoggerJobName",productName:"productName",scriptParams:"scriptParams",managerScriptId:"managerScriptId",managerDeploymentId:"managerDeploymentId"};if(a&&a.flowConfigFileId)Celigo.BatchProcess.staticState.reserved.flowConfigFileId=a.flowConfigFileId;this.getInitialScriptParameterValues=function(){return a.initialScriptParameterValues};this.getConfigurationFileID=function(){return Celigo.BatchProcess.getConfigurationFileID()};
this.getFlowConfiguration=function(){return Celigo.BatchProcess.getFlowConfiguration()};this.getProductName=function(){var a=b.getFlowConfiguration()[e.productName];a||(a="Integrator (Custom Integration)");return a};this.getScriptParameterId=function(){var a=b.getFlowConfiguration()[e.scriptParams];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the Script Parameters.");return a};this.getScheduleScriptId=function(){var a=b.getFlowConfiguration()[e.managerScriptId];
if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the Manager Script ID.");return a};this.getScheduleScriptDeploymentId=function(){if($$.getContext().getScriptId()===b.getScheduleScriptId())return $$.getContext().getDeploymentId();var a=b.getFlowConfiguration()[e.managerDeploymentId];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the Manager Deployment ID.");return a};this.getIntegrationName=function(){var a=b.getFlowConfiguration()[e.integration];
if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the integration.");return a};this.getUseCaseName=function(){var a=b.getFlowConfiguration()[e.useCase];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the Use Case.");return a};this.handleError=function(a){var c="Error Code: "+a.code+" | Error Message: "+a.message;$L.error(c,b.publicState.reserved.integrationLoggerID,this.getIntegrationName(),null,null,this.getUseCaseName());
$$.logExecution("ERROR","IntegrationBP - error",c+" | Stack Trace: "+a.stackTrace)};this.handleTopLevelError=function(a){var a=new Celigo.lang.NetSuiteError({error:a}),c="Error Code: "+a.getCode()+" | Error Message: "+a.getDetails();$$.logExecution("ERROR","IntegrationBP - top error",c+" | Stack Trace: "+a.getStackTrace());$L.error(c,b.publicState.reserved.integrationLoggerID,this.getIntegrationName(),null,null,this.getUseCaseName());a=b.getJobStatusLoggerInstance();a.setJobStatusLoggerID(b.publicState.reserved.statusLoggerID);
a.setFailedStatus();a.setFailureMessage("Please check integration logs for details.");a.setEndTime(new Date);a.logStatus()};this.childOfLoggingBPPreProcess=function(){b.flowSpecificPreProcess();logUntil("IntegrationBatchProcess - childOfLoggingBPPreProcess - method ends","",c)};this.getChildOfLoggingBPPreProcessPoints=function(){return b.getRequiredPoints(50,b.flowSpecificPreProcess,b.getFlowSpecificPreProcessPoints)};this.flowSpecificPreProcess=function(){};this.flowSpecificPreProcess.isNotImplemented=
!0;this.getFlowSpecificPreProcessPoints=function(){return b.getBatchProcessConstant("MAX_POINT")}};Celigo.integrator.batch.IntegrationBatchProcess.extend(Celigo.suitescript.scheduled.LoggingBatchProcess);Celigo.BatchProcess.getConfigurationFileID=function(){return Celigo.BatchProcess.staticState.reserved.flowConfigFileId};Celigo.BatchProcess.getFlowConfiguration=function(){if(!Celigo.BatchProcess.staticState.reserved.configData)Celigo.BatchProcess.staticState.reserved.configData=Celigo.integratorUtil.loadFlowConfiguration(Celigo.BatchProcess.getConfigurationFileID());
return Celigo.BatchProcess.staticState.reserved.configData};$.namespace("Celigo.core.integrator.batch");Celigo.core.integrator.batch.IntegrationBatchProcess=Celigo.integrator.batch.IntegrationBatchProcess;$.namespace("Celigo.integrator.batch.file");Celigo.integrator.batch.file.FileImport=function(a){Celigo.integrator.batch.file.FileImport.superclass.constructor.call(this,a);var b=this,c=new Date(2012,8,20),e={storeFileInNS:"storeFileInNS",importFolderId:"importFolderId",backupFolderId:"backupFolderId",
errorFolderId:"errorFolderId",useOriginalFileName:"useOriginalFileName",importFileType:"importFileType",netSuiteFileType:"netSuiteFileType",extension:"extension",mapper:"mapper"},f=a?a.keepInboundFile:null,g=a?a.testInboundFileId:null,h=null,j=null,i=function(){var a=b.publicState.reserved.integrationLoggerID;try{f||$$.deleteFile(b.publicState.reserved.importFileID)}catch(e){var e=Celigo.Error.convert(e),j="Error Code: "+(e.name||e.getCode())+" | ";j+="Error Message: "+(e.message||e.getDetails()+
". ");j+="Unable to delete file "+b.publicState.reserved.importFileID+". The integration will try to re-import the file if error is not cleared. Please contact support.";$L.error(j,a);return}try{logUntil("hasMoreFiles",function(){return b.publicState.reserved.hasMoreFiles},c),b.publicState.reserved.hasMoreFiles===!0&&Celigo.integratorUtil.scheduleWithNextAvailableRunner({flowConfig:'{"flowConfigFileId":"'+b.getConfigurationFileID()+'"}',flowState:""})}catch(i){i=Celigo.Error.convert(i),j="Error Code: "+
(i.name||i.getCode())+" | ",j+="Error Message: "+(i.message||i.getDetails()+". "),j+="Unable to reschedule script "+b.getScheduleScriptId()+" [Deployment Id: "+b.getScheduleScriptDeploymentId()+"]. Remaining files will not be imported by the integration. Please contact support.",$L.error(j,a)}};this.fileContents=null;this.getImportFolderId=function(a){a=a[e.importFolderId];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the import folder ID.");return a};
this.getBackupFolderId=function(a){a=a[e.backupFolderId];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the backup folder ID.");return a};this.getErrorFolderId=function(a){a=a[e.errorFolderId];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the error folder ID.");return a};this.getImportFileType=function(a){a=a[e.importFileType];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain "+
e.importFileType);return a};this.getMapperInstance=function(){if(!j){var a=b.getFlowConfiguration()[e.mapper];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the mapper class name.");a=eval(a);if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Mapper class does not exist.");j=new a}return j};this.getBackupFileId=function(){if(h)return h;throw $$.createError("CELIGO_INVALID_METHOD_CALL","FileImport - Cannot call getBackupFildId before the backup file is created.");
};this.getFileDataToImport=function(a){if(g)f=!0,b.publicState.reserved.importFileID=g,b.publicState.reserved.hasMoreFiles=!1;else{a=$.search({type:"file",filters:"folder.null.is."+b.getImportFolderId(a),maxResults:1E3});if(!a||a.length===0)return null;b.publicState.reserved.importFileID=a[0].getId();b.publicState.reserved.hasMoreFiles=a.length>1?!0:!1}a=$$.loadFile(b.publicState.reserved.importFileID);return{fileContents:a.getValue(),fileName:a.getName()}};this.getAllObjects=function(){return b.getAllObjectsHelper(b.getFlowConfiguration())};
this.getJobStatusLoggerType=function(){return"import"};this.flowSpecificPreProcess=function(){logUntil("FileImport - flowSpecificPreProcess - begin","",c);var a=b.getFlowConfiguration(),j=b.publicState.reserved.integrationLoggerID,f=null;try{f=b.getFileDataToImport(a);logUntil("fileData",function(){return f},c);if(!f){$L.info("No files are available for import.",j);b.publicState.reserved.noDataToImport=!0;return}b.fileContents=f.fileContents;b.originalFileName=f.fileName;logUntil("that.fileContents - flowSpecificPreProcess",
function(){return b.fileContents},c)}catch(i){throw i=Celigo.Error.convert(i),new Celigo.Error({name:"CELIGO_IMPORT_ERROR",message:"Error occurred while loading the import file",cause:i});}if(!b.fileContents){try{$$.deleteFile(b.publicState.reserved.importFileID)}catch(g){}throw $$.createError("CELIGO_IMPORT_ERROR","Cannot import a null or empty file.");}if(!a[e.storeFileInNS]||a[e.storeFileInNS]!=!1)try{var q=b.getImportFileType(a),r=f.fileName;logUntil("FileImport - flowSpecificPreProcess - fileName",
r,c);var p=r.lastIndexOf("."),w="";q[e.extension]?w=q[e.extension]:p!=-1&&(w=r.substr(p+1));var p=null,p=a[e.useOriginalFileName]&&a[e.useOriginalFileName]==!0&&r?r:"import_"+Celigo.dateUtil.convertDateToTimeStamp(new Date,"YYYYMMDDHHmmss")+"."+w,u=b.getBackupFolderId(a),s=$$.createFile(p,q[e.netSuiteFileType],b.fileContents);s.setFolder(u);h=$$.submitFile(s);logUntil("FileImport - flowSpecificPreProcess - backupFileId",h,c);var v=b.getJobStatusLoggerInstance();v.setJobStatusLoggerID(b.publicState.reserved.statusLoggerID);
v.setRecordFile(h);v.logStatus();logUntil("FileImport - flowSpecificPreProcess - backup file attached to job record","",c)}catch(t){t=Celigo.Error.convert(t),$L.error(t,j)}};this.getErrorCount=function(){return b.getErrors().length+b.publicState.reserved.numberOfMappingErrors};this.childOfLoggingBPPostProcess=function(){if(b.publicState.reserved.noDataToImport!==!0){var a=b.publicState.reserved.integrationLoggerID,c=b.getFlowConfiguration(),e=b.mapErrorsToFile(b.getErrors());if(b.getErrorCount()>
0){if(!e)throw $$.createError("CELIGO_CORE_ERROR","File Import - There is error(s) but the mapped error file is empty.");try{var j="import_failures_"+Celigo.dateUtil.convertDateToTimeStamp(new Date,"YYYYMMDDHHmmss")+"."+b.getErrorFileTypeAndExtension().extension,f=$$.createFile(j,b.getErrorFileTypeAndExtension().type,e);f.setFolder(b.getErrorFolderId(c));var i=$$.submitFile(f);$L.info("Uploaded import errors file to NetSuite: "+j+" Id: "+i,a);b.setErrorFileId(i)}catch(g){g=Celigo.Error.convert(g),
$L.error(g,a)}}b.connectionSpecificPostProcess(c)}};this.getChildOfLoggingBPPostProcessPoints=function(){return 100};this.mapErrorsToFile=function(){};this.getAllObjectsHelper=function(){throw $$.createError("DEVELOPER_ERROR","getAllObjectsHelper not implemented.");};this.getErrorFileTypeAndExtension=function(){throw $$.createError("DEVELOPER_ERROR","getErrorFileTypeAndExtension not implemented.");};this.connectionSpecificPostProcess=function(a){i(a)};this.preProcessFileContents=function(a){return a}};
Celigo.integrator.batch.file.FileImport.extend(Celigo.integrator.batch.IntegrationBatchProcess);$.namespace("Celigo.integrator.batch.file");Celigo.core.integrator.batch.file.FileImport=Celigo.integrator.batch.file.FileImport;$.namespace("Celigo.integrator.batch.file.flat");Celigo.integrator.batch.file.flat.BaseFlatFileImport=function(a){Celigo.integrator.batch.file.flat.BaseFlatFileImport.superclass.constructor.call(this,a);var b=this;this.logMappingErrors=function(a){for(var e=0;e<a.length;e++){var f=
a[e],g="Mapping Error on row: "+(f.rowIndex+1)+" | ";g+="Error Code: "+f.code+" | ";g+="Error Message: "+f.message;Celigo.Logger.error(g,b.publicState.reserved.integrationLoggerID)}};this.mapErrorsToFile=function(a){var e=[],f=b.publicState.reserved.failedToMap;$$.logExecution("DEBUG","failedToMap",f);for(var g=0;g<f.length;g++)e.push(f[g]);for(g=0;g<a.length;g++)f=a[g],e.push({rowIndex:f.object.rowIndex,code:f.code,message:f.message});$$.logExecution("DEBUG","modifiedErrorsArray",e);a=b.getMapperInstance();
g=b.getFlowConfiguration().mappingData;e=a.mapErrorsToExternal(b.publicState.reserved.twoDimArray,e,g);$$.logExecution("DEBUG","mappedContentsWithErrors",e);return e};this.getErrorFileTypeAndExtension=function(){return{type:"CSV",extension:"csv"}}};Celigo.integrator.batch.file.flat.BaseFlatFileImport.extend(Celigo.integrator.batch.file.FileImport);$.namespace("Celigo.core.integrator.batch.file.csv");Celigo.core.integrator.batch.file.csv.BaseCSVFileImport=Celigo.integrator.batch.file.flat.BaseFlatFileImport;
$.namespace("Celigo.integrator.batch.file.flat");Celigo.integrator.batch.file.flat.CsvMultiMappingFileImport=function(a){Celigo.integrator.batch.file.flat.CsvMultiMappingFileImport.superclass.constructor.call(this,a);var b=this;this.getAllObjectsHelper=function(a){if(b.publicState.reserved.noDataToImport===!0)return[];var e=b.getMapperInstance(),a=a.mappingData;b.fileContents=b.preProcessFileContents(b.fileContents);var f=e.fileToTwoDimArray(b.fileContents,a);$$.logExecution("DEBUG","fileContents",
b.fileContents);$$.logExecution("DEBUG","fileDataAsTwoDimArray",f);$$.logExecution("DEBUG","mappingJSObject",a);var g=b.getAllSubMappingNames(a);$$.logExecution("DEBUG","subMappingNamesArray",g);if(!g||g.length===0)throw $$.createError("MISSING_REQUIRED_PARAMETER","subMappingNamesArray is null or empty. No mappings found.");for(var h=[],j=0;j<g.length;j++)a.mappingToApply=g[j],h.push(e.mapExternalToJS(f,a));$$.logExecution("DEBUG","returnedObjects",h);for(var i=[],j=0;j<h.length;j++)for(var k=h[j].failedToMap,
e=0;e<k.length;e++)i.push(k[e]);b.logMappingErrors(i);b.publicState.reserved.twoDimArray=f;b.publicState.reserved.failedToMap=i;b.publicState.reserved.numberOfMappingErrors=i.length;f=[];i=h[0].jsObjects;for(j=0;j<i.length;j++){var k=i[j].rowIndex,l={};l.rowIndex=k;for(e=0;e<h.length;e++){var m=b.findReturnedObjectForIndex(h[e],k);if(!m){l=null;break}l[a[g[e]].nlobjRecordType]=m.jsObject}l&&f.push(l)}return f};this.findReturnedObjectForIndex=function(a,b){for(var f=null,g=a.jsObjects,h=0;h<g.length;h++)g[h].rowIndex===
b&&(f=g[h]);return f};this.getAllSubMappingNames=function(a){for(var b=[],f=_.keys(a),g=0;g<f.length;g++){var h=a[f[g]];(h.mappings||h.nlobjRecordType)&&b.push(f[g])}return b}};Celigo.integrator.batch.file.flat.CsvMultiMappingFileImport.extend(Celigo.integrator.batch.file.flat.BaseFlatFileImport);$.namespace("Celigo.core.integrator.batch.file.csv");Celigo.core.integrator.batch.file.csv.CSVMultiMappingFileImport=Celigo.integrator.batch.file.flat.CsvMultiMappingFileImport;$.namespace("Celigo.integrator.batch.file.flat");
Celigo.integrator.batch.file.flat.CsvMultiMappingFileImportRunnable=function(a){Celigo.integrator.batch.file.flat.CsvMultiMappingFileImportRunnable.superclass.constructor.call(this,a);var b=this;this.run=function(a,e,f,g){if(!e.reserved.numberOfRecordsImported)e.reserved.numberOfRecordsImported=0;e.reserved.numberOfRecordsImported+=b.runAndReturnNumberOfRecordsImported(a,e,f,g);return!0};this.runAndReturnNumberOfRecordsImported=function(){throw $$.createError("DEVELOPER_ERROR","runAndReturnNumberOfRecordsImported not implemented.");
}};Celigo.integrator.batch.file.flat.CsvMultiMappingFileImportRunnable.extend(Celigo.suitescript.scheduled.Runnable);$.namespace("Celigo.core.integrator.batch.file.csv");Celigo.core.integrator.batch.file.csv.CSVMultiMappingFileImportRunnable=Celigo.integrator.batch.file.flat.CsvMultiMappingFileImportRunnable;$.namespace("Celigo.integrator.batch.file.flat");Celigo.integrator.batch.file.flat.FixedWidthFileImport=function(a){Celigo.integrator.batch.file.flat.FixedWidthFileImport.superclass.constructor.call(this,
a);var b=this;this.getAllObjectsHelper=function(a){if(b.publicState.reserved.noDataToImport===!0)return[];var e=a.mappingData;logUntil("mappingJSObject",e,123456789);b.fileContents=b.preProcessFileContents(b.fileContents);logUntil("that.fileContents",b.fileContents,123456789);var f=b.getMapperInstance(),a=f.fileToTwoDimArray(b.fileContents,e);logUntil("mappingJSObject - after map 2 dim array",e,123456789);e=f.mapExternalToJS(a,e);logUntil("returnedObjects",e,123456789);f=e.failedToMap;b.logMappingErrors(f);
b.publicState.reserved.twoDimArray=a;b.publicState.reserved.failedToMap=f;b.publicState.reserved.numberOfMappingErrors=f.length;a=e.jsObjects;for(e=0;e<a.length;e++)f=a[e].jsObject,a[e][f.nlobjRecordType]=f,delete a[e].jsObject;return a};this.getMapperInstance=function(){return new Celigo.core.mapping.csv.FixedWidthMapper}};Celigo.integrator.batch.file.flat.FixedWidthFileImport.extend(Celigo.integrator.batch.file.flat.BaseFlatFileImport);$.namespace("Celigo.core.integrator.batch.file.csv");Celigo.core.integrator.batch.file.csv.FixedWidthMapperFileImport=
Celigo.integrator.batch.file.flat.FixedWidthFileImport;Celigo.core.integrator.batch.file.csv.FixedWidthMultiRecordMappingFileImport=Celigo.integrator.batch.file.flat.FixedWidthFileImport;Celigo.core.integrator.batch.file.csv.FixedWidthMultiLineMultiMappingFileImport=Celigo.integrator.batch.file.flat.FixedWidthFileImport;$.namespace("Celigo.integrator.batch.file.poller");Celigo.integrator.batch.file.poller.BatchFilePoller=function(a){Celigo.integrator.batch.file.poller.BatchFilePoller.superclass.constructor.call(this,
a);this.publicState.invokedFromIntegratorManagerSuitelet=a.invokedFromIntegratorManagerSuitelet;this.getAllObjects=function(){if(a.flowConfigFileId)return[{flowConfigFileId:a.flowConfigFileId,ignoreScheduleCheck:!0}];var b=Celigo.integratorUtil.getAllEnabledFlowConfigFileIds();$$.logExecution("DEBUG","FTPManager - allEnabledFlowConfigFileIds",b);return _.map(b,function(a){return{flowConfigFileId:a}})};this.handleError=function(a){$$.logExecution("ERROR",a.code,a.message)};this.getListOfRunnableClassnames=
function(){return["Celigo.integrator.batch.file.poller.BatchFilePollerRunnable"]};this.getScriptParameterId=function(){return"custscript_celigo_ftp_manager_sta"};this.getScheduleScriptId=function(){return"customscript_celigo_ftp_manager"};this.getScheduleScriptDeploymentId=function(){return"customdeploy_celigo_ftp_manager_demand"}};Celigo.integrator.batch.file.poller.BatchFilePoller.extend(Celigo.suitescript.scheduled.BatchProcess);Celigo.integrator.batch.file.poller.BatchFilePoller.scheduled=function(){var a=
$$.getContext().getSetting("SCRIPT","custscript_celigo_ftp_manager_sta"),a=a?JSON.parse(a):{},a=a.flowConfigFileId||"all";(new Celigo.integrator.batch.file.poller.BatchFilePoller({flowConfigFileId:a==="all"?void 0:a})).start()};Celigo.integrator.batch.file.poller.BatchFilePoller.suitelet=function(a,b){$$.setToTrackExecutionLogs();var c=a.getParameter("flowConfigFileId");if(c){var e=a.getParameter("invokedFromIntegratorManagerSuitelet")==="T";log("BatchFilePoller - invokedFromIntegratorManagerSuitelet",
e);c=new Celigo.integrator.batch.file.poller.BatchFilePoller({flowConfigFileId:c==="all"?void 0:c,invokedFromIntegratorManagerSuitelet:e});c.start();log("BatchFilePoller - fileToProcessCount",JSON.stringify(c.publicState.fileToProcessCount));if(e)return{success:!0,fileToProcessCountByFlowConfigFileId:c.publicState.fileToProcessCount};else c.isScriptRescheduled()?b.write('<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId:<br />\nTo run a specific flow, specify the file id of the config file. This will ignore the flow schedule.<br />\nTo run all flows, set this parameter to "all". This will respect the flow schedule.</p><p>Usage limit reached, Rescheduled. <a href="'+
$$.resolveURL("TASKLINK","LIST_SCRIPTSTATUS")+'">Go to Script Status.</a></p>'):b.write('<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId:<br />\nTo run a specific flow, specify the file id of the config file. This will ignore the flow schedule.<br />\nTo run all flows, set this parameter to "all". This will respect the flow schedule.</p><p>Execution Completed, Not Rescheduled. If you are running an import flow and there are file(s) to be imported, the flow will be processed by the Integration Manager scheduled script. <a href="'+
$$.resolveURL("TASKLINK","LIST_SCRIPTSTATUS")+'">Go to Script Status.</a></p>'),b.write($$.outputTrackedExecutionLogsAsHTMLTable())}else b.write('<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId:<br />\nTo run a specific flow, specify the file id of the config file. This will ignore the flow schedule.<br />\nTo run all flows, set this parameter to "all". This will respect the flow schedule.</p>Missing parameter: flowConfigFileId')};$.namespace("Celigo.connectors.poller");
Celigo.connectors.poller.BatchFilePoller=Celigo.integrator.batch.file.poller.BatchFilePoller;$.namespace("Celigo.integrator.batch.file.poller");Celigo.integrator.batch.file.poller.BatchFilePollerRunnable=function(a){Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.superclass.constructor.call(this,a);var b=_.extend(Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.constants,{INTEGRATION:"integration",USECASE:"useCase",IMPORT_FILE_TYPE:"importFileType"});getIntegrationName=function(a){a=
a[b.INTEGRATION];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the integration.");return a};getUseCaseName=function(a){a=a[b.USECASE];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the use case.");return a};getIntegrationLoggerNewJobName=function(a){return getIntegrationName(a)+" - "+getUseCaseName(a)};this.getConst=function(a){return b[a]};this.getImportFileType=function(a){a=a[b.IMPORT_FILE_TYPE];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER",
"Congifuration file doesn't contain "+b.IMPORT_FILE_TYPE);return a};this.createNewImportJobRecordAndLogError=function(a,b){var f=$L.newJob(getIntegrationLoggerNewJobName(b),getIntegrationName(b));$L.error(CeligoError.format(a,"Failed to process download."),f);var g=new Celigo.JobStatusLogger;g.convertToImportStatusLogger();g.setFailedStatus();g.setIntegration(getIntegrationName(b));g.setUseCase(getUseCaseName(b));g.setIntegrationLog(f);g.setStartTime(new Date);g.setEndTime(new Date);g.setNumberOfErrors(1);
g.setNumberOfSuccesses(0);g.logStatus()};this.getPoints=function(){return 200};this.run=function(a,b,f){var g=a.flowConfigFileId;log("BatchFilePollerRunnable - flowConfigFileId",g);if(!b.fileToProcessCount)b.fileToProcessCount={};b.fileToProcessCount[g]||(b.fileToProcessCount[g]=0);g=Celigo.integratorUtil.loadFlowConfiguration(g);b.flowConfigObject=g;log("BatchFilePollerRunnable - flowConfigObject",JSON.stringify(g));try{if(!a.ignoreScheduleCheck&&!Celigo.integratorUtil.shouldFlowRunNow(g)){log("BatchFilePollerRunnable - schedule check failed, skipped",
a.flowConfigFileId);return}log("BatchFilePollerRunnable - schedule check passed",a.flowConfigFileId)}catch(h){throw h=Celigo.Error.convert(h),log("BatchFilePollerRunnable - schedule check errored, skipped",a.flowConfigFileId),h;}(a=Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.isBatchFilePollerCompatibleFlowConfigObject(g))&&f.unshift(a)}};Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.extend(Celigo.suitescript.scheduled.Runnable);Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.constants=
{IMPORT_FOLDER_ID:"importFolderId"};Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.getImportFolderId=function(a){return a[Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.constants.IMPORT_FOLDER_ID]};Celigo.integrator.batch.file.poller.BatchFilePollerRunnable.isBatchFilePollerCompatibleFlowConfigObject=function(a){if(!Celigo.core.integrator.util.IntegratorUtil.isImportFlow(a))return log("BatchFilePollerRunnable - not import flow","return false"),!1;log("BatchFilePollerRunnable - import flow",
"continue");return Celigo.connectors.poller.ftp.FtpBatchFilePollerRunnable.isFtpFlowConfigObject(a)?(log("BatchFilePollerRunnable - ftp import flow","return true"),"Celigo.connectors.poller.ftp.FtpBatchFilePollerRunnable"):(log("BatchFilePollerRunnable - not supported import flow","return false"),!1)};$.namespace("Celigo.connectors.poller");Celigo.connectors.poller.BatchFilePollerRunnable=Celigo.integrator.batch.file.poller.BatchFilePollerRunnable;$.namespace("Celigo.integrator.batch.file.poller.ftp");
Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable=function(a){Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.superclass.constructor.call(this,a);var b=this,c=_.extend(Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.constants,{});this.getPoints=function(){return 200};this.run=function(a,f,g,h){var j=f.flowConfigObject;log("FtpBatchFilePollerRunnable - flowConfigObject",JSON.stringify(j));var i=null;try{var k=b.getImportFileType(j);k[b.getConst("IMPORT_FOLDER_ID")]=
Celigo.connectors.poller.BatchFilePollerRunnable.getImportFolderId(j);var l=j[c.FTP_CONFIG],i=(new Celigo.connectors.ftp.FtpConnector).download(k,l).responseData}catch(m){throw m=Celigo.Error.convert(m),b.createNewImportJobRecordAndLogError(m,j),m;}log("FtpBatchFilePollerRunnable - downloadResponse",JSON.stringify(i));i.hasFile?(f.fileToProcessCount[a.flowConfigFileId]+=1,i.hasMoreFiles?(g.unshift("Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable"),log("FtpBatchFilePollerRunnable - hasMoreFiles T - actionQueue",
JSON.stringify(g))):f.invokedFromIntegratorManagerSuitelet?log("FtpBatchFilePollerRunnable - invokedFromIntegratorManagerSuitelet T - did not call runner",""):(Celigo.integratorUtil.scheduleWithNextAvailableRunner({flowConfig:'{"flowConfigFileId":"'+a.flowConfigFileId+'"}',flowState:Celigo.ScriptManager.Test.getTestResultId()?JSON.stringify({testResultId:Celigo.ScriptManager.Test.getTestResultId()}):""}),h.doNotTellTestFrameworkToFinishBecauseAnotherScriptInvoked(),log("FtpBatchFilePollerRunnable - hasMoreFiles F - called runner",
""))):log("FtpBatchFilePollerRunnable - hasFile F - returned, did not call runner","")}};Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.extend(Celigo.integrator.batch.file.poller.BatchFilePollerRunnable);Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.constants={FTP_CONFIG:"ftpConfig"};Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.getFtpConfigFromFlowConfigObject=function(a){a=a[Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.constants.FTP_CONFIG];
if(!a)throw $$.createError("CELIGO_MISSING_CONFIG","Configuration file does not contain ftpConfig.");return a};Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.isFtpFlowConfigObject=function(a){try{return Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable.getFtpConfigFromFlowConfigObject(a),!0}catch(b){b=Celigo.Error.convert(b);if(b.getCode&&b.getCode()==="CELIGO_MISSING_CONFIG")return!1;throw b;}};$.namespace("Celigo.connectors.poller.ftp");Celigo.connectors.poller.ftp.FtpBatchFilePollerRunnable=
Celigo.integrator.batch.file.poller.ftp.FtpBatchFilePollerRunnable;$.namespace("Celigo.integrator.batch.file.xml");Celigo.integrator.batch.file.xml.XmlFileImport=function(a){Celigo.integrator.batch.file.xml.XmlFileImport.superclass.constructor.call(this,a);var b=this,c=new Date(2012,8,20);this.getAllObjectsHelper=function(a){logUntil("XMLFileImport - getAllObjectsHelper - method starts","",c);if(b.publicState.reserved.noDataToImport===!0)return[];var f=b.getMapperInstance(),g=a.mappingData,h=b.preProcessFileContentsAndReturnXMLDocument(b.fileContents);
logUntil("XMLFileImport - getAllObjectsHelper - file content converted to XML doc","",c);_.isArray(g)||(g=[g]);for(var a={},j={},i=0;g&&i<g.length;i++){logUntil("XMLFileImport - getAllObjectsHelper - mappingData["+i+"]",g[i],c);var k=f.mapExternalToJS(h,g[i]);a[k.identifier]=k.jsObjects;j[k.identifier]=k.failedToMap;b.publicState.reserved.numberOfMappingErrors=(b.publicState.reserved.numberOfMappingErrors||0)+k.failedToMap.length}logUntil("XMLFileImport - getAllObjectsHelper - logging mapping errors",
"",c);b.logMappingErrors(j);b.publicState.reserved.failedToMap=j;logUntil("XMLFileImport - getAllObjectsHelper - mapping errors logged","",c);for(i in a)for(f=0;f<a[i].length;f++)a[i][f]=Celigo.oop.Collection.makeElement(a[i][f]);a=new Celigo.oop.Collection(a);logUntil("XMLFileImport - getAllObjectsHelper - method ends","",c);return a};this.preProcessFileContentsAndReturnXMLDocument=function(a){return $$.stringToXML(b.preProcessFileContents(a))};this.logMappingErrors=function(a){for(var c in a)for(var g=
0;g<a[c].length;g++){var h=a[c][g],j="Mapping Error at node: "+(h.nodeIndex+1)+" | ";j+="Error Code: "+h.code+" | ";j+="Error Message: "+h.message;Celigo.Logger.error(j,b.publicState.reserved.integrationLoggerID)}};this.mapErrorsToFile=function(a){for(var c=b.publicState.reserved.failedToMap,g=0;g<a.length;g++)c[a[g].identifier].push({nodeIndex:a[g].object.nodeIndex,code:a[g].code,message:a[g].message});var a=b.getMapperInstance(),h=b.getFlowConfiguration().mappingData;_.isArray(h)||(h=[h]);for(var j=
{},g=0;h&&g<h.length;g++)j[a.getIdentifier(h[g])]=g;var g=b.preProcessFileContentsAndReturnXMLDocument(b.fileContents),i;for(i in c)a.mapErrorsToExternal(g,c[i],h[j[i]]);return $$.xmlToString(g)};this.getErrorFileTypeAndExtension=function(){return{type:"XMLDOC",extension:"xml"}};this.handleError=function(a){a.identifier=b.publicState.reserved.objects.getCurrentObjectIndex()[0];$L.error("Error Code: "+a.code+" | Error Message: "+a.message+" | Stack Trace: "+a.stackTrace,b.publicState.reserved.integrationLoggerID)}};
Celigo.integrator.batch.file.xml.XmlFileImport.extend(Celigo.integrator.batch.file.FileImport);$.namespace("Celigo.core.integrator.batch.file.xml");Celigo.core.integrator.batch.file.xml.XMLFileImport=Celigo.integrator.batch.file.xml.XmlFileImport;$.namespace("Celigo.integrator.batch.manager.");Celigo.integrator.batch.manager.IntegratorBatchManager=function(a){Celigo.integrator.batch.manager.IntegratorBatchManager.superclass.constructor.call(this,a);var b=this,c=new Date(2013,7,31),e=null,f=function(a,
b,c){var e=b.implFileIds;log("lib file ids",Celigo.JSON.stringify(e));for(var f=0;e&&f<e.length;f++)log("loading lib file",e[f]),eval($$.loadFile(e[f]).getValue());b=b.flowBatchProcess;e=null;log("flowBatchProcess",b);if(!b)throw $$.createError("MISSING_PARAMETER","Flow Configuration file "+a+" does not contain required field: flowBatchProcess");b=eval(b);try{e=new b(c)}catch(g){throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"CELIGO_INVALID_FLOW_BATCH_PROCESS",message:'The "flowBatchProcess" property in your config file must contain the fully qualified classname (i.e. constructor function) of your flow implementation class. A value for this property was found, but it was not the name of a valid constructor function.',
cause:g});}return e},g=function(a){a.processSavedSearchConfig=function(a){_.each(a,function(a){a.additionalColumns=["internalid.null.count"]});return a};a=a.getAllObjectsBehavior();a.noDateCreatedColumn();var a=a.execute(),b={};if(a.completed)for(var c=a.data.getNextObject();c;){var e=a.data.getCurrentObjectIndex()[0];b[e]=c[0].internalid;c=a.data.getNextObject()}else throw $$.createError("CELIGO_UNEXPECTED_ERROR","IntegratorManager - runnerRun - expecting behavior to complete.");return b};this.publicState.doNotSerialize.silent=
!0;this.getParameterIdForTimeEmulator=function(){return""};this.getAllObjects=function(){var a;log("IntegratorManager - getManagerConfiguration",JSON.stringify(b.getManagerConfiguration()));log("IntegratorManager - getScriptParameterId",b.getScriptParameterId());log("IntegratorManager - getFolderPathToFlowConfigs",b.getFolderPathToFlowConfigs());log("IntegratorManager - getFlowConfigParameterId",b.getFlowConfigParameterId());var c=b.getFolderPathToFlowConfigs().split("/"),e,f="@NONE@";for(a=0;c&&
a<c.length;a++)if((e=$.search("folder",null,[new nlobjSearchFilter("name",null,"is",c[a]),new nlobjSearchFilter("parent",null,"anyof",f)]))&&e.length>0)f=e[0].getId();else return log("Integrator Flow Configuration not found"),[];log("folderId",f);c=[];e=$.search("file",null,[new nlobjSearchFilter("folder",null,"is",f)],[new nlobjSearchColumn("folder")]);for(a=0;e&&a<e.length;a++)e[a].getValue("folder")===f&&(log("flow config file",e[a].getId()),c.push({flowConfigFileId:e[a].getId()}));log("IntegratorManager - flowConfigFileIds found",
JSON.stringify(c));return c};this.scheduledScriptEntryPoint=function(){var a=$$.getContext().getSetting("SCRIPT",b.getFlowConfigParameterId())||"";logUntil("IntegratorManager - scheduledScriptEntryPoint - configParam",a,c);if(a)b.runnerRun(a);else if($$.getContext().getCompany()==="TSTDRV841073")$$.logExecution("AUDIT","script doesn't run in Storm");else{try{var e,f;$$.getContext().getScriptId()=="customscript_celigo_integrator_manager"?(e="custscript_celigo_global_bm_sch_lastrun",f="custscript_celigo_global_bm_sch_tick"):
(e=this.getParameterIdForTimeEmulator(),f="thisisfoo");if(e&&f){var k=new Celigo.integrator.scheduling.PersistenceHandler("",""),g=k.getLastRunTimestamp(),m=k.getTick();m||(m=9E5);var n;g===void 0||g===null||(g===""||g.trim&&g.trim()===""||isNaN(+g)||"Invalid Date"===(new Date(+g)).toString()?(n=new Celigo.integrator.scheduling.TimeEmulator(new Date,m),n.roundBackward()):(n=new Celigo.integrator.scheduling.TimeEmulator(new Date(+g),m),n.roundForward(),+g===n.getAnchor().getTime()&&n.fastforward()))}}catch(o){$$.logExecution("audit",
"warning : failed to emulate time, actual time will be used",Celigo.Error.format(o))}n=void 0;a=new Date;$$.logExecution("audit","scheduling flows with time",""+a);k=!1;(new Date).getTime()-a.getTime()>18E5&&(k=!0,$$.logExecution("audit","scheduler is behind time","reschedule"));this.cronDate=new Date(a.getTime());b.start();k&&(k=$$.scheduleScript($$.getContext().getScriptId()),k!=="QUEUED"?$$.logExecution("error","failed to reschedule batch manager","wait for next run"):$$.logExecution("audit","successfully scheduled another scheduler"))}};
this.suiteletScriptEntryPoint=function(a,c){try{var e=a.getParameter("method");if(e)if(e==="startFlow")b.startFlow(a,c,"T");else if(e==="getRecordCountToBeProcessed")b.getRecordCountToBeProcessed(a,c);else if(e==="getFlowStatus")b.getFlowStatus(a,c);else throw $$.createError("CELIGO_UNKNOWN_METHOD","Integration Manager - method "+e+" is not supported");else b.startFlow(a,c,a.getParameter("delegate"),!0)}catch(f){$.handleError(f),c.write(JSON.stringify({success:!1,message:CeligoError.format(f)}))}};
this.startFlow=function(a,c,e,f){var g=a.getParameter("isTestingManager"),m=a.getParameter("flowConfigFileId"),n=a.getParameter("keepInboundFile"),o=a.getParameter("testInboundFileId"),q=Celigo.JSON.parse(a.getParameter("exportTestDataFilters"));if(!m&&!g)c.write('<h4 style="text-decoration:underline;">Usage:</h4>\n<p>Export Flow: to run an export flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5859</br>\n</br>\nImport Flow: to run an import flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860</br>\nOptionally, you can also use the keepInboundFile parameter to prevent the script from deleting your inbound file.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860&keepInboundFile=T</p>\n<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId: to run a specific flow, specify the file id of the config file.</br>\nkeepInboundFile: for file import flow, to keep the inbound file during development, set this param to true.</br>\ntestInboundFileId: for file import flow, put the inbound file id here (this is useful so that inbound file can be edited easily with Celigo IDE).</br>\nexportTestDataFilters: for export flow, during development, we may want to debug on a small set of record using test data filters on the saved searches (this param need to be properly escaped using encodeURIComponent(Celigo.JSON.stringify())).</br>\nisTestingManager: set this to T to run the integration manager (to test if it invokes the flow correctly).</br>\ndelegate: set this to F to NOT skip the suitelet and invoke the flow to run on the Integration Manager scheduled script.</p>Missing parameter: flowConfigFileId or isTestingManager');
else{var r=a=null;g==="T"?(a=b,a.start()):(g=b.runnerRun(Celigo.JSON.stringify({flowConfigFileId:m,keepInboundFile:n,exportTestDataFilters:q,testInboundFileId:o,delegate:e!=="F"})),a=g.batchProcess,r=g.jsonData);f?e!=="F"?c.write('<h4 style="text-decoration:underline;">Usage:</h4>\n<p>Export Flow: to run an export flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5859</br>\n</br>\nImport Flow: to run an import flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860</br>\nOptionally, you can also use the keepInboundFile parameter to prevent the script from deleting your inbound file.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860&keepInboundFile=T</p>\n<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId: to run a specific flow, specify the file id of the config file.</br>\nkeepInboundFile: for file import flow, to keep the inbound file during development, set this param to true.</br>\ntestInboundFileId: for file import flow, put the inbound file id here (this is useful so that inbound file can be edited easily with Celigo IDE).</br>\nexportTestDataFilters: for export flow, during development, we may want to debug on a small set of record using test data filters on the saved searches (this param need to be properly escaped using encodeURIComponent(Celigo.JSON.stringify())).</br>\nisTestingManager: set this to T to run the integration manager (to test if it invokes the flow correctly).</br>\ndelegate: set this to F to NOT skip the suitelet and invoke the flow to run on the Integration Manager scheduled script.</p>Delegated. <a href="'+
$$.resolveURL("TASKLINK","LIST_SCRIPTSTATUS")+'">Go to Script Status.</a><br/>Data: '+JSON.stringify(r)):a.isScriptRescheduled()?c.write('<h4 style="text-decoration:underline;">Usage:</h4>\n<p>Export Flow: to run an export flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5859</br>\n</br>\nImport Flow: to run an import flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860</br>\nOptionally, you can also use the keepInboundFile parameter to prevent the script from deleting your inbound file.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860&keepInboundFile=T</p>\n<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId: to run a specific flow, specify the file id of the config file.</br>\nkeepInboundFile: for file import flow, to keep the inbound file during development, set this param to true.</br>\ntestInboundFileId: for file import flow, put the inbound file id here (this is useful so that inbound file can be edited easily with Celigo IDE).</br>\nexportTestDataFilters: for export flow, during development, we may want to debug on a small set of record using test data filters on the saved searches (this param need to be properly escaped using encodeURIComponent(Celigo.JSON.stringify())).</br>\nisTestingManager: set this to T to run the integration manager (to test if it invokes the flow correctly).</br>\ndelegate: set this to F to NOT skip the suitelet and invoke the flow to run on the Integration Manager scheduled script.</p>Usage limit reached, Rescheduled. <a href="'+
$$.resolveURL("TASKLINK","LIST_SCRIPTSTATUS")+'">Go to Script Status.</a>'):c.write('<h4 style="text-decoration:underline;">Usage:</h4>\n<p>Export Flow: to run an export flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5859</br>\n</br>\nImport Flow: to run an import flow, you just need to specify the file id of the config file in the File Cabinet.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860</br>\nOptionally, you can also use the keepInboundFile parameter to prevent the script from deleting your inbound file.</br>\nFor example, https://system.netsuite.com/app/site/hosting/scriptlet.nl?script=165&deploy=1&flowConfigFileId=5860&keepInboundFile=T</p>\n<h4 style="text-decoration:underline;">Supported Parameters:</h4>\n<p>flowConfigFileId: to run a specific flow, specify the file id of the config file.</br>\nkeepInboundFile: for file import flow, to keep the inbound file during development, set this param to true.</br>\ntestInboundFileId: for file import flow, put the inbound file id here (this is useful so that inbound file can be edited easily with Celigo IDE).</br>\nexportTestDataFilters: for export flow, during development, we may want to debug on a small set of record using test data filters on the saved searches (this param need to be properly escaped using encodeURIComponent(Celigo.JSON.stringify())).</br>\nisTestingManager: set this to T to run the integration manager (to test if it invokes the flow correctly).</br>\ndelegate: set this to F to NOT skip the suitelet and invoke the flow to run on the Integration Manager scheduled script.</p>Execution Completed, Not Rescheduled.'):
c.write(JSON.stringify({success:!0,jsonData:r}))}};this.getRecordCountToBeProcessed=function(a,b){var c=a.getParameter("flowConfigFileId");if(!c)throw $$.createError("Missing parameter: flowConfigFileId");var e=Celigo.integratorUtil.loadFlowConfiguration(c),c=f(c,e,{flowConfigFileId:c}),l={};if(Celigo.core.integrator.util.IntegratorUtil.isExportFlow(e))l.numberOfRecordsToBeProcessedBySavedSearch=g(c);b.write(JSON.stringify({success:!0,jsonData:l}))};this.getFlowStatus=function(a,b){var c=a.getParameter("jobRecordId");
if(!c)throw $$.createError("Missing parameter: jobRecordId");var e={},c=new $R({nlobjRecordType:"customrecord_celigo_job_export",id:c});e.jobRecord=c.toJSON();c=c.get("custrecord_celigo_je_log");e.errorLogs=c?Celigo.Logger.getErrorList(c):[];b.write(JSON.stringify({success:!0,jsonData:e}))};this.isEnvironmentAllowed=function(a,b){if(!a)throw new CeligoError({message:"nlapiContext did not identify an environment"});b||(b="PRODUCTION");return a.toUpperCase()===b.toUpperCase()};this.runnerRun=function(a){var e=
Celigo.JSON.parse(a),i=e.flowConfigFileId,k=Celigo.integratorUtil.loadFlowConfiguration(i);log("runnerRun - flowConfigParamString",a);log("runnerRun - flowConfigObject",JSON.stringify(k));var l=$$.getContext().getEnvironment(),m=!0;l==="SANDBOX"&&k.ignoreEnvironmentAfterRefreshAndRunInSandbox?m=!1:l==="BETA"&&k.ignoreEnvironmentAfterRefreshAndRunInBeta&&(m=!1);if(m&&!this.isEnvironmentAllowed(l,k.environment||"PRODUCTION"))log("INFO","Flow "+i+" skipped because it is not allowed to run in this NetSuite environment.");
else{l={};a&&(l[b.getFlowConfigParameterId()]=a);a={flowConfigFileId:i,initialScriptParameterValues:l,exportTestDataFilters:e.exportTestDataFilters,keepInboundFile:e.keepInboundFile,testInboundFileId:e.testInboundFileId,jobRecordId:e.jobRecordId,integrationLogId:e.integrationLogId};l=f(i,k,a);m={};if(e.delegate){logUntil("IntegratorManager - runnerRun - delegate",e.delegate,c);e=!1;if(Celigo.connectors.poller.BatchFilePollerRunnable.isBatchFilePollerCompatibleFlowConfigObject(k)){var n=Celigo.connectors.poller.BatchFilePoller.suitelet({getParameter:function(a){return{flowConfigFileId:i,
invokedFromIntegratorManagerSuitelet:"T"}[a]}}).fileToProcessCountByFlowConfigFileId[i];logUntil("IntegratorManager - runnerRun - fileToProcessCount",n,c);(m.fileToProcessCount=n)||(e=!0)}if(!e){n=e=null;n=l.initializeJobRecord();e=n.jobRecordId;n=n.integrationLogId;m.jobRecordId=e;if(Celigo.core.integrator.util.IntegratorUtil.isExportFlow(k))m.numberOfRecordsToBeProcessedBySavedSearch=g(l);a=_.extend(a,{jobRecordId:e,integrationLogId:n});if(!Celigo.integratorUtil.scheduleWithNextAvailableRunner({flowConfig:Celigo.JSON.stringify(a)}))throw $$.createError("CELIGO_FAILED_TO_RUN_FLOW",
"Integrator Manager failed to find an available runner deployment to run the flow "+i);}}else if(l.start(),k.nextFlowId)return Celigo.BatchProcess.staticState.reserved.configData=null,this.runnerRun(JSON.stringify({flowConfigFileId:k.nextFlowId}));return{batchProcess:l,jsonData:m}}};this.getListOfRunnableClassnames=function(){return["Celigo.integrator.batch.manager.IntegratorBatchManagerRunnable"]};this.getManagerConfiguration=function(){e||(e=Celigo.integratorUtil.loadManagerConfiguration(b.getProductName()));
return e};this.getScriptParameterId=function(){return b.getManagerConfiguration().managerScriptParam};this.getFolderPathToFlowConfigs=function(){return b.getManagerConfiguration().folderPathToFlowConfigs};this.getFlowConfigParameterId=function(){return b.getManagerConfiguration().flowConfigParameterId};this.getProductName=function(){return null}};Celigo.integrator.batch.manager.IntegratorBatchManager.extend(Celigo.suitescript.scheduled.BatchProcess);$.namespace("Celigo.scheduled");Celigo.scheduled.IntegratorManager=
Celigo.integrator.batch.manager.IntegratorBatchManager;$.namespace("Celigo.integrator.batch.manager");Celigo.integrator.batch.manager.IntegratorBatchManagerRunnable=function(a){Celigo.integrator.batch.manager.IntegratorBatchManagerRunnable.superclass.constructor.call(this,a);this.getPoints=function(){return 200};this.run=function(a,c,e,f){if(a&&a.flowConfigFileId)if(a=a.flowConfigFileId,log("flowConfigFileId",a),c=Celigo.integratorUtil.loadFlowConfiguration(a),Celigo.connectors.poller.BatchFilePollerRunnable.isBatchFilePollerCompatibleFlowConfigObject(c))log("isBatchFilePollerCompatibleFlowConfigObject = T",
"skipped");else if(Celigo.integratorUtil.shouldFlowRunNow(c,f.cronDate)){if(!Celigo.integratorUtil.scheduleWithNextAvailableRunner({flowConfig:Celigo.JSON.stringify({flowConfigFileId:a})}))throw $$.createError("FAILED_TO_RUN_FLOW","Integrator Manager failed to find an available runner deployment to run the flow "+a);log("flow runner invoked to run flow "+a)}else log("shouldFlowRunNow = F","skipped")}};Celigo.integrator.batch.manager.IntegratorBatchManagerRunnable.extend(Celigo.suitescript.scheduled.Runnable);
$.namespace("Celigo.scheduled");Celigo.scheduled.IntegratorManagerRunnable=Celigo.integrator.batch.manager.IntegratorBatchManagerRunnable;$.namespace("Celigo.integrator.batch");Celigo.integrator.batch.DefaultImport=function(a){Celigo.integrator.batch.DefaultImport.superclass.constructor.call(this,a);var b=this;this.getListOfRunnableClassnames=function(){return["Celigo.integrator.batch.DefaultImportRunnable"]};this.getMapperInstance=function(){if(!b.getFlowConfiguration().mappingData)throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"INVALID_IMPORT_FLOW_CONFIGURATION",
message:"The configuration file describing this import data flow does not provide a Mapping, please contact Celigo Support: (config.mappingData is empty)."});return _.isNumber(b.getFlowConfiguration().mappingData.keyColumn)||_.isString(b.getFlowConfiguration().mappingData.keyColumn)?new Celigo.core.mapping.csv.MultiLineCSVMapper:new Celigo.core.mapping.csv.StandardCSVMapper}};Celigo.integrator.batch.DefaultImport.extend(Celigo.integrator.batch.file.flat.CsvMultiMappingFileImport);$.namespace("Celigo.integrator.batch");
Celigo.integrator.batch.DefaultImportRunnable=function(a){Celigo.integrator.batch.DefaultImportRunnable.superclass.constructor.call(this,a);var b=function(a){var e,f=null,g={},h;if(a.nlobjSublistIds){a.writeLog=!0;for(f in a.nlobjSublistIds)if(a.nlobjSublistIds.hasOwnProperty(f)&&(g[f]={replaceAll:!0,lines:a.nlobjSublistIds[f]},a.nlobjFieldIds.hasOwnProperty("celigo_replaceAllLines_"+f))){h=a.nlobjFieldIds["celigo_replaceAllLines_"+f];if(h==="F"||h===!1)g[f].replaceAll=!1;delete a.nlobjFieldIds["celigo_replaceAllLines_"+
f]}a.nlobjSublistIds=g}for(e in a.nlobjFieldIds)a.nlobjFieldIds.hasOwnProperty(e)&&Object.prototype.toString.apply(a.nlobjFieldIds[e])==="[object Object]"&&a.nlobjFieldIds[e].hasOwnProperty("nlobjSublistIds")&&(a.nlobjFieldIds[e]=b(a.nlobjFieldIds[e]));return a};this.runAndReturnNumberOfRecordsImported=function(a,e,f,g){if(a){if(!g.getFlowConfiguration().mappingData.nlobjRecordType)throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"INVALID_IMPORT_MAPPING_CONFIGURATION",message:"The mapping file describing this import data flow does not provide a NetSuite Record Type, please contact Celigo Support: (config.mappingData.nlobjRecordType is empty)."});
$$.logExecution("AUDIT","Celigo.integrator.batch.DefaultImportRunnable - target ",a);$$.logExecution("AUDIT","Celigo.integrator.batch.DefaultImportRunnable - processing "+g.getFlowConfiguration().mappingData.nlobjRecordType,a[g.getFlowConfiguration().mappingData.nlobjRecordType]);a[g.getFlowConfiguration().mappingData.nlobjRecordType]=b(a[g.getFlowConfiguration().mappingData.nlobjRecordType]);$$.logExecution("AUDIT","Celigo.integrator.batch.DefaultImportRunnable - processing2 "+g.getFlowConfiguration().mappingData.nlobjRecordType,
a[g.getFlowConfiguration().mappingData.nlobjRecordType]);a=(new $R(a[g.getFlowConfiguration().mappingData.nlobjRecordType])).save();$$.logExecution("AUDIT","Celigo.integrator.batch.DefaultImportRunnable - saved target",g.getFlowConfiguration().mappingData.nlobjRecordType+" - "+a);return 1}}};Celigo.integrator.batch.DefaultImportRunnable.extend(Celigo.integrator.batch.file.flat.CsvMultiMappingFileImportRunnable);$.namespace("Celigo.integrator.batch.netsuite");Celigo.integrator.batch.netsuite.AbstractExport=
function(a){Celigo.integrator.batch.netsuite.AbstractExport.superclass.constructor.call(this,a);var b=this,c={savedSearchConfig:"savedSearchConfig",exportFolderId:"exportFolderId",checkBoxField:"checkBoxField",dateField:"dateField",ignoreFilter:"ignoreFilter",backupFolderId:"backupFolderId"};this.getExportConstant=function(a){return c[a]};this.getSavedSearchConfig=function(){if(_.isFunction(b.getSavedSearches))savedSearchConfig=_.map(b.getSavedSearches(),function(a){return{type:a.getRecordType(),
id:a.getSearchId(),checkBoxField:a.getCheckBoxField(),dateField:a.getDateField(),ignoreFilter:a.getIgnoreFilter(),respectSorting:a.getRespectSorting(),additionalColumns:a.getAdditionalColumns(),additionalFilters:a.getAdditionalFilters()}});else if(savedSearchConfig=b.getFlowConfiguration()[b.getExportConstant("savedSearchConfig")],!savedSearchConfig)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the saved search configuration.");return b.processSavedSearchConfig(savedSearchConfig)};
this.getFolderIDToStoreExportedFile=function(){var a=b.getFlowConfiguration()[b.getExportConstant("exportFolderId")];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the export folder ID.");return a};this.getFolderIDToStoreExportedFileInBackup=function(){var a=b.getFlowConfiguration()[b.getExportConstant("backupFolderId")];if(!a)throw $$.createError("MISSING_REQUIRED_PARAMETER","Congifuration file doesn't contain the backup folder ID.");return a};this.setExportedFileID=
function(a){b.publicState.reserved.exportedFileID=a};this.saveFileToBackupFolderAndAttachToJobRecord=function(a){var c=b.getFolderIDToStoreExportedFileInBackup();a.setFolder(c);a=$$.submitFile(a);b.setExportedFileID(a)};this.saveFileToOutboundFolderAndAttachToJobRecord=function(a){var c=b.getFolderIDToStoreExportedFile();a.setFolder(c);a=$$.submitFile(a);b.setExportedFileID(a)};this.saveFileToOutboundFolderAndAttachToJobRecordAndUploadToFTPServer=function(a){b.saveFileToOutboundFolderAndAttachToJobRecord(a);
var c=Celigo.connectors.poller.ftp.FtpBatchFilePollerRunnable.getFtpConfigFromFlowConfigObject(b.getFlowConfiguration());(new Celigo.connectors.ftp.FtpConnector).upload(a,c)};this.getCurrentSavedSearchId=function(){var a=b.getObjects().getCurrentObjectIndex();return!a?null:a.length>1?a[0]:b.getSavedSearchConfig()[0].id};this.handleError=function(a){var c=a.object.length>0?a.object[0].recordType:void 0,g=a.object.length>0?a.object[0].id:void 0;$L.error("Error Code: "+a.code+" | Error Message: "+a.message+
" | Stack Trace: "+a.stackTrace,b.publicState.reserved.integrationLoggerID,this.getIntegrationName(),c,g,this.getUseCaseName())};this.getJobStatusLoggerType=function(){return"export"}};Celigo.integrator.batch.netsuite.AbstractExport.extend(Celigo.integrator.batch.IntegrationBatchProcess);$.namespace("Celigo.core.integrator.batch.netsuite");Celigo.core.integrator.batch.netsuite.AbstractExport=Celigo.integrator.batch.netsuite.AbstractExport;$.namespace("Celigo.integrator.batch.netsuite");Celigo.integrator.batch.netsuite.Export=
function(a){Celigo.integrator.batch.netsuite.Export.superclass.constructor.call(this,a);Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"]=null;var b=this,c=new Date(2012,11,29),e=0,f=a?a.exportTestDataFilters:null,g=$.uuid(),h=function(a,b){Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"+g]||(Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"+g]={});Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"+
g][a]||(Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"+g][a]=b());return Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"+g][a]};this.publicState.reserved.keepSuccessfullyProcessedObjects=!0;this.getAllObjectsBehavior=function(){var a=h("lastExecutionNSDateTime",function(){return b.getLastExecutionNSDateTime()});logUntil("Export - getAllObjectsBehavior - lastExecutionNSDateTime",a,c);b instanceof Celigo.integrator.batch.Export&&
Celigo.event.dispatcher.integrator.batch.ExportDispatcher.emit("BATCH_EXPORT:PRE_PROCESS_SAVED_SEARCHES",b,b.getSavedSearches());var e=h("savedSearchConfig",function(){for(var e=_.clone(b.getSavedSearchConfig()),f=0;e&&f<e.length;f++){logUntil("Export - getAllObjectsBehavior - savedSearchConfig "+f,e[f],c);var g=e[f][b.getExportConstant("ignoreFilter")];logUntil("Export - getAllObjectsBehavior - ignoreFilter",g,c);if(!g){var i=g=null,h=i=null;e[f][b.getExportConstant("checkBoxField")]?g=e[f][b.getExportConstant("checkBoxField")]+
".null.is.F":a&&((i=e[f][b.getExportConstant("dateField")])&&i.indexOf(".")!==-1?(h=i.split(".")[0],i=i.split(".")[1]):i=e[f][b.getExportConstant("dateField")],g=(i||"lastmodifieddate")+"."+h+".onorafter."+a);logUntil("Export - getAllObjectsBehavior - newFilter",g,c);if(g)e[f].additionalFilters||(e[f].additionalFilters=[]),e[f].additionalFilters.push(g)}}return e});logUntil("Export - getAllObjectsBehavior - savedSearchConfig",e,c);b.publicState.getAllObjectsWorkspace=b.publicState.getAllObjectsWorkspace||
{};return new Celigo.oop.behaviors.SavedSearchExecutionBehavior({state:b.publicState.getAllObjectsWorkspace,savedSearchConfig:e,testDataFilters:f,lastSyncTime:a?$$.stringToDate(a).getTime():0,maxPerIteration:b.getIterationCount(),pageSize:b.getPageSize(),maxResults:b.getMaxResults()})};this.getMaxResults=function(){return 0};this.getIterationCount=function(){return 2E3};this.getPageSize=function(){return b.getIterationCount()-100};this.shouldYieldBeforeGetAllObjects=function(){if(e<b.getRecordCountToBeProcessedBeforeYield())return e+=
b.getPageSize(),!1;e=b.getPageSize();return!0};this.getPostProcessPoints=function(){return b.getRequiredPoints(10,b.flowSpecificPostProcess,b.getFlowSpecificPostProcessPoints)};this.postProcess=function(){b.flowSpecificPostProcess();var a=b.getJobStatusLoggerInstance();a.setJobStatusLoggerID(b.publicState.reserved.statusLoggerID);b.publicState.reserved.exportedFileID&&a.setRecordFile(b.publicState.reserved.exportedFileID);a.logStatus()};this.getNextBatchProcess=function(){var a=b.getSavedSearchConfig();
logUntil("Export - savedSearchConfig",a,c);for(var e={},f=0;a&&f<a.length;f++)a[f][b.getExportConstant("checkBoxField")]&&(e[a[f].id]=a[f][b.getExportConstant("checkBoxField")]);logUntil("Export - checkBoxFieldBySavedSearchId",e,c);return{classname:b.getAfterExportBatchProcess(),passAllObjects:!0,additionalContext:{jobRecordId:b.publicState.reserved.statusLoggerID,integrationLogId:b.publicState.reserved.integrationLoggerID,checkBoxFieldBySavedSearchId:e,exportErrorCount:b.getErrors().length+Celigo.integrator.mapping.DeprecatedAbstractMapper.totalCountOfMappingErrors}}};
this.processSavedSearchConfig=function(a){return a};this.getAfterExportBatchProcess=function(){return"Celigo.core.integrator.batch.netsuite.AfterExport"};this.getRecordCountToBeProcessedBeforeYield=function(){return 1E4};this.getFlowSpecificPostProcessPoints=function(){return b.getBatchProcessConstant("MAX_POINT")};this.flowSpecificPostProcess=function(){throw $$.createError("DEVELOPER_ERROR","flowSpecificPostProcess not implemented");}};Celigo.integrator.batch.netsuite.Export.extend(Celigo.integrator.batch.netsuite.AbstractExport);
$.namespace("Celigo.core.integrator.batch.netsuite");Celigo.core.integrator.batch.netsuite.Export=Celigo.integrator.batch.netsuite.Export;$.namespace("Celigo.integrator.batch.netsuite");Celigo.integrator.batch.netsuite.AfterExport=function(a){Celigo.integrator.batch.netsuite.AfterExport.superclass.constructor.call(this,a);var b=this;b.publicState.reserved.checkBoxFieldBySavedSearchId=a.checkBoxFieldBySavedSearchId;this.getListOfRunnableClassnames=function(){return _.keys(b.publicState.reserved.checkBoxFieldBySavedSearchId).length>
0?["Celigo.integrator.batch.netsuite.AfterExportRunnable"]:[]};this.getErrorCount=function(){return a.exportErrorCount+b.getErrors().length}};Celigo.integrator.batch.netsuite.AfterExport.extend(Celigo.integrator.batch.netsuite.AbstractExport);$.namespace("Celigo.core.integrator.batch.netsuite");Celigo.core.integrator.batch.netsuite.AfterExport=Celigo.integrator.batch.netsuite.AfterExport;$.namespace("Celigo.integrator.batch.netsuite");Celigo.integrator.batch.netsuite.AfterExportRunnable=function(a){Celigo.integrator.batch.netsuite.AfterExportRunnable.superclass.constructor.call(this,
a);this.getPoints=function(){return 20};this.run=function(a,c,e,f){a&&a.length>0&&(e=f.getCurrentSavedSearchId(),log("AfterExportRunnable - currentSavedSearchId",e),c=c.reserved.checkBoxFieldBySavedSearchId[e],log("AfterExportRunnable - checkBoxField",c),c&&(log("AfterExportRunnable - setting checkbox field "+c+" to T",a[0].recordType+" "+a[0].id),$$.submitField(a[0].recordType,a[0].id,c,"T")))}};Celigo.integrator.batch.netsuite.AfterExportRunnable.extend(Celigo.suitescript.scheduled.Runnable);$.namespace("Celigo.core.integrator.batch");
Celigo.core.integrator.batch.netsuite.AfterExportRunnable=Celigo.integrator.batch.netsuite.AfterExportRunnable;$.namespace("Celigo.integrator.batch.netsuite");Celigo.integrator.batch.netsuite.DefaultExport=function(a){Celigo.integrator.batch.netsuite.DefaultExport.superclass.constructor.call(this,a);var b=this,c={uiMappingConfigProp:"ui_mapping",fileNameConfigProp:"fileName",fileExtensionConfigProp:"fileExtension"};this.getFlowSpecificPostProcessPoints=function(){return 100};this.flowSpecificPostProcess=
function(){Celigo.util.ExceptionHandler.handle(this,function(){var a=b.publicState.reserved.objects.getData(),f=null,g=null,h=g=null,j=h=null;if(a)if(g=new Celigo.oop.Collection(a),g.getSize()<1)$$.logExecution("AUDIT","No records found, exiting.");else{$.log("successfullyProcessedRecords",a);if(!b.getFlowConfiguration()[c.uiMappingConfigProp])throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"INVALID_FLOW_CONFIGURATION",message:'The property named "'+c.uiMappingConfigProp+'" is missing from the flow configuration file.'});
b.getFlowConfiguration()[c.uiMappingConfigProp]==="CSV_DEFAULT_NO_MAPPINGS"?(f=new Celigo.core.mapping.csv.StandardCSVMapper,h="CSV",j=".csv"):b.getFlowConfiguration()[c.uiMappingConfigProp]==="XML_DEFAULT_NO_MAPPINGS"&&(f=new Celigo.core.mapping.xml.XMLMapper,h="XMLDOC",j=".xml");if(!f)throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"UNSUPPORTED_MAPPING",message:'The property named "'+c.uiMappingConfigProp+'" in the configuration file refers to an usupported or missing mapping.'});
if(!h)throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"UNDETERMINED_FILE_FORMAT",message:"Unable to determine file format from configuration file."});if(!j)throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"UNDETERMINED_FILE_EXTENSION",message:"Unable to determine file extension from configuration file."});$.log("that.getFlowConfiguration().mappingData",b.getFlowConfiguration().mappingData||"no mapping data found");g=f.mapJSToExternal(g,b.getFlowConfiguration().mappingData);
if(h==="XMLDOC")g.fileContents=$$.xmlToString(g.xmlDocument),b.getFlowConfiguration()[c.fileExtensionConfigProp]=j;h=$$.createFile(b.getExportFileName(),h,g.fileContents);b.saveFileToOutboundFolderAndAttachToJobRecordAndUploadToFTPServer(h)}else $$.logExecution("AUDIT","No records found, exiting.")},function(a){$$.logExecution("ERROR","An unexpected error occurred while executing your data flow.",a.getStackTrace());throw a;})};this.getListOfRunnableClassnames=function(){return[]};this.getExportFilePrefix=
function(a){a||(b.getIntegrationName(),b.getUseCaseName(),b.getFlowConfiguration());return b.getIntegrationName()+"-"+b.getUseCaseName()};this.getExportFileName=function(a){a||(a={integration:b.getIntegrationName(),useCase:b.getUseCaseName(),fileName:b.getFlowConfiguration()[c.fileNameConfigProp],fileExtension:b.getFlowConfiguration()[c.fileExtensionConfigProp]});if(b.publicState.reserved.statusLoggerID)a.jobDate=$$.stringToDate($$.lookupField("customrecord_celigo_job_export",b.publicState.reserved.statusLoggerID,
"created")),a.jobDate.setSeconds((new Date).getSeconds());else if(!a.jobDate)a.jobDate=new Date;if(!a.fileName)a.fileName="{integration}-{flow}-{timestamp(YYYY-MM-DDTHH:mm:ssZ)}";if(!a.fileExtension)a.fileExtension=".csv";$$.logExecution("AUDIT","objData",a);var f=a.fileName.replace(/({timestamp([^{]*)})/g,function(b){return b!=="{timestamp}"&&b.replace(/^.*\(|\).*$/g,"")?Celigo.moment(a.jobDate).format(b.replace(/^.*\(|\).*$/g,"")):Celigo.moment(a.jobDate).toString()}).replace(/({integration})/,
a.integration).replace(/({flow})/,a.useCase);f+=a.fileExtension;$$.logExecution("AUDIT","Export file name",f);return f}};Celigo.integrator.batch.netsuite.DefaultExport.extend(Celigo.integrator.batch.netsuite.Export);$.namespace("Celigo.integrator.connectors");Celigo.integrator.connectors.IConnector=function(){};Celigo.integrator.connectors.IConnector.prototype={getCredentialRef:null,getResponseMapper:null,getResponseMappingRef:null,getCache:null,getNextConnector:null};$.namespace("Celigo.integrator.connectors");
Celigo.integrator.connectors.Connector=function(a){this._super(a);this.getExecutionLogger=function(){if(!this.executionLogger)this.executionLogger=$.getExecutionLogger(this.getClassName()),this.executionLogger.setLogLevel("audit");return this.executionLogger};this.getEventDispatcher=function(){if(!this.eventDispather)this.eventDispather=Celigo.event.dispatcher.integrator.connectors.ConnectorDispatcher;return this.eventDispather};this.getUtil=function(){return Celigo.integrator.connectors.Util};this.setErrorSuppressed=
function(b){a.errorSuppressed=!!b};this.isErrorSuppressed=function(){return!!a.errorSuppressed};this.getCredentialRef=function(){_.isUndefined(a.credentialRef)||this.validateConfigType("credentialRef",Celigo.io.CredentialsManager);return a.credentialRef};this.getMethod=function(){return a.method};this.setMethod=function(b){a.method=b};this.getMethodConfig=function(){return a.methodConfig};this.setMethodConfig=function(b){a.methodConfig=b};this.getResponseMapper=function(){return a.responseMapper};
this.getResponseMappingRef=function(){return a.responseMappingRef};this.shouldRenderConfig=function(){return a.renderConfig!==!1};this.shouldRenderMessage=function(){return a.renderMessage!==!1};this.shouldMergeCache=function(){return a.mergeCache!==!1};this.getNextConnector=function(){return a.nextConnector};this.setNextConnector=function(b){a.nextConnector=b};this.getCache=function(){if(!a.cache)a.cache={};return a.cache};this.setCache=function(b){a.cache=b};this.getContext=function(){return this.context};
this.setContext=function(a){this.context=a||{}};this.getRetryConfig=function(){return a.retryConfig};this.getRetryCount=function(){return a.retryCount};this.getName=function(){return a.name||""};this.setName=function(b){a.name=b};this.fire=function(b,c){try{var e,f,g,h,j,i=0,k=10,l=!1,m,n,o;this.getExecutionLogger().debug("connector ("+this.getClassName()+"["+this.getMethod()+"]"+(this.getName()?": "+this.getName():"")+")");if(!this.getMethod())throw new Celigo.Error({message:"connector method is required, make sure to set the method in the config or use SetMethod dynamically"});
o=a[this.getMethod()];if(!o||!_.isFunction(o))o=this[this.getMethod()];if(!o||!_.isFunction(o))throw new Celigo.Error({message:'invalid connector method "'+this.getMethod()+'"'});h=this.getUtil().getRenderDataObject(this,b,c);nlapiGetContext().getEmail()==="vinh@celigo.com"&&nlapiLogExecution("AUDIT","vinh render data",JSON.stringify(h));if(this.shouldRenderMessage()&&b&&b.getData&&b.getData()){var q;q=b.getData()instanceof Celigo.integrator.model.JSONDocument?b.getData().getContent():b.getData().toString();
q=Celigo.util.HandlebarsUtil.render(q,h);b.getData().setContent(q)}this.shouldRenderConfig()&&(f=Celigo.util.deepClone(a),Celigo.util.HandlebarsUtil.render(a,h));this.getEventDispatcher().emit("CONNECTOR:BEFORE_CONNECT",this,b);if((e=o.call(this,b,c))&&!(e instanceof Celigo.integrator.connectors.model.Message))throw new Celigo.Error({message:"connector must return Celigo.integrator.connectors.model.Message instances"});g=this.getRetryConfig();if(this.getUtil().isValidRetryConfig(g)){this.getExecutionLogger().debug("retry config is provided");
j=g.getIntervalInSeconds()||30;k=g.getMaxRetries()||10;do{++i;a.retryCount=i;if(!e)throw new Celigo.Error({message:"error mapping connector output message: no output message"});m=this.getUtil().mapConnectorOutput(e,this);this.getUtil().shouldRetry(m,g)?(Celigo.BatchProcess&&Celigo.BatchProcess.isScheduledScript&&i>10&&i%10===0?(this.getExecutionLogger().debug("should retry connector call after yield"),Celigo.BatchProcess.yield(),this.getExecutionLogger().debug("done yielding")):(this.getExecutionLogger().debug("should retry connector call after sleeping"),
$.sleep(j),this.getExecutionLogger().debug("done sleeping")),this.getExecutionLogger().debug("attempting connector retry #"+i+" with Interval "+j+" s"),e=o.call(this,b)):(this.getExecutionLogger().debug("should stop retrying"),l=!0)}while(i<k&&!l)}this.getEventDispatcher().emit("CONNECTOR:AFTER_CONNECT",this,e);Celigo.util.objectExtend(!0,a,f);m=this.getUtil().mapConnectorOutput(e,this);if(!this.getNextConnector())return this.getExecutionLogger().debug("this is the last connector, returning output"),
e;n=this.getContext();m&&(n=this.getUtil().mergeConnectorContext(n,m));this.getNextConnector().setContext(n);this.shouldMergeCache()&&this.getNextConnector().setCache(this.getUtil().mergeConnectorCache(this.getNextConnector().getCache(),this.getCache()));this.getExecutionLogger().debug("calling next connector");return this.getNextConnector().fire(b)}catch(r){if(this.getEventDispatcher().emit("CONNECTOR:ON_ERROR",this,b,c),!this.isErrorSuppressed())throw r;}}};Celigo.integrator.connectors.Connector.extend(Celigo.io.PrivateStateful);
Celigo.integrator.connectors.Connector.implement(Celigo.integrator.connectors.IConnector);Celigo.integrator.connectors.Connector.className="Celigo.integrator.connectors.Connector";Celigo.integrator.connectors.Connector.__events__={"CONNECTOR:BEFORE_CONNECT":"CONNECTOR:BEFORE_CONNECT","CONNECTOR:AFTER_CONNECT":"CONNECTOR:AFTER_CONNECT","CONNECTOR:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS":"CONNECTOR:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS","CONNECTOR:EMPTY_RESPONSE_MAPPER":"CONNECTOR:EMPTY_RESPONSE_MAPPER",
"CONNECTOR:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS":"CONNECTOR:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS","CONNECTOR:ON_ERROR":"CONNECTOR:ON_ERROR"};$.namespace("Celigo.integrator.connectors");Celigo.integrator.connectors.Util=function(){var a=$.getExecutionLogger("Celigo.integrator.connectors.Util");return{isValidConnector:function(a){return!a||!(a instanceof Celigo.integrator.connectors.Connector)||!_.isString(a.getMethod())||!_.isFunction(a.setContext)?!1:!0},isValidRetryConfig:function(a){return a&&
a instanceof Celigo.integrator.connectors.model.RetryConfiguration},shouldRetry:function(b,c){var e=new Celigo.integrator.connectors.RetryAssertionsValidator,f;try{return f=e.validate(b,c.getRetryAssertions()),f===!0?!1:!0}catch(g){return a.error(g.message),!1}},configToJsObject:function(a){if(a){var c;c=a.nlobjFieldIds?a.nlobjFieldIds:a;_.each(c,function(a,b){_.isObject(a)&&a.nlobjFieldIds&&(c[b]=Celigo.integrator.connectors.Util.configToJsObject(a))});a.nlobjSublistIds&&_.each(a.nlobjSublistIds,
function(a,b){c[b]=a});return c}},credsManagerToLiteral:function(a){return!a||!(a instanceof Celigo.io.CredentialsManager)?a:{userName:a.getUserName(),password:a.getPassword(),securityKey:a.getSecurityKey(),host:a.getHost()}},mergeConnectorContext:function(a,c){return Celigo.object.ObjectMerger.mergeObjects([a,c])},mergeConnectorCache:function(a,c){return Celigo.object.ObjectMerger.mergeObjects([a,c])},getRenderDataObject:function(a,c,e){if(!a||!(a instanceof Celigo.integrator.connectors.Connector))throw new Celigo.Error({message:"connector has to be an instance of Celigo.integrator.connectors.Connector"});
return{cache:a.getCache(),credentials:Celigo.integrator.connectors.Util.credsManagerToLiteral(a.getCredentialRef()),responseContext:a.getContext(),message:c instanceof Celigo.integrator.connectors.model.Message&&c.getData&&c.getData()?c.getData().toString():c,dataFlowInvocationContext:e&&e.getInvocationContext()||void 0}},mapConnectorOutput:function(a,c){if(!a)return{};if(!c||!c.getEventDispatcher||!c.getEventDispatcher())throw new Celigo.Error({message:"connector instance and event dispatcher are required"});
c.getEventDispatcher().emit("CONNECTOR:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS",c,a.getData());var e;c.getResponseMapper()?e=c.getResponseMapper().mapToNetSuite(a.getData(),c.getResponseMapping()):(e=new Celigo.integrator.mapping.model.MapToNetSuiteResult({}),c.getEventDispatcher().emit("CONNECTOR:EMPTY_RESPONSE_MAPPER",c,a.getData(),e));c.getEventDispatcher().emit("CONNECTOR:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS",c,e,a.getData());if(e&&e.getJsObjects()){var f=[];if((e=e.getJsObjects())&&e instanceof
Celigo.lang.Collection)e.each(function(a){f.push(Celigo.integrator.connectors.Util.configToJsObject(a))});else if(_.isArray(e))_.each(e,function(a){f.push(Celigo.integrator.connectors.Util.configToJsObject(a))});else throw new Celigo.Error({message:"mapping output should be a collection instance"});f.length===1&&(f=f[0]);return f}}}}();$.namespace("Celigo.integrator.connectors");Celigo.integrator.connectors.RetryAssertionsValidator=function(){var a={is:function(a,b,f){return a[b]===f},isnot:function(a,
b,f){return a[b]!==f},truthy:function(a,b){return!!a[b]},falsy:function(a,b){return!a[b]},greaterthan:function(a,b,f){return a[b]>f},lessthan:function(a,b,f){return a[b]<f}},b=function(b,e){return a[e.getOperator().toLowerCase()].call(this,b,e.getPropName(),e.getValue())};this.validate=function(c,e){if(!e||!_.isArray(e)||!e.length)throw new Celigo.Error({message:"invalid retry assertions list"});for(var f,g=0;g<e.length;++g){f=e[g];if(!f instanceof Celigo.integrator.connectors.model.RetryAssertion)throw new Celigo.Error({message:"invalid retry assertion, must be an instance of Celigo.integrator.connectors.model.RetryAssertion"});
if(f instanceof Celigo.integrator.connectors.model.EmptyResponseRetryAssertion)f=!!c;else{if(!f.getPropName()||!f.getOperator())throw new Celigo.Error({message:"invalid retry assertion, missing propName and/or operator"});if(!a[f.getOperator().toLowerCase()])throw new Celigo.Error({message:"unsupported operator "+f.getOperator()});f=b(c,f)}if(f!==!0)return!1}return!0}};$.namespace("Celigo.integrator.connectors");Celigo.integrator.connectors.FileDownloadResult=function(a){var b=a.file,c=a.moreFilesAvailable;
this.getFile=function(){return b};this.areMoreFilesAvailable=function(){return c}};$.namespace("Celigo.integrator.connectors.model");Celigo.integrator.connectors.model.Message=function(a){Celigo.integrator.connectors.model.Message.superclass.constructor.call(this,a,!0);this.getName=function(){return a.name};this.setName=function(b){a.name=b};this.getData=function(){return a.data};this.setData=function(b){a.data=b};this.getFileId=function(){return a.fileId};this.setFileId=function(b){a.fileId=b};this.hasMore=
function(){return a.hasMore};this.setHasMore=function(b){a.hasMore=!!b};this.getBatchId=function(){return a.batchId};this.setBatchId=function(b){a.batchId=b};this.getPartNumber=function(){return a.partNumber};this.setPartNumber=function(b){a.partNumber=b};this.isLastPart=function(){return a.lastPart};this.setLastPart=function(b){a.lastPart=b}};Celigo.integrator.connectors.model.Message.extend(Celigo.io.PrivateStateful);Celigo.integrator.connectors.model.Message.className="Celigo.integrator.connectors.model.Message";
$.namespace("Celigo.integrator.connectors.model");Celigo.integrator.connectors.model.RetryAssertion=function(a){this._super(a);this.getPropName=function(){return a.propName};this.getOperator=function(){return a.operator};this.getValue=function(){return a.value}};Celigo.integrator.connectors.model.RetryAssertion.extend(Celigo.io.PrivateStateful);Celigo.integrator.connectors.model.RetryAssertion.className="Celigo.integrator.connectors.model.RetryAssertion";$.namespace("Celigo.integrator.connectors.model");
Celigo.integrator.connectors.model.EmptyResponseRetryAssertion=function(a){this._super(a)};Celigo.integrator.connectors.model.EmptyResponseRetryAssertion.extend(Celigo.integrator.connectors.model.RetryAssertion);Celigo.integrator.connectors.model.EmptyResponseRetryAssertion.className="Celigo.integrator.connectors.model.EmptyResponseRetryAssertion";$.namespace("Celigo.integrator.connectors.model");Celigo.integrator.connectors.model.RetryConfiguration=function(a){this._super(a);if(!a.retryAssertions)a.retryAssertions=
[];this.getRetryAssertions=function(){return a.retryAssertions};this.getIntervalInSeconds=function(){return a.intervalInSeconds};this.getMaxRetries=function(){return a.maxRetries}};Celigo.integrator.connectors.model.RetryConfiguration.extend(Celigo.io.PrivateStateful);Celigo.integrator.connectors.model.RetryConfiguration.className="Celigo.integrator.connectors.model.RetryConfiguration";$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.model.PreparedStatement=function(a){this._super(a);
this.getStatement=function(){return a.statement};this.getValues=function(){return a.values};this.getExecutionLogger=function(){if(!this.executionLogger)this.executionLogger=$.getExecutionLogger(this.getClassName());return this.executionLogger};var b=function(b){if(!_.isNumber(b)||!(b>0&&b%1===0))throw new Celigo.Error({message:"Invalid Index Parameter. Index must be an positive integer."});if(b>a.paramCount)throw new Celigo.Error({message:"Index Out of Bound. Index must be between 1 and "+a.paramCount});
},c=function(b,c,g){if(a.paramTypes[b-1]&&a.paramTypes[b-1]!==c)throw new Celigo.Error({message:"This parameter was previously set to type: "+a.paramTypes[b-1]});a.paramTypes[b-1]=c;a.paramValues[b-1]=g};a.statement=a.statement||"";a.paramCount=function(a){if(!a)return 0;a=a.match(/\?/g);return!a?0:a.length}(a.statement);a.paramTypes=_.isArray(a.paramTypes)?a.paramTypes:[];a.paramValues=_.isArray(a.paramValues)?a.paramValues:[];a.paramValuesBatch=_.isArray(a.paramValuesBatch)?a.paramValuesBatch:[];
this.setBoolean=function(a,f){b(+a);c(+a,"Boolean",!!f)};this.setDouble=function(a,f){b(+a);c(+a,"Double",f)};this.setString=function(a,f){b(+a);c(+a,"String",f)};this.setInt=function(a,f){b(+a);if(!_.isNumber(+f)||f%1!==0)throw new CeligoError({message:"Not an Integer"});c(+a,"Integer",+f)};this.setBigDecimal=function(a,f){b(+a);c(+a,"BigDecimal",f)};this.setDate=function(a,f){b(+a);if((new Date(f)).toString()==="Invalid Date")throw new CeligoError({name:"INVALID_DATE_FORMAT",message:"Invalid Date Format => "+
f});c(+a,"Date",f)};this.setDatetime=function(a,f){b(+a);c(+a,"Timestamp",f)};this.setByExternalDataType=function(a,b,c){var h=Celigo.integrator.connectors.model.PreparedStatement.DataTypes;if(!h||!h[a.toLowerCase()])throw new Celigo.Error({name:"invalid or unsupported external data type",message:a});this["set"+h[a.toLowerCase()]].call(this,b,c)};this.addBatch=function(){if(Celigo.integrator.connectors.sql.SqlUtil.isQueryStatement(a.statement))throw new Celigo.Error({message:"cannot add batch for a query statement"});
a.paramValuesBatch.push(a.paramValues);a.paramValues=[]}};Celigo.integrator.connectors.model.PreparedStatement.extend(Celigo.io.PrivateStateful);Celigo.integrator.connectors.model.PreparedStatement.className="Celigo.integrator.connectors.model.PreparedStatement";Celigo.integrator.connectors.model.PreparedStatement.DataTypes={datetime:"Datetime",date:"Date","boolean":"Boolean",string:"String",bigdecimal:"BigDecimal","double":"Double",integer:"Integer"};$.namespace("Celigo.integrator.connectors.file");
Celigo.integrator.connectors.file.FileCabinetConnector=function(a){this._super(a);this.getFileId=function(){return a.fileId};this.getFolderId=function(){return a.folderId};this.getMessageBackupFolder=function(){return a.messageBackupFolder};this.getNetSuiteFileType=function(){return a.netSuiteFileType||"PLAINTEXT"};this.getBackupFileExtension=function(){return a.backupFileExtension};this.save=function(a){a=$$.createFile(a.getName(),this.getNetSuiteFileType(),a.getData().toString());a.setFolder(this.getFolderId());
return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:""}),fileId:$$.submitFile(a)})};this.createBackupFile=function(a){this.getBackupFileExtension()&&a.setName(a.getName()+"."+this.getBackupFileExtension());a.setFolder(this.getMessageBackupFolder());var c=Celigo.util.FileUtil.saveFileIfNameIsUniqueInFolder(a);c||(a.setName(Celigo.util.FileUtil.appendFileName(a.getName(),"-"+(new Date).getTime())),c=Celigo.util.FileUtil.saveFileIfNameIsUniqueInFolder(a));
c||(a.setName(Celigo.util.FileUtil.appendFileName(a.getName(),"-"+(Math.random()*1E3).toFixed())),Celigo.util.FileUtil.saveFileIfNameIsUniqueInFolder(a))};this.download=function(){var a,c=this.getFileId(),e;e=[];if(c)parseInt(c,10)>0&&(a=$$.loadFile(c),this.createBackupFile(a));else if(c=[],c.push((new nlobjSearchColumn("internalid")).setSort()),c.push(new nlobjSearchColumn("name")),e=this.getFolderId(),e=[["folder","anyof",e]],(e=$$.searchRecord("file",null,e,c))&&e.length>0){if(!this.getMessageBackupFolder())throw $$.createError("MISSING_REQUIRED_PARAMETER",
"Configuration file doesn't contain messageBackupFolder");a=$$.loadFile(e[0].getId());this.createBackupFile(a)}else e=[];return new Celigo.integrator.connectors.model.Message({name:a?a.getName():null,data:new Celigo.integrator.model.Document({content:a?a.getValue():""}),fileId:a?a.getId():null,hasMore:e.length>1})}};Celigo.integrator.connectors.file.FileCabinetConnector.extend(Celigo.integrator.connectors.Connector);Celigo.integrator.connectors.file.FileCabinetConnector.className="Celigo.integrator.connectors.file.FileCabinetConnector";
Celigo.util.namespace("Celigo.integrator.connectors.ftp");Celigo.integrator.connectors.ftp.FtpConnection=Backbone.Model.extend({getCollection:function(){var a=JSON.parse(this.getFileDataAsObject().plainText),b=[],c;for(c in a)b.push({id:c,name:a[c].name||c,host:a[c].host,username:a[c].username,password:a[c].password||null,passwordLength:a[c].password?a[c].password.length:null,protocol:a[c].protocol,privateKey:a[c].privateKey||null,userDirectoryIsRoot:a[c].userDirectoryIsRoot===void 0?null:a[c].userDirectoryIsRoot});
return b},getFileDataAsObject:function(){var a=null;try{$$.loadFile("Celigo/Integrator/Configuration/Global/FTP_Credentials.txt")}catch(b){b=Celigo.Error.convert(b);Celigo.util.handleError(b);Celigo.core.file.FolderStructureManager.addPath("Celigo/Integrator/Configuration/Global");Celigo.core.file.FolderStructureManager.createMissingFolders();var a=$$.createFile("FTP_Credentials.txt","PLAINTEXT","{}"),c=Celigo.core.file.FolderStructureManager.getFolder("Celigo/Integrator/Configuration/Global").internalId;
if(!c)throw $$.createError("CONFIG_FILE_INITIALIZATION_ERROR","Unable to create FTP configuration file.");a.setFolder(c);$$.submitFile(a)}a=Celigo.util.FileUtil.decryptConfigFileIfEncrypted("Celigo/Integrator/Configuration/Global/FTP_Credentials.txt");Celigo.SuiteScript.logExecution("AUDIT","FTP_Credentials file ID",a.file.getId());c=null;try{c=JSON.parse(a.plainText)}catch(e){throw e=Celigo.Error.convert(e),Celigo.util.handleError(e),$$.createError("CONFIG_FILE_CORRUPTION","Unable to update stored Connections due to corrupted configuration file, please contact Celigo Support with the following : "+
e.message||e.getMessage());}if(!c)throw $$.createError("CONFIG_FILE_CORRUPTION","Unable to update stored Connections due to corrupted configuration file, please contact Celigo Support.");return a},sync:function(a,b){$.log("OPERATION",a);switch(a){case "create":case "update":var c=this.getFileDataAsObject(),e=JSON.parse(c.plainText),f=this.id||Celigo.util.makeGuid(),g=null;this.id=f;e[f]=this.clone();g=JSON.stringify(e);g=Celigo.core.crypto.Encryptor.encrypt(g);Celigo.util.FileUtil.updateFile(c.file.getId(),
g);return f;case "read":return c=this.getCollection(),b.id?_.find(c,function(a){return a.id===b.id}):null;case "delete":if(!b.id)throw $$.createError("ID_REQUIRED",'Please set "id" before invoking "DELETE".');c=this.getFileDataAsObject();e=JSON.parse(c.plainText);$.log("connection to delete",b.id);for(f in e)f===b.id&&delete e[f];g=JSON.stringify(e);Celigo.SuiteScript.logExecution("AUDIT","FTP_Credentials before update",g);Celigo.util.FileUtil.isConfigFileEncrypted(g)&&(g=Celigo.core.crypto.Encryptor.encrypt(g));
Celigo.util.FileUtil.updateFile(c.file.getId(),g);return b.id}}});$.namespace("Celigo.connectors.ftp");Celigo.connectors.ftp.FtpConnection=Celigo.integrator.connectors.ftp.FtpConnection;$.namespace("Celigo.integrator.connectors.ftp");Celigo.integrator.connectors.ftp.FtpConnector=function(a){var b=new Date(2013,8,18),c={BRIDGE_URL:(Celigo.integrator.connectors.ftp.FtpConnector.DO_NOT_USE_WILL_BE_REMOVED_WITHOUT_NOTICE___TEST_URL||$$.getContext().getSetting("SCRIPT","custscript_celigo_global_ftp_bridge_url")||
$$.getContext().getSetting("SCRIPT","custscript_celigo_global_ftp_bridge_url_2")||"https://prd-win01.celigo.com/FileTransferBridge").trim(),BRIDGE_SECRET_KEY:($$.getContext().getSetting("SCRIPT","custscript_celigo_global_ftp_brdg_key")||"9f25542c-8323-445f-9113-e769d6f9d1cb").trim(),BRIDGE_MAX_RETRIES:5,INACTIVE:"inactive",CREDENTIALS_REF:"credentialsRef",RELATIVE_PATH:"relativePath",TIMEOUT:"timeout",CREDENTIAL_DATA:"credentialData",SECRET_KEY:"secretKey",RSA_PRIVATE_KEY:"privateKey",PAYLOAD:"payload",
IMPORT_FOLDER_ID:"importFolderId",NETSUITE_FILE_TYPE:"netSuiteFileType",NETSUITE_FILE_EXTENSION:"netSuiteFileExtension",REMOVE_EXTENSION:"removeExtension",CONTENT_BASE64_ENCODED:"contentBase64Encoded",FILE_CONTENTS:"fileContents",FILE_NAME:"fileName",LEAVE_FILE_ON_SERVER:"leaveFileOnServer"},e=a?a.credentials:void 0,f=function(a){var e=a[c.INACTIVE];if(e===!0)return logUntil("FTP INACTIVE",e,b),null;var f=a[c.CREDENTIALS_REF],g;if(f){if(f instanceof Celigo.io.CredentialsManager)if(f.getUserName()){if(e=
{username:f.getUserName(),password:f.getPassword(),privateKey:f.getSecurityKey(),host:a.host||f.getHost(),protocol:a.protocol||f.getProtocol(),userDirectoryIsRoot:a.userDirectoryIsRoot||f.getUserDirectoryIsRoot()},g=f.getOptions()){if(g.usePassiveMode)e.usePassiveMode=!0;if(g.entryParserFtpClientConfig)e.entryParserFtpClientConfig=g.entryParserFtpClientConfig}}else f=new Celigo.io.CredentialsManagerDepricated({id:f.getId()}),e={username:f.getUserName(),password:f.getPassword(),privateKey:f.getSecurityKey(),
host:a.host,protocol:a.protocol,userDirectoryIsRoot:a.userDirectoryIsRoot};else if(g=new Celigo.io.CredentialsManager({id:f}),g.getUserName()){if(e={username:g.getUserName(),password:g.getPassword(),privateKey:g.getSecurityKey(),host:g.getHost(),protocol:g.getProtocol(),userDirectoryIsRoot:g.getUserDirectoryIsRoot()},(g=g.getOptions())&&g.usePassiveMode)e.usePassiveMode=!0}else e=(new Celigo.connectors.ftp.FtpConnection({id:f})).fetch();if(!e)throw $$.createError("MISSING_REQUIRED_PARAMETER","FTP Credentials file doesn't contain ftpCredentials for: "+
f);}else e=a,a={};if(!e.protocol)e.protocol="ftp";if(!_.isBoolean(e.userDirectoryIsRoot))e.userDirectoryIsRoot=null;if(f=a[c.RELATIVE_PATH])f=_.str.trim(f),_.str.startsWith(f,"/")||(f="/"+f),e[c.RELATIVE_PATH]=f;if((f=/:(\d+)$/.exec(e.host))&&f.length>1)e.port=f[1],e.host=e.host.substr(0,e.host.length-e.port.length-1);f=a;f[c.SECRET_KEY]=c.BRIDGE_SECRET_KEY;f[c.CREDENTIAL_DATA]=e;(a=a[c.TIMEOUT])&&(f[c.TIMEOUT]=a);return f},g=function(a,b){if(b[c.CREDENTIAL_DATA]&&b[c.CREDENTIAL_DATA][c.RSA_PRIVATE_KEY]&&
!b[c.CREDENTIAL_DATA].keyIsEncoded)b[c.CREDENTIAL_DATA][c.RSA_PRIVATE_KEY]=Celigo.Base64.encode(b[c.CREDENTIAL_DATA][c.RSA_PRIVATE_KEY]),b[c.CREDENTIAL_DATA].keyIsEncoded=!0;var e,f=[];f["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8";Celigo.integrator.connectors.ftp.FtpConnector["ONLY_ENCODE_&_AND_+"]===!0?(e=c.PAYLOAD+"="+JSON.stringify(b),e=e.replace(/&/g,encodeURIComponent("&")),e=e.replace(/\+/g,encodeURIComponent("+"))):e=c.PAYLOAD+"="+encodeURIComponent(JSON.stringify(b));
var g=null;if(_.str.endsWith(a,"/deleteFile"))b.suppressFileNonExistError=!0,g={payload:c.PAYLOAD+"="+encodeURIComponent(JSON.stringify(b))};return Celigo.util.JavaBridgeHandler.request("FTP Bridge",a,e,f,g)};if(!c.BRIDGE_URL||c.BRIDGE_URL.indexOf("https")!==0)throw new Celigo.lang.NetSuiteError({name:"CELIGO_BRIDGE_CONFIGURATION_ERROR",message:"Celigo bridge endpoint must be secure (https): the following endpoint introduces a security risk and will not be used => "+c.BRIDGE_URL});this.testConnection=
function(a){a=a||e;a=f({username:a.username,password:a.password,protocol:a.protocol,host:a.host,privateKey:a.privateKey,userDirectoryIsRoot:a.userDirectoryIsRoot});g(c.BRIDGE_URL+"/ping",a)};this.download=function(a,e){logUntil("FtpConnector - download","",b);var k=a[c.NETSUITE_FILE_TYPE];if(!k)throw $$.createError("MISSING_REQUIRED_PARAMETER","Configuration file doesn't contain "+c.NETSUITE_FILE_TYPE);logUntil("FtpConnector - download - netSuiteFileType",k,b);var h=a[c.NETSUITE_FILE_EXTENSION];logUntil("FtpConnector - download - netSuiteFileExtension",
h,b);var m=a[c.IMPORT_FOLDER_ID];if(!m)throw $$.createError("MISSING_REQUIRED_PARAMETER","Configuration file doesn't contain "+c.IMPORT_FOLDER_ID);logUntil("FtpConnector - download - importFolderId",m,b);var n=f(e);if(!n)return{responseData:{}};n.deleteDownloadedFile=!1;if(a.characterSetName)n.characterSetName=a.characterSetName;logUntil("FtpConnector - download - requestData",n,b);var o=g(c.BRIDGE_URL+"/download",n),q=null;if(o.hasFile===!0){q=o.fileName;h&&!_.str.endsWith(q,h)&&(q+="."+h);logUntil("FtpConnector - download - fileName",
q,b);k=$$.createFile(q,k,o.fileContents);k.setFolder(m);h=Celigo.util.FileUtil.saveFileIfNameIsUniqueInFolder(k);h||(q=Celigo.util.FileUtil.appendFileName(q,"-"+(new Date).getTime()),k.setName(q),h=Celigo.util.FileUtil.saveFileIfNameIsUniqueInFolder(k));h||(q=Celigo.util.FileUtil.appendFileName(q,"-"+(Math.random()*1E3).toFixed()),k.setName(q),h=Celigo.util.FileUtil.saveFileIfNameIsUniqueInFolder(k));if(!h)throw new Celigo.Error({name:"CELIGO_FILE_NAME_NOT_UNIQUE",message:"Cannot save file to NetSuite File Cabinet. File name: "+
o.fileName});q=h;if(!a[c.LEAVE_FILE_ON_SERVER])try{n.fileName=o.fileName,logUntil("FtpConnector - delete - requestData",n,b),g(c.BRIDGE_URL+"/deleteFile",n)}catch(r){throw n=$$.loadRecord("folder",m).getFieldValue("name")+" backup",(k=$$.searchRecord("folder",null,[new nlobjSearchFilter("parent",null,"anyof",m),new nlobjSearchFilter("name",null,"is",n)]))&&k.length>0?m=k[0].getId():(k=$$.createRecord("folder"),k.setFieldValue("name",n),k.setFieldValue("parent",m),m=$$.submitRecord(k)),q=$$.loadFile(q),
q.setFolder(m),$$.submitFile(q),new Celigo.Error({name:"CELIGO_FTP_DELETE_FILE_ERROR",message:"Cannot delete file on FTP server after saving to NetSuite File Cabinet. File name: "+o.fileName,cause:r});}}return{fileId:q,fileContents:o.fileContents,responseData:o}};var h=function(a,b){var e=a.getName(),g=a.getValue(),h=f(b);if(!h)return null;var n=b[c.REMOVE_EXTENSION];n&&e.lastIndexOf("."+n)!==-1&&(e=e.substring(0,e.lastIndexOf("."+n)));h[c.FILE_NAME]=e;h[c.FILE_CONTENTS]=g;h[c.CONTENT_BASE64_ENCODED]=
$.nsContentEnumRepresentsBinaryType(a.getType());return h};this.upload=function(a,b){var e=h(a,b);return!e?{responseData:{}}:{responseData:g(c.BRIDGE_URL+"/upload",e)}};this.multipartUpload=function(a,b){var e=h(a,b);if(!e)return{responseData:{}};e.celigoUploadId=b.celigoUploadId;e.partNumber=b.partNumber;e.lastPart=b.lastPart;b.celigoUploadId&&(e[c.FILE_NAME]=Celigo.integrator.connectors.ftp.FtpConnector.multipartUploadFileNameByUploadId[b.celigoUploadId]);var l=g(c.BRIDGE_URL+"/multipartUpload",
e);if(e.lastPart===!0){for(var e=null,m=(new Date).getTime(),n=1;n<=3&&(new Date).getTime()-m<18E5;n++){if(n>1)e=f(b),e.celigoUploadId=b.celigoUploadId,e.retry=!0,g(c.BRIDGE_URL+"/multipartUpload",e);for(e=null;e!=="DONE"&&e!=="ERROR"&&(new Date).getTime()-m<18E5;)e&&$.sleep(15),l=b,(e=f(l))?(e.celigoUploadId=l.celigoUploadId,l=g(c.BRIDGE_URL+"/multipartUploadCheck",e)):l={responseData:{}},e=l.uploadStatus;if(e==="DONE")return{uploadStatus:l.uploadStatus,responseData:l}}if(e==="ERROR")throw new Celigo.lang.NetSuiteError({name:"CELIGO_FTP_MULTIPART_FILE_UPLOAD_ERROR",
message:"Message: "+l.message+". Complete Message: "+l.completeMessage+".",stackTrace:l.stackTrace});throw new Celigo.Error({name:"CELIGO_FTP_MULTIPART_FILE_UPLOAD_ERROR",message:"File failed to upload to FTP server in 30 minutes"});}Celigo.integrator.connectors.ftp.FtpConnector.multipartUploadFileNameByUploadId[l.celigoUploadId]=e[c.FILE_NAME];return{celigoUploadId:l.celigoUploadId,responseData:l}}};Celigo.integrator.connectors.ftp.FtpConnector.multipartUploadFileNameByUploadId={};new Date<new Date(2014,
0,5)&&(Celigo.integrator.connectors.ftp.FtpConnector.DO_NOT_USE_WILL_BE_REMOVED_WITHOUT_NOTICE___TEST_URL="https://prd-win01.celigo.com/FileTransferBridgeTest");$.namespace("Celigo.connectors.ftp");Celigo.connectors.ftp.FtpConnector=Celigo.integrator.connectors.ftp.FtpConnector;$.namespace("Celigo.integrator.connectors.ftp");Celigo.integrator.connectors.ftp.FtpConnectorImpl=function(a){this._super(a);var b=this;this.setHost=function(b){a.host=b};this.getHost=function(){return a.host};this.setProtocol=
function(b){a.protocol=b};this.getProtocol=function(){return a.protocol};this.setUserDirectoryIsRoot=function(b){a.userDirectoryIsRoot=b};this.getUserDirectoryIsRoot=function(){return a.userDirectoryIsRoot};this.getRelativePath=function(){return a.relativePath};this.getMessageBackupFolder=function(){return a.messageBackupFolder};this.getNetSuiteFileType=function(){return a.netSuiteFileType||"PLAINTEXT"};this.getNetSuiteFileExtension=function(){if(a.netSuiteFileExtension&&_.str.startsWith(a.netSuiteFileExtension,
"."))a.netSuiteFileExtension=a.netSuiteFileExtension.substr(1);return a.netSuiteFileExtension||"txt"};this.getFileNameStartsWith=function(){return a.fileNameStartsWith};this.setFileNameStartsWith=function(b){a.fileNameStartsWith=b};this.getFileNameEndsWith=function(){return a.fileNameEndsWith};this.setFileNameEndsWith=function(b){a.fileNameEndsWith=b};this.getRemoveExtension=function(){return a.removeExtension||!1};this.isLeaveFileOnServer=function(){return a.leaveFileOnServer===!0?!0:!1};this.setLeaveFileOnServer=
function(b){a.leaveFileOnServer=!!b};this.getCharacterSetName=function(){return a.characterSetName};this.setCharacterSetName=function(b){a.characterSetName=b};this.getCompressionFormat=function(){return a.compressionFormat};this.setCompressionFormat=function(b){a.compressionFormat=b};var c=new Celigo.integrator.connectors.ftp.FtpConnector;this.download=function(){var a={netSuiteFileType:this.getNetSuiteFileType(),netSuiteFileExtension:this.getNetSuiteFileExtension(),importFolderId:this.getMessageBackupFolder(),
leaveFileOnServer:this.isLeaveFileOnServer(),characterSetName:this.getCharacterSetName()},b={credentialsRef:this.getCredentialRef(),relativePath:this.getRelativePath(),fileNameStartsWith:this.getFileNameStartsWith(),fileNameEndsWith:this.getFileNameEndsWith(),protocol:this.getProtocol(),host:this.getHost(),userDirectoryIsRoot:this.getUserDirectoryIsRoot()},a=c.download(a,b);return new Celigo.integrator.connectors.model.Message({name:a.responseData.fileName,data:new Celigo.integrator.model.Document({content:a.fileContents||
""}),fileId:a.fileId,hasMore:!!a.responseData.hasMoreFiles})};var e=function(a){var c={credentialsRef:b.getCredentialRef(),relativePath:b.getRelativePath(),removeExtension:b.getRemoveExtension(),protocol:b.getProtocol(),host:b.getHost(),userDirectoryIsRoot:b.getUserDirectoryIsRoot(),compressionFormat:b.getCompressionFormat()},e=null,j=null,i=a.getName(),k=b.getMessageBackupFolder();try{if(k){var l=$$.searchRecord("file",null,[["name","is",i],"AND",["folder","is",k]]);if(l&&l.length>0)var m=i.lastIndexOf("."),
n=i.substr(0,m),o=i.substr(m),i=n+"-"+(new Date).toString()+o}k?(e=$$.createFile(i,b.getNetSuiteFileType(),a.getData().toString()),e.setFolder(k),j=$$.submitFile(e),i!==a.getName()&&(e=$$.createFile(a.getName(),b.getNetSuiteFileType(),a.getData().toString()))):e=$$.createFile(i,b.getNetSuiteFileType(),a.getData().toString())}catch(q){a="Failed to save backup file in NetSuite File Cabinet before sending to FTP server : "+Celigo.Error.format(q),$$.logExecution("ERROR","FTP Connector error (non-critical)",
a),$L.errorOnCurrentJob(a)}return{ftpCfg:c,fileId:j,file:e}};this.upload=function(a){var a=e(a),b=c.upload(a.file,a.ftpCfg);return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:b.responseData}),fileId:a.fileId})};this.multipartUpload=function(a){var b=e(a);b.ftpCfg.celigoUploadId=a.getBatchId();b.ftpCfg.partNumber=a.getPartNumber();b.ftpCfg.lastPart=a.isLastPart();a=c.multipartUpload(b.file,b.ftpCfg);return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:a.responseData}),
batchId:a.celigoUploadId,fileId:b.fileId})};this.testConnection=function(a){return c.testConnection(a)}};Celigo.integrator.connectors.ftp.FtpConnectorImpl.extend(Celigo.integrator.connectors.Connector);Celigo.integrator.connectors.ftp.FtpConnectorImpl.className="Celigo.integrator.connectors.ftp.FtpConnectorImpl";$.namespace("Celigo.integrator.connectors.http");Celigo.integrator.connectors.http.HttpConnectorImpl=function(a){this._super(a);this.getResponseMapping=this.getResponseMappingRef;var b=1E4,
c=-1E4,e=function(a){a&&_.isString(a)&&a.trim()[0]!=="-"&&(a=a.trim().split("-"),a.length===1?(b=+a[0],c=1E4):a.length===2&&(b=+a[0],c=a[1]?+a[1]:1E4))};e(a.remote_unavailable_http_codes);$$.logExecution("debug",b,c);this.setRemoteUnavailableHttpCodes=function(a){e(a)};this.getRequestUrl=function(){return a.requestUrl};this.setRequestUrl=function(b){a.requestUrl=b};this.getRequestHeader=function(){return a.requestHeader};this.setRequestHeader=function(b){a.requestHeader=b};this.getRequestBody=function(){return a.requestBody};
this.setRequestBody=function(b){a.requestBody=b};this.getRequestBodyJSON=function(){return a.requestBodyJSON};this.setRequestBodyJSON=function(b){a.requestBodyJSON=b};this.postProcessResponse=function(a){return a.getBody()};this.request=function(e,g){if(e&&!(e instanceof Celigo.integrator.connectors.model.Message))throw new Celigo.Error({message:"input data has to be an instance of Celigo. integrator.connectors.model.Message"});if(!this.getRequestUrl())throw new Celigo.Error({message:"missing requestUrl"});
var h=new Celigo.integrator.connectors.http.HttpClient(a),j;this.getRequestBodyJSON()?j=JSON.stringify(this.getRequestBodyJSON()):this.getRequestBody()?j=this.getRequestBody():e&&e.getData()&&(j=e.getData().toString());h=h.request(g,this.getRequestUrl(),this.getRequestHeader(),j);j=+h.getCode();if(j>=b&&j<=c)throw new Celigo.Error({name:"REMOTE_UNAVAILABLE",message:j+" - "+$$.escapeXML(h.getBody())});if(j>=400)throw new Celigo.Error({name:"ERROR_HTTP_RESPONSE_"+h.getCode(),message:"Error http response: "+
$$.escapeXML(h.getBody())});j=this.postProcessResponse(h);return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.HttpDocument({content:j,response:h})})};this.post=function(a){return this.request(a,"POST")};this.get=function(a){return this.request(a,"GET")};this.put=function(a){return this.request(a,"PUT")};this.del=function(a){return this.request(a,"DELETE")}};Celigo.integrator.connectors.http.HttpConnectorImpl.extend(Celigo.integrator.connectors.Connector);Celigo.integrator.connectors.http.HttpConnectorImpl.className=
"Celigo.integrator.connectors.http.HttpConnectorImpl";$.namespace("Celigo.integrator.connectors.http");Celigo.integrator.connectors.http.HttpClient=function(a){a||(a={});var b=$.getExecutionLogger("Celigo.integrator.connectors.http.HttpClient");a.bridgeUrl&&b.audit("Bridge URL override",a.bridgeUrl);a.verbose||b.setLogLevel("ERROR");var c=(a.bridgeUrl||$$.getContext().getSetting("SCRIPT","custscript_celigo_global_http_proxy_url")||"https://prd-win01.celigo.com/HTTPProxy").trim(),e=(a.bridgeSecret||
$$.getContext().getSetting("SCRIPT","custscript_celigo_global_http_proxy_key")||"9f25542c-8323-445f-9113-e769d6f9d1cb").trim(),f={OPTIONS:1,HEAD:1,GET:1,PUT:1,DELETE:1,PATCH:1,POST:1,TRACE:0,CONNECT:0},g={HEAD:1,GET:1,PUT:1,DELETE:1,POST:1},h={"application/json":1,"application/json; charset=UTF-8":1,"application/soap+xml":1,"application/soap+xml; charset=UTF-8":1,"text/xml":1,"text/xml; charset=UTF-8":1},j={"application/xml":1};if(!c||c.indexOf("https")!==0)throw new Celigo.lang.NetSuiteError({name:"CELIGO_BRIDGE_CONFIGURATION_ERROR",
message:"Celigo bridge endpoint must be secure (https): the following endpoint introduces a security risk and will not be used => "+c});var i=this,k={},l=function(a,c,e,f){return k.forceUseProxy===!0?!0:g[a]!==1?!0:e&&e["Content-Type"]&&!h[e["Content-Type"]]?(b.audit('"Content-Type" header not supported by NetSuite: '+e["Content-Type"],"Routing HTTP call through proxy service."),!0):e&&e.Accept&&j[e.Accept]?(b.audit('"Accept" header not supported by NetSuite: '+e.Accept,"Routing HTTP call through proxy service."),
!0):a==="PUT"&&(f===void 0||f===null||f==="")?(b.audit("Empty PUT request","Routing HTTP call through proxy"),!0):!1};(function(a){if(_.isObject(a)){if(a.baseUrl&&!_.isString(a.baseUrl))throw new CeligoError({message:"baseUrl must be String"});if(a.defaultHeaders&&!_.isObject(a.defaultHeaders))throw new CeligoError({message:"defaultHeaders must be Object"});if(a.forceUseProxy&&a.forceUseProxy!==!0&&a.forceUseProxy!==!1)throw new CeligoError({message:"forceUseProxy must be Boolean"});if(a.acceptCertificate&&
a.acceptCertificate!==!0&&a.acceptCertificate!==!1)throw new CeligoError({message:"acceptCertificate must be Boolean"});k=_.clone(a);if(a.defaultHeaders)k.defaultHeaders=_.clone(a.defaultHeaders)}})(a);this.getBaseUrl=function(){return k.baseUrl||""};this.setBaseUrl=function(a){k.baseUrl=a};this.getDefaultHeaders=function(){return k.defaultHeaders?_.clone(k.defaultHeaders):{}};this.setDefaultHeaders=function(a){k.defaultHeaders=_.clone(a)};this.isForceUseProxy=function(){return k.forceUseProxy===
!0};this.setForceUseProxy=function(a){k.forceUseProxy=a};this.isAcceptCertificate=function(){return k.acceptCertificate===!0};this.setAcceptCertificate=function(a){k.acceptCertificate=a};this.request=function(a,g,j,h){if(!a||!_.isString(a))throw new CeligoError({message:"method must be String"});if(f[a.toUpperCase()]!==1)throw new CeligoError({message:"method is not supported"});a=a.toUpperCase();j=j||null;h=_.isString(h)?String(h):_.clone(h);if(l(a,g,j,h)){var k={};k.httpMethod=a;k.destinationUrl=
i.getBaseUrl()?i.getBaseUrl()+g:g;k.secretKey=e;k.acceptCertificate=i.isAcceptCertificate();k.headerOverrideMap=j;k=Celigo.Base64.encode(JSON.stringify(k));g=c+"?celigoPayload="+k;b.audit(a+" request through proxy");a=$$.requestURL(g,h,j)}else b.audit(a+" request directly"),g=i.getBaseUrl()?i.getBaseUrl()+g:g,b.audit("url",g),b.audit("data","<pre>"+$$.escapeXML(h)+"</pre>"),a==="POST"&&(h=h||" "),a=$$.requestURL(g,h,_.extend(i.getDefaultHeaders(),j),a);return a}};Celigo.integrator.connectors.http.HttpClient.prototype.options=
function(a,b){return this.request("OPTIONS",a,b)};Celigo.integrator.connectors.http.HttpClient.prototype.head=function(a,b){return this.request("HEAD",a,b)};Celigo.integrator.connectors.http.HttpClient.prototype.get=function(a,b){return this.request("GET",a,b)};Celigo.integrator.connectors.http.HttpClient.prototype.put=function(a,b,c){return this.request("PUT",a,b,c)};Celigo.integrator.connectors.http.HttpClient.prototype.del=function(a,b,c){return this.request("DELETE",a,b,c)};Celigo.integrator.connectors.http.HttpClient.prototype.patch=
function(a,b,c){return this.request("PATCH",a,b,c)};Celigo.integrator.connectors.http.HttpClient.prototype.post=function(a,b,c){return this.request("POST",a,b,c)};$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.sql.Connection=function(){var a={},b=function(a){if(!a)throw new CeligoError({message:"this property cannot be set to empty"});};this.getEndPoint=function(){return a.url};this.setEndPoint=function(c){b(c);a.url=c};this.getUserName=function(){return a.username};
this.setUserName=function(c){b(c);a.username=c};this.getPassword=function(){return a.password};this.setPassword=function(c){b(c);a.password=c};this.toJSON=function(){return a}};$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.sql.SqlUtil=function(){var a={SELECT:"select",INSERT:"insert",UPDATE:"update",UPSERT:"upsert",MERGE:"upsert",DELETE:"delete"};return{SQL_STATEMENT_TYPES:a,validateStatementType:function(b){var c=!1,e;for(e in a)b&&b.toLowerCase()===a[e]&&(c=!0);if(!c)throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"CELIGO_DEVELOPER_ERROR",
message:"Invalid SqlStatementType - "+b});},isQueryStatement:function(a){return a.search(/select/i)>-1&&!~a.search(/update|delete|insert/i)?!0:!1}}}();$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.sql.UpdateResult=function(a){if(!a||!a.data||!_.isArray(a.data))throw new CeligoError({message:'invalid parameter "data"'});var b=a.data,c=0,e=function(){if(c===0)throw new CeligoError({message:"before first row"});if(c===0)throw new CeligoError({message:"after last row"});
},f=function(a){if(!_.isNumber(a)||!(a>0&&a%1===0))throw new CeligoError({message:"Invalid Index Parameter. Index must be an positive integer."});if(a>b[c-1].length)throw new CeligoError({message:"Index Out of Bound. Index must be between 1 and "+b[c-1].length});};this.next=function(){if(c===-1)return!1;if(c<b.length)return c++,!0;c=-1;return!1};this.rewind=function(){c=0};this.getRowsAffected=function(){e();f(1);return b[c-1][0]};this.getError=function(){e();f(2);return b[c-1][1]};this.getGeneratedKey=
function(){e();f(3);return b[c-1][2]};this.getData=function(){return b}};$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.sql.ResultSet=function(a){if(!a||!a.data||!_.isArray(a.data))throw new CeligoError({message:'invalid parameter "data"'});var b=a.data,c=a.resultSetTypes||[],e=a.resultSetColumns,f=0,g=this,h=g.constructor;this.next=function(){if(f===-1)return!1;if(f<b.length)return f++,!0;f=-1;return!1};this.rewind=function(){f=0};this.getRow=function(){return f};this.getColumnByIndex=
function(a){var e;if(f===0)throw new CeligoError({message:"before first row"});if(f===0)throw new CeligoError({message:"after last row"});if(!_.isNumber(a)||!(a>0&&a%1===0))throw new CeligoError({message:"Invalid Index Parameter. Index must be an positive integer."});if(a>b[f-1].length)throw new CeligoError({message:"Index Out of Bound. Index must be between 1 and "+b[f-1].length});e=b[f-1][a-1];var g,a=c[a-1];if(!a)return e;g=h.ColumnTypes[a];if(!g)throw new CeligoError({name:"Unsupported column type",
message:"Unsupportd column type: "+a});return e.constructor===g?e:g===String||g===Number?g(e):new g(e)};this.getColumnByName=function(a){if(!a)throw new CeligoError({name:"columnlabel argument is required",message:"columnlabel argument is required"});var b;b=a;if(!e||!e.length)throw new CeligoError({name:"No column metadata",message:"No column metadata"});if(b){b=String(b);for(var c=e.length;c>-1&&e[c]!==b;c--);b=c+1}else b=0;if(!b)throw new CeligoError({name:"invalid column name",message:"no column named: "+
a});if(b)return g.getColumnByIndex(b)};this.getStringByIndex=function(a){return String(g.getColumnByIndex(a))};this.getString=function(a){return String(g.getColumnByName(a))};this.getData=function(){return b}};Celigo.integrator.connectors.sql.ResultSet.ColumnTypes={String:String,Double:Number,Integer:Number,BigDecimal:Number,Float:Number,Date:Date};$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.sql.PreparedStatement=function(a,b){if(!a||!(a instanceof Celigo.integrator.connectors.sql.Connection))throw new CeligoError({message:'invalid parameter "connection"'});
if(!b||!_.isString(b))throw new CeligoError({message:'Invalid "statement" String parameter type -> '+typeof b});var c,e,f,g,h,j=$.getExecutionLogger("Celigo.integrator.connectors.sql.PreparedStatement"),i=function(a){return a.search(/select/i)>-1&&!~a.search(/update|delete|insert/i)?!0:!1},k=function(a){if(!_.isNumber(a)||!(a>0&&a%1===0))throw new CeligoError({message:"Invalid Index Parameter. Index must be an positive integer."});if(a>e)throw new CeligoError({message:"Index Out of Bound. Index must be between 1 and "+
e});},l=function(a,b,c){if(f[a-1]&&f[a-1]!==b)throw new CeligoError({message:"This parameter was previously set to type: "+f[a-1]});f[a-1]=b;g[a-1]=c};c=b||"";e=function(a){if(!a)return 0;a=a.match(/\?/g);return!a?0:a.length}(c);f=[];g=[];h=[];this.setBoolean=function(a,b){k(+a);l(+a,"Boolean",!!b)};this.setDouble=function(a,b){k(+a);l(+a,"Double",b)};this.setString=function(a,b){k(+a);l(+a,"String",b)};this.setInt=function(a,b){k(+a);if(!_.isNumber(+b)||b%1!==0)throw new CeligoError({message:"Not an Integer"});
l(+a,"Integer",+b)};this.setBigDecimal=function(a,b){k(+a);l(+a,"BigDecimal",b)};this.setDate=function(a,b){k(+a);if((new Date(b)).toString()==="Invalid Date")throw new CeligoError({name:"INVALID_DATE_FORMAT",message:"Invalid Date Format => "+b});l(+a,"Date",b)};this.addBatch=function(){if(i(c))throw new CeligoError({message:"cannot add batch for a query statement"});h.push(g);g=[]};this.toJSON=function(){var b={configuration:a.toJSON(),statement:c,statementTypes:f};b.statementValues=i(c)?g:g.length===
0?h:h.concat([g]);return b};this.executeQuery=function(){if(!i(c))throw new CeligoError({message:"cannot executeQuery for a non query statement: "+c});var a=this.toJSON();a.secretKey="9f25542c-8323-445f-9113-e769d6f9d1cb";a=JSON.stringify(a);j.debug("sql query request",a);try{var b=$$.requestURL("https://prd-win01.celigo.com/DBBridge/executeQuery",{payload:Celigo.Base64.encode(a)})}catch(e){throw e=Celigo.Error.convert(e),new CeligoError({name:"ERROR_SEND_REQUEST",message:"error send request or no response",
cause:e});}j.debug(b.getCode(),b.getBody());if(+b.getCode()>200)throw new CeligoError({name:"ERROR_EXECUTE",message:b.getBody()});try{var g=JSON.parse(b.getBody())}catch(f){throw f=Celigo.Error.convert(f),new CeligoError({name:"ERROR_PARSE_RESPONSE",message:"error parse query response",cause:f});}if(g.success!==!0||!g.data)throw new CeligoError({name:"SQL_BRIDGE_ERROR",message:g.completeMessage||g.message,stackTrace:g.stackTrace});return new Celigo.integrator.connectors.sql.ResultSet(g)};this.executeBatch=
this.executeUpdate=function(){if(i(c))throw new CeligoError({message:"cannot executeUpdate for a query statement: "+c});var a=this.toJSON();a.secretKey="9f25542c-8323-445f-9113-e769d6f9d1cb";a=JSON.stringify(a);j.debug("sql update request",a);try{var b=$$.requestURL("https://prd-win01.celigo.com/DBBridge/executeUpdate",{payload:Celigo.Base64.encode(a)})}catch(e){throw e=Celigo.Error.convert(e),new CeligoError({name:"ERROR_SEND_REQUEST",message:"error send request or no response",cause:e});}j.debug(b.getCode(),
b.getBody());if(+b.getCode()>200)throw new CeligoError({name:"ERROR_EXECUTE",message:b.getBody()});try{var g=JSON.parse(b.getBody())}catch(f){throw f=Celigo.Error.convert(f),new CeligoError({name:"ERROR_PARSE_RESPONSE",message:"error parse query response",cause:f});}if(g.success!==!0)throw new CeligoError({name:"SQL_BRIDGE_ERROR",message:g.completeMessage||g.message,stackTrace:g.stackTrace});return new Celigo.integrator.connectors.sql.UpdateResult(g)}};Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES=
{Date:"Date",Boolean:"Boolean",String:"String",BigDecimal:"BigDecimal",Double:"Double",Integer:"Integer"};$.namespace("Celigo.integrator.connectors.sql");Celigo.integrator.connectors.sql.SqlConnector=function(a){if(!a||!(a instanceof Celigo.integrator.connectors.sql.Connection))throw new CeligoError({message:'invalid parameter "connection"'});this.prepareStatement=function(b){return new Celigo.integrator.connectors.sql.PreparedStatement(a,b)};this.getConnection=function(){return a}};$.namespace("Celigo.integrator.connectors.sql");
Celigo.integrator.connectors.sql.SqlConnectorImpl=function(a){this._super(a);var b=(a.bridgeUrlOverride||$$.getContext().getSetting("SCRIPT","custscript_celigo_global_sql_bridge_url")||"https://prd-win01.celigo.com/DBBridge").trim();BRIDGE_update=b+"/executeUpdate";BRIDGE_query=b+"/executeQuery";BRIDGE_secret=(a.bridgeKeyOverride||$$.getContext().getSetting("SCRIPT","custscript_celigo_global_sql_brdg_key")||"9f25542c-8323-445f-9113-e769d6f9d1cb").trim();$$.logExecution("AUDIT","SQL Bridge URL",b);
if(!b||b.indexOf("https")!==0)throw new Celigo.lang.NetSuiteError({name:"CELIGO_BRIDGE_CONFIGURATION_ERROR",message:"Celigo bridge endpoint must be secure (https): the following endpoint introduces a security risk and will not be used => "+b});var c=this,e=function(a){if(!a||!(a instanceof Celigo.integrator.connectors.model.Message))throw new Celigo.Error({name:"invalid_parameter",message:"requires a Celigo.integrator.connectors.model.Message instance"});if(!a.getData()||!(a.getData()instanceof Celigo.integrator.model.PreparedStatementDocument))throw new Celigo.Error({name:"invalid_parameter",
message:"requires message to contain a Celigo.integrator.model.PreparedStatementDocument instance"});if(!a.getData().getContent()||!(a.getData().getContent()instanceof Celigo.integrator.connectors.model.PreparedStatement))throw new Celigo.Error({name:"invalid_parameter",message:"requires document to contain a Celigo.integrator.connectors.model.PreparedStatement instance"});},f=function(b){b=b.toJSON();if(!a.credentialRef.getUserName())a.credentialRef=new Celigo.io.CredentialsManagerDepricated({id:a.credentialRef.getId()});
var c={configuration:{url:a.databaseUrl||(a.credentialRef.getHost?a.credentialRef.getHost():null),username:a.credentialRef.getUserName(),password:a.credentialRef.getPassword()},statement:b.statement,statementTypes:b.paramTypes};c.statementValues=Celigo.integrator.connectors.sql.SqlUtil.isQueryStatement(b.statement)?b.paramValues:b.paramValues.length===0?b.paramValuesBatch:b.paramValuesBatch.concat([b.paramValues]);c.secretKey=BRIDGE_secret;return c},g=function(a,b){try{var e=$$.requestURL(b,{payload:Celigo.Base64.encode(a)})}catch(g){throw new Celigo.Error({name:"ERROR_SEND_REQUEST",
message:"error send request or no response",cause:g});}c.getExecutionLogger().debug(e.getCode(),e.getBody());if(+e.getCode()>200)throw new Celigo.Error({name:"ERROR_EXECUTE",message:e.getBody()});try{var f=JSON.parse(e.getBody())}catch(m){throw new Celigo.Error({name:"ERROR_PARSE_RESPONSE",message:"error parse query response",cause:m});}if(f.success!==!0||!f.data)throw new CeligoError({name:"SQL_BRIDGE_ERROR",message:f.completeMessage||f.message,stackTrace:f.stackTrace});return f};this.getDatabaseUrl=
function(){return a.databaseUrl};this.query=function(a){e(a);a=a.getData().getContent();if(!Celigo.integrator.connectors.sql.SqlUtil.isQueryStatement(a.getStatement()))throw new Celigo.Error({message:"cannot query for a non query statement: "+a.getStatement()});a=JSON.stringify(f(a));c.getExecutionLogger().debug("sql query request",a);a=new Celigo.integrator.connectors.sql.ResultSet(g(a,BRIDGE_query));return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:a})})};
this.update=function(a){e(a);a=a.getData().getContent();if(Celigo.integrator.connectors.sql.SqlUtil.isQueryStatement(a.getStatement()))throw new Celigo.Error({message:"cannot executeUpdate for a query statement: "+a.getStatement()});a=JSON.stringify(f(a));c.getExecutionLogger().debug("sql update request",a);a=new Celigo.integrator.connectors.sql.UpdateResult(g(a,BRIDGE_update));return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:a})})};this.executeBatch=
c.executeUpdate};Celigo.integrator.connectors.sql.SqlConnectorImpl.extend(Celigo.integrator.connectors.Connector);Celigo.integrator.connectors.sql.SqlConnectorImpl.className="Celigo.integrator.connectors.sql.SqlConnectorImpl";$.namespace("Celigo.integrator.connectors.webdav");Celigo.integrator.connectors.webdav.WebDavConnection=function(a){var b=a?a.username:null,c=a?a.password:null,e=a?a.endpoint:null,f=a?a.alwaysUseBridge:!1;e&&e.charAt(e.length-1)!=="/"&&(e+="/");this.getUserName=function(){return b};
this.setUsername=function(a){b=a};this.getPassword=function(){return c};this.setPassword=function(a){c=a};this.getEndpoint=function(){return e};this.setEndpoint=function(a){e=a};this.isAlwaysUseBridge=function(){return f};this.setAlwaysUseBridge=function(a){f=a}};$.namespace("Celigo.integrator.connectors.webdav");Celigo.integrator.connectors.webdav.WebDavConnector=function(a){var b={BRIDGE_URL:"https://prd-win01.celigo.com/HTTPProxy/test?celigoPayload=",BRIDGE_SECRET_KEY:"9f25542c-8323-445f-9113-e769d6f9d1cb",
BRIDGE_MAX_RETRIES:3,INACTIVE:"inactive",CREDENTIALS_REF:"credentialsRef",RELATIVE_PATH:"relativePath",TIMEOUT:"timeout",CREDENTIAL_DATA:"credentialData",SECRET_KEY:"secretKey",PAYLOAD:"payload",IMPORT_FOLDER_ID:"importFolderId",NETSUITE_FILE_TYPE:"netSuiteFileType",NETSUITE_FILE_EXTENSION:"netSuiteFileExtension",REMOVE_EXTENSION:"removeExtension",FILE_CONTENTS:"fileContents",FILE_NAME:"fileName",ALLOWED_WEBDAV_HTTP_RESPONSE_CODES_STRINGS:["200","201","204","207"]},c=function(c,e,f,i,k){var l=null,
m=null,n=m=null,o=null,q=!1;c.charAt(0)==="/"&&(c=c.substring(1,c.length-1));o=a.getEndpoint()+c||"";i&&(o+=i);if(a.isAlwaysUseBridge()||e==="PROPFIND")q=!0;$$.logExecution("DEBUG","WebDAV callViaBridge",q);$$.logExecution("DEBUG","WebDAV httpMethod",e);$$.logExecution("DEBUG","WebDAV destination URL",o);$$.logExecution("DEBUG","WebDAV headers",f?f:"");$$.logExecution("DEBUG","WebDAV fileName",i);$$.logExecution("DEBUG","WebDAV uploadFileContents",k);for(c=0;c<=b.BRIDGE_MAX_RETRIES;c++){l=q?$$.requestURL(b.BRIDGE_URL+
Celigo.Base64.encode(JSON.stringify({secretKey:b.BRIDGE_SECRET_KEY,httpMethod:e,destinationUrl:o})),k||null,f):$$.requestURL(o,k||null,f,e);$$.logExecution("AUDIT","NetSuite Response code",l.getCode());$$.logExecution("AUDIT","NetSuite Response body",$$.escapeXML(l.getBody()));if(!l)throw new CeligoError({name:"CELIGO_UNEXPECTED_ERROR",message:"NetSuite failed to provide WebDAV HTTP response object."});if(q)if(n=l.getHeader("Celigo-Success"),m=l.getHeader("Celigo-Original-Response-Code"),$$.logExecution("DEBUG",
"Celigo Bridge Success Flag",n),n==="true")break;else if(!n)throw new CeligoError({name:"CELIGO_WEBDAV_BRIDGE_ERROR",message:"Request to WebDav service returns invalid Celigo-Success header "+n});}m=m||l.getCode().toString();$$.logExecution("DEBUG","WebDAV Response Code",m);if(n==="false"||b.ALLOWED_WEBDAV_HTTP_RESPONSE_CODES_STRINGS.indexOf(m)===-1)throw new CeligoError({name:"CELIGO_WEBDAV_ERROR",message:"Request to WebDav service could not be completed. Response code: "+l.getCode()+". Response body: "+
l.getBody()});return l},e=function(){return"Basic "+Celigo.Base64.encode(a.getUserName()+":"+a.getPassword())},f=function(a){$$.logExecution("DEBUG","processResponseAndReturnLatestFile ",a);var b=[],c=null,e=null,c=$$.stringToXML(a),a=$$.selectNodes(c,"D:multistatus/D:response");if(!a||a.length===0)return null;for(var f=1;f<a.length;f++)c=$$.selectNodes(a[f],"D:propstat/D:prop/D:getlastmodified"),(e=$$.selectNodes(a[f],"D:propstat/D:prop/D:displayname"))&&!(e.length<1||!e[0].firstChild||!e[0].firstChild.nodeValue||
!c||c.length<1||!c[0].firstChild)&&b.push({lastModifiedDate:new Date(Date.parse(c[0].firstChild.nodeValue)),fileName:e[0].firstChild.nodeValue});if(b.length===0)return null;b=b.sort(function(a,b){return!b.lastModifiedDate||a.lastModifiedDate?0:b.lastModifiedDate-a.lastModifiedDate});$$.logExecution("DEBUG","all nodes info",b);return b};if(!b.BRIDGE_URL||b.BRIDGE_URL.indexOf("https")!==0)throw new Celigo.lang.NetSuiteError({name:"CELIGO_BRIDGE_CONFIGURATION_ERROR",message:"Celigo bridge endpoint must be secure (https): the following endpoint introduces a security risk and will not be used => "+
b.BRIDGE_URL});this.testConnection=function(){c("","PROPFIND",{Authorization:e(),Depth:1})};this.download=function(a,b){if(!b)throw new CeligoError({name:"CELIGO_REQUIRED_ARGUMENT",message:'You are missing the required argument "netSuiteFolderId".'});var j=null,i=null,k=c(a,"PROPFIND",{Authorization:e(),Depth:1}),l=f(k.getBody());if(!l||l.length===0||!l[0].fileName)return null;k=c(a,"GET",{Authorization:e()},l[0].fileName);$$.logExecution("DEBUG","file Contents",$$.escapeXML(k.getBody()));try{j=Celigo.util.FileUtil.createFile(l[0].fileName,
k.getBody()),j.setFolder(b),i=$$.submitFile(j)}catch(m){throw new CeligoError({name:"CELIGO_WEBDAV_FILE_BACKUP_ERROR",message:"Unable to backup file in NetSuite, aborting download.",cause:m});}try{c(a,"DELETE",{Authorization:e()},l[0].fileName)}catch(n){throw $$.deleteFile(i),new CeligoError({name:"CELIGO_WEBDAV_FILE_BACKUP_ERROR",message:"Unable to delete backend-up file from WebDAV server, aborting download.",cause:n});}return new Celigo.integrator.connectors.FileDownloadResult({file:j,moreFilesAvailable:l.length>
1})};this.upload=function(a,b){var f=b.getName();c(a,"PUT",{Authorization:e()},f,b.getValue())}};$.namespace("Celigo.integrator.connectors.async");Celigo.integrator.connectors.async.NativeJSONHTTPConnector=function(a){this._super(a);var b=this,c=$.getExecutionLogger(this.getClassName());if(!a)throw Error("missing connector config");if(!a.url)throw Error('missing connector config "url"');if(!a.method)throw Error('missing connector config "method"');if(a.forceUseProxy===!0)var e=!0;var f=function(a){if((a=
a.getData())&&a.getContent()){a=a.getContent();if(typeof a==="string")try{a=JSON.parse(a)}catch(b){throw Error("expecting a JSON object not invalid");}return a}},g,h=function(a,f,k){var h=b.getContext(),h=h&&h.dataFlowInvocation?h.dataFlowInvocation:{};h.consumerType="Celigo.integrator.consumer.HTTPSender";h.consumerConfig={method:f,url:k,init:{forceUseProxy:e}};a=Celigo.io.Serializable.revive(JSON.stringify({header:JSON.stringify(h),payload:JSON.stringify(a),celigo_classname:"Celigo.io.Message"}));
g||(g=new Celigo.io.MessageManager);g.enqueueMessage(a);c.audit("message queued: "+a.getMessageProperty("id"));Celigo.integrator.consumer.Util.scheduleConsumerRunner();c.audit("message consumer scheduled");return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.JSONDocument({content:{success:!0}})})};this.clone=function(){return new Celigo.integrator.connectors.async.NativeJSONHTTPConnector(_.clone(a))};this.post=function(b){return h(f(b),"post",a.url)};this.put=function(b){return h(f(b),
"put",a.url)};this.del=function(b){return h(f(b),"delete",a.url)};this.auto=function(c){var c=f(c),e=b.getContext(),g;if(e&&e.dataFlowInvocation&&e.dataFlowInvocation.executionType)g=e.dataFlowInvocation.executionType;return h(c,g=="create"?"post":g=="delete"?"delete":"put",a.url)}};Celigo.integrator.connectors.async.NativeJSONHTTPConnector.extend(Celigo.integrator.connectors.Connector);Celigo.integrator.connectors.async.NativeJSONHTTPConnector.className="Celigo.integrator.connectors.async.NativeJSONHTTPConnector";
$.namespace("Celigo.integrator.connectors.system");Celigo.integrator.connectors.system.HttpConnector=function(a){this._super(a);var b=$.getExecutionLogger("Celigo.integrator.connectors.system.HttpConnector"),c=function(){return $$.encrypt($$.getContext().getCompany())},e=this,f=function(a,f,j){if(a&&!(a instanceof Celigo.integrator.connectors.model.Message))throw Error("input data has to be an instance of Celigo. integrator.connectors.model.Message");if(!e.getRequestUrl())throw Error("missing requestUrl");
if(!(j&&j===c)&&e.getRequestUrl().substring(0,26).toLowerCase()!=="https://api.integrator.io/")throw Error("non integrator api requestUrl not allowed");var i;try{var k=e.getRequestHeader()||{};if(j&&j===c)k.Authorization="Bearer "+c();else{var l=$$.lookupField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_iio_token");if(!l)throw Error("missing secure token in record");if(typeof CeligoSecureHelper==="undefined"||!CeligoSecureHelper||!CeligoSecureHelper.decryptAPIToken)throw Error("missing secure token");
var m;try{if(m=CeligoSecureHelper.decryptAPIToken(l),!m)throw Error("empty");}catch(n){throw b.error("decryption error",n.name+" - "+n.message),Error("invalid API token");}k.Authorization="Bearer "+m}var o=a.getData().toString();switch(f){case "POST":if(i=$$.requestURL(e.getRequestUrl(),o,k),+i.getCode()!==202)throw Error("expecting code 202 instead of "+i.getCode());}}catch(q){throw b.error("request url error",q.name+" - "+q.message),new Celigo.Error({name:"REMOTE_UNAVAILABLE",message:q.name+" - "+
q.message});}return new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:i.getBody()})})};this.getRequestUrl=function(){return a.requestUrl};this.setRequestUrl=function(b){a.requestUrl=b};this.getRequestHeader=function(){return a.requestHeader};this.setRequestHeader=function(b){a.requestHeader=b};this.post=function(a){return f(a,"POST")};this.testPost=function(a){return f(a,"POST",c)}};Celigo.integrator.connectors.system.HttpConnector.extend(Celigo.integrator.connectors.Connector);
Celigo.integrator.connectors.system.HttpConnector.className="Celigo.integrator.connectors.system.HttpConnector";if($$.getContext().getScriptId()==="customscript_celigo_consumer_runner")$.namespace("Celigo.integrator.consumer"),Celigo.integrator.consumer.Runner=function(){Celigo.lang.require.setScriptSettingTTL(0);Celigo.lang.require.setScriptSettingPurge(!0);var a=$.getExecutionLogger("Celigo.integrator.consumer.Runner");this.run=function(){var b=$$.getContext().getUser();if(b&&+b!==-4)Celigo.CONSUMER_RUNNER_FORCE_USE_SYSTEM_DATETIME_FORMAT=
!0;var b=!1,c=new Celigo.io.MessageManager,e=(new Date).getTime(),f,g;$.getQueueCount()>1&&(f=new Celigo.util.Locker("CELIGO_CONSUMER_RUNNER",18E5));f&&(g=f.lock());if(f&&!g)a.audit("another instance is running, yielding...");else for(c.loadMessages();c.hasNextMessage();){if((new Date).getTime()-e>=9E5){a.audit("remaining time low, yielding...");b=!0;break}if($$.getContext().getRemainingUsage()<=1E3){a.audit("remaining usage low, yielding...");b=!0;break}c.consumeNextMessage();c.hasNextMessage()||
c.loadMessages()}f&&f.unlock();b&&Celigo.integrator.consumer.Util.scheduleConsumerRunner();Celigo.CONSUMER_RUNNER_FORCE_USE_SYSTEM_DATETIME_FORMAT=!1};this.cleanup=function(){a.audit("cleaning up...");var b=Celigo.io.MessageMetadata.Q,c=(new Date).getTime()-13824E5;if((c=$$.searchRecord(b.recType,null,[new nlobjSearchFilter(b.fldDeadLetter,null,"is","T"),new nlobjSearchFilter(b.fldEnqueued,null,"lessthan",c)],new nlobjSearchColumn(b.fldPayloadFile)))&&c.length)for(var e=0;e<c.length;e++)try{$$.deleteRecord(b.recType,
c[e].getId());try{c[e].getValue(b.fldPayloadFile)&&$$.deleteFile(c[e].getValue(b.fldPayloadFile))}catch(f){}}catch(g){a.debug("deletion exception :"+g.message)}a.audit("done cleaning up")}},Celigo.integrator.consumer.Runner.prototype.scheduled=function(){$$.getContext().getDeploymentId().search(/customdeploy_celigo_consumer_cleaner/i)>-1?this.cleanup():this.run()};$.namespace("Celigo.integrator.consumer");Celigo.integrator.consumer.Util=function(){$.getExecutionLogger("Celigo.integrator.consumer.Util");
return{scheduleConsumerRunner:function(){$$.scheduleScript("customscript_celigo_consumer_runner")}}}();$.namespace("Celigo.integrator.consumer");Celigo.integrator.consumer.DataFlowMessageConsumer=function(){this.logger=$.getExecutionLogger("Celigo.integrator.consumer.DataFlowMessageConsumer")};Celigo.integrator.consumer.DataFlowMessageConsumer.prototype.getDataFlowMetadata=function(a,b){if(a==="batch")return Celigo.integrator.batch.DataFlowMetadata;else if(a==="realtime"&&b==="export")return Celigo.integrator.realtime.ExportMetadata;
else if(a==="realtime"&&b==="import")return Celigo.integrator.realtime.ImportMetadata};Celigo.integrator.consumer.DataFlowMessageConsumer.prototype.consumeMessage=function(a){this.logger.audit("receives message...");this.logger.debug(a.getHeaders());var b=Celigo.integrator.dataflow.InvocationContext,c,e;try{var f=a.getHeaders();if(!f||!f[b.dataFlowType]||!f[b.dataFlowDirection]||!f[b.dataFlowRecordType]||!f[b.dataFlowRecordId])throw Error("missing header values to resume data flow");if(f[b.dataFlowType]===
"realtime"&&f[b.dataFlowDirection]==="export"&&(!f[b.eventType]||!f[b.executionType]))throw Error("missing event type or execution type for realtime export");c=this.getDataFlowMetadata(f[b.dataFlowType],f[b.dataFlowDirection]);if(!c)throw Error('no valid metadata found for flow type "'+f[b.dataFlowType]+'" and flow direction "'+f[b.dataFlowDirection]+'"');Celigo.event.dispatcher.Util.removeAllListeners();e=Celigo.integrator.dataflow.Factory.getDataFlowByRecordId(f[b.dataFlowRecordId],c);f[b.dataFlowType]===
"realtime"&&f[b.dataFlowDirection]==="export"&&(e.setInvocationContextByKey(Celigo.integrator.dataflow.InvocationContext.eventType,f[b.eventType]),e.setInvocationContextByKey(Celigo.integrator.dataflow.InvocationContext.executionType,f[b.executionType]))}catch(g){return b="failed to initialize flow instance, caused by: "+g.name+" - "+g.message,this.logger.error(b),a.setMessageProperty("errorMessage",b),!0}if(a.getHeaderProperty("executionType")==="xedit")try{var h=JSON.parse(a.getPayload());if(h.recordtype&&
(h.id||h.internalid)){if(!Celigo.integrator.consumer.DataFlowMessageConsumer.__cache__)Celigo.integrator.consumer.DataFlowMessageConsumer.__cache__={};var j=Celigo.integrator.consumer.DataFlowMessageConsumer.__cache__,i=h.recordtype,k=String(h.id||h.internalid);j[i]&&j[i][k]?this.logger.debug("expanding xedit message: got cached"):(h=(new Celigo.model.netsuite.RecordJSONifier).jsonifyRec($$.loadRecord(i,k)),j[i]||(j[i]={}),j[i][k]=h,this.logger.debug("expanding xedit message: loaded record"));h=_.clone(j[i][k]);
h.__xedit__=a.getPayload();h=JSON.stringify(h);a.setPayload(h)}}catch(l){this.logger.error("error expanding xedit message",l.message)}e.setMessageToConsume(a);Celigo.integrator.dataflow.Runner.runDataFlow(e);return!0};$.namespace("Celigo.integrator.consumer");Celigo.integrator.consumer.IntegratorIOConsumer=function(){this.logger=$.getExecutionLogger("Celigo.integrator.consumer.IntegratorIOConsumer");this.shouldEmit=this.invokeHook=!0;_.extend(this,new Celigo.event.EventEmitter);this.setName("Celigo.integrator.consumer.IntegratorIOConsumer");
this.setVerbose(!0)};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.getRequestURL=function(a){return this.requestURL||"https://api"+(a?".staging":"")+".integrator.io/v1/netsuite/exports/:_id/data"};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.setRequestURL=function(a){this.requestURL=a};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.getExpectedHttpStatus=function(){return this.expectedHttpStatus||204};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.setExpectedHttpStatus=
function(a){this.expectedHttpStatus=+a;if(this.expectedHttpStatus===NaN)throw Error("invalid expected http status code "+a);};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.shouldInvokeHook=function(){return this.invokeHook};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.setInvokeHook=function(a){this.invokeHook=!!a};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.shouldEmitEvents=function(){return this.shouldEmit};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.setEmitEvents=
function(a){this.shouldEmit=!!a};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.isCancelled=function(){return!!this.cancelled};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.setCancelled=function(a){this.cancelled=!!a};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.unStringify=function(a){try{return JSON.parse(a)}catch(b){return a}};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.stringify=function(a){try{return _.isString(a)?a:JSON.stringify(a)}catch(b){throw Error("error stringify payload; caused by: "+
b.message);}};Celigo.integrator.consumer.IntegratorIOConsumer.prototype.consumeMessage=function(a){try{var b=Celigo.integrator.dataflow.InvocationContext,c=Celigo.integrator.realtime.ExportMetadata,e=a.getHeaders();if(!e||!e[b.integratorIOFlowId]||!e.uuid||!e[b.dataFlowRecordType]||!e[b.dataFlowRecordId])throw Error("missing header value(s): uuid, integratorIOFlowId, NetSuite flow record info");if(e[b.dataFlowType]!=="realtime"||e[b.dataFlowDirection]!=="export"||!e[b.eventType]||!e[b.executionType])throw Error("missing event type or execution type or unsupported flow types");
if(a.getHeaderProperty("executionType")==="xedit")try{var f=JSON.parse(a.getPayload());if(f.recordtype&&(f.id||f.internalid)){if(!Celigo.integrator.consumer.IntegratorIOConsumer.__cache__)Celigo.integrator.consumer.IntegratorIOConsumer.__cache__={};var g=Celigo.integrator.consumer.IntegratorIOConsumer.__cache__,h=f.recordtype,j=String(f.id||f.internalid);if(g[h]&&g[h][j])this.logger.debug("expanding xedit message: got cached");else{var i=JSON.parse(e.sublists||"{}");g[h]||(g[h]={});g[h][j]=(new Celigo.model.netsuite.RecordJSONifier).jsonifyRec($$.loadRecord(h,
j),i);this.logger.debug("expanding xedit message: loaded record")}f=_.clone(g[h][j]);f.__xedit__=a.getPayload();f=JSON.stringify(f);a.setPayload(f)}}catch(k){this.logger.error("error expanding xedit message",k.message)}if(this.shouldEmitEvents()){if(e[b.dataFlowRecordType]&&e[b.dataFlowRecordId]){this.logger.debug("querying flow plugins...");var l=$$.lookupField(e[b.dataFlowRecordType],e[b.dataFlowRecordId],c.getFlowFldPlugins());if(l){this.logger.debug("loading flow plugins...",l);var m;try{if((m=
JSON.parse(l))&&m.length)for(g=0;g<m.length;++g)f=Celigo.io.Serializable.revive(JSON.stringify(m[g])),f.connectWithDispatcher(this)}catch(n){throw Error("error parsing and initializing plugins config: "+n.message);}}}this.emit("BEFORE_CONSUME_MESSAGE",this,a)}if(this.isCancelled())return!0;var o,q,r;if(this.shouldInvokeHook()){var p;try{p=$$.lookupField(e[b.dataFlowRecordType],e[b.dataFlowRecordId],[c.getFlowFldHookPreSendFile(),c.getFlowFldHookPreSendFunc(),c.getFlowFldHookPreSendConfig(),c.getFlowFldHookSettings()])}catch(w){p=
$$.lookupField(e[b.dataFlowRecordType],e[b.dataFlowRecordId],[c.getFlowFldHookPreSendFile(),c.getFlowFldHookPreSendFunc(),c.getFlowFldHookSettings()]),p[c.getFlowFldHookPreSendConfig()]=void 0}var u=p?p[c.getFlowFldHookPreSendFile()]:null,s=p?p[c.getFlowFldHookPreSendFunc()]:null,f={};if(p[c.getFlowFldHookPreSendConfig()])try{f=JSON.parse(p[c.getFlowFldHookPreSendConfig()])}catch(v){$$.logExecution("error","Invalid PreSend Hook Configuration JSON",v.message)}var t=p?p[c.getFlowFldHookSettings()]:
"{}",t=this.unStringify(t);if(Celigo.integrator.Hook.should(u,s)){var y=this.unStringify(a.getPayload()),x=Celigo.integrator.Hook.invokeWithFile("preSend",u,s,{data:y,configuration:f,settings:t});if(x&&x.errors&&_.isArray(x.errors)&&x.errors.length){for(p=0;p<x.errors.length;p++)x.errors[p].source="suitescript_hook";q=x.errors;o=void 0;r=Error("preSend hook error response: "+x.errors[0]&&x.errors[0].message)}else if(x&&x.data&&_.isArray(x.data)&&x.data.length)q=void 0,o=x.data,r=void 0;else return!0}else q=
void 0,o=[this.unStringify(a.getPayload())],r=void 0}else q=void 0,o=[this.unStringify(a.getPayload())],r=void 0;if(!q&&!o)return!0;var B=e[b.integratorIOFlowId],A,z;q?(A=this.getRequestURL(a.getHeaderProperty("isStaging")).replace(":_id",encodeURIComponent(B)).replace("/data","/errors"),z=this.stringify(q)):(A=this.getRequestURL(a.getHeaderProperty("isStaging")).replace(":_id",encodeURIComponent(B)),z=this.stringify(o));var E;try{var C=$$.lookupField(e[b.dataFlowRecordType],e[b.dataFlowRecordId],
c.getFlowFldToken());if(!C)throw Error("missing secure token on flow record");if(typeof CeligoSecureHelper==="undefined"||!CeligoSecureHelper||!CeligoSecureHelper.decryptAPIToken)throw Error("missing secure token");var F=CeligoSecureHelper.decryptAPIToken(C);if(!F)throw Error("empty");E=F}catch(I){throw this.logger.error("error fetching token",I.name+" - "+I.message),Error("no API token");}a={"Content-Type":"application/json",Authorization:"Bearer "+E};try{var L=$$.getContext();a["X-NetSuite-CompanyId"]=
L.getCompany();a["X-NetSuite-Environment"]=L.getEnvironment();a["X-NetSuite-Version"]=L.getVersion()}catch(M){$$.logExecution("error","Error extracting the context: getContext",M)}var J=this.getExpectedHttpStatus();try{var G=(new Date).getTime();this.logger.debug("posting url",A);var H=$$.requestURL(A,z,a);this.logger.debug(H.getCode(),H.getBody());if(+H.getCode()===401||+H.getCode()===403||+H.getCode()===404)try{return $$.submitField(e[b.dataFlowRecordType],e[b.dataFlowRecordId],c.getFlowFldDisabled(),
"T"),!0}catch(K){this.logger.error("error processing "+H.getCode()+": "+K.message)}if(+H.getCode()!==J)throw Error("expecting code "+J+" instead of "+H.getCode());$$.submitField("customrecord_celigo_global_cache",1,"custrecord_iio_api_down_at","0")}catch(D){throw(new Date).getTime()-G>3E4&&(this.logger.debug("API may be down"),$$.submitField("customrecord_celigo_global_cache",1,"custrecord_iio_api_down_at",String((new Date).getTime()))),D;}if(r)throw r;return!0}finally{this.logger.debug("removing event handlers..."),
this.removeAllListeners()}};$.namespace("Celigo.integrator.consumer");Celigo.integrator.consumer.HTTPSender=function(){this._super();this.logger=$.getExecutionLogger("Celigo.integrator.consumer.HTTPSender")};Celigo.integrator.consumer.HTTPSender.extend(Celigo.io.Consumer);Celigo.integrator.consumer.HTTPSender.className="Celigo.integrator.consumer.HTTPSender";Celigo.integrator.consumer.HTTPSender.prototype.consumeMessage=function(a){var b;try{b=a.getHeaders();if(!b||b.consumerType!=="Celigo.integrator.consumer.HTTPSender"||
!b.consumerConfig)throw Error("missing httpConfig");b=b.consumerConfig}catch(c){return this.logger.error("error getting message headers, caused by: "+c.message),a.setMessageProperty("errorMessage","invalid headers: "+c.message),!1}try{var e=(new Celigo.integrator.connectors.http.HttpClient(b.init||{})).request(b.method,b.url,b.headers||{},a.getPayload()),f=+e.getCode();if(f>=200&&f<300)return!0;else throw Error('non-successful status code "'+e.getCode()+'"');}catch(g){return this.logger.error("error sending payload, caused by: "+
g.message),a.setMessageProperty("errorMessage",g.message),!1}};$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.SqlStatementMetadata=function(a){this._super(a);this.getSchemaName=function(){return a.schemaName};this.setSchemaName=function(b){a.schemaName=b};this.getTableName=function(){return a.tableName};this.setTableName=function(b){a.tableName=b};this.getSqlStatementType=function(){return a.sqlStatementType};this.setSqlStatementType=function(b){Celigo.integrator.connectors.sql.SqlUtil.validateStatementType(b);
a.sqlStatementType=b};this.getJsExternalIdProperty=function(){return a.jsExternalIdProperty||"externalid"};this.setJsExternalIdProperty=function(b){a.jsExternalIdProperty=b};this.getTablePrimaryKeyProperty=function(){return a.tablePrimaryKeyProperty};this.setTablePrimaryKeyProperty=function(b){a.tablePrimaryKeyProperty=b};this.getPreparedStatement=function(){return a.preparedStatement};this.setPreparedStatement=function(b){a.preparedStatement=b}};Celigo.integrator.mapping.model.SqlStatementMetadata.className=
"Celigo.integrator.mapping.model.SqlStatementMetadata";Celigo.integrator.mapping.model.SqlStatementMetadata.extend(Celigo.io.PrivateStateful);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.StatefulMapping=function(a){this._super(a);this.get=function(b){return a[b]};this.getValue=function(b,c){return a[b][c]};this.set=function(b,c){a[b]=c};this.setValue=function(b,c,e){a[b][c]=e};this.toJSON=function(){a.celigo_classname=this.getClassName();return _.clone(a)}};Celigo.integrator.mapping.model.StatefulMapping.className=
"Celigo.integrator.mapping.model.StatefulMapping";Celigo.integrator.mapping.model.StatefulMapping.extend(Celigo.io.Serializable);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.DocumentMapping=function(a){if(a.id){var b=Celigo.JSON.parse(Celigo.integrator.util.IntegratorUtil.getMappingFileContent(a.id));_.defaults(b,a);delete b.id;b=Celigo.io.Serializable.revive(Celigo.JSON.stringify(b));b.setMappingId(a.id);return b}this._super(a);if(!a.recordMappings)a.recordMappings=
[];if(!a.staticLookupMaps)a.staticLookupMaps={};_.each(a.staticLookupMaps,function(a){_.each(a,function(b,c){a[c.toLowerCase()]=b})});var c=null;this.getMappingId=function(){return c};this.setMappingId=function(a){c=a};this.getHeaderMappings=function(){this.validateConfigType("headerMappings",Celigo.integrator.mapping.model.FieldMappingSet,!0,!0);return a.headerMappings};this.getHeaderMapping=function(b){return a.headerMappings[b]};this.setHeaderMappings=function(b){a.headerMappings=b};this.setHeaderMapping=
function(b,c){a.headerMappings[b]=c};this.getRecordMappings=function(){this.validateConfigType("recordMappings",Celigo.integrator.mapping.model.RecordMapping,!0,!0);return a.recordMappings};this.getRecordMapping=function(b){return a.recordMappings[b]};this.setRecordMappings=function(b){a.recordMappings=b};this.setRecordMapping=function(b,c){a.recordMappings[b]=c};this.addRecordMapping=function(b){a.recordMappings.push(b)};this.getFooterMappings=function(){this.validateConfigType("footerMappings",
Celigo.integrator.mapping.model.FieldMappingSet,!0,!0);return a.footerMappings};this.getFooterMapping=function(b){return a.footerMappings[b]};this.setFooterMappings=function(b){a.footerMappings=b};this.setFooterMapping=function(b,c){a.footerMappings[b]=c};this.getStaticLookupMaps=function(){return a.staticLookupMaps||{}};this.getStaticLookupMap=function(b){return a.staticLookupMaps[b]||{}};this.setStaticLookupMap=function(b,c){a.staticLookupMaps[b]=c};this.isMapToErrorFileDisabled=function(){return!!a.mapToErrorFileDisabled};
this.getUiProperties=function(){return a.uiProperties}};Celigo.integrator.mapping.model.DocumentMapping.extend(Celigo.io.PrivateStateful);Celigo.integrator.mapping.model.DocumentMapping.className="Celigo.integrator.mapping.model.DocumentMapping";$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.FrontendMapping=function(a){this._super(a);this.getTranslator=function(){return a.translator};this.setTranslator=function(b){a.translator=b}};Celigo.integrator.mapping.model.FrontendMapping.extend(Celigo.integrator.mapping.model.DocumentMapping);
Celigo.integrator.mapping.model.FrontendMapping.className="Celigo.integrator.mapping.model.FrontendMapping";$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.FlatFileMapping=function(a){this._super(a);this.getFileHasHeaders=function(){return a.fileHasHeaders};this.setFileHasHeaders=function(b){a.fileHasHeaders=b};this.getLineDelimiter=function(){return a.lineDelimiter||"\n"};this.setLineDelimiter=function(b){a.lineDelimiter=b};this.getReplaceLineBreaksInCellDataWithSpace=
function(){return a.replaceLineBreaksInCellDataWithSpace};this.setReplaceLineBreaksInCellDataWithSpace=function(b){a.replaceLineBreaksInCellDataWithSpace=b};this.getReplaceTabsInCellDataWithSpace=function(){return a.replaceTabsInCellDataWithSpace};this.setReplaceTabsInCellDataWithSpace=function(b){a.replaceTabsInCellDataWithSpace=b}};Celigo.integrator.mapping.model.FlatFileMapping.className="Celigo.integrator.mapping.model.FlatFileMapping";Celigo.integrator.mapping.model.FlatFileMapping.extend(Celigo.integrator.mapping.model.DocumentMapping);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.CsvFileMapping=function(a){this._super(a);this.getFieldDelimiter=function(){this.validateConfigType("fieldDelimiter","string",!1,!0);return a.fieldDelimiter||","};this.setFieldDelimiter=function(b){a.fieldDelimiter=b};this.getWrapWithQuotes=function(){this.validateConfigType("wrapWithQuotes","boolean",!1,!0);return a.wrapWithQuotes};this.setWrapWithQuotes=function(b){a.wrapWithQuotes=b};this.getAdditionalControlCharacters=
function(){this.validateConfigType("additionalControlCharacters","string",!0,!0);return a.additionalControlCharacters};this.setAdditionalControlCharacters=function(b){a.additionalControlCharacters=b};this.getReplaceLineBreaksInCellDataWithSpace=function(){this.validateConfigType("replaceLineBreaksInCellDataWithSpace","boolean",!1,!0);return a.replaceLineBreaksInCellDataWithSpace};this.setReplaceLineBreaksInCellDataWithSpace=function(b){a.replaceLineBreaksInCellDataWithSpace=b};this.getReplaceTabsInCellDataWithSpace=
function(){this.validateConfigType("replaceLineBreaksInCellDataWithSpace","boolean",!1,!0);return a.replaceTabsInCellDataWithSpace};this.setReplaceTabsInCellDataWithSpace=function(b){a.replaceTabsInCellDataWithSpace=b}};Celigo.integrator.mapping.model.CsvFileMapping.extend(Celigo.integrator.mapping.model.FlatFileMapping);Celigo.integrator.mapping.model.CsvFileMapping.className="Celigo.integrator.mapping.model.CsvFileMapping";$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.FixedWidthFileMapping=
function(a){this._super(a);this.getLeftAlign=function(){return a.leftAlign};this.setLeftAlign=function(b){a.leftAlign=b};this.getFillCharacter=function(){return a.fillCharacter};this.setFillCharacter=function(b){a.fillCharacter=b}};Celigo.integrator.mapping.model.FixedWidthFileMapping.className="Celigo.integrator.mapping.model.FixedWidthFileMapping";Celigo.integrator.mapping.model.FixedWidthFileMapping.extend(Celigo.integrator.mapping.model.FlatFileMapping);$.namespace("Celigo.integrator.mapping.model");
Celigo.integrator.mapping.model.XmlFileMapping=function(a){this._super(a);this.getNamespaces=function(){return a.namespaces};this.setNamespaces=function(b){a.namespaces=b};this.getDocumentElementQualifiedName=function(){this.validateConfigType("documentElementQualifiedName","string",!1,!1);return a.documentElementQualifiedName};this.setDocumentElementQualifiedName=function(b){a.documentElementQualifiedName=b};this.getCreateNodeForEmptyField=function(){this.validateConfigType("createNodeForEmptyField",
"boolean",!1,!0);return _.isUndefined(a.createNodeForEmptyField)?!0:a.createNodeForEmptyField};this.setCreateNodeForEmptyField=function(b){a.createNodeForEmptyField=b};this.getUseUnnamedNamespace=function(){this.validateConfigType("useUnnamedNamespace","boolean",!1,!0);return _.isUndefined(a.useUnnamedNamespace)?!0:a.useUnnamedNamespace};this.setUseUnnamedNamespace=function(b){a.useUnnamedNamespace=b}};Celigo.integrator.mapping.model.XmlFileMapping.className="Celigo.integrator.mapping.model.XmlFileMapping";
Celigo.integrator.mapping.model.XmlFileMapping.extend(Celigo.integrator.mapping.model.DocumentMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.JsonMapping=function(a){this._super(a)};Celigo.integrator.mapping.model.JsonMapping.className="Celigo.integrator.mapping.model.JsonMapping";Celigo.integrator.mapping.model.JsonMapping.extend(Celigo.integrator.mapping.model.DocumentMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.MappingNode=
function(a){this._super(a);if(!a.children)a.children=[];this.getChildren=function(){return a.children};this.getChild=function(b){return a.children[b]};this.setChildren=function(b){a.children=b};this.setChild=function(b,c){a.children[b]=c};this.addChild=function(b){a.children.push(b)}};Celigo.integrator.mapping.model.MappingNode.className="Celigo.integrator.mapping.model.MappingNode";Celigo.integrator.mapping.model.MappingNode.extend(Celigo.io.PrivateStateful);$.namespace("Celigo.integrator.mapping.model");
Celigo.integrator.mapping.model.RecordMapping=function(a){this._super(a);this.getSavedSearchBindings=function(){return a.savedSearchBindings};this.getSavedSearchBinding=function(b){return a.savedSearchBindings[b]};this.setSavedSearchBindings=function(b){a.savedSearchBindings=b};this.setSavedSearchBinding=function(b,c){a.savedSearchBindings[b]=c};this.getRecordIdentifiers=function(){return a.recordIdentifiers};this.setRecordIdentifiers=function(b){a.recordIdentifiers=b};this.getRecordType=function(){return a.recordType};
this.setRecordType=function(b){a.recordType=b}};Celigo.integrator.mapping.model.RecordMapping.className="Celigo.integrator.mapping.model.RecordMapping";Celigo.integrator.mapping.model.RecordMapping.extend(Celigo.integrator.mapping.model.MappingNode);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.CollectionMapping=function(a){this._super(a);if(!a.collectionIds)a.collectionIds=[];this.getCollectionIds=function(){this.validateConfigType("collectionIds","string",!0,!0);
return a.collectionIds};this.getCollectionId=function(b){return a.collectionIds[b]};this.setCollectionIds=function(b){a.collectionIds=b};this.setCollectionIds=function(b,c){a.collectionIds[b]=c}};Celigo.integrator.mapping.model.CollectionMapping.extend(Celigo.integrator.mapping.model.MappingNode);Celigo.integrator.mapping.model.CollectionMapping.className="Celigo.integrator.mapping.model.CollectionMapping";$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.XmlCollectionMapping=
function(a){this._super(a);this.getXPath=function(){return a.xPath};this.setXPath=function(b){a.xPath=b}};Celigo.integrator.mapping.model.XmlCollectionMapping.className="Celigo.integrator.mapping.model.XmlCollectionMapping";Celigo.integrator.mapping.model.XmlCollectionMapping.extend(Celigo.integrator.mapping.model.CollectionMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.JsonCollectionMapping=function(a){this._super(a);this.getJsonPath=function(){return a.jsonPath};
this.setJsonPath=function(b){a.jsonPath=b}};Celigo.integrator.mapping.model.JsonCollectionMapping.className="Celigo.integrator.mapping.model.JsonCollectionMapping";Celigo.integrator.mapping.model.JsonCollectionMapping.extend(Celigo.integrator.mapping.model.CollectionMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.SqlCollectionMapping=function(a){this._super(a);if(!a.sqlStatementMetadata)a.sqlStatementMetadata=new Celigo.integrator.mapping.model.SqlStatementMetadata({});
this.getSqlStatementMetadata=function(){return a.sqlStatementMetadata};this.setSqlStatementMetadata=function(b){return a.sqlStatementMetadata=b}};Celigo.integrator.mapping.model.SqlCollectionMapping.className="Celigo.integrator.mapping.model.SqlCollectionMapping";Celigo.integrator.mapping.model.SqlCollectionMapping.extend(Celigo.integrator.mapping.model.CollectionMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.FieldMappingSet=function(a){this._super(a);if(!a.fieldMappings)a.fieldMappings=
[];this.getFieldMappings=function(){return a.fieldMappings};this.getFieldMapping=function(b){return a.fieldMappings[b]};this.setFieldMappings=function(b){a.fieldMappings=b};this.setFieldMapping=function(b,c){a.fieldMappings[b]=c};this.addFieldMapping=function(b){a.fieldMappings.push(b)}};Celigo.integrator.mapping.model.FieldMappingSet.className="Celigo.integrator.mapping.model.FieldMappingSet";Celigo.integrator.mapping.model.FieldMappingSet.extend(Celigo.integrator.mapping.model.MappingNode);$.namespace("Celigo.integrator.mapping.model");
Celigo.integrator.mapping.model.SqlFieldMappingSet=function(a){this._super(a);if(!a.sqlStatementMetadata)a.sqlStatementMetadata=new Celigo.integrator.mapping.model.SqlStatementMetadata({});this.getSqlStatementMetadata=function(){return a.sqlStatementMetadata};this.setSqlStatementMetadata=function(b){return a.sqlStatementMetadata=b}};Celigo.integrator.mapping.model.SqlFieldMappingSet.className="Celigo.integrator.mapping.model.SqlFieldMappingSet";Celigo.integrator.mapping.model.SqlFieldMappingSet.extend(Celigo.integrator.mapping.model.FieldMappingSet);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.LineMappingSet=function(a){this._super(a);this.getLineIds=function(){return a.lineIds};this.getLineId=function(b){return a.lineIds[b]};this.setLineIds=function(b){a.lineIds=b};this.setLineId=function(b,c){a.lineIds[b]=c}};Celigo.integrator.mapping.model.LineMappingSet.className="Celigo.integrator.mapping.model.LineMappingSet";Celigo.integrator.mapping.model.LineMappingSet.extend(Celigo.integrator.mapping.model.FieldMappingSet);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.NodeMappingSet=function(a){this._super(a)};Celigo.integrator.mapping.model.NodeMappingSet.className="Celigo.integrator.mapping.model.NodeMappingSet";Celigo.integrator.mapping.model.NodeMappingSet.extend(Celigo.integrator.mapping.model.FieldMappingSet);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.FieldMapping=function(a){this._super(a);if(_.isNumber(a.externalField))a.externalField=a.externalField.toString();
var b=null;this.isInactive=function(){this.validateConfigType("inactive","boolean",!1,!0);return a.inactive};this.setInactive=function(b){a.inactive=b};this.getJsField=function(){this.validateConfigType("jsField","string",!1,!0);return a.jsField};this.setJsField=function(b){a.jsField=b};this.getExternalField=function(){this.validateConfigType("externalField","string",!1,!0);return a.externalField};this.setExternalField=function(b){a.externalField=b};this.getExternalFieldSize=function(){return a.externalFieldSize};
this.setExternalFieldSize=function(b){a.externalFieldSize=b};this.getHardCodedValue=function(){return a.hardCodedValue};this.setHardCodedValue=function(b){a.hardCodedValue=b};this.getDateFormat=function(){this.validateConfigType("dateFormat","string",!1,!0);return a.dateFormat};this.setDateFormat=function(b){a.dateFormat=b};this.getDateTimeZone=function(){this.validateConfigType("dateTimeZone","string",!1,!0);return a.dateTimeZone};this.setDateTimeZone=function(b){a.dateTimeZone=b};this.getLookupType=
function(){this.validateConfigType("lookupType","string",!1,!0);return a.lookupType};this.setLookupType=function(b){a.lookupType=b};this.getLookupSource=function(){this.validateConfigType("lookupSource","string",!1,!0);return a.lookupSource};this.setLookupSource=function(b){a.lookupSource=b};this.getLookupKey=function(){this.validateConfigType("lookupKey","string",!1,!0);return a.lookupKey};this.setLookupKey=function(b){a.lookupKey=b};this.getLookupFilterExpression=function(){return a.lookupFilterExpression};
this.getLookupFilterExpressionCache=function(c,e){if(!b){for(var f=a.lookupFilterExpression,g=f,h=[],j=/{{([^{^}]+)}}/g,i=j.exec(f),k=0,l=0;i&&k<10;){k++;var m=i[1];nlapiLogExecution("debug","efield",m);var n=c!=="Celigo.integrator.mapper.json.JsonMapper"?m.replace(/\s/g,"$pAc3$").replace(/\./g,"$dot$"):m;c==="Celigo.integrator.mapper.json.JsonMapper"&&e===!0&&m.search(/^\[.+\].*/)===-1&&m.search(/^[\d|\*]+\..*/)===-1&&(m="[0]."+m,n="[0]."+n,g=g.substring(0,i.index+2+l)+"[0]."+g.substring(i.index+
2+l),l+=4);h.push({iFld:n,eFld:m});n!==m&&(g=g.replace("{{"+m+"}}","{{"+n+"}}"));i=j.exec(f)}b={exp:g,fields:h};$$.logExecution("DEBUG","lookupFilterExpressionCache",b)}return b};this.setLookupFilterExpression=function(b){a.lookupFilterExpression=b};this.getLookupOperator=function(){return a.lookupOperator};this.setLookupOperator=function(b){a.lookupOperator=b};this.getLookupValue=function(){this.validateConfigType("lookupValue","string",!1,!0);return a.lookupValue};this.setLookupValue=function(b){a.lookupValue=
b};this.getLookupAllowFailures=function(){return a.lookupAllowFailures};this.setLookupAllowFailures=function(b){a.lookupAllowFailures=b};this.getLookupDefaultValue=function(){return a.lookupDefaultValue};this.setLookupDefaultValue=function(b){a.lookupDefaultValue=b};this.getUseDefaultOnMultipleMatches=function(){return a.useDefaultOnMultipleMatches};this.setUseDefaultOnMultipleMatches=function(b){a.useDefaultOnMultipleMatches=b};this.getLookupFilters=function(){return a.lookupFilters};this.setLookupFilters=
function(b){a.lookupFilters=b};this.getExternalDatatype=function(){return a.externalDatatype};this.setExternalDatatype=function(b){a.externalDatatype=b};this.getSubRecordMapping=function(){return a.subRecordMapping};this.setSubRecordMapping=function(b){a.subRecordMapping=b};this.isCacheAll=function(){this.validateConfigType("cacheAll","boolean",!1,!0);return a.cacheAll};this.setCacheAll=function(b){a.cacheAll=b};this.isMandatory=function(){this.validateConfigType("mandatory","boolean",!1,!0);return a.mandatory};
this.setMandatory=function(b){a.mandatory=b};this.getNamespaces=function(){return a.namespaces};this.setNamespaces=function(b){a.namespaces=b};this.setInternalId=function(b){a.internalId=b};this.isInternalId=function(){this.validateConfigType("internalId","boolean",!1,!0);return a.internalId};this.setImmutable=function(b){a.immutable=b};this.isImmutable=function(){this.validateConfigType("immutable","boolean",!1,!0);return a.immutable};this.getLookupKeyIsExternalId=function(){this.validateConfigType("lookupKeyIsExternalId",
"boolean",!1,!0);return a.lookupKeyIsExternalId};this.setLookupKeyIsExternalId=function(b){a.lookupKeyIsExternalId=!!b};this.getLookupRelationshipName=function(){this.validateConfigType("lookupRelationshipName","string",!1,!0);return a.lookupRelationshipName};this.setLookupRelationshipName=function(b){a.lookupRelationshipName=b}};Celigo.integrator.mapping.model.FieldMapping.className="Celigo.integrator.mapping.model.FieldMapping";Celigo.integrator.mapping.model.FieldMapping.extend(Celigo.io.PrivateStateful);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.FixedWidthFieldMapping=function(a){this._super(a);this.getFillCharacter=function(){return a.fillCharacter};this.setFillCharacter=function(b){a.fillCharacter=b};this.getLeftAlign=function(){return a.leftAlign};this.setLeftAlign=function(b){a.leftAlign=b};this.getColumnWidth=function(){return a.columnWidth};this.setColumnWidth=function(b){a.columnWidth=b};this.getColumnStart=function(){return a.columnStart};this.setColumnStart=
function(b){a.columnStart=b};this.getTruncationIndicator=function(){return a.truncationIndicator||""};this.setTruncationIndicator=function(b){a.truncationIndicator=b}};Celigo.integrator.mapping.model.FixedWidthFieldMapping.className="Celigo.integrator.mapping.model.FixedWidthFieldMapping";Celigo.integrator.mapping.model.FixedWidthFieldMapping.extend(Celigo.integrator.mapping.model.FieldMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.MappingError=function(a){this._super(a);
this.getIndex=function(){return a.index};this.setIndex=function(b){a.index=b};this.getIndexNumber=function(){return a.indexNumber};this.setIndexNumber=function(b){a.indexNumber=b};this.getError=function(){return a.error};this.setError=function(b){a.error=b};this.getExternalId=function(){return a.externalId};this.setExternalId=function(b){a.externalId=b}};Celigo.integrator.mapping.model.MappingError.className="Celigo.integrator.mapping.model.MappingError";Celigo.integrator.mapping.model.MappingError.extend(Celigo.io.PrivateStateful);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.MapToExternalResult=function(a){this._super(a);this.getDocument=function(){return a.document};this.setDocument=function(b){a.document=b};this.getMappingErrors=function(){return a.mappingErrors};this.setMappingErrors=function(b){a.mappingErrors=b}};Celigo.integrator.mapping.model.MapToExternalResult.className="Celigo.integrator.mapping.model.MapToExternalResult";Celigo.integrator.mapping.model.MapToExternalResult.extend(Celigo.io.PrivateStateful);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.MapToNetSuiteResult=function(a){this._super(a);this.getJsObjects=function(){return a.jsObjects};this.setJsObjects=function(b){a.jsObjects=b};this.getMappingErrors=function(){return a.mappingErrors};this.setMappingErrors=function(b){a.mappingErrors=b}};Celigo.integrator.mapping.model.MapToNetSuiteResult.className="Celigo.integrator.mapping.model.MapToNetSuiteResult";Celigo.integrator.mapping.model.MapToNetSuiteResult.extend(Celigo.io.PrivateStateful);
$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.RecordIdentifier=function(a){this._super(a)};Celigo.integrator.mapping.model.RecordIdentifier.className="Celigo.integrator.mapping.model.RecordIdentifier";Celigo.integrator.mapping.model.RecordIdentifier.extend(Celigo.io.PrivateStateful);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.TokenLimitRecordIdentifier=function(a){this._super(a);this.getStartToken=function(){this.validateConfigType("startToken",
"string",!1,!1);return a.startToken};this.setStartToken=function(b){a.startToken=b};this.getEndToken=function(){this.validateConfigType("endToken","string",!1,!0);return a.endToken};this.setEndToken=function(b){a.endToken=b}};Celigo.integrator.mapping.model.TokenLimitRecordIdentifier.className="Celigo.integrator.mapping.model.TokenLimitRecordIdentifier";Celigo.integrator.mapping.model.TokenLimitRecordIdentifier.extend(Celigo.integrator.mapping.model.RecordIdentifier);$.namespace("Celigo.integrator.mapping.model");
Celigo.integrator.mapping.model.KeyColumnRecordIdentifier=function(a){this._super(a);this.getKeyColumns=function(){return a.keyColumns};this.setKeyColumns=function(b){a.keyColumns=b}};Celigo.integrator.mapping.model.KeyColumnRecordIdentifier.className="Celigo.integrator.mapping.model.KeyColumnRecordIdentifier";Celigo.integrator.mapping.model.KeyColumnRecordIdentifier.extend(Celigo.integrator.mapping.model.RecordIdentifier);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.XPathRecordIdentifier=
function(a){this._super(a);this.getXPath=function(){this.validateConfigType("xPath","string",!1,!1);return a.xPath};this.setXPath=function(b){a.xPath=b};this.getNamespaces=function(){return a.namespaces};this.setNamespaces=function(b){a.namespaces=b}};Celigo.integrator.mapping.model.XPathRecordIdentifier.className="Celigo.integrator.mapping.model.XPathRecordIdentifier";Celigo.integrator.mapping.model.XPathRecordIdentifier.extend(Celigo.integrator.mapping.model.RecordIdentifier);$.namespace("Celigo.integrator.mapping.model");
Celigo.integrator.mapping.model.JsonPathRecordIdentifier=function(a){this._super(a);this.getJsonPath=function(){return a.jsonPath};this.setJsonPath=function(b){a.jsonPath=b}};Celigo.integrator.mapping.model.JsonPathRecordIdentifier.className="Celigo.integrator.mapping.model.JsonPathRecordIdentifier";Celigo.integrator.mapping.model.JsonPathRecordIdentifier.extend(Celigo.integrator.mapping.model.RecordIdentifier);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.OutboundJSONMappingSet=
function(a){this._super(a);this.getWritePath=function(){return a.writePath};this.setWritePath=function(b){a.writePath=b};this.getReadPath=function(){return a.readPath};this.setReadPath=function(b){a.readPath=b}};Celigo.integrator.mapping.model.OutboundJSONMappingSet.extend(Celigo.integrator.mapping.model.FieldMappingSet);Celigo.integrator.mapping.model.OutboundJSONMappingSet.className="Celigo.integrator.mapping.model.OutboundJSONMappingSet";$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.OutboundJSONDocumentMapping=
function(a){this._super(a);this.getOutputPath=function(){return a.outputPath};this.setOutputPath=function(b){a.outputPath=b}};Celigo.integrator.mapping.model.OutboundJSONDocumentMapping.className="Celigo.integrator.mapping.model.OutboundJSONDocumentMapping";Celigo.integrator.mapping.model.OutboundJSONDocumentMapping.extend(Celigo.integrator.mapping.model.DocumentMapping);$.namespace("Celigo.integrator.mapping.model");Celigo.integrator.mapping.model.RealtimeFieldMappingSet=function(a){this._super(a);
this.getReadPath=function(){return a.readPath};this.setReadPath=function(b){a.readPath=b}};Celigo.integrator.mapping.model.RealtimeFieldMappingSet.extend(Celigo.integrator.mapping.model.FieldMappingSet);Celigo.integrator.mapping.model.RealtimeFieldMappingSet.className="Celigo.integrator.mapping.model.RealtimeFieldMappingSet";$.namespace("Celigo.integrator.mapping");if(!Celigo.cache)Celigo.cache={};if(!Celigo.cache.mapperCache)Celigo.cache.mapperCache={};Celigo.integrator.mapping.DeprecatedAbstractMapper=
function(){var a=this,b=new Date(2012,2,25),c={MAPPING_DATA:"mappingData",DATA_TRANSPORT_MEDIUM:"dataTransportMedium",NLOBJ_RECORD_TYPE:"nlobjRecordType",MAPPINGS:"mappings",MAPPING_TO_APPLY:"mappingToApply",EXTERNAL_FIELD:"externalField",JS_FIELD:"jsField",HARD_CODED_VALUE:"hardCodedValue",DATE_FORMAT:"dateFormat",DATE_TIME_ZONE:"dateTimeZone",SUBLIST:"sublist",LOOKUP_TYPE:"lookupType",LOOKUP_SOURCE:"lookupSource",LOOKUP_KEY:"lookupKey",LOOKUP_VALUE:"lookupValue",LOOKUP_ALLOW_FAILURES:"lookupAllowFailures",
LOOKUP_FILTERS:"lookupFilters",DO_NOT_CACHE_LOOKUP:"doNotCacheLookup",lookupAllowBodyFieldInternalId:"lookupAllowBodyFieldInternalId",headerFieldFirstLineOnly:"headerFieldFirstLineOnly",defaultValueIfEmpty:"default",inactive:"inactive"},e={},f=function(b,c){for(var e=[],f=0;f<c.length;f++){var k=c[f],l=k[b];if(!l&&!k[a.getConstant("inactive")])throw $$.createError("MISSING_REQUIRED_PARAMETER",b+"is null for mapping index: "+f);e.push(l)}return e};this.getConstant=function(a){return c[a]};this.getLookupValue=
function(b,c,e){var f=c[a.getConstant("LOOKUP_SOURCE")];if(!f)throw $$.createError("MISSING_REQUIRED_PARAMETER",a.getConstant("LOOKUP_SOURCE")+" is required for lookup mapping.");var k=c[a.getConstant("LOOKUP_ALLOW_FAILURES")];if("static"===c[a.getConstant("LOOKUP_TYPE")]){c=e[f][b];if(!c){if(k!==!0)throw e="Could not find mapping in static lookup.",e+=" { Source: "+f+"}",e+=" { Key: "+b+"}",$$.createError("MISSING_STATIC_LOOKUP",e);return""}return c}var l=c[a.getConstant("LOOKUP_KEY")];if(!l)throw $$.createError("MISSING_REQUIRED_PARAMETER",
a.getConstant("LOOKUP_KEY")+" is required for value lookup.");var m=c[a.getConstant("LOOKUP_VALUE")];if(!m)throw $$.createError("MISSING_REQUIRED_PARAMETER",a.getConstant("LOOKUP_VALUE")+" is required for value lookup.");var n=f+"_"+l+"_"+m,e="Could not find instance in value lookup.";e+=" { Source: "+f+"}";e+=" { Key Field: "+l+"}";e+=" { Value Field: "+m+"}";e+=" { Key Value: "+b+"}";if(Celigo.cache.mapperCache[n]){c=Celigo.cache.mapperCache[n][b];if(!c){if(k!==!0)throw $$.createError("MISSING_LOOKUP",
e);return""}return c}var o=c[a.getConstant("LOOKUP_FILTERS")];o||(o=_.contains($.getIsInActiveSearchFilterNonSupportedObjectIds(),f)?[]:["isinactive.null.is.F"]);c[a.getConstant("DO_NOT_CACHE_LOOKUP")]&&o.push(new nlobjSearchFilter(l,null,"is",b));var q=[];q.push(new nlobjSearchColumn("internalid"));q[0].setSort();l!=="internalid"&&!c[a.getConstant("DO_NOT_CACHE_LOOKUP")]&&q.push(new nlobjSearchColumn(l));m!=="internalid"&&q.push(new nlobjSearchColumn(m));f=$.search({type:f,filters:o,columns:q,sortedByInternalId:!0})||
[];if(c[a.getConstant("DO_NOT_CACHE_LOOKUP")])if(f.length===0)if(k)return"";else throw $$.createError("MISSING_LOOKUP",e);else return(c=f[0].getValue(m))&&m==="internalid"&&(c=parseInt(c,10)),log("lookupValue",m),log("looked value",c),c;o={};for(q=0;q<f.length;q++)f[q].getValue(l)&&((c=f[q].getValue(m))&&m==="internalid"&&(c=parseInt(c,10)),o[f[q].getValue(l)]=c);Celigo.cache.mapperCache[n]=o;c=o[b];if(!c){if(k!==!0)throw $$.createError("MISSING_LOOKUP",e);return""}return c};this.getImportMappingsToApply=
function(b){var c=b[a.getConstant("MAPPING_TO_APPLY")];return c?[b[c]]:a.getAllImportSubMappings(b)};this.getAllImportSubMappings=function(b){for(var c=[],e=_.keys(b),f=0;f<e.length;f++){var k=b[e[f]];k&&k[a.getConstant("MAPPINGS")]&&c.push(k)}return c};this.getMappingsFromMappingToApply=null;this.mapOneExternalObjectToJSObject_isNewLine=function(b){return a.mapOneExternalObjectToJSObject_isNewLine_defaultImpl(b)};this.mapOneExternalObjectToJSObject_isNewLine_defaultImpl=function(a){var a=a.mapping[c.JS_FIELD],
f=_.first(a.split("."));logUntil("Abstract Mapper - mapOneExternalObjectToJSObject_isNewLine_defaultImpl - jsField",a,b);logUntil("Abstract Mapper - mapOneExternalObjectToJSObject_isNewLine_defaultImpl - subListId",f,b);e[f]||(e[f]=a);logUntil("Abstract Mapper - mapOneExternalObjectToJSObject_isNewLine_defaultImpl - fieldMarkingNewLineItem",e[f],b);return a===e[f]?!0:!1};this.mapOneExternalObjectToJSObject_sublistFieldOnFirstRow=!0;this.mapOneExternalObjectToJSObject=function(c,e,j,i){var k=a.getMappingsFromMappingToApply?
a.getMappingsFromMappingToApply(c,i):c[a.getConstant("MAPPINGS")];if(!k||k.length===0)throw $$.createError("MISSING_REQUIRED_PARAMETER",a.getConstant("MAPPINGS")+" is required for mapping objects.");var l=f(a.getConstant("JS_FIELD"),k),m=c[a.getConstant("NLOBJ_RECORD_TYPE")];if(!m)throw $$.createError("MISSING_MAPPING_PARAMETER",a.getConstant("NLOBJ_RECORD_TYPE")+" is required.");var n=c[a.getConstant("headerFieldFirstLineOnly")];n!==!1&&(n=!0);for(var o={},q={},r=0;r<j;r++){i.mappingJSObject=e;i.currentRow=
r;a.getMappingsFromMappingToApply&&r>0&&(k=a.getMappingsFromMappingToApply(c,i),l=f(a.getConstant("JS_FIELD"),k));for(var p={},w={},u=0;u<l.length;u++){var s,v=l[u],t=k[u];if(t[a.getConstant("inactive")]!==!0){s=t[a.getConstant("HARD_CODED_VALUE")];var y=t[a.getConstant("SUBLIST")];logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - jsField",v,b);i.mapping=t;if(!a.isValidHardCodedValue(s)){s=a.getFieldValue(i);if(s==="celigo-special-way-to-say-there-is-no-value")continue;var x=t[a.getConstant("DATE_FORMAT")],
B=t[a.getConstant("DATE_TIME_ZONE")],A=t[a.getConstant("LOOKUP_TYPE")];if(x||B)s?(s=Celigo.dateUtil.convertTimeStampToDate(s,x,B),s=$$.dateToString(s,"datetime")):s="";else if(A)if(s){if(!y&&!t[a.getConstant("lookupAllowBodyFieldInternalId")]&&t[a.getConstant("LOOKUP_VALUE")]==="internalid")throw $$.createError("DEVELOPER_ERROR","You should not use internal id lookup for field "+v+" because it is a body field.");s=a.getLookupValue(s,t,e)}else s=""}logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - cellValue",
s,b);if(_.isNull(s)||s==="")(t=t[a.getConstant("defaultValueIfEmpty")])&&(s=t);if(!_.isNull(s))if(y&&y===!0){if(a.mapOneExternalObjectToJSObject_sublistFieldOnFirstRow||r>0){logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - row",r,b);v=v.split(".");p[v[0]]||(p[v[0]]={});w[_.first(v)]||(w[_.first(v)]=a.mapOneExternalObjectToJSObject_isNewLine(i));y=p[v[0]];for(t=1;t<v.length;t++)t<v.length-1?(y[v[t]]||(y[v[t]]={}),y=y[v[t]]):(x=v[t].indexOf("[]"),x===-1?y[v[t]]=s:(x=v[t].substr(0,x),y[x]||
(y[x]=[]),y[x].push(s)))}}else if(r===0||!n){v=v.split(".");y=o;for(t=0;t<v.length;t++)t<v.length-1?(y[v[t]]||(y[v[t]]={}),y=y[v[t]]):(x=v[t].indexOf("[]"),x===-1?y[v[t]]=s:(x=v[t].substr(0,x),y[x]||(y[x]=[]),y[x].push(s)))}}}logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - sublists before",q,b);u=0;for(v=_.keys(p);u<v.length;u++)if(t=v[u],w[t])q[t]?q[t].push(p[t]):q[t]=[p[t]];else if(y=_.last(q[t]),s=p[t],y){logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - lastLineItem "+
t,y,b);logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - additionalColumns "+t,s,b);t=0;for(x=_.keys(s);t<x.length;t++)y[x[t]]=_.isArray(y[x[t]])?y[x[t]].concat(s[x[t]]):s[x[t]]}logUntil("Abstract Mapper - mapOneExternalObjectToJSObject - sublists after",q,b)}return{nlobjRecordType:m,nlobjFieldIds:o,nlobjSublistIds:q}};this.isValidHardCodedValue=function(a){return a||a===!1||a===""||a===0};this.getExportValue=function(b,c,e){var f=c[a.getConstant("HARD_CODED_VALUE")];if(a.isValidHardCodedValue(f))return f;
f=c[a.getConstant("JS_FIELD")];if(!f)throw $$.createError("MISSING_MAPPING_PARAMETER",a.getConstant("JS_FIELD")+" is null for mapping "+JSON.stringify(c));b=b[f];if(!_.isUndefined(b)&&!_.isNull(b))if(_.isArray(b))b=_.invoke(b,"toString");else if(b==="")return"";else b=b.toString();else return b;var f=c[a.getConstant("DATE_FORMAT")],k=c[a.getConstant("DATE_TIME_ZONE")];return f||k?Celigo.dateUtil.convertDateToTimeStamp(new Date(b),f,k):c[a.getConstant("LOOKUP_TYPE")]?a.getLookupValue(b,c,e):b};this.verifyRequiredParameter=
function(a,b,c){c||(c=function(a){return!!a||a===0});if(!c(b))throw $$.createError("MISSING_REQUIRED_PARAMETER",a+" is required.");};this.generatePrintableObjectIndex=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c],c<a.length-1&&(b+=" - ");return b};this.mapJSToExternal=function(c,e){var f=a.mapJSToExternalWithoutLoggingError(c,e),i=f.failedToMap;i&&i.length>0&&(Celigo.integrator.mapping.DeprecatedAbstractMapper.totalCountOfMappingErrors+=i.length);for(var k=0;i&&k<i.length;k++){var l=i[k].error,
l="Mapping error at index: "+i[k].index+" | Code: "+(l.name||l.getCode())+" | Message: "+(l.message||l.getDetails());logUntil("Abstract Mapper - mapJSToExternal - logging error",l,b);$L.errorOnCurrentJob(l)}return f};this.mapJSToExternalWithoutLoggingError=function(){throw $$.createError("DEVELOPER_ERROR","mapJSToExternalWithoutLoggingError not implemented");};this.mapExternalToJS=function(){throw $$.createError("DEVELOPER_ERROR","mapExternalToJS not implemented");};this.mapErrorsToExternal=function(){throw $$.createError("DEVELOPER_ERROR",
"mapErrorsToExternal not implemented");}};Celigo.integrator.mapping.DeprecatedAbstractMapper.totalCountOfMappingErrors=0;Celigo.AbstractMapper=Celigo.integrator.mapping.DeprecatedAbstractMapper;Celigo.util.namespace("Celigo.integrator.mapping");Celigo.integrator.mapping.RecordMapping=Backbone.Model.extend({initialize:function(a){$$.logExecution("DEBUG","Initialize RecordMapping",{args:arguments})},normalize:function(a,b){var c=a.plainText,c=JSON.parse(c);if(!c.name)c.name=c.mappingName||b;c.id=b;
c.mappingId=b;return c},getMappingsInUse:function(){var a;a=[["custrecord_celigo_batch_data_flow_userid","isempty",""],"AND",["isinactive","is","F"]];var b=[new nlobjSearchColumn("custrecord_celigo_batch_data_flow_conf")],c=[],e,f;a=$$.searchRecord("customrecord_celigo_batch_data_flow",null,a,b);_.each(a,function(a){try{if(a.getValue("custrecord_celigo_batch_data_flow_conf"))(f=JSON.parse(a.getValue("custrecord_celigo_batch_data_flow_conf")))&&f.responseMappingRef&&f.responseMappingRef.id?(e=f.responseMappingRef.id,
c.push(e),f.uiProperties&&f.uiProperties.operationMappings&&_.each(f.uiProperties.operationMappings,function(a){c.push(a)})):f&&f.requestMappingRef&&f.requestMappingRef.id&&c.push(f.requestMappingRef.id)}catch(b){}});a=[["custrecord_celigo_rt_export_userid","isempty",""],"AND",["isinactive","is","F"]];b=[new nlobjSearchColumn("custrecord_celigo_rt_export_conf")];a=$$.searchRecord("customrecord_celigo_rt_export_flow",null,a,b);_.each(a,function(a){try{if(a.getValue("custrecord_celigo_rt_export_conf")&&
(f=JSON.parse(a.getValue("custrecord_celigo_rt_export_conf")))&&f.requestMappingRef&&f.requestMappingRef.id)e=f.requestMappingRef.id,c.push(e)}catch(b){}});a=[["custrecord_celigo_rt_import_userid","isempty",""],"AND",["isinactive","is","F"]];b=[new nlobjSearchColumn("custrecord_celigo_rt_import_flow_conf")];a=$$.searchRecord("customrecord_celigo_rt_import_flow",null,a,b);_.each(a,function(a){try{if(a.getValue("custrecord_celigo_rt_import_flow_conf")&&(f=JSON.parse(a.getValue("custrecord_celigo_rt_import_flow_conf")))&&
f.requestMappingRef&&f.requestMappingRef.id)e=f.requestMappingRef.id,c.push(e),f.uiProperties&&f.uiProperties.operationMappings&&_.each(f.uiProperties.operationMappings,function(a){c.push(a)})}catch(b){}});return _.uniq(c)},getCollection:function(){var a=Celigo.core.file.FolderStructureManager.getFolder("Celigo/Integrator/Configuration/Global/Mappings").internalId;if(!a)throw $$.createError("CONFIG_FILE_INITIALIZATION_ERROR","Unable to find Mapping configuration folder.");var b=[];b.push(new nlobjSearchColumn("modified"));
b[0].setSort(!0);b.push(new nlobjSearchColumn("name"));var a=$.search({type:"file",filters:["folder.null.is."+a],columns:b}),c=[],e=this.getMappingsInUse(),f=null,g=null,h=null;_.each(e,function(a){h=a;try{f=this.normalize(this.getFileData(h),h),c.push(f)}catch(b){}},this);_.each(a,function(a){g=a.getValue("name");h=g.substring(0,g.length-4);if(e.indexOf(h)===-1)try{f=this.normalize(this.getFileData(h),h),c.push(f)}catch(b){}},this);return c},getFileData:function(a){$$.logExecution("AUDIT","getFileData",
a);var b=null;try{b=$$.loadFile("Celigo/Integrator/Configuration/Global/Mappings/"+a+".txt")}catch(c){c=Celigo.Error.convert(c);Celigo.util.handleError(c);Celigo.core.file.FolderStructureManager.addPath("Celigo/Integrator/Configuration/Global/Mappings");Celigo.core.file.FolderStructureManager.createMissingFolders();b=$$.createFile(a+".txt","PLAINTEXT","{}");a=Celigo.core.file.FolderStructureManager.getFolder("Celigo/Integrator/Configuration/Global/Mappings").internalId;if(!a)throw $$.createError("CONFIG_FILE_INITIALIZATION_ERROR",
"Unable to create mapping configuration file. Cannot find system folder at Celigo/Integrator/Configuration/Global/Mappings");b.setFolder(a);b=$$.submitFile(b);b=$$.loadFile(b)}b={file:b,plainText:Celigo.util.FileUtil.decryptLoadedConfigFileIfEncrypted(b)};a=null;try{a=JSON.parse(b.plainText)}catch(e){throw e=Celigo.Error.convert(e),Celigo.util.handleError(e),$$.createError("CONFIG_FILE_CORRUPTION","Unable to retrieve stored Mapping due to corrupted configuration file, please contact Celigo Support with the following : "+
e.message||e.getMessage());}if(!a)throw $$.createError("CONFIG_FILE_CORRUPTION","Unable to retrieve stored Mapping due to corrupted configuration file, please contact Celigo Support.");return b},sync:function(a,b){$.log("OPERATION",a);switch(a){case "create":case "update":var c=this.id||Celigo.util.makeGuid(),e=this.getFileData(c),f=JSON.parse(e.plainText),f=null,f=this.clone(),f=JSON.stringify(f),f=JSON.parse(f);Celigo.SuiteScript.logExecution("AUDIT","deleting id from fileContent");delete f.id;
Celigo.SuiteScript.logExecution("AUDIT","deleted id from fileContent",f);f=JSON.stringify(f);Celigo.SuiteScript.logExecution("AUDIT","Mapping before update",f);Celigo.util.FileUtil.isConfigFileEncrypted(f)&&(f=Celigo.core.crypto.Encryptor.encrypt(f));Celigo.util.FileUtil.updateFile(e.file.getId(),f);return c;case "read":return b.id?this.normalize(this.getFileData(b.id),b.id):this.getCollection();case "delete":if(!b.id)throw $$.createError("ID_REQUIRED",'Please set "id" before invoking "DELETE".');
e=this.getFileData(b.id);$$.deleteFile(e.file.getId());return b.id}}});Celigo.util.namespace("Celigo.core.mapping");Celigo.core.mapping.RecordMapping=Celigo.integrator.mapping.RecordMapping;$.namespace("Celigo.integrator.mapping.flat");Celigo.integrator.mapping.flat.BaseFlatFileMapper=function(a){Celigo.integrator.mapping.flat.BaseFlatFileMapper.superclass.constructor.call(this,a);var b=this,c=new Date(2012,3,14),e={OUTPUT_HEADERS:"outputHeaders",SEPARATOR:"separator",WRAP_WITH_QUOTES:"wrapWithQuotes",
REPLACE_LINE_BREAKS_IN_CELL_DATA_WITH_SPACE:"replaceLineBreaksInCellDataWithSpace",REPLACE_TABS_IN_CELL_DATA_WITH_SPACE:"replaceTabsInCellDataWithSpace",FILE_HAS_HEADERS:"fileHasHeaders",columnIndex:"columnIndex"},f=[],g=[],h=function(a){return a?!!a[b.getCSVConstant("FILE_HAS_HEADERS")]:!0},j=function(a){var c=",";if(!a)return c;(a=a[b.getCSVConstant("SEPARATOR")])&&(c=a);return c},i=function(a,e){logUntil("mapJSObjectArrayToTwoDimArrayWithoutUsingMappings - start",null,c);var g=[],k=a.getNextObject();
f=[];for(var i=_.keys(k[0]),i=i.filter(function(a){return!a||a==="id"||a==="recordType"||a==="datecreated"||a==="celigoExportType"?!1:!0}),j=[],p=0;p<i.length;p++)j.push(i[p]);logUntil("mapJSObjectArrayToTwoDimArrayWithoutUsingMappings - fileHeaders",j,c);h(e)&&g.push(j);for(var w=null,i=null;k;){w=[];for(p=0;p<k.length;p++)try{i=[];objectToMap=k[p];for(var u=0;u<j.length;u++)i.push(objectToMap[j[u]]);w.push(i)}catch(s){s=Celigo.Error.convert(s),w={},u=a.getCurrentObjectIndex(),w.index=b.generatePrintableObjectIndex(u),
w.error=s,f.push(w),w=[]}g=g.concat(w);k=a.getNextObject()}return g},k=function(a,e,f,g){g=g||b.getImportMappingsToApply(e,a)[0];logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - mappingToApply",g,c);var i=g[b.getConstant("MAPPINGS")];logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - mappings",i,c);for(var j=0;i&&j<i.length;j++){var h=i[j];if(h[b.getConstant("NLOBJ_RECORD_TYPE")]){logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - subMappings",h,c);var w=h[b.getCSVConstant("columnIndex")];
logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - columnIndex",(w||0).toString(),c);for(var u=0;a&&u<a.length;u++){var s=k([a[u]],e,f,h);logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - mappedSubRecord",s,c);if(w)if(a[u].length>w&&!_isUndefined(a[u][w]))throw $$.createError("CELIGO_CORE_ERROR","BaseCSVMapper - mapTwoDimArrayRecordToJSObject - subrecord is already mapped");else a[u][w]=s;else w=a[u].length,a[u].push(s),h[b.getCSVConstant("columnIndex")]=w}}}logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - recordTwoDimArray after mapped subrecords",
a,c);logUntil("BaseCSVMapper - mapTwoDimArrayRecordToJSObject - mappingToApply after mapped subrecords",g,c);return b.mapOneExternalObjectToJSObject(g,e,a.length,{recordTwoDimArray:a,completeTwoDimArray:f})};this.getLineSeparator=function(){return"\n"};this.getCSVConstant=function(a){return e[a]};this.convertCSVColumnNameToColumnIndex=function(a,b){var e=null;if("string"===typeof a){if(e=b[0].indexOf(a),e===-1)throw $$.createError("MISSING_COLUMN","Column not found in csv headers for "+a);}else if(e=
a,logUntil("BaseCSVMapper - convertCSVColumnNameToColumnIndex - completeTwoDimArray[0]",b[0],c),e>=b[0].length)throw $$.createError("INDEX_OUT_OF_BOUNDS","columnIndex cannot be greater than or equal to the length of the array.");return e};this.getExportHeaders=function(a){for(var c=[],a=a[b.getConstant("MAPPINGS")],e=0;e<a.length;e++){var f=a[e],g=f[b.getConstant("EXTERNAL_FIELD")];g||(g=f[b.getConstant("JS_FIELD")]);if(!g)throw $$.createError("MISSING_REQUIRED_PARAMETER",b.getConstant("EXTERNAL_FIELD")+
" and "+b.getConstant("JS_FIELD")+"not defined for mapping index: "+e);c.push(g)}return c};this.fileToTwoDimArray=function(a,b){var e=j(b),e=e||",";a.length>0&&a.charAt(0)===e&&(a='""'+a);for(var f=RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),g=[[]],k=null;k=f.exec(a);){logUntil("BaseCSVMapper - fileToTwoDimArray - arrMatches",k,c);var i=k[1];i.length&&i!=e&&g.push([]);k=k[2]?k[2].replace(RegExp('""',"g"),'"'):k[3]||"";g[g.length-1].push(k)}g.length>0&&(e=g[g.length-
1],(e.length===0||e.length===1&&e[0]==="")&&g.pop());return g};this.preProcessTwoDimArrayBeforeConvertingToFileContents=function(a,c,e){var f=[],g=j(c),k=!0,i=!1,h=!1,u=!1;c&&(k=c[b.getCSVConstant("OUTPUT_HEADERS")],i=c[b.getCSVConstant("WRAP_WITH_QUOTES")],h=c[b.getCSVConstant("REPLACE_LINE_BREAKS_IN_CELL_DATA_WITH_SPACE")],u=c[b.getCSVConstant("REPLACE_TABS_IN_CELL_DATA_WITH_SPACE")]);for(var s,v,t=0;t<a.length;t++)if(!(t===0&&k===!1)){c=a[t];s=[];for(var y=0;y<c.length;y++)v=c[y]||"",Object.prototype.toString.apply(v)===
"[object String]"&&(e===!0&&(v.indexOf(g)!==-1||v.indexOf('"')!==-1||v.indexOf("\n")!==-1)?(v=v.replace(/\"/g,'""'),v='"'+v+'"'):i&&i===!0&&(v='"'+v+'"'),h&&h===!0&&(v=v.replace(/(\r\n|\n|\r)/g," ")),u&&u===!0&&(v=v.replace(/\t/g," "))),s.push(v);f.push(s)}return f};this.convertProcessedTwoDimArrayToCSVFileContents=function(a,c){for(var e="",f=j(c),g=b.getLineSeparator(c),k=0;k<a.length;k++)for(var i=a[k],h=0;h<i.length;h++)e+=i[h],e+=h<i.length-1?f:g;return e};this.getFieldValue=function(a){var e=
a.recordTwoDimArray,f=a.completeTwoDimArray,g=a.mappingJSObject,k=a.mapping,a=a.currentRow;logUntil("BaseCSVMapper - getFieldValue - currentRow",(a||0).toString(),c);logUntil("BaseCSVMapper - getFieldValue - mapping",k,c);var i=k[b.getCSVConstant("columnIndex")];if(_.isUndefined(i)){k=k[b.getConstant("EXTERNAL_FIELD")];if(!_.isString(k)&&!_.isNumber(k))throw $$.createError("MISSING_MAPPING_PARAMETER",b.getConstant("EXTERNAL_FIELD")+" is null for - "+jsField);if(_.isString(k)&&!h(g))throw $$.createError("INVALID_MAPPING_FIELD",
"externalField can't be a string if file doesn't have headers.");if(_.isString(k)){if(i=f[0].indexOf(k),i===-1)throw $$.createError("MISSING_COLUMN","Column not found in csv headers for "+k);}else i=k}logUntil("BaseCSVMapper - getFieldValue - columnIndex",i.toString(),c);if(i>=e[a].length)throw $$.createError("INDEX_OUT_OF_BOUNDS","columnIndex cannot be greater than or equal to the length of the array.");return e[a][i]};this.getStartIndex=function(a){return h(a)?1:0};this.preProcessExportMappingJSObject=
function(a){return a};this.preProcessImportMappingJSObject=function(a){return a};this.convertTwoDimArrayToFileContents=function(a,c){var e=b.preProcessTwoDimArrayBeforeConvertingToFileContents(a,c,!0);return b.convertProcessedTwoDimArrayToCSVFileContents(e,c)};this.mapJSToExternalWithoutLoggingError=function(a,c){var e=[[]];if(c){var c=b.preProcessExportMappingJSObject(c),e=c[b.getConstant("MAPPINGS")],g;if(!e||e.length===0)g=i(a,c);else{var e=c,k=[],j=b.getExportHeaders(e),h=e[b.getConstant("MAPPINGS")];
k.push(j);f=[];for(j=a.getNextObject();j;){for(var w=[],u=0;u<j.length;u++)try{var s=[];objectToMap=j[u];for(var v=[],t=0;t<h.length;t++)if(g=h[t],g[b.getConstant("inactive")]!==!0){var y=b.getExportValue(objectToMap,g,e);(_.isUndefined(y)||_.isNull(y))&&v.push("Field value is missing for mapping "+JSON.stringify(g));s.push(y)}if(v.length>0)throw $$.createError("MISSING_FIELD_VALUE",v.join(" | "));w.push(s)}catch(x){x=Celigo.Error.convert(x),w={},s=a.getCurrentObjectIndex(),w.index=b.generatePrintableObjectIndex(s),
w.error=x,f.push(w),w=[]}k=k.concat(w);j=a.getNextObject()}g=k}e=g}else e=i(a);return{fileContents:b.convertTwoDimArrayToFileContents(e,c),failedToMap:f}};this.mapExternalToJS=function(a,e){if(!e)throw $$.createError("UNEXPECTED_ERROR","mappingJSObject is null or empty.");var e=b.preProcessImportMappingJSObject(e),f={},i=e,j=[];g=[];logUntil("twoDimArray",a,c);for(var h=b.getStartIndex(i);h<a.length;){var p={};try{var p=b.transferExternalRecord(a,h,i),w=p.recordArray;logUntil("transferredRecord['recordArray'] - "+
h,p.recordArray,c);if(w.length>0){var u=k(w,i,a);logUntil("jsObject - "+h,u,c);j.push({jsObject:u,rowIndex:h})}}catch(s){var s=Celigo.Error.convert(s),v={rowIndex:h,code:s.name||s.getCode(),message:s.message||s.getDetails()};g.push(v)}v=h;p.lastIndex?h=p.lastIndex+1:h+=1;if(h<=v)throw $$.createError("FATAL_ERROR","A fatal error has happened in BaseCSVMapper: i <= oldI");}f.jsObjects=j;f.failedToMap=g;return f};this.mapErrorsToExternal=function(a,e,f){logUntil("BaseCSVMapper - mapErrorsToExternal - started",
"",c);if(!f)throw $$.createError("UNEXPECTED_ERROR","mappingJSObject is null or empty.");f=b.preProcessImportMappingJSObject(f);logUntil("BaseCSVMapper - mapErrorsToExternal - preProcessImportMappingJSObject successfully","",c);var g=f,k=[],i=[];i.push("Error Code");i.push("Error Message");h(g)&&(i=i.concat(a[0]));k.push(i);for(g=b.getStartIndex(g);g<a.length;g++)i=[],i.push(""),i.push(""),i=i.concat(a[g]),k.push(i);logUntil("BaseCSVMapper - mapErrorsToExternal - addEmptyErrorColumns successfully",
"",c);a=f;for(i=0;i<e.length;i++){var g=e[i],j=g.rowIndex;h(a)||(j+=1);k[j][0]=g.code;k[j][1]=g.message}logUntil("BaseCSVMapper - mapErrorsToExternal - copyMappingfailuresToTwoDimArrayContainingErrors successfully","",c);e=b.preProcessTwoDimArrayBeforeConvertingToFileContents(k,f,!0);logUntil("BaseCSVMapper - mapErrorsToExternal - preProcessTwoDimArrayBeforeConvertingToFileContents successfully","",c);return b.convertProcessedTwoDimArrayToCSVFileContents(e,f)};this.transferExternalRecord=function(){throw $$.createError("DEVELOPER_ERROR",
"transferExternalRecord not implemented");}};Celigo.integrator.mapping.flat.BaseFlatFileMapper.extend(Celigo.integrator.mapping.DeprecatedAbstractMapper);$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.BaseCSVMapper=Celigo.integrator.mapping.flat.BaseFlatFileMapper;$.namespace("Celigo.integrator.mapping.flat");Celigo.integrator.mapping.flat.FlatFileMapper=function(a){Celigo.integrator.mapping.flat.FlatFileMapper.superclass.constructor.call(this,a);this.transferExternalRecord=function(a,
c){return{recordArray:[a[c]],lastIndex:c}}};Celigo.integrator.mapping.flat.FlatFileMapper.extend(Celigo.integrator.mapping.flat.BaseFlatFileMapper);$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.StandardCSVMapper=Celigo.integrator.mapping.flat.FlatFileMapper;$.namespace("Celigo.integrator.mapping.flat.csv");Celigo.integrator.mapping.flat.csv.MultiLineCsvMapper=function(a){Celigo.integrator.mapping.flat.csv.MultiLineCsvMapper.superclass.constructor.call(this,a);var b=this;constants=
{limitToken:"limitToken",tokenStart:"tokenStart",tokenEnd:"tokenEnd",identifierExternalField:"identifierExternalField",keyColumn:"keyColumn",noSubListOnFirstLine:"noSubListOnFirstLine"};logUntilDate=new Date(2012,9,29);identifierColumnIndex=tokenEnd=tokenStart=limitToken=null;transferExternalRecordUsingToken=function(a,c,g,h){logUntil("MultiLineCSVMapper - transferExternalRecordUsingToken - index",c,logUntilDate);c===b.getStartIndex(h)&&(tokenStart=limitToken[constants.tokenStart],b.verifyRequiredParameter(constants.tokenStart,
tokenStart),tokenEnd=limitToken[constants.tokenEnd]);for(var g=[],h=null,j=!1,i=a.length-1;c<a.length;c++)if(h=a[c][identifierColumnIndex],j||h===tokenStart){g.push(a[c]);logUntil("MultiLineCSVMapper - transferExternalRecordUsingToken - added",c,logUntilDate);if(tokenEnd){if(h===tokenEnd){i=c;break}}else if(j&&h===tokenStart){i=c-1;g.pop();break}j=!0}return{lastIndex:i,recordArray:g}};keyColumnIndex=foundKey=null;transferExternalRecordUsingKey=function(a,c,g,h){logUntil("MultiLineCSVMapper - transferExternalRecordUsingKey - index",
c,logUntilDate);c===b.getStartIndex(h)&&(foundKey={},logUntil("MultiLineCSVMapper - transferExternalRecordUsingKey - mappingJSObject",h,logUntilDate),logUntil("MultiLineCSVMapper - transferExternalRecordUsingKey - mappingToApply",g,logUntilDate),g=b.getKeyColumnConfig(g,h),b.verifyRequiredParameter(constants.keyColumn,g),keyColumnIndex=b.convertCSVColumnNameToColumnIndex(g,a),logUntil("MultiLineCSVMapper - transferExternalRecordUsingKey - keyColumnIndex",keyColumnIndex,logUntilDate));for(var g=[],
j=h=null;c<a.length;c++)key=a[c][keyColumnIndex],foundKey[key]||(h||(h=key),key===h?g.push(a[c]):_.isNull(j)&&(j=c-1));_.isNull(j)&&(j=a.length-1);_.isNull(h)||(foundKey[h]=!0);return{lastIndex:j,recordArray:g}};this.identifierExternalFieldRequired=!1;this.getKeyColumnConfig=function(a,b){logUntil("MultiLineCSVMapper - getKeyColumnConfig - keyColumn",b[constants.keyColumn],logUntilDate);return b[constants.keyColumn]};var c=null;this.transferExternalRecord=function(a,f,g){logUntil("MultiLineCSVMapper - transferExternalRecord - index",
f===0?"0":f,logUntilDate);if(f===b.getStartIndex(g)){c=b.getImportMappingsToApply(g)[0];logUntil("MultiLineCSVMapper - mappingToApply",c,logUntilDate);if(limitToken=c[constants.limitToken])b.identifierExternalFieldRequired=!0;if(b.identifierExternalFieldRequired){var h=c[constants.identifierExternalField];b.verifyRequiredParameter(constants.identifierExternalField,h);logUntil("MultiLineCSVMapper - transferExternalRecord - identifierExternalField",h,logUntilDate);identifierColumnIndex=b.convertCSVColumnNameToColumnIndex(h,
a)}logUntil("MultiLineCSVMapper - transferExternalRecord - limitToken",limitToken,logUntilDate);logUntil("MultiLineCSVMapper - transferExternalRecord - identifierColumnIndex",identifierColumnIndex,logUntilDate)}h=null;h=limitToken?transferExternalRecordUsingToken(a,f,c,g):transferExternalRecordUsingKey(a,f,c,g);logUntil("MultiLineCSVMapper - transferExternalRecord - lastIndex",h.lastIndex,logUntilDate);for(a=0;h.recordArray&&a<h.recordArray.length;a++)logUntil("MultiLineCSVMapper - transferExternalRecord - recordArray - "+
a,h.recordArray[a],logUntilDate);return h};this.preProcessImportMappingJSObject=function(a){b.mapOneExternalObjectToJSObject_sublistFieldOnFirstRow=a[constants.noSubListOnFirstLine]?!1:!0;return a};this.getIdentifierColumnIndex=function(){return identifierColumnIndex}};Celigo.integrator.mapping.flat.csv.MultiLineCsvMapper.extend(Celigo.integrator.mapping.flat.BaseFlatFileMapper);$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.MultiLineCSVMapper=Celigo.integrator.mapping.flat.csv.MultiLineCsvMapper;
$.namespace("Celigo.integrator.mapping.flat.csv");Celigo.integrator.mapping.flat.csv.MultiLineMultiMappingCsvMapper=function(a){Celigo.integrator.mapping.flat.csv.MultiLineMultiMappingCsvMapper.superclass.constructor.call(this,a);var b=this,c=new Date(2012,1,6),e={keyColumn:"keyColumn"};this.mapOneExternalObjectToJSObject_sublistFieldOnFirstRow=this.identifierExternalFieldRequired=!0;this.getImportMappingsToApply=function(a){var c=a[b.getConstant("MAPPING_TO_APPLY")];if(c)return a[c].headerFieldFirstLineOnly=
!1,[a[c]]};this.getMappingsFromMappingToApply=function(a,c){var e=c.recordTwoDimArray[c.currentRow||0][b.getIdentifierColumnIndex()];return a[e].mappings};this.getKeyColumnConfig=function(a){logUntil("MultiLineMultiMappingCSVMapper - getKeyColumnConfig - keyColumn",a[e.keyColumn],c);return a[e.keyColumn]}};Celigo.integrator.mapping.flat.csv.MultiLineMultiMappingCsvMapper.extend(Celigo.integrator.mapping.flat.csv.MultiLineCsvMapper);$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.MultiLineMultiMappingCSVMapper=
Celigo.integrator.mapping.flat.csv.MultiLineMultiMappingCsvMapper;$.namespace("Celigo.integrator.mapping.flat.fixedwidth");Celigo.integrator.mapping.flat.fixedwidth.FixedWidthMapper=function(a){Celigo.integrator.mapping.flat.fixedwidth.FixedWidthMapper.superclass.constructor.call(this,a);var b=this,c={COLUMN_LIMITS:"columnLimits",COLUMN_WIDTH:"columnWidth",LEFT_ALIGN:"leftAlign",FILL_CHARACTER:"fillCharacter"};this.convertTwoDimArrayToFileContents=function(a,f){var g=b.preProcessTwoDimArrayBeforeConvertingToFileContents(a,
f,!1),h="",j=b.getLineSeparator(f),i=!0;f&&(i=f[b.getCSVConstant("OUTPUT_HEADERS")]);var k=f[b.getConstant("MAPPINGS")];if(!k)throw $$.createError("MISSING_REQUIRED_PARAMETER",b.getConstant("MAPPINGS")+" is required for mappings js to fixed width.");$$.logExecution("DEBUG","mappings",k);for(var l=0;l<g.length;l++)for(var m=g[l],n=0;n<k.length;n++){var o=k[n][c.COLUMN_WIDTH];if(!o)throw $$.createError("MISSING_REQUIRED_PARAMETER",c.COLUMN_WIDTH+" is required for mappings js to fixed width.");var q=
k[n][c.LEFT_ALIGN],r=k[n][c.FILL_CHARACTER]||" ";i!==!1&&l===0&&(r=" ");var p=m[n];p||(p="");if(p.length>o)p=p.substr(0,o);else for(;p.length<o;)q!==!1?p+=r:p=r+p;h+=p;n===k.length-1&&(h+=j)}return h};this.preProcessExportMappingJSObject=function(a){a[b.getCSVConstant("OUTPUT_HEADERS")]=!1;a[b.getCSVConstant("REPLACE_LINE_BREAKS_IN_CELL_DATA_WITH_SPACE")]=!0;a[b.getCSVConstant("REPLACE_TABS_IN_CELL_DATA_WITH_SPACE")]=!0;return a};this.getExportHeaders=function(a){for(var c=[],a=a[b.getConstant("MAPPINGS")],
g=0;g<a.length;g++){var h=a[g];if(h[b.getConstant("inactive")]!==!0){var j=h[b.getConstant("EXTERNAL_FIELD")];j||(j=h[b.getConstant("JS_FIELD")]);j||(j=h[b.getConstant("HARD_CODED_VALUE")]);if(!j&&j!=="")throw $$.createError("MISSING_REQUIRED_PARAMETER",b.getConstant("EXTERNAL_FIELD")+", "+b.getConstant("JS_FIELD")+" and "+b.getConstant("HARD_CODED_VALUE")+"not defined for mapping index: "+g);c.push(j)}}return c};this.fileToTwoDimArray=function(a,b){var g=b[c.COLUMN_LIMITS];if(!g)throw $$.createError("MISSING_REQUIRED_PARAMETER",
c.COLUMN_LIMITS+" is required for fixed width mappings.");var h=a.replace(/\r\n/g,"\n").split("\n");logUntil("arrData",h,1321905597423);if(h.length>0){var j=h[h.length-1];(j.length===0||j.length===1&&j[0]==="")&&h.pop()}for(var j=[],i=0;i<h.length;i++){for(var k=[],l=h[i],m=0;m<g.length;m++){var n=g[m],n=l.substr(n.start,n.end-n.start+1);k.push($.trim(n))}j.push(k)}$$.logExecution("DEBUG","twoDimArray",j);return j};this.preProcessImportMappingJSObject=function(a){a[b.getCSVConstant("FILE_HAS_HEADERS")]=
!1;return a}};Celigo.integrator.mapping.flat.fixedwidth.FixedWidthMapper.extend(Celigo.integrator.mapping.flat.FlatFileMapper);$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.FixedWidthMapper=Celigo.integrator.mapping.flat.fixedwidth.FixedWidthMapper;$.namespace("Celigo.integrator.mapping.flat.fixedwidth");Celigo.integrator.mapping.flat.fixedwidth.MultiRecordFixedWidthMapper=function(a){Celigo.integrator.mapping.flat.fixedwidth.MultiRecordFixedWidthMapper.superclass.constructor.call(this,
a);var b=this,c={IDENTIFIER_LIMITS:"identifierLimits"};this.fileToTwoDimArray=function(a,f){var g=f[c.IDENTIFIER_LIMITS];if(!g)throw $$.createError("MISSING_REQUIRED_PARAMETER",c.IDENTIFIER_LIMITS+" is required for mutli record fixed width mappings.");var h=a.replace(/\r\n/g,"\n").split("\n");logUntil("arrData",h,1321905597423);if(h.length>0){var j=h[h.length-1];(j.length===0||j.length===1&&j[0]==="")&&h.pop()}j=g.start;if(!g.width&&!g.end)throw $$.createError("MISSING_REQUIRED_PARAMETER",c.IDENTIFIER_LIMITS+
" should have either width or end defined.");var i=g.width;i||(i=g.end-g.start+1);if(i===0)throw $$.createError("INVALID_CONFIG","Width can't be zero for the identifier.");for(var g=[],k=0;k<h.length;k++){var l=[],m=h[k],n=$.trim(m.substr(j,i)),o=f[n];if(o){o=o[b.getConstant("MAPPINGS")];if(!o)throw $$.createError("MISSING_REQUIRED_PARAMETER",b.getConstant("MAPPINGS")+" is required for mutli record fixed width mappings.");l.push(n);for(n=0;n<o.length;n++){var q=o[n],r=q.start;if(!q.width&&!q.end)throw $$.createError("MISSING_REQUIRED_PARAMETER",
"No width or end defined for mapping with index: "+n);var p=q.width;p||(p=q.end-q.start+1);if(p===0)throw $$.createError("INVALID_CONFIG","Width can't be zero for a fixed width field. Mapping index: "+n);r=m.substr(r,p);l.push($.trim(r));q[b.getConstant("EXTERNAL_FIELD")]=n+1}g.push(l)}}logUntil("twoDimArray",g,1321905597423);return g};this.getImportMappingsToApply=function(a,b){return[a[b[0][0]]]}};Celigo.integrator.mapping.flat.fixedwidth.MultiRecordFixedWidthMapper.extend(Celigo.integrator.mapping.flat.fixedwidth.FixedWidthMapper);
$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.MultiRecordFixedWidthMapper=Celigo.integrator.mapping.flat.fixedwidth.MultiRecordFixedWidthMapper;$.namespace("Celigo.integrator.mapping.flat.fixedwidth");Celigo.integrator.mapping.flat.fixedwidth.MultiLineMultiMappingFixedWidthMapper=function(a){Celigo.integrator.mapping.flat.fixedwidth.MultiLineMultiMappingFixedWidthMapper.superclass.constructor.call(this,a);var b=this;logUntilDate=new Date(2012,2,4);fwConstants={limitToken:"limitToken",
tokenStart:"tokenStart",tokenEnd:"tokenEnd",identifierForNewLine:"identifierForNewLine",tokenRules:"token",rulesToPass:"pass",rulesToFail:"fail"};transferExternalRecordUsingToken=function(a,e,f,g){f=g[fwConstants.tokenStart];b.verifyRequiredParameter(fwConstants.tokenStart,f);for(var g=g[fwConstants.tokenEnd],h=[],j=null,i=!1,k=a.length-1;e<a.length;e++)if(j=a[e][0],i||j===f){h.push(a[e]);if(g){if(j===g){k=e;break}}else if(i&&j===f){k=e-1;h.pop();break}i=!0}return{lastIndex:k,recordArray:h}};foundKey=
{};transferExternalRecordUsingKey=function(a,b){b===0&&(foundKey={});for(var f=[],g=null,h=null,j=b;j<a.length;j++)key=a[j][1],foundKey[key]||(g||(g=key),key===g?f.push(a[j]):_.isNull(h)&&(h=j-1));_.isNull(h)&&(h=a.length-1);_.isNull(g)||(foundKey[g]=!0);return{lastIndex:h,recordArray:f}};this.transferExternalRecord=function(a,b,f){var g=f[fwConstants.limitToken],h=null,h=g?transferExternalRecordUsingToken(a,b,f,g):transferExternalRecordUsingKey(a,b,f);logUntil("MultiLineMultiMappingFixedWidthMapper - transferExternalRecord - lastIndex",
h.lastIndex,logUntilDate);for(a=0;h.recordArray&&a<h.recordArray.length;a++)logUntil("MultiLineMultiMappingFixedWidthMapper - transferExternalRecord - recordArray - "+a,h.recordArray[a],logUntilDate);return h};this.getImportMappingsToApply=function(a){a.headerFieldFirstLineOnly=!1;return[a]};this.getMappingsFromMappingToApply=function(a,b){return a[b.recordTwoDimArray[b.currentRow||0][0]].mappings};this.mapOneExternalObjectToJSObject_isNewLine=function(a){var e=a.mappingJSObject[fwConstants.identifierForNewLine];
if(!e)return b.mapOneExternalObjectToJSObject_isNewLine_defaultImpl(a);logUntil("MultiLineMultiMappingFixedWidthMapper - mapOneExternalObjectToJSObject_isNewLine - identifierForNewLine",e,logUntilDate);var f=a.mapping[b.getConstant("JS_FIELD")],f=_.first(f.split(".")),e=e[f];b.verifyRequiredParameter("rules (when using identifierForNewLine)",e);e=e[fwConstants.tokenRules];b.verifyRequiredParameter("token rules (when using identifierForNewLine)",e);for(var f=a.currentRow||0,a=_.map(a.recordTwoDimArray,
function(a){return a[0]}),g=0;e&&g<e.length;g++){var h=e[g][fwConstants.rulesToPass],j=e[g][fwConstants.rulesToFail],i=!1,k;for(k in h){var l=parseInt(k,10);a[f+l]!==h[k]&&(i=!0)}if(!i){for(k in j)l=parseInt(k,10),log("p",k),log("tokenArray[currentRow + n]",a[f+l]),log("rulesToFail[p]",j[k]),a[f+l]===j[k]&&(i=!0);if(!i)return logUntil("MultiLineMultiMappingFixedWidthMapper - mapOneExternalObjectToJSObject_isNewLine - passed",e[g],logUntilDate),!0}}logUntil("MultiLineMultiMappingFixedWidthMapper - mapOneExternalObjectToJSObject_isNewLine - failed",
"",logUntilDate);return!1}};Celigo.integrator.mapping.flat.fixedwidth.MultiLineMultiMappingFixedWidthMapper.extend(Celigo.integrator.mapping.flat.fixedwidth.MultiRecordFixedWidthMapper);$.namespace("Celigo.core.mapping.csv");Celigo.core.mapping.csv.MultiLineMultiMappingFixedWidthMapper=Celigo.integrator.mapping.flat.fixedwidth.MultiLineMultiMappingFixedWidthMapper;$.namespace("Celigo.integrator.mapping.xml");Celigo.integrator.mapping.xml.XmlMapper=function(){Celigo.integrator.mapping.xml.XmlMapper.superclass.constructor.call(this);
var a=this,b={MAP_ONE_RECORD_TO_ONE_NODE:"mapOneRecordToOneNode",TOP_LEVEL_NODE_TAG_NAME:"topLevelNodeTagName",OBJECT_NODE_TAG_NAME:"objectNodeTagName",XPATH:"xPath",GROUP:"group",IGNORE_GROUP:"ignoreGroup",OBJECT_NODES_XPATH:"objectNodesXPath",SPECIAL_USE_CASE:"specialUseCase",savedSearch:"savedSearch",topLevelNode:"topLevelNode",namespaceURILookup:"namespaces",doNotCreateNodeForEmptyField:"doNotCreateNodeForEmptyField"},c=[],e=[],f=void 0,g=0,h=!1,j=void 0,i=void 0,k=void 0,l=void 0,m=void 0,n=
function(a){a.xml="http://www.w3.org/XML/1998/namespace";a.xmlns="http://www.w3.org/2000/xmlns/";m=2;return a},o={},q=function(a){var b=null,c=null,e=!1;if(a.indexOf(":")>0){c=a.substring(0,a.indexOf(":"));k&&k[c]&&(c=k[c]);b=i[c];if(!b)throw $$.createError("CELIGO_INVALID_CONFIG","Missing required namespace URI for namespace alias "+c);a=a.substring(a.indexOf(":")+1);e=_.keys(i).length>1+m}return{namespaceAlias:c,namespaceURI:b,tagName:a,qualifiedTagName:c&&(c==="xml"||c==="xmlns"||e)?c+":"+a:a}},
r=function(a){return a.getOwnerDocument()||a},p=function(a,b){var c=q(a);return c.namespaceURI?(c="local-name()='"+c.tagName+"' and namespace-uri()='"+c.namespaceURI+"'",b&&(c="@*["+c+"]"),c):b?"@"+c.tagName:"name()='"+c.tagName+"'"},w=function(a){try{if(!o[a]){for(var b=a.split("/"),c=0;b&&c<b.length;c++)if(b[c]!=="text()"&&b[c].indexOf("*")!==0&&b[c].indexOf(".")!==0&&b[c]!==""){var e=!1;b[c].indexOf("@")===0&&(e=!0,b[c]=b[c].substring(1));var f=null,f=b[c].indexOf("[")>0?b[c].substring(0,b[c].indexOf("[")):
b[c],g=null,g=f.indexOf("nlapi:")===0?(e?"@":"")+f+"[":(e?"@":"")+"*["+p(f);if(b[c].indexOf("[")>0)if(conditionString=b[c].substring(b[c].indexOf("[")+1,b[c].length-1),Celigo.util.StringUtil.endsWith(g,"[")||(g+=" and "),isNaN(conditionString)){for(var k=A(conditionString),e=[],f=0;f<k.length;f++){var i=k[f].valueIsString?"'"+k[f].value+"'":""+k[f].value;k[f].isAttribute?e.push(p(k[f].name,!0)+"="+i):e.push(k[f].name+"="+i)}g+=e.join(" and ")}else g+="position()="+conditionString;b[c]=g+"]";b[c]=
Celigo.util.StringUtil.removeSuffix(b[c],"[]")}o[a]=b.join("/")}return o[a]}catch(j){throw j=Celigo.Error.convert(j),$$.createError("CELIGO_XML_MAPPER_ERROR","Failed to convert xPath "+a+" to NetSuite-compatible xPath. Error: "+CeligoError.format(j));}},u=function(b){for(var c=0;b&&c<b.length;c++){var e=b[c][a.getXMLConstant("GROUP")],f=b[c][a.getXMLConstant("XPATH")];f.charAt(0)==="/"&&(f="."+f);e||(e=f.substring(f.lastIndexOf("/")+1),e!=="text()"&&e.charAt(0)!=="@"&&(f+="/text()"));b[c][a.getXMLConstant("XPATH")]=
f;(f=b[c][a.getConstant("MAPPINGS")])&&(b[c][a.getConstant("MAPPINGS")]=u(f))}return b},s=function(b,e){var k=u(e[a.getConstant("MAPPINGS")]),l=e[a.getXMLConstant("topLevelNode")];l||(l=e[a.getXMLConstant("TOP_LEVEL_NODE_TAG_NAME")]);if(!f){var n=l.split("/")[0];n.indexOf("[")>0&&(n=n.substring(0,n.indexOf("[")));var n=q(n).qualifiedTagName,o='<?xml version="1.0" encoding="UTF-8"?><'+n;if(_.keys(i).length===1+m)for(var r in i){if(!(r==="xml"||r==="xmlns")){var p=i[r];o+=' xmlns="'+p+'"'}}else for(r in i)r===
"xml"||r==="xmlns"||(p=i[r],o+=" xmlns:"+r+'="'+p+'"');o+="></"+n+">";f=$$.stringToXML(o)}var w=B(f,l?"./"+l:"."),n=e[a.getXMLConstant("savedSearch")],l=!1;if(_.isNull(n))l=!0,b=new Celigo.oop.Collection({fakeRecord_1:{celigoIsElement:!0,data:[{recordType:"fakeRecord",id:"1"}]}});else if(_.isString(n)){b=b.getData();if(!b[n])return;o={};o[n]=b[n];b=new Celigo.oop.Collection(o)}else if(!_.isUndefined(n))throw $$.createError("CELIGO_INVALID_CONFIG","savedSearch can not be of type "+typeof n);for(o=
b.getNextObject();o;){log("XMLMapper - processing object at index 0",b.getCurrentObjectIndex());n=[];try{var t=e[a.getXMLConstant("MAP_ONE_RECORD_TO_ONE_NODE")],s=e[a.getXMLConstant("OBJECT_NODE_TAG_NAME")]||o[0].recordType,v;if(t){var I=q(s);I.namespaceURI?n.push(f.createElementNS(I.namespaceURI,I.qualifiedTagName)):n.push(f.createElement(I.qualifiedTagName));w.appendChild(_.last(n));y(_.last(n),o,k,e);v=_.last(n)}else{v=[];for(r=0;o&&r<o.length;r++)I=q(s),I.namespaceURI?n.push(f.createElementNS(I.namespaceURI,
I.qualifiedTagName)):n.push(f.createElement(I.qualifiedTagName)),w.appendChild(_.last(n)),y(_.last(n),[o[r]],k,e),v[r]=_.last(n)}l||(o=null,h?((o=j.getElementData(b.getCurrentObjectIndex()))||(o=[]),o[g]=v):o=v,j.setElementData(b.getCurrentObjectIndex(),o))}catch(x){x=Celigo.Error.convert(x),_.each(n,function(a){w.removeChild(a)}),n={},o=b.getCurrentObjectIndex(),n.index=a.generatePrintableObjectIndex(o),n.error=x,c.push(n)}finally{o=b.getNextObject()}}b.reset()},v=function(a,b){if(a){var c={};_.each(i,
function(a,b){c[a]=b});var e={};_.each(a,function(a,b){if(c[a])e[b]=c[a];else{var f=b;if(i[b])for(var g=0;g<26;g++){var k="abcdefghijklmnopqrstuvwxyz".charAt(g);if(!i[b+k]){f=b+k;break}}i[f]=a;e[b]=f}});l[b]=e}},t=function(b,c){_.isArray(c)?h=!0:(h=!1,c=[c]);f=void 0;j=b.makeEmptyCopy();l={};i=n({});for(var e=0;c&&e<c.length;e++)v(c[e][a.getXMLConstant("namespaceURILookup")],e);for(e=0;c&&e<c.length;e++)g=e,k=l[e],s(b,c[e]);return f},y=function(c,e,f,g){for(var k={},i=g[b.doNotCreateNodeForEmptyField],
j=0;f&&j<f.length;j++)if(f[j][a.getConstant("inactive")]!==!0){var h=f[j][a.getXMLConstant("XPATH")],l=f[j][a.getXMLConstant("GROUP")],m=f[j][a.getXMLConstant("IGNORE_GROUP")]||[];if(!h)throw $$.createError("MISSING_CONFIG_VALUE","Celigo.integrator.mapping.xml.XmlMapper - xPath is required");if(l){var q=f[j][a.getConstant("MAPPINGS")];if(!q||!q.length)throw $$.createError("MISSING_CONFIG_VALUE","Celigo.integrator.mapping.xml.XmlMapper - (Sub)mappings is required and must be an array");for(var n=m,
m={},o=0;o<n.length;o++)m[n[o]]=!0;var o=_.groupBy(e,function(a){return a[l]}),r;for(r in o)m[r]||(n=B(c,h,!0,null,k),y(n,o[r],q,g))}else{m=a.getExportValue(e[0],f[j],g);q=_.isArray(m);_.isArray(m)||(m=[m]);for(o=0;m&&o<m.length;o++)if(((n=m[o])||n==="")&&!(n===""&&i)){var p=B(c,h,q,null,k);p.getNodeType()!==Celigo.enums.JavaNodeConstants.get("TEXT_NODE")&&p.getNodeType()!==Celigo.enums.JavaNodeConstants.get("ATTRIBUTE_NODE")&&(n=$$.escapeXML(n));p.getNodeType()===Celigo.enums.JavaNodeConstants.get("ATTRIBUTE_NODE")?
p.setValue(n):p.setNodeValue(n)}}}},x=function(a){return a==="text()"?"TEXT":a.indexOf("@")===0?"ATTRIBUTE":"ELEMENT"},B=function(a,b,c,e,f){var g;b==="."?g=a:c?g=void 0:(g=w(b),f?(f[g]||(f[g]=$$.selectNode(a,g)),g=f[g]):g=$$.selectNode(a,g));if(!g){g=b.substring(0,b.lastIndexOf("/"));var b=b.substring(b.lastIndexOf("/")+1),k=x(b),i=!1;if(k==="TEXT"||k==="ATTRIBUTE")i=!0;g=B(a,g,c&&i,b,f)}if(e){a=null;if(x(e)==="TEXT")a=r(g).createTextNode("");else if(x(e)==="ATTRIBUTE")a=e.substring(1),c=q(a),a=
c.namespaceURI?r(g).createAttributeNS(c.namespaceURI,c.qualifiedTagName):r(g).createAttribute(c.qualifiedTagName);else if(x(e)==="ELEMENT"&&(f=e.indexOf("[")>0,g.getOwnerDocument()?(a=f?e.substring(0,e.indexOf("[")):e,c=q(a),a=c.namespaceURI?r(g).createElementNS(c.namespaceURI,c.qualifiedTagName):r(g).createElement(c.qualifiedTagName)):a=g.getDocumentElement(),f)){e=e.substring(e.indexOf("[")+1,e.lastIndexOf("]"));e=A(e);for(f=0;f<e.length;f++)e[f].isAttribute&&(c=q(e[f].name),c.namespaceURI?a.setAttributeNS(c.namespaceURI,
c.qualifiedTagName,e[f].value):a.setAttribute(c.qualifiedTagName,e[f].value))}a.getNodeType()===Celigo.enums.JavaNodeConstants.get("ATTRIBUTE_NODE")?g.setAttributeNode(a):!g.getOwnerDocument()||g.appendChild(a);g=a}return g},A=function(a){if(!a||a.indexOf("=")<0)return[];var b=a.charAt(0)==="@",c=b?1:0,e=a.indexOf("="),f=a.charAt(e+1)==="'",g=e+(f?2:1),k=a.indexOf(f?"'":" ",g);if(k<0)k=a.length;if(!(c<e&&e<g&&g<k))throw $$.createError("CELIGO_CORE_ERROR","XMLMapper - parseXPathConditionString - !(conditionNameStart < conditionNameEnd && conditionNameEnd < conditionValueStart && conditionValueStart < conditionValueEnd) - input: "+
a);c=a.substring(c,e);g=a.substring(g,k);k=$.trim(a.substring(k+1));k=Celigo.util.StringUtil.removePrefix(k,"and");k=$.trim(k);if(c==="")throw $$.createError("CELIGO_CORE_ERROR","XMLMapper - parseXPathConditionString - conditionName is empty - input: "+a);return[{name:c,value:g,isAttribute:b,valueIsString:f}].concat(A(k))},z={datecreated:!0},E=function(a){var b={jsField:a,xPath:"/"+(a.lastIndexOf("{")>0?a.substr(0,a.lastIndexOf("{")):a)};if(z[a])b.dateFormat="ISO";return b},C={date:function(a){z[a]=
!0}},F=function(a,b){var c={},e={},f={},g={},k=[],i=[],j,h,l,m,q,n,o;h=a.getData();h=_.keys(h);var r={};if(h.length>1)throw $$.createError("DEVELOPER_ERROR","mapJSObjectsToXMLDocSpecialUseCaseTransactionWithItemList only support 1 search result");if(h=a.getData()[h[0]].metadata){r=_.groupBy(h.columns,function(a){return a.name});h=Celigo.util.getNlobjRecordMetadata({recordTypeId:h.recordType,sublistIds:["item"],returnAsKeyFields:!0,includeSystemFields:!1,includeSelectOptions:!1,excludeStandardFields:!1});
for(j in r)if(h.bodyFields[j]&&h.bodyFields[j].type==="date"||h.sublists.item[j]&&h.sublists.item[j].type==="date")z[r[j][0].label]=!0;for(j in r)if(l=r[j][0].label,h=/{(.+)}$/.exec(l)){m=h[1].split(",");for(h=0;m&&h<m.length;h++)C[m[h]](l)}o=function(a){return r[a]&&r[a][0]&&r[a][0].label?r[a][0].label:a};j=o("line");h=o("linesequencenumber");l=o("closed");m=o("billable");q=o("matchbilltoreceipt");n=o("amount");o=o("shippingamount")}else j=b.lineIdColId||"line",h=b.lineSeqNumColId||"linesequencenumber",
l=b.closedColId||"closed",m=b.billableColId||"billable",q=b.matchBillToReceiptColId||"matchbilltoreceipt",n=b.amountColId||"amount",o=b.shippingAmtColId||"shippingamount";f[j]=!0;f[h]=!0;f[l]=!0;f[m]=!0;f[q]=!0;g[n]=!0;g[o]=!0;for(j=a.getNextObject();j;){l=j[0];for(var p in l)!c[p]&&!f[p]&&l[p]&&(k.push(E(p)),c[p]=!0);for(h=1;h<j.length;h++)for(p in l=j[h],l)if(!e[p]&&(g[p]||!c[p])&&l[p])i.push(E(p)),e[p]=!0;j=a.getNextObject()}a.reset();k.push({group:"itemLineSeqNo",ignoreGroup:["0"],xPath:"/items/item",
mappings:i});return t(a,{mapOneRecordToOneNode:!0,topLevelNodeTagName:"document",mappings:k})},I=function(b,c,f){for(var g=[],k=c[a.getXMLConstant("OBJECT_NODES_XPATH")],i=f?[c]:a.getImportMappingsToApply(c),j=0;i&&j<i.length;j++){for(var h=i[j],l=a.getConstant("MAPPINGS"),m=i[j][a.getConstant("MAPPINGS")],q=0;m&&q<m.length;q++)if(m[q][a.getConstant("inactive")]!==!0&&_.isUndefined(m[q][a.getXMLConstant("OBJECT_NODES_XPATH")])&&!a.isValidHardCodedValue(m[q][a.getConstant("HARD_CODED_VALUE")])){var n=
m[q][a.getXMLConstant("XPATH")],o=n.substring(n.lastIndexOf("/")+1);n.charAt(0)==="/"&&(n="."+n);o==="text()"&&(n=n.substring(0,n.lastIndexOf("/")));m[q][a.getXMLConstant("XPATH")]=n}h[l]=m;i[j][a.getConstant("headerFieldFirstLineOnly")]=!1}h=[];if(f)if(j=c[a.getConstant("JS_FIELD")],j.indexOf("[]",j.length-2)!==-1)h=$$.selectNodes(b,w(k));else{var r=$$.selectNode(b,w(k));r&&(h=[r])}else h=$$.selectNodes(b,w(k));for(j=0;h&&j<h.length;j++)try{b={};r=h[j];if(!f)b.nodeIndex=j;for(k=0;i&&k<i.length;k++){for(var p=
i[k][a.getConstant("MAPPINGS")],t=i[k][a.getConstant("NLOBJ_RECORD_TYPE")],l=0,m={},q=0;p&&q<p.length;q++){var s=p[q][a.getXMLConstant("OBJECT_NODES_XPATH")],v=p[q][a.getConstant("JS_FIELD")],n=[];if(s)n=I(r,p[q],!0);else{var u=p[q][a.getXMLConstant("XPATH")];u&&(n=$$.selectValues(r,u)||[])}if(l<n.length)l=n.length;m[v]=n}var y=a.mapOneExternalObjectToJSObject(i[k],c,l,{valuesByJSField:m});f?b=y:b[t]=y}g.push(b)}catch(x){x=Celigo.Error.convert(x);if(f)throw x;e.push({nodeIndex:j,code:x.name||x.getCode(),
message:x.message||x.getDetails()})}return g};this.getXMLConstant=function(a){return b[a]};this.getIdentifier=function(b){return b[a.getXMLConstant("OBJECT_NODES_XPATH")]};this.getFieldValue=function(b){var c=b.valuesByJSField,e=b.currentRow,b=b.mapping[a.getConstant("JS_FIELD")];return e<c[b].length?c[b][e]:e===0?null:"celigo-special-way-to-say-there-is-no-value"};this.mapJSToExternalWithoutLoggingError=function(b,e){c=[];var f=void 0;if(e)f=e[a.getXMLConstant("SPECIAL_USE_CASE")]==="TRANSACTION_W_ITEM_LIST"?
F(b,e):t(b,e);else{for(var f={mapOneRecordToOneNode:!1,topLevelNodeTagName:"document",mappings:[]},g={},k=b.getNextObject();k;){for(var i=0;k&&i<k.length;i++)for(var h in k[i])g[h]||(f.mappings.push({jsField:h,xPath:"/"+h.replace(/ /g,"_")}),g[h]=!0);k=b.getNextObject()}b.reset();f=t(b,f)}return{failedToMap:c,fileContents:f,xmlDocument:f,xmlNodeCollection:j}};this.mapExternalToJS=function(b,c){e=[];return{identifier:c[a.getXMLConstant("OBJECT_NODES_XPATH")],jsObjects:I(b,c),failedToMap:e}};this.mapErrorsToExternal=
function(b,c,e){e=e[a.getXMLConstant("OBJECT_NODES_XPATH")];b=$$.selectNodes(b,w(e));for(e=0;c&&e<c.length;e++){var f=c[e].code,g=c[e].message,k=b[c[e].nodeIndex],i=B(k,"./celigoErrors/error",!0),j=r(k).createElement("code");i.appendChild(j);var h=r(k).createTextNode("");j.appendChild(h);h.setNodeValue(f);f=r(k).createElement("message");i.appendChild(f);h=r(k).createTextNode("");f.appendChild(h);h.setNodeValue(g)}};this.testMethodDoNotUse_convertToNetSuiteCompatibleXPath=function(a){i=n({});k={};
return w(a)}};Celigo.integrator.mapping.xml.XmlMapper.extend(Celigo.integrator.mapping.DeprecatedAbstractMapper);$.namespace("Celigo.core.mapping.xml");Celigo.core.mapping.xml.XMLMapper=Celigo.integrator.mapping.xml.XmlMapper;$.namespace("Celigo.integrator.mapping.xml.xsd");Celigo.integrator.mapping.xml.xsd.XsdToObjectSet=function(){Celigo.integrator.mapping.xml.xsd.XsdToObjectSet.superclass.constructor.call(this);var a=this,b=[];includedSchemas=[];xmlConstants={KEY_COLUMN:"keyColumn"};this.doNothing=
function(){};this.loadIncludedSchemas=function(a){var b=$$.searchRecord("customrecord_celigo_amazon_product_categ",null,new nlobjSearchFilter("name",null,"startswith",a),new nlobjSearchColumn("custrecord_amazon_product_category_xsd"));if(b)b=$$.loadFile(b[0].getValue("custrecord_amazon_product_category_xsd")),includedSchemas.push({schemaName:a,document:$$.stringToXML(b.getValue())});else throw $$.createError("MISSING_SCHEMA_FILE","The required Amazon Product Category record: "+a+" is missing or was never created. <br />Please create an Amazon Product Category record with this name and select Product XSD: "+
a+".xml");};this.walkTheDOM=function(b){for(b=b.getFirstChild();b;)a.walkTheDOM(b),b=b.getNextSibling()};this.findTypeNode=function(a){for(var b=0;b<includedSchemas.length;b++){var f=$$.selectNode(includedSchemas[b].document,'//*[@name="'+a+'"]');if(f)break}if(f)return f;else throw $$.createError("Cannot find a node in included schemas with name: "+node.getAttribute("ref"));};this.findReferencedNode=function(a){var b=$$.selectNode(a,'//xsd:element[@name="'+a.getAttribute("ref")+'"]');if(!b)for(var f=
0;f<includedSchemas.length;f++)if(b=$$.selectNode(includedSchemas[f].document,'//xsd:element[@name="'+a.getAttribute("ref")+'"]'))break;if(b)return b;else throw $$.createError("Cannot find a node in included schemas with name: "+a.getAttribute("ref"));};this.processSiblings=function(a,e){for(var f=0;f<a.length;f++)if(a[f].nodeName==="xsd:include"&&$$.selectValue(a[f],"@schemaLocation")){for(var g=!1,h=$$.selectValue(a[f],"@schemaLocation"),h=h.substring(0,h.indexOf(".")),j=0;j<includedSchemas.length;j++)if(includedSchemas[j].schemaName==
h){g=!0;break}g||this.loadIncludedSchemas(h)}else if(a[f].nodeName==="xsd:element")if(h=null,a[f].hasAttribute("name")){h=a[f].getAttribute("name");for(g=0;g<b.length;g++);g=e;h&&(g=g+"/"+h);a[f].hasChildNodes()?(h=$$.selectNodes(a[f],"child::node()"),this.processSiblings(h,g)):a[f].hasAttribute("type")&&a[f].getAttribute("type")==="xsd:dateTime"&&$$.logExecution("AUDIT",g)}else{if(a[f].hasAttribute("ref")&&(j=this.findReferencedNode(a[f])))g=e,j.hasAttribute("name")&&(h=j.getAttribute("name"))&&
(g=g+"/"+h),j.hasChildNodes()?(h=$$.selectNodes(j,"child::node()"),this.processSiblings(h,g)):j.hasAttribute("type")&&(h=this.findTypeNode(j.getAttribute("type")))&&this.processSiblings([h],g),b.push(a[f].getAttribute("ref"))}else a[f].nodeName==="xsd:complexType"?a[f].hasChildNodes()&&(h=$$.selectNodes(a[f],"child::node()"),this.processSiblings(h,e)):a[f].nodeName==="xsd:simpleType"?a[f].hasChildNodes()&&((g=$$.selectNode(a[f],"xsd:restriction"))&&g.hasAttribute("base"),$$.logExecution("AUDIT",e)):
a[f].nodeName==="xsd:sequence"?a[f].hasChildNodes()&&(h=$$.selectNodes(a[f],"child::node()"),this.processSiblings(h,e)):a[f].nodeName==="xsd:choice"&&a[f].hasChildNodes()&&(h=$$.selectNodes(a[f],"child::node()"),this.processSiblings(h,e))};this.evaluateXSD=function(a){var b=$$.stringToXML($$.loadFile(a).getValue());includedSchemas.push({schemaName:a.substring(0,a.indexOf(".")),document:b});this.processSiblings($$.selectNodes(b,"/xsd:schema/*"),".")}};$.namespace("Celigo.core.mapping.xml");Celigo.core.mapping.xml.XSDToObjectSet=
Celigo.integrator.mapping.xml.xsd.XsdToObjectSet;$.namespace("Celigo.integrator.mapping");Celigo.integrator.mapping.Traverser=function(a){var b=$.getExecutionLogger("Celigo.integrator.mapping.Traverser"),c=this,e=function(a,g,h,j){if(a){try{var i=a.getClassName()}catch(k){return}var l=j||c;try{h.call(l,a,i,g)}catch(m){b.error("callback error",m.message)}var n;a instanceof Celigo.integrator.mapping.model.DocumentMapping?n=a.getRecordMappings():a instanceof Celigo.integrator.mapping.model.FieldMapping?
a.getSubRecordMapping()&&(n=[a.getSubRecordMapping()]):n=a instanceof Celigo.integrator.mapping.model.FieldMappingSet?a.getFieldMappings():a.getChildren();if(n&&n.length){++g;for(a=0;a<n.length;a++)e(n[a],g,h,j)}}};this.traverse=function(b,c){typeof b==="function"&&e(a,0,b,c)}};$.namespace("Celigo.integrator.mapper");Celigo.integrator.mapper.AbstractMapper=function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.AbstractMapper"});if(a.celigo_classname==="Celigo.integrator.mapper.AbstractMapper")throw $$.createError("ABSTRACT_CLASS_INSTANTIATION",
"Celigo.integrator.mapper.AbstractMapper is an abstract class.");if(!a.cache)a.cache={};if(!a.objectsCountToProcessBeforeYield)a.objectsCountToProcessBeforeYield=100;if(!a.numberFieldMappingsExecutedBeforeYield)a.numberFieldMappingsExecutedBeforeYield=5E4;Celigo.integrator.mapper.AbstractMapper.superclass.constructor.call(this,a);this.getClassName=function(){return"Celigo.integrator.mapper.AbstractMapper"};var b=this,c={EPOCH:"epoch"},e=new Date(2012,10,2),f=0,g={cache:a.cache,record:null,system:{today:(new Date).toISOString()}},
h=function(a,b){if(Array.isArray(a)){for(var c=[],e=0;e<a.length;e++){var f=parseInt(a[e],b);if(isNaN(f))return a;c.push(f)}return c}else return c=parseInt(a,b),isNaN(c)?a:c},j=function(a,c,f){for(var c=c.getChildren(),g=0;c&&g<c.length;g++){var i=c[g];if(i instanceof Celigo.integrator.mapping.model.FieldMappingSet)b.mapJsToExternalWithFieldMappingSet(a,i,c.length===1,f);else if(i instanceof Celigo.integrator.mapping.model.CollectionMapping){var h=i.getCollectionIds(),r=_.groupBy(a,function(a){logUntil("AbstractMapper - mapOneJsToExternalWithOneMappingNodeRecursively - jsObjectRow",
function(){return a},e);var b=!0,c=[];_.each(h,function(e){c.push(a[e]);!_.isUndefined(a[e])&&!_.isNull(a[e])&&a[e]!==""&&(b=!1)});logUntil("AbstractMapper - mapOneJsToExternalWithOneMappingNodeRecursively - temp",function(){return c},e);return b?"EMPTY":JSON.stringify(c)});logUntil("AbstractMapper - mapOneJsToExternalWithOneMappingNodeRecursively - jsObjectGroups",function(){return r},e);for(var p in r)if(p!=="EMPTY"){var w=b.beforeMapOneJsToExternalWithOneMappingNodeRecursively(r[p],i,f);j(r[p],
i,w)}}}},i=function(c,e,f){var c=_.isString(c)?_.str.trim(c):c,g=String(c).toLowerCase(),i,j,r=e.getLookupSource();if(!r)throw $$.createError("MISSING_REQUIRED_PARAMETER","lookupSource is missing for mapping "+JSON.stringify(e));var p=e.getLookupAllowFailures(),w=e.getLookupDefaultValue(),u=e.getUseDefaultOnMultipleMatches();b.isValidHardCodedValue(w)||(w="");i=e.getLookupType();if(i!=="static"&&i!=="record"){var s={success:!1,value:void 0,error:void 0};Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:EXTERNAL_LOOKUP",
b,c,e,s);if(s.success===!0)return s.value;if(p)return w;i='Could not find lookup value for "'+i+'" with source "'+r+'" where "'+e.getLookupKey()+'" is "'+g+'"';s.error&&_.isObject(s.error)&&s.error.message?i+=";caused by: "+s.error.message:_.isString(s.error)&&(i+=";caused by: "+s.error);throw $$.createError("VALUE_LOOKUP_FAILED",i);}if(e.getLookupType()==="static"){j=b.mappingData.getStaticLookupMap(r)[g];if(_.isUndefined(j))if(p)return w;else throw i="Could not find mapping in static lookup.",i+=
" { Source: "+r+"}",i+=" { Key: "+c+"}",$$.createError("MISSING_STATIC_LOOKUP",i);return j}i=e.getLookupKey();var v=e.getLookupFilterExpression();if(!i&&!v)throw $$.createError("MISSING_REQUIRED_PARAMETER","Both lookupKey and lookupFilterExpression are missing for mapping "+JSON.stringify(e));var t=e.getLookupValue();if(!t)throw $$.createError("MISSING_REQUIRED_PARAMETER","lookupValue is missing for mapping "+JSON.stringify(e));var y=e.isCacheAll();_.isUndefined(y)&&(y=!1);if(y&&v)throw $$.createError("INVALID_CONFIG",
"lookupFilterExpression cannot be used with cacheAll = true");var x=0;if(v){s=Celigo.util.HandlebarsUtil.render(e.getLookupFilterExpressionCache(a.celigo_classname,Array.isArray(c)).exp,c);log("renderedFE - pre",s);var s=JSON.parse(s),B=function(a){if(_.isArray(a))if(a.length===3&&(a[1]==="is"||a[1]==="equalto"||a[0]==="internalid"&&a[1]==="anyof")){if(a[2]===""||a[2]===null)a.pop(),a.pop(),a.push("isempty"),a[0]==="internalid"&&x++}else{for(var b=0;b<a.length;b++)B(a[b]);if(a.length===3&&(a[1]===
"OR"||a[1]==="or"))a[0].length===2&&a[0][0]==="internalid"&&a[0][1]==="isempty"?(a.shift(),a.shift(),x--):a[2].length===2&&a[2][0]==="internalid"&&a[2][1]==="isempty"&&(a.pop(),a.pop(),x--)}};B(s);log("renderedFE - post",s);g=$$.createSearch(r,s,[new nlobjSearchColumn(t)]);r&&Celigo.util.getMainLineFilterSupportedTransactionTypeIds().indexOf(r)>-1&&Celigo.util.appendFilter(g,"mainline",null,"is","T");var A;try{A=g.runSearch().getResults(0,10)}catch(z){if(z&&(typeof z.getCode==="function"&&z.getCode()===
"MISMATCHED_SEARCH_PARENTHESIS"||z.code==="MISMATCHED_SEARCH_PARENTHESIS"||z.name==="MISMATCHED_SEARCH_PARENTHESIS"))g.setFilterExpression(Celigo.util.flattenFilterExpression(g.getFilterExpression())),A=g.runSearch().getResults(0,10);else throw z;}var E=t&&t.toLowerCase&&t.toLowerCase()==="internalid",g=_.map(A,function(a){return E?h(a.getValue(t),10):a.getValue(t)})}else{A=r+"_"+i+"_"+t;if(!c&&c!==0)if(p)return w;else throw c="Missing KeyValue for the Lookup.",c+=" { Source: "+r+"}",c+=" { Key Field: "+
i+"}",c+=" { Value Field: "+t+"}",$$.createError("VALUE_LOOKUP_FAILED",c);if(!Celigo.cache.mapperCache[A]||!y&&!Celigo.cache.mapperCache[A][g]){var C=e.getLookupFilters(),C=C?C.slice(0):_.contains($.getIsInActiveSearchFilterNonSupportedObjectIds(),r)?[]:["isinactive.null.is.F"],v=!1;if(!y){var F=e.getLookupOperator();F||(F="is");var e=$$.getContext().getCompany(),I=$$.getContext().getEnvironment().toUpperCase();j=i;r==="opportunity"&&i&&i.toLowerCase()==="externalid"&&(e&&e.substring(0,6)=="TSTDRV"||
I==="SANDBOX")?(j="externalidstring",F==="anyof"?F="is":F==="noneof"&&(F="isnot")):i&&i.toLowerCase()==="otherrefnum"&&F==="is"&&(F="equalto");C.push(new nlobjSearchFilter(j,null,F,c));if((j==="name"||j==="itemid")&&_.contains($.getNsItemTypeIds(),r))v=!0}e=[(new nlobjSearchColumn("internalid")).setSort()];y&&i!=="internalid"&&e.push(new nlobjSearchColumn(i));t!=="internalid"&&e.push(new nlobjSearchColumn(t));v&&e.push(new nlobjSearchColumn("itemid"));r&&Celigo.util.getMainLineFilterSupportedTransactionTypeIds().indexOf(r)>
-1&&(r==="opportunity"&&(r="transaction",C.push("type.null.is.Opprtnty")),C.push("mainline.null.is.T"));for(var C=$.search({type:r,filters:C,columns:e,sortedByInternalId:!0,maxResults:y?void 0:4E3})||[],L={},e=0;e<C.length;e++)if(I=y?C[e].getValue(i):c){I=String(I).toLowerCase();if(v&&(j=C[e].getValue("itemid").toLowerCase(),j!==g&&!_.str.endsWith(j," : "+g)))continue;j=C[e].getValue(t);f&&!isNaN(j)&&(t&&t.toLowerCase&&t.toLowerCase()==="internalid"?j=h(j,10):(F=C[e].getText(t))&&F!==j&&(j=h(j,10)));
L[I]||(L[I]=[]);L[I].push(j)}_.each(L,function(a,b){L[b]=_.uniq(a)});Celigo.cache.mapperCache[A]=L}g=Celigo.cache.mapperCache[A][g]}if(p)return g&&g.length&&g.length>1&&u?w:g&&g.length&&x<=0?g[g.length-1]:w;else if(p=g&&g.length?g.length:0,p===1)return g[0];else throw w=$.getRecordNameFromRecordType(r),s?i=p>1?'A mapping error occurred. More than one match for "'+JSON.stringify(s)+'" for the record type "'+w+'".':'A mapping error occurred. Could not find a match for "'+JSON.stringify(s)+'" for the record type "'+
w+'".':(r=$.getFieldNameFromFieldId(r,i),i=p>1?'A mapping error occurred. More than one match for "'+c+'" found in the "'+r+'" field of the record type "'+w+'".':'A mapping error occurred. Could not find "'+c+'" in the "'+r+'" field of the record type "'+w+'".'),$$.createError("VALUE_LOOKUP_FAILED",i);};this.indexOfCurrentDocumentPartBeingMappedToJsObject=this.mappingErrors=this.mappingData=this.document=this.jsObjects=void 0;this.isValidHardCodedValue=function(a){return this.INTEGRATOR_IO_MAPPER&&
a===null?!0:a||a===!1||a===""||a===0};this.mapJsToExternalWithOneRecordMapping=function(a){logUntil("AbstractMapper - mapJsToExternalWithOneRecordMapping - recordMapping",a,e);var c=a.getSavedSearchBindings();b.jsObjects.reset();for(var f=b.jsObjects.getNextObject(),g=null;f;){var i=null;try{if(i=b.jsObjects.getCurrentObjectIndex(),!c||i&&i.length>0&&_.include(c,i[0]))g=b.beforeMapOneJsObjectToExternal(f,a),j(f,a,g),b.afterMapOneJsObjectToExternal(f,a,g)}catch(h){h=Celigo.Error.convert(h),Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:MAP_TO_EXTERNAL_ERROR",
b,h,a,f,c,g),b.onErrorWhenMapOneJsObjectToExternal(),b.mappingErrors.push(new Celigo.integrator.mapping.model.MappingError({index:b.generatePrintableObjectIndex(i),indexNumber:i,error:h})),b.jsObjects.removeLastObject()}finally{f=b.jsObjects.getNextObject()}}};this.getExportFieldValue=function(a,e){var f;f=e.getHardCodedValue();var j=e.getJsField();if(arguments.length>2)f=arguments[2];else if(!b.isValidHardCodedValue(f)){if(!j)throw $$.createError("MISSING_MAPPING_PARAMETER","jsField is missing for mapping "+
JSON.stringify(e));f=a[j]}var h=_.isArray(f);h||(f=[f]);var q=e.getDateFormat(),r=e.getDateTimeZone(),p=e.getLookupType();g.record=a;f=_.map(f,function(a){if(_.isUndefined(a)){var b=Celigo.util.HandlebarsUtil.render(j,g);b!==j&&(a=b)}if(_.isUndefined(a)||_.isNull(a)||a==="")return a;a=_.isDate(a)||_.isNumber(a)?a:Celigo.util.HandlebarsUtil.render(a.toString(),g);q||r?(_.isString(a)&&(a=_.str.endsWith(a,"Z")?new Date(a):Celigo.util.dateUtil.convertNetSuiteDateTimeStringToJSDateObject(a,null,null,!Celigo.util.dateUtil.isFormatDateOnly(q))),
a=q&&q.toLowerCase()===c.EPOCH?a.getTime():Celigo.dateUtil.convertDateToTimeStamp(a,q,r,!Celigo.util.dateUtil.isFormatDateOnly(q))):p&&(a=i(a,e,!1));return a});return h?f:f[0]};this.getImportFieldValue=function(a,e){var f=e.getHardCodedValue();b.isValidHardCodedValue(f)&&(a=f);if(_.isUndefined(a)||_.isNull(a)||a==="")if(e.getLookupType()&&e.getLookupAllowFailures()===!0&&(this.INTEGRATOR_IO_MAPPER&&e.getLookupDefaultValue()!==void 0||!this.INTEGRATOR_IO_MAPPER&&e.getLookupDefaultValue()))return e.isInternalId()?
h(e.getLookupDefaultValue(),10):e.getLookupDefaultValue();else if(e.getLookupType()&&e.getLookupAllowFailures()===!1)if(this.INTEGRATOR_IO_MAPPER)throw new Celigo.Error({name:"STATIC_MAPPING_ERROR",message:"Exported value is empty/undefined for the field: "+e.getExternalField()+". Ensure value is not empty/undefined or Uncheck 'Fail If Unique Match Not Found' field and enter appropriate default value"});else return a;else return a;var f=e.getDateFormat(),g=e.getDateTimeZone();if(f||g){if(f&&f.toLowerCase()===
c.EPOCH)return $$.stringToDate(a).getTime();this.INTEGRATOR_IO_MAPPER?(a=Celigo.dateUtil.convertTimeStampToDateIO(a,f,g),a=$$.dateToString(a,"datetimetz")):(a=Celigo.dateUtil.convertTimeStampToDate(a,f,g),a=$$.dateToString(a,"datetime"));return a}e.getLookupType()&&(a=i(a,e,!0));if(a!=null)if(e.isInternalId())a=h(a,10);else if(e.getExternalDatatype()==="int"){if(a=h(a,10),this.INTEGRATOR_IO_MAPPER&&isNaN(+a))throw new Celigo.Error({name:"INVALID_TYPE_CONVERSION_INT",message:"failed to convert "+a+
" to Integer"});}else if(e.getExternalDatatype()==="float"){if(f=a,a=parseFloat(a),this.INTEGRATOR_IO_MAPPER&&isNaN(a))throw new Celigo.Error({name:"INVALID_TYPE_CONVERSION_FLOAT",message:"failed to convert "+f+" to Float"});}else e.getExternalDatatype()==="string"&&(a=this.INTEGRATOR_IO_MAPPER?this.safeStringify(a):String(a));return a};this.safeStringify=function(a){if(a==null)return"";var b=Object.prototype.toString.call(a);if(b==="[object String]")return a;var c;if(b==="[object Object]"||b==="[object Array]"){try{c=
JSON.stringify(a)}catch(e){try{c=a.toString()}catch(f){c=String(a)}}return c}try{c=a.toString()}catch(g){c=String(a)}return c};this.mapExternalToJsWithOneRecordMapping=function(c){logUntil("AbstractMapper - mapExternalToJsWithOneRecordMapping - recordMapping",c,e);for(var f=b.splitDocumentIntoPartsEachMapsToOneObject(c),g=null,i=0,j=0;f&&j<f.length;j++){try{i===a.objectsCountToProcessBeforeYield?($$.logExecution("audit","AbstractMapper - yield","set objectsCountToProcessBeforeYield ("+a.objectsCountToProcessBeforeYield+
") to your desired value"),i=0,Celigo.BatchProcess.yield()):i++;logUntil("AbstractMapper - mapExternalToJsWithOneRecordMapping - documentParts "+j,f[j],e);var g=b.mapOneDocumentPartToJsObject(f[j],c),h=b.indexOfCurrentDocumentPartBeingMappedToJsObject;if(_.isArray(h)){if(g.documentIndex=h[0],h.length>1)g.allIndex=h}else g.documentIndex=h;if(g.nlobjFieldIds&&c.getRecordType()==="salesorder"){if(g.nlobjFieldIds.shipaddr1&&!g.nlobjFieldIds.shipaddresslist)g.nlobjFieldIds.shipaddresslist=" ";if(g.nlobjFieldIds.billaddr1&&
!g.nlobjFieldIds.billaddresslist)g.nlobjFieldIds.billaddresslist=" "}this.INTEGRATOR_IO_MAPPER&&(g.exportedDoc=f[j]);b.jsObjects.push(g)}catch(r){var p=r.externalId,r=Celigo.Error.convert(r);Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:MAP_TO_NETSUITE_ERROR",b,r,c,g,f[j]);logUntil("AbstractMapper - mapExternalToJsWithOneRecordMapping - error "+j,function(){return r},e);var w=_.isArray(b.indexOfCurrentDocumentPartBeingMappedToJsObject)?b.indexOfCurrentDocumentPartBeingMappedToJsObject[0]:
b.indexOfCurrentDocumentPartBeingMappedToJsObject;b.mappingErrors.push(new Celigo.integrator.mapping.model.MappingError({index:b.generatePrintableDocumentIndex(w,f[j]),indexNumber:w,error:r,externalId:p}))}if(a.mapTheFirstRecordOnly)j=f.length}};this.getCache=function(){return a.cache};this.beforeBeginMapJsToExternal=function(){};this.beforeFinishMapJsToExternal=function(){};this.beforeMapJsToExternalOneRecordMapping=function(){};this.beforeMapOneJsObjectToExternal=function(){};this.afterMapOneJsObjectToExternal=
function(){};this.beforeMapOneJsToExternalWithOneMappingNodeRecursively=function(){};this.onErrorWhenMapOneJsObjectToExternal=function(){};this.startMapToNetSuite=function(){};this.endMapToNetSuite=function(){};this.generatePrintableObjectIndex=function(a){return a.join(" - ")};this.preProcessMapToExternalMapping=function(a){return a};this.getMapToExternalResultDocument=function(){return new Celigo.integrator.model.Document({content:b.document})};this.incrementProcessingUnit=function(c){Celigo.BatchProcess.isScheduledScript&&
(f++,f%1E3===0&&log("AbsMapper - incrementProcessingUnit - processingUnitCount",f),f%a.numberFieldMappingsExecutedBeforeYield===0&&(c?c.call(b):($$.logExecution("audit","AbstractMapper - yield","set numberFieldMappingsExecutedBeforeYield ("+a.numberFieldMappingsExecutedBeforeYield+") to your desired value"),Celigo.BatchProcess.yield())))};this.getProcessingUnitCount=function(){return f};this.mapJsToExternalWithFieldMappingSet=function(){throw $$.createError("CELIGO_ABSTRACT_METHOD","mapJsToExternalWithFieldMappingSet is an abstract method");
};this.splitDocumentIntoPartsEachMapsToOneObject=function(){throw $$.createError("CELIGO_ABSTRACT_METHOD","splitDocumentIntoPartsEachMapsToOneObject is an abstract method");};this.mapOneDocumentPartToJsObject=function(){throw $$.createError("CELIGO_ABSTRACT_METHOD","mapOneDocumentPartToJsObject is an abstract method");};this.generatePrintableDocumentIndex=function(){throw $$.createError("CELIGO_ABSTRACT_METHOD","generatePrintableDocumentIndex is an abstract method");};this.searchBeforeSave=function(){throw $$.createError("CELIGO_ABSTRACT_METHOD",
"runSearchBeforeSave is an abstract method");};this.mapToExternal=function(a,c){if(c instanceof Celigo.integrator.mapping.model.FrontendMapping){var f=c.getTranslator();if(!f||!_.isFunction(f.translate))throw $$.createError("CELIGO_MAPPING_ERROR",this.getClassName()+" - mapToExternal - front end mapping needs to be translated.");c=f.translate(c)}b.jsObjects=a;b.document="";b.mappingData=b.preProcessMapToExternalMapping(c);b.mappingErrors=[];b.beforeBeginMapJsToExternal();for(var g=b.mappingData.getHeaderMappings(),
i=0;g&&i<g.length;i++)logUntil("AbstractMapper - mapToExternal - headerMapping "+i,function(){return g[i]},e),b.mapJsToExternalWithFieldMappingSet([{}],g[i]);f=b.mappingData.getRecordMappings();for(i=0;f&&i<f.length;i++)b.beforeMapJsToExternalOneRecordMapping(f[i],i),b.mapJsToExternalWithOneRecordMapping(f[i]);f=b.mappingData.getFooterMappings();for(i=0;f&&i<f.length;i++)b.mapJsToExternalWithFieldMappingSet([{}],f[i]);for(i=0;b.mappingErrors&&i<b.mappingErrors.length;i++){logUntil("AbstractMapper - mapToExternal - mappingErrors "+
i,function(){return b.mappingErrors[i]},e);var f=b.mappingErrors[i].getIndex(),j=b.mappingErrors[i].getError(),f="Mapping error at index: "+f+" | Code: "+(j.name||j.getCode())+" | Message: "+(j.message||j.getDetails())+" | Stack Trace: "+j.getStackTrace?j.getStackTrace():"none";log("AbstractMapper - mapToExternal - logging error",f)}b.beforeFinishMapJsToExternal();b.jsObjects=null;f=this.getMapToExternalResultDocument();b.document=null;j=b.mappingErrors;b.mappingErrors=null;Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:MAP_TO_EXTERNAL_COMPLETE",
b);return new Celigo.integrator.mapping.model.MapToExternalResult({document:f,mappingErrors:j})};this.mapToNetSuite=function(a,c){if(!a)throw $$.createError("CELIGO_MAPPER_ERROR",this.getClassName()+" - mapToNetSuite - document cannot be empty.");if(c instanceof Celigo.integrator.mapping.model.FrontendMapping){var e=c.getTranslator();if(!e||!_.isFunction(e.translate))throw $$.createError("CELIGO_MAPPING_ERROR",this.getClassName()+" - mapToNetSuite - front end mapping needs to be translated.");c=e.translate(c)}b.jsObjects=
[];b.document=a.getContent();b.documentLength=b.document&&_.isString(b.document)?b.document.length:void 0;b.mappingData=c;b.mappingErrors=[];b.indexOfCurrentDocumentPartBeingMappedToJsObject=void 0;b.startMapToNetSuite();for(var f=b.mappingData.getRecordMappings(),e=0;f&&e<f.length;e++)b.mapExternalToJsWithOneRecordMapping(f[e]);for(e=0;b.mappingErrors&&e<b.mappingErrors.length;e++){var f=b.mappingErrors[e].getIndex(),g=b.mappingErrors[e].getError(),f="Mapping error at index: "+f+" | "+Celigo.Error.format(g);
log("AbstractMapper - mapToNetSuite - logging error",f)}b.endMapToNetSuite();b.document=null;e=b.jsObjects;b.jsObjects=null;f=b.mappingErrors;b.mappingErrors=null;Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:MAP_TO_NETSUITE_COMPLETE",b);return new Celigo.integrator.mapping.model.MapToNetSuiteResult({jsObjects:Celigo.lang.Collection.arrayOrObjectToCollection(e),mappingErrors:f})};this.getErrorFileNetSuiteContentType=function(){return a.errorFileNetSuiteContentType||""};this.setErrorFileNetSuiteContentType=
function(b){a.errorFileNetSuiteContentType=b};this.getErrorFileExtension=function(){return a.errorFileExtension||""};this.setErrorFileExtension=function(b){a.errorFileExtension=b};this.mapToErrorFileImpl=function(){};this.mapToErrorFile=function(a,c,e,f){if(c&&c instanceof Celigo.integrator.mapping.model.DocumentMapping)this.mappingData=c;else if(c)throw new Celigo.Error({name:"INVALID_DOCUMENT_MAPPING",message:"the mapping should be an instanceof Celigo.integrator.mapper.model.DocumentMapping"});
if(!this.mappingData)throw new Celigo.Error({name:"INVALID_DOCUMENT_MAPPING",message:"no valid mapping data is available"});if(this.mappingData.isMapToErrorFileDisabled())return $$.logExecution("audit","mapToErrorFile disabled by mapping configuration",""),null;if(!a||!(a instanceof Celigo.integrator.model.Document))throw new Celigo.Error({name:"INVALID_DOCUMENT",message:"the document should be an instanceof Celigo.integrator.model.Document"});Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:BEFORE_MAP_TO_ERROR_FILE",
b,a);!_.isUndefined(b.documentLength)&&_.isFunction(a.getContent)&&a.getContent()&&b.documentLength!==a.getContent().length&&$$.logExecution("audit","warning","the given input file may have been changed since the last mapping");this.document=a.getContent();f=_.isUndefined(f)?!0:!!f;if(!e||!_.isArray(e)||!e.length)return $$.logExecution("debug","invalid error array","input errors need to be an array with error literal objects"),null;a=this.mapToErrorFileImpl(e,f);a=new Celigo.integrator.model.Document({content:a});
Celigo.event.dispatcher.integrator.mapping.Dispatcher.emit("MAPPER:AFTER_MAP_TO_ERROR_FILE",b,a);a=a.getContent();if(!a||!_.isString(a)||!a.length)return $$.logExecution("debug","empty or null error file output","no file to be created"),null;c="importError-"+Celigo.dateUtil.convertDateToTimeStamp(new Date,"YYYYMMDDHHmmss")+"."+(this.getErrorFileExtension()||"txt");return $$.createFile(c,this.getErrorFileNetSuiteContentType()||"PLAINTEXT",a)}};Celigo.integrator.mapper.AbstractMapper.extend(Celigo.io.PrivateStateful);
Celigo.integrator.mapper.AbstractMapper.__events__={"MAPPER:MAP_TO_EXTERNAL_ERROR":"MAPPER:MAP_TO_EXTERNAL_ERROR","MAPPER:MAP_TO_NETSUITE_ERROR":"MAPPER:MAP_TO_NETSUITE_ERROR","MAPPER:BEFORE_MAP_TO_ERROR_FILE":"MAPPER:BEFORE_MAP_TO_ERROR_FILE","MAPPER:AFTER_MAP_TO_ERROR_FILE":"MAPPER:AFTER_MAP_TO_ERROR_FILE","MAPPER:EXTERNAL_LOOKUP":"MAPPER:EXTERNAL_LOOKUP","MAPPER:MAP_TO_NETSUITE_COMPLETE":"MAPPER:MAP_TO_NETSUITE_COMPLETE","MAPPER:MAP_TO_EXTERNAL_COMPLETE":"MAPPER:MAP_TO_EXTERNAL_COMPLETE"};$.namespace("Celigo.integrator.mapper.flat");
Celigo.integrator.mapper.flat.BaseFlatFileMapper=function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.flat.BaseFlatFileMapper"});if(a.celigo_classname==="Celigo.integrator.mapper.flat.BaseFlatFileMapper")throw $$.createError("ABSTRACT_CLASS_INSTANTIATION","Celigo.integrator.mapper.flat.BaseFlatFileMapper is an abstract class.");Celigo.integrator.mapper.flat.BaseFlatFileMapper.superclass.constructor.call(this,a);this.getClassName=function(){return"Celigo.integrator.mapper.flat.BaseFlatFileMapper"};
var b=this,c=new Date(2014,11,30),e={},f=null,g=null,h=function(a,b,c){if(b&&b.length>0){if(!a.matchById)a.matchById={};for(var a=a.matchById,e=0;e<b.length-1;e++)a[b[e]]||(a[b[e]]={}),a=a[b[e]];a[b[b.length-1]]||(a[b[b.length-1]]=[]);a[b[b.length-1]].push(c)}else{if(!a.matchAll)a.matchAll=[];a.matchAll.push(c)}},j=function(a,f){var g=f._baseFlatFileMapperUniqueIdForRecordMapping;if(!g)throw $$.createError("DEVELOPER_ERROR","recordMapping._baseFlatFileMapperUniqueIdForRecordMapping can't be null");
var i=e[g];if(!i){e[g]={};for(var i=e[g],g=f.getChildren(),j=0;g&&j<g.length;j++){var k=g[j];if(k instanceof Celigo.integrator.mapping.model.LineMappingSet){var p=k;h(i,p.getLineIds(),{sublistId:null,lineMappingSet:p})}else if(k instanceof Celigo.integrator.mapping.model.CollectionMapping){var w=k,k=w.getChildren(),p=w.getCollectionIds(),w=null;if(p&&p.length===1)w=p[0];else throw $$.createError("INVALID_MAPPING_CONFIG","collectionIds needs to have one and only one id");for(var u=0;k&&u<k.length;u++)p=
k[u],h(i,p.getLineIds(),{sublistId:w,lineMappingSet:p})}else throw $$.createError("INVALID_MAPPING_CONFIG","child has to be either LineMappingSet or CollectionMapping");}logUntil("lineMappingSetLookup",function(){return Celigo.JSON.stringify(i)},c)}return i.matchAll?i.matchAll:b.getLineMappingSetFromLookup(a,i.matchById)},i=function(a,e){logUntil("recurse mapping");if(!e._baseFlatFileMapperUniqueIdForRecordMapping)e._baseFlatFileMapperUniqueIdForRecordMapping=(new Date).getTime().toString();for(var f=
{nlobjRecordType:e.getRecordType(),nlobjFieldIds:{},nlobjSublistIds:{}},g=0;a&&g<a.length;g++){var h=a[g];logUntil("NewBaseFlatFileMapper - mapOneDocumentPartToJsObject - rowData "+g,function(){return Celigo.JSON.stringify(h)},c);var k=j(h,e);_.each(k,function(a){var e=a.sublistId,g=a.lineMappingSet;if(g&&(logUntil("NewBaseFlatFileMapper - mapOneDocumentPartToJsObject - lineMappingSet",function(){return Celigo.JSON.stringify(g)},c),a=g.getFieldMappings())){e&&(f.nlobjSublistIds[e]||(f.nlobjSublistIds[e]=
{lines:[]}),f.nlobjSublistIds[e].lines.push({}));for(var j=!0,k=0;k<a.length;k++){var l=a[k];logUntil("NewBaseFlatFileMapper - mapOneDocumentPartToJsObject - fieldMapping "+k,function(){return Celigo.JSON.stringify(l)},c);if(!l.isInactive()){var m=l.getJsField(),r=l.getSubRecordMapping(),o=null;if(r){if(o=i([h],r),r=null,r=e?_.last(f.nlobjSublistIds[e].lines)[m]:f.nlobjFieldIds[m])o.nlobjFieldIds=_.extend(r.nlobjFieldIds,o.nlobjFieldIds),o.nlobjSublistIds=_.extend(r.nlobjSublistIds,o.nlobjSublistIds)}else{if(l.getLookupFilterExpression()){for(var o=
{},r=l.getLookupFilterExpressionCache().fields,A=0;A<r.length;A++)o[r[A].iFld]=b.mapOneDocumentPartToJsObjectRecursively_getFieldValue(h,new Celigo.integrator.mapping.model.FieldMapping({externalField:r[A].eFld}));$$.logExecution("DEBUG","tempObj",o)}else o=b.mapOneDocumentPartToJsObjectRecursively_getFieldValue(h,l);o=b.getImportFieldValue(o,l)}e?(_.last(f.nlobjSublistIds[e].lines)[m]=o,o!==""&&!b.isValidHardCodedValue(l.getHardCodedValue())&&(j=!1)):f.nlobjFieldIds[m]=o}}e&&j&&f.nlobjSublistIds[e].lines.pop()}});
logUntil("NewBaseFlatFileMapper - mapOneDocumentPartToJsObject - obj "+g,function(){return Celigo.JSON.stringify(f)},c)}return f};this.getColumnIndexFromHeader=function(a){if(_.isUndefined(a)||_.isNull(a))return a;var b;if(isNaN(a)){if(!g)throw $$.createError("CELIGO_INVALID_CONFIG","File doesn't has headers.");b=_.indexOf(g,a);if(b<0)throw $$.createError("CELIGO_INVALID_CONFIG","There is no such header: "+a);}else b=parseInt(a,10);return b};this.splitDocumentIntoPartsEachMapsToOneObject=function(a){f=
[];var e=this.splitDocumentIntoPartsEachMapsToOneObject_splitDocToArray(b.document);logUntil(this.getClassName()+" - splitDocumentIntoPartsEachMapsToOneObject - dataArray",function(){return JSON.stringify(e)},c);b.mappingData.getFileHasHeaders()?($$.logExecution("debug","file has header",b.mappingData.getFileHasHeaders()),g=e.shift()):g=null;this.lineLookup=null;if(a=a.getRecordIdentifiers())if(a instanceof Celigo.integrator.mapping.model.TokenLimitRecordIdentifier){var i=a.getStartToken(),a=[];this.lineLookup=
{};for(var j=0;e&&j<e.length;j++)log(this.getClassName()+" - splitDocumentIntoPartsEachMapsToOneObject - data1[i] "+j,e[j]),this.splitDocumentIntoPartsEachMapsToOneObject_tokenLimitMatches(e[j],i)?(f.push([j]),a.push([e[j]]),this.lineLookup[String(a.length-1)]=[g?j+1:j]):a.length>0&&(f[f.length-1].push(j),a[a.length-1].push(e[j]),this.lineLookup[String(a.length-1)].push(g?j+1:j))}else if(a instanceof Celigo.integrator.mapping.model.KeyColumnRecordIdentifier){for(var i=a.getKeyColumns(),h=0;h<i.length;h++)i[h]=
this.getColumnIndexFromHeader(i[h]);for(var a=[],k={},j=0;e&&j<e.length;j++){log(this.getClassName()+" - splitDocumentIntoPartsEachMapsToOneObject - data2[i] "+j,e[j]);for(var p=[],h=0;h<i.length;h++)p.push(e[j][i[h]]);p=p.join("$$#$@#");k[p]||k[p]===0?(a[k[p]].push(e[j]),f[k[p]].push(j)):(a.push([e[j]]),k[p]=a.length-1,f.push([j]))}}else throw $$.createError("INVALID_MAPPING","Type of recordIdentifiers is not supported.");else a=_.map(e,function(a,b){f.push([b]);return[a]});return a};this.mapOneDocumentPartToJsObject=
function(a,e){b.indexOfCurrentDocumentPartBeingMappedToJsObject=f.shift();logUntil("NewBaseFlatFileMapper - mapOneDocumentPartToJsObject - documentPart",a,c);logUntil("NewBaseFlatFileMapper - mapOneDocumentPartToJsObject - documentPartLineNumber",b.indexOfCurrentDocumentPartBeingMappedToJsObject,c);return i(a,e)};this.generatePrintableDocumentIndex=function(){return"Row number "+(b.indexOfCurrentDocumentPartBeingMappedToJsObject[0]+1)};var k=null;this.beforeMapOneJsObjectToExternal=function(){k=b.document};
this.onErrorWhenMapOneJsObjectToExternal=function(){b.document=k}};Celigo.integrator.mapper.flat.BaseFlatFileMapper.className="Celigo.integrator.mapper.flat.BaseFlatFileMapper";Celigo.integrator.mapper.flat.BaseFlatFileMapper.extend(Celigo.integrator.mapper.AbstractMapper);Celigo.integrator.mapper.flat.BaseFlatFileMapper.prototype.pad=function(a,b){return!a||!_.isString(a)||isNaN(+b)||a.length>=+b?a:a+Array(b-a.length+1).join(" ")};$.namespace("Celigo.integrator.mapper.flat");Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper=
function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper"});if(a.celigo_classname==="Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper")throw $$.createError("ABSTRACT_CLASS_INSTANTIATION","Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper is an abstract class.");Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper.superclass.constructor.call(this,a);this.getClassName=function(){return"Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper"};
this.mapOneDocumentPartToJsObjectRecursively_getFieldValue=function(a,c){var e=this.getColumnIndexFromHeader(c.getExternalField());log("column "+e,c.getJsField());if(e>=a.length)throw $$.createError("CELIGO_INVALID_VALUE","externalField exceed number of columns in this row: "+Celigo.JSON.stringify(a));return a[e]};this.splitDocumentIntoPartsEachMapsToOneObject_tokenLimitMatches=function(a,c){return a[0]===c}};Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper.className="Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper";
Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper.extend(Celigo.integrator.mapper.flat.BaseFlatFileMapper);$.namespace("Celigo.integrator.mapper.flat.csv");Celigo.integrator.mapper.flat.csv.CsvMapper=function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.flat.csv.CsvMapper"});Celigo.integrator.mapper.flat.csv.CsvMapper.superclass.constructor.call(this,a);a.errorFileNetSuiteContentType=a.errorFileNetSuiteContentType||"CSV";a.errorFileExtension=a.errorFileExtension||"csv";this.getClassName=
function(){return"Celigo.integrator.mapper.flat.csv.CsvMapper"};var b=this,c=new Date(2012,9,30),e,f,g,h,j,i,k=function(){e=b.mappingData.getFieldDelimiter();f=b.mappingData.getLineDelimiter();g=b.mappingData.getWrapWithQuotes();h=b.mappingData.getReplaceLineBreaksInCellDataWithSpace();j=b.mappingData.getReplaceTabsInCellDataWithSpace();i=['"',e,f];var a=b.mappingData.getAdditionalControlCharacters();a&&a.length>0&&(i=i.concat(a))},l=function(a){g?a='"'+a.replace(/"/g,'""')+'"':_.any(i,function(b){return a.indexOf(b)!==
-1})&&(a='"'+a.replace(/"/g,'""')+'"');h&&(a=a.replace(/(\r\n|\n|\r)/g," "));j&&(a=a.replace(/\t/g," "));return a},m=function(a){k();f=f.charAt(0);f==="\n"&&(f="");a.length>0&&a.charAt(0)===e&&(a='""'+a);for(var b=RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+f+"\\r\\n]*))","gi"),g=[[]],i=null;i=b.exec(a);){logUntil("CsvMapper - fileToTwoDimArray - arrMatches",function(){return JSON.stringify(i)},c);var j=i[1];j.length&&j!==e&&g.push([]);j=i[2]?i[2].replace(RegExp('""',"g"),'"'):
i[3]||"";g[g.length-1].push(j)}g.length>0&&(a=g[g.length-1],(a.length===0||a.length===1&&a[0]==="")&&g.pop());logUntil("CsvMapper - fileToTwoDimArray - arrData",function(){return JSON.stringify(g)},c);return g};this.beforeMapJsToExternalOneRecordMapping=function(a,c){k();if(!(c>0)&&b.mappingData.getFileHasHeaders()){var g=a.getChildren();if(g&&g.length===1){for(;!g[0].getFieldMappings;)g=g[0].getChildren();for(var g=g[0].getFieldMappings(),i="",j=0;g&&j<g.length;j++){var h=g[j],h=h.getExternalField()||
h.getJsField();i+=l(h);i+=j<g.length-1?e:f}b.document=i+b.document}}};this.mapJsToExternalWithFieldMappingSet=function(a,g,i){k();a=i?a:a.slice(0,1);for(i=0;i<a.length;i++){var j=a[i],h=g.getLineIds(),m=g.getFieldMappings(),u="";h&&h.length>0&&(u+=h.join(e)+e);h=!0;logUntil("CsvMapper - mapJsToExternalWithFieldMappingSet - fieldMappings",function(){return Celigo.JSON.stringify(m)},c);for(var s=0;m&&s<m.length;s++){b.incrementProcessingUnit();var v=String(b.getExportFieldValue(j,m[s])||"");v!==""&&
(h=!1);u+=l(v);u+=s<m.length-1?e:f}h||(b.document+=u)}};this.getLineMappingSetFromLookup=function(a,b){for(var c=0;a&&c<a.length;c++)if(b&&b[a[c]]){if(b=b[a[c]],_.isArray(b)&&b.length>0&&b[0].lineMappingSet)return b}else break;return[{sublistId:null,lineMappingSet:null}]};this.preProcessMapToExternalMapping=function(a){a||(a=new Celigo.integrator.mapping.model.CsvFileMapping({fileHasHeaders:!0}));var e=a.getRecordMappings();if(e&&e.length>0)return a;b.jsObjects.reset();e=b.jsObjects.getNextObject();
if(!e||e.length===0)return a;var f=[],g="";e[0].recordType&&(g=(new Celigo.core.metadata.NetSuiteCreatedDateSearchColumnMetadata).getCreatedDateSearchColumn(e[0].recordType));_.each(e[0],function(a,b){_.contains(["id","recordType","celigoExportType",g],b)||f.push({jsField:b,celigo_classname:"Celigo.integrator.mapping.model.FieldMapping"})});logUntil(b.getClassName()+" - preProcessMapToExternalMapping - no mapping use case","generating mappings",c);e=Celigo.io.Serializable.revive(JSON.stringify({children:[{fieldMappings:f,
celigo_classname:"Celigo.integrator.mapping.model.LineMappingSet"}],celigo_classname:"Celigo.integrator.mapping.model.RecordMapping"}));a.setRecordMappings([e]);logUntil(b.getClassName()+" - preProcessMapToExternalMapping - generated documentMapping",function(){return Celigo.JSON.stringify(a)},c);return a};this.splitDocumentIntoPartsEachMapsToOneObject_splitDocToArray=function(a){return m(a)};this.mapToErrorFileImpl=function(a,b){var c=this.splitDocumentIntoPartsEachMapsToOneObject_splitDocToArray(this.document),
e=this.mappingData.getFileHasHeaders(),f;if(e)f=_.last(c[0],2),f[0]==="Celigo_Error_Code"&&f[1]==="Celigo_Error_Message"?$$.logExecution("audit","error columns already present","existing columns will be overwritten"):(c[0].push("Celigo_Error_Code"),c[0].push("Celigo_Error_Message")),f=c[0].length;else{for(var g=0;g<c.length;g++)for(var i=c[g].length-1;i>c[g].length-3;i--){if(c[g][i]&&~c[g][i].search(/celigo_error_code/i)){f=c[g].length;break}if(f)break}f||(f=c[0].length+2)}var j=e?c.length-1:c.length,
g=[],h={},i={};e&&g.push(c[0]);for(var k=0,m=a.length;k<m;k++){var l=a[k];if(!l||!_.isNumber(l.index)||l.index<0||l.index>j-1||!l.code&&!l.message)$$.logExecution("error","invalid error literal is discarded, actual document length(without headers):"+j+" )",l);else{var B=l.index,A=l.allIndex||[B];e&&(B+=1,A=_.map(A,function(a){return a+1}));c[B][f-2]=e?String(l.code):"Celigo_Error_Code:"+String(l.code);c[B][f-1]=e?String(l.message):"Celigo_Error_Message:"+String(l.message);i[String(B)]=1;_.each(A,
function(a){h[String(a)]=1})}}j=0;for(k=c.length;j<k;j++)!(e&&j===0)&&!i[j]&&(c[j][f-1]="",c[j][f-2]="");if(b){j=0;for(k=c.length;j<k;j++)h[j]&&g.push(c[j]);c=g}g=null;return this.convertTwoDimensionalArrayToCsvContent(c,this.mappingData)}};Celigo.integrator.mapper.flat.csv.CsvMapper.className="Celigo.integrator.mapper.flat.csv.CsvMapper";Celigo.integrator.mapper.flat.csv.CsvMapper.extend(Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper);Celigo.integrator.mapper.flat.csv.CsvMapper.prototype.convertTwoDimensionalArrayToCsvContent=
function(a,b){if(!b||!(b instanceof Celigo.integrator.mapping.model.CsvFileMapping))return $$.logExecution("error","invalid mapping","mapping must be an instance of FlatFileMapping"),"";var c=[],e=b.getFieldDelimiter(),f=b.getLineDelimiter(),g=b.getFileHasHeaders(),h=b.getWrapWithQuotes();if(h!==!0&&h!==!1)var j=!0;for(var i=b.getReplaceLineBreaksInCellDataWithSpace(),k=b.getReplaceTabsInCellDataWithSpace(),l,m,n,o=0;o<a.length;o++)if(!(o===0&&g===!1)){l=a[o];m=[];for(var q=0;q<l.length;q++)n=l[q]||
"",Object.prototype.toString.apply(n)==="[object String]"&&(j===!0&&(n.indexOf(e)!==-1||n.indexOf('"')!==-1||n.indexOf("\n")!==-1)?(n=n.replace(/\"/g,'""'),n='"'+n+'"'):h&&h===!0&&(n='"'+n+'"'),i&&i===!0&&(n=n.replace(/(\r\n|\n|\r)/g," ")),k&&k===!0&&(n=n.replace(/\t/g," "))),m.push(n);c.push(m)}g="";for(h=0;h<c.length;h++){l=c[h];for(j=0;j<l.length;j++)n=l[j],g+=n,g+=j<l.length-1?e:f}return g};$.namespace("Celigo.integrator.mapper.flat.fixedwidth");Celigo.integrator.mapper.flat.fixedwidth.FixedWidthMapper=
function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.flat.fixedwidth.FixedWidthMapper"});Celigo.integrator.mapper.flat.fixedwidth.FixedWidthMapper.superclass.constructor.call(this,a);this.getClassName=function(){return"Celigo.integrator.mapper.flat.fixedwidth.FixedWidthMapper"};var b=this,c=new Date(2012,9,11);this.mapJsToExternalWithFieldMappingSet=function(a,f){var g=b.mappingData.getLineDelimiter(),h=b.mappingData.getLeftAlign()||!0,j=b.mappingData.getFillCharacter()||" ",i=a[0],k=f.getLineIds(),
l=f.getFieldMappings(),m="";k&&k.length>0&&(m+=k.join(""));k=!0;logUntil("NewFixedWidthMapper - mapJsToExternalWithFieldMappingSet - fieldMappings",function(){return l},c);for(var n=0;l&&n<l.length;n++){b.incrementProcessingUnit();var o=l[n],q=b.getExportFieldValue(i,o)||"";q!==""&&(k=!1);var r=o.getColumnWidth();if(!r)throw $$.createError("INVALID_MAPPING_CONFIG","Field Mapping needs to have Column Width");if(q.length>r)var p=o.getTruncationIndicator(),q=q.substr(0,r-p.length)+p;else p=o.getFillCharacter()!==
void 0?o.getFillCharacter():j,o=o.getLeftAlign()!==void 0?o.getLeftAlign():h,q=_.str.pad(q,r,p,o?"right":"left");m+=q;n===l.length-1&&(m+=g)}k||(b.document+=m)};this.splitDocumentIntoPartsEachMapsToOneObject_splitDocToArray=function(a){a=a.split("\n");_.last(a)===""&&a.pop();return a};this.splitDocumentIntoPartsEachMapsToOneObject_tokenLimitMatches=function(a,b){return _.str.startsWith(a,b)};this.getLineMappingSetFromLookup=function(a,b){logUntil("NewFixedWidthMapper - getLineMappingSetFromLookup - lineMappingSetLookup",
function(){return b},c);for(var g=!0;g;){var g=!1,h;for(h in b)if(logUntil("NewFixedWidthMapper - getLineMappingSetFromLookup - prefix",h,c),_.str.startsWith(a,h)){b=b[h];if(_.isArray(b)&&b.length>0&&b[0].lineMappingSet)return b;a=a.substr(h.length);g=!0;break}}return[{sublistId:null,lineMappingSet:null}]};this.mapOneDocumentPartToJsObjectRecursively_getFieldValue=function(a,b){if(_.isUndefined(this.maxWidth))this.maxWidth=0;if(b&&_.isFunction(b.getColumnStart)&&_.isNumber(b.getColumnStart())&&_.isFunction(b.getColumnWidth)&&
_.isNumber(b.getColumnWidth())){var c=b.getColumnStart()+b.getColumnWidth();this.maxWidth=c>this.maxWidth?c:this.maxWidth}c=b.getHardCodedValue();if(!c&&!(c===!1||c===""||c===0)){var c=b.getColumnStart(),h=b.getColumnWidth();_.isString(c)&&(c=+c);if(!_.isNumber(c)||_.isNaN(c))throw $$.createError("CELIGO_INVALID_VALUE","columnStart has to be a number: "+Celigo.JSON.stringify(b));_.isString(h)&&(h=+h);if(!_.isNumber(h)||_.isNaN(h))throw $$.createError("CELIGO_INVALID_VALUE","columnWidth has to be a number: "+
Celigo.JSON.stringify(b));return(c=a.substr(c,h))?_.str.trim(c):c}};this.mapToErrorFileImpl=function(a,b){var c=this.splitDocumentIntoPartsEachMapsToOneObject_splitDocToArray(this.document),h=this,j=[],i=0,k=0,l=0,m=0;!this.lineLookup||_.isEmpty(this.lineLookup)?_.each(a,function(a){if(!_.isNumber(a.index)||a.index<0||a.index>c.length-1||!a.code&&!a.message)$$.logExecution("error","invalid error literal is discarded",a);else{a={lines:[a.index],code:a.code,message:a.message};if(a.code&&a.code.length>
k)k=a.code.length;if(a.message&&a.message.length>l)l=a.message.length;j.push(a)}}):($$.logExecution("debug","row elements are grouped"),_.each(a,function(a){if(!_.isNumber(a.index)||!a.code&&!a.message||!h.lineLookup[String(a.index)])$$.logExecution("error","invalid error literal is discarded",a);else{a={lines:h.lineLookup[String(a.index)],code:a.code,message:a.message};if(a.code&&a.code.length>k)k=a.code.length;if(a.message&&a.message.length>l)l=a.message.length;j.push(a)}}));if(!j||!j.length)return"";
for(var n,o=0;o<c.length;o++){var q=c[o].search(/celigo_error_code/i);if(q>-1){n=q;break}}if(n)for(o=0;o<c.length;o++){if(c[o]=c[o].substring(0,n),c[o].length>i)i=c[o].length}else if(_.each(c,function(a){if(a&&a.length>i)i=a.length}),this.maxWidth&&this.maxWidth>i)i=this.maxWidth;m=i+k+l+39;_.each(j,function(a){for(var b=a.lines,e=-1,f=b.length-1;f>-1;f--)e=b[f],f!==0?c[e]=h.pad(c[e],m):(c[e]=h.pad(c[e],i),a.code=h.pad(a.code,k),a.message=h.pad(a.message,l),c[e]=c[e]+"Celigo_Error_Code:"+a.code+"Celigo_Error_Message:"+
a.message)});n="";if(b)return o=_.filter(c,function(a){return a&&a.length===m}),c=null,n=o.join(this.mappingData.getLineDelimiter()),o=null,n;c=_.map(c,function(a){return h.pad(a,m)});n=c.join(this.mappingData.getLineDelimiter());c=null;return n}};Celigo.integrator.mapper.flat.fixedwidth.FixedWidthMapper.extend(Celigo.integrator.mapper.flat.BaseFlatFileMapper);Celigo.util.namespace("Celigo.integrator.mapper.flat.sql");Celigo.integrator.mapper.flat.sql.SqlMapper=function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.flat.sql.SqlMapper"});
Celigo.integrator.mapper.flat.sql.SqlMapper.superclass.constructor.call(this,a);this.getClassName=function(){return"Celigo.integrator.mapper.flat.sql.SqlMapper"};var b=this,c=null,e=null,f=function(a){return a&&a.getConnection&&a.getConnection()&&a.getConnection().getEndPoint&&a.getConnection().getEndPoint()&&a.getConnection().getEndPoint().indexOf("mysql")>-1},g=function(a){return(a.getSchemaName()?a.getSchemaName()+".":"")+a.getTableName()},h=function(a){statementString="INSERT INTO "+g(a.getSqlStatementMetadata())+
" (";valuesString=" VALUES (";_.each(a.getFieldMappings(),function(a,b,c){a.getExternalField()&&(statementString+=a.getExternalField(),b===c.length-1?statementString+=")":statementString+=", ");b===c.length-1?valuesString+="?)":valuesString+="?, "});statementString+=valuesString;return statementString},j=function(a){var b="";_.each(a.getFieldMappings(),function(a,c,e){a.getExternalField()&&(b+=a.getExternalField()+" = ?",c!==e.length-1&&(b+=", "))});return b},i=function(a){statementString="UPDATE "+
g(a.getSqlStatementMetadata())+" SET ";statementString+=j(a,statementString);var a=a.getSqlStatementMetadata().getTablePrimaryKeyProperty(),b;_.isArray(a)?(b=[],_.each(a,function(a){b.push(a+" = ?")}),b=b.join(" AND ")):b=a+" = ?";return statementString=[statementString,b].join(" WHERE ")},k=function(a){var b="";switch(a.getSqlStatementMetadata().getSqlStatementType().toLowerCase()){case Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.INSERT:b=h(a);b+=";";break;case Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPDATE:b=
i(a);b+=";";break;case Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPSERT:f(c)?(b=h(a),b+=" ON DUPLICATE KEY UPDATE ",b+=j(a)):(b="MERGE INTO "+g(a.getSqlStatementMetadata()),b+=" USING (SELECT "+a.getSqlStatementMetadata().getTablePrimaryKeyProperty()+" FROM "+g(a.getSqlStatementMetadata()),b+=" WHERE "+a.getSqlStatementMetadata().getTablePrimaryKeyProperty()+" = ?) S",b+=" ON (S."+a.getSqlStatementMetadata().getTablePrimaryKeyProperty()+" = ?)",b+=" WHEN MATCHED THEN ",b+=i(a),
b+=" WHEN NOT MATCHED THEN ",b+=h(a));b+=";";break;case Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.DELETE:b=a.getSqlStatementMetadata().getSqlStatementType()+" FROM "+g(a.getSqlStatementMetadata())+" ";b+=" WHERE "+a.getSqlStatementMetadata().getTablePrimaryKeyProperty()+" = ?;";break;default:throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"CELIGO_UNSUPPORTED_SQL_STATEMENT_TYPE",message:"Unsupported SQL statement type for export => "+a.getSqlStatementMetadata().getSqlStatementType()});
}$$.logExecution("AUDIT","SQL Statement",b);return c&&c instanceof Celigo.integrator.connectors.sql.SqlConnector?c.prepareStatement(b):new Celigo.integrator.connectors.model.PreparedStatement({statement:b})},l=function(a,c,e,f){_.each(a.getFieldMappings(),function(a){var g=b.getExportFieldValue(e,a)||"";if(!a.getExternalDatatype())throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"CELIGO_DEVELOPER_ERROR",message:"SQL FieldMapping requires externalDatatype property to be set prior to mapping."});
if(c.setByExternalDataType)c.setByExternalDataType(a.getExternalDatatype(),++f,g);else switch(a.getExternalDatatype()){case Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES.String:c.setString(++f,g);break;case Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES.Date:c.setDate(++f,g);break;case Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES.Boolean:c.setBoolean(++f,g);break;case Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES.BigDecimal:c.setBigDecimal(++f,
g);break;case Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES.Double:c.setDouble(++f,g);break;case Celigo.integrator.connectors.sql.PreparedStatement.DATATYPES.Integer:c.setInt(++f,g);break;default:throw new Celigo.connectors.netsuite.object.NetSuiteError({name:"CELIGO_INVALID_EXTERNAL_DATATYPE",message:"Invalid SQL ExternalDatatype => "+a.getExternalDatatype()});}});return f};this.mapJsToExternal=function(a,e,f){c=f;b.jsObjects=a;b.document=[];b.mappingData=e;b.mappingErrors=[];_.each(b.mappingData.getRecordMappings(),
function(a){b.mapJsToExternalWithOneRecordMapping(a)});for(a=0;b.mappingErrors&&a<b.mappingErrors.length;a++)b.mappingErrors[a]?(e=b.mappingErrors[a].error||{name:"CELIGO_UNEXPECTED_MAPPING_ERROR",message:"Empty mapping error!"},e="Mapping error at index: "+(b.mappingErrors[a].index||-1)+" | Code: "+(e.name||e.getCode())+" | Message: "+(e.message||e.getDetails()),$$.logExecution("debug","mapping error",e),$L.errorOnCurrentJob(e)):$L.errorOnCurrentJob("Mapping error at unknown index! | Code: CELIGO_UNEXPECTED_MAPPING_ERROR | Message: Empty mapping error!");
return{document:b.document,mappingErrors:b.mappingErrors}};this.mapToExternal=function(a,c){this.mapJsToExternal(a,c);return new Celigo.integrator.mapping.model.MapToExternalResult({document:new Celigo.integrator.model.PreparedStatementDocument({content:e}),mappingErrors:b.mappingErrors})};this.mapJsToExternalWithFieldMappingSet=function(a,g){b.incrementProcessingUnit();g.getSqlStatementMetadata().getPreparedStatement()||($$.logExecution("AUDIT","Intializing new prepared statement for mapping node"),
$$.logExecution("AUDIT","Schema",g.getSqlStatementMetadata().getSchemaName()),$$.logExecution("AUDIT","Table",g.getSqlStatementMetadata().getTableName()),$$.logExecution("AUDIT","Statement Type",g.getSqlStatementMetadata().getSqlStatementType()),$$.logExecution("AUDIT","Table Key Property",g.getSqlStatementMetadata().getTablePrimaryKeyProperty()),$$.logExecution("AUDIT","JS External Key Property",g.getSqlStatementMetadata().getJsExternalIdProperty()),e=k(g),g.getSqlStatementMetadata().setPreparedStatement(e),
b.document.push(e));var i,j=0,h=g.getSqlStatementMetadata().getJsExternalIdProperty();i=_.isArray(a)?a[0]:a;if(g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPDATE||g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.DELETE||g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPSERT&&
!f(c)){if(!h)throw new Celigo.Error({name:"CELIGO_EMPTY_EXTERNAL_KEY_PROPERTY",message:"Unable to find external key property for mapping."});if(_.isArray(h))_.each(h,function(a){if(!i[a])throw new Celigo.Error({name:"CELIGO_INVALID_EXTERNAL_KEY",message:"Invalid external key ( key field on data object is empty): "+a});});else if(!i[h])throw new Celigo.Error({name:"CELIGO_INVALID_EXTERNAL_KEY",message:"Invalid external key ( key field on data object is empty): "+h});}!f(c)&&g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===
Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPSERT&&(e.setString(++j,i[g.getSqlStatementMetadata().getJsExternalIdProperty()]),e.setString(++j,i[g.getSqlStatementMetadata().getJsExternalIdProperty()]));try{j=l(g,e,i,j)}catch(p){$$.logExecution("error",p.name,p.message)}if(g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPDATE||g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.DELETE||
g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPSERT&&!f(c))_.isArray(h)?_.each(h,function(a){$$.logExecution("debug",a,i[a]);e.setString(++j,i[a])}):e.setString(++j,i[h]);g.getSqlStatementMetadata().getSqlStatementType().toLowerCase()===Celigo.integrator.connectors.sql.SqlUtil.SQL_STATEMENT_TYPES.UPSERT&&(j=l(g,e,i,j));e.addBatch()};this.splitDocumentIntoPartsEachMapsToOneObject_splitDocToArray=function(a){return a.getData()}};
Celigo.integrator.mapper.flat.sql.SqlMapper.className="Celigo.integrator.mapper.flat.sql.SqlMapper";Celigo.integrator.mapper.flat.sql.SqlMapper.extend(Celigo.integrator.mapper.flat.TwoDimensionalFlatFileMapper);$.namespace("Celigo.integrator.mapper.json");Celigo.integrator.mapper.json.JsonMapper=function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.json.JsonMapper"});Celigo.integrator.mapper.json.JsonMapper.superclass.constructor.call(this,a);a.errorFileNetSuiteContentType=a.errorFileNetSuiteContentType||
"PLAINTEXT";a.errorFileExtension=a.errorFileExtension||"txt";this.getClassName=function(){return"Celigo.integrator.mapper.json.JsonMapper"};var b=$.getExecutionLogger(this.getClassName()),c=this,e=new Date(2012,11,20),f=function(a,b){var c=RegExp("{{[^{]*?\\[\\*\\].*?}}","g"),e=[],f,g=0,h,q,r=0,p={},w=[],u;for(p.$=a;f=c.exec(b);)e.push(f[0]);if(e.length===0)return w=Celigo.util.HandlebarsUtil.render(b,p),[w];_.each(e,function(b){b.indexOf("[*]")>0&&(h=b.substring(b.indexOf("$."),b.indexOf("[*]")),
q=jsonPath(a,h)||[],r=q.length>0?q[0].length:0,g=r>g?r:g)});for(var s=0;s<g;s++)u=b,_.each(e,function(a){a.indexOf("[*]")>0&&(f=a.replace("[*]",".["+s+"]"),u=u.replace(a,f))}),w.push(Celigo.util.HandlebarsUtil.render(u,p));return w},g=function(a,b){var e=b.getRecordIdentifiers();if(e instanceof Celigo.integrator.mapping.model.JsonPathRecordIdentifier){var e=e.getJsonPath(),f=jsonPath(a,e)||[];c.objectPath=jsonPath(a,e,{resultType:"PATH"});if(_.isEmpty(f))throw $$.createError("INVALID_DATA","No Data Found in the Input JSON Object at the JSON Path : "+
e);!_.isArray(f[0])&&_.isObject(f[0])&&(f[0]=[f[0]]);return f[0]}else throw $$.createError("INVALID_MAPPING","recordIdentifiers must be an instance of JsonPathRecordIdentifier Class");},h=function(b,i){for(var k={nlobjRecordType:i.getRecordType(),nlobjFieldIds:{},nlobjSublistIds:{}},l=[],m=i.getChildren(),n=null,o=null,q=null,r=null,p=function(a){return h(a,E)},w=0;m&&w<m.length;w++){n=m[w];r=q=o=null;if(n instanceof Celigo.integrator.mapping.model.FieldMappingSet)r=n.getFieldMappings();else if(n instanceof
Celigo.integrator.mapping.model.CollectionMapping&&(o=n.getCollectionIds()[0],q=n.getJsonPath?n.getJsonPath():null,r=n.getChildren()[0].getFieldMappings(),!q)){for(var u=null,s=null,n=0;r&&n<r.length;n++){var v=r[n].getLookupFilterExpression(),t=r[n].getExternalField(),s=[];v?s=_.map(_.pluck(r[n].getLookupFilterExpressionCache(a.celigo_classname,Array.isArray(b)).fields,"eFld"),function(a){return(a.indexOf("[*]")===0||a.indexOf("*")===0?"$":"$.")+a}):t&&!t.match(/{{(.*?)}}/g)&&(s=[t]);for(v=0;v<s.length;v++)if(t=
s[v],u){if(t.indexOf("[*]")>0&&t.indexOf(".*.")>0&&t.indexOf(u)!==0){u=null;break}}else if(u=t.lastIndexOf("[*]"),u>0)u=t.substr(0,u+3);else if(u=t.lastIndexOf(".*."),u>0)u=t.substr(0,u+2);else{u=null;break}}u&&(q=u)}l.push({sublistId:o,sublistJsonPath:q,mappings:r})}for(n=0;n<l.length;n++){for(var o=l[n].sublistId,q=l[n].sublistJsonPath,m=l[n].mappings,y=[],r=[],s=!0,x=[],w=0;m&&w<m.length;w++){var B=m[w];if(!B.isInactive()){var A=B.getJsField(),z=B.getExternalField(),u=B.getHardCodedValue(),E=B.getSubRecordMapping(),
t=null;logUntil("JsonMapper - mapOneDocumentPartToJsObjectRecursively - fieldMapping "+w,"jsField : "+A,e);if(E)v=g(b,E),t=_.map(v,p);else if(_.isUndefined(u)){if(o)if(z&&z.match(/{{(.*?)}}/g))t=_.isArray(b)&&b.length>0&&z&&z.indexOf("$.0.")<0&&z.indexOf("$[0].")<0&&z.indexOf("$.*.")<0&&z.indexOf("$[*].")<0?c.INTEGRATOR_IO_MAPPER?Celigo.util.ExpressionUtil.processIOExpressions(b[0],z,o)||[]:f(b[0],z,o)||[]:c.INTEGRATOR_IO_MAPPER?Celigo.util.ExpressionUtil.processIOExpressions(b,z,o)||[]:f(b,z,o)||
[];else if(q){var C=jsonPath(b,q);if(C&&C.length>0)if(B.getLookupFilterExpression()){t=[];for(v=0;v<C.length;v++){var F=Celigo.io.Serializable.revive(Celigo.JSON.stringify(B)),I=F.getLookupFilterExpression(),I=I.indexOf("[*]")>0?I.replace(/\[\*\]/g,(q==="$[*]"?"":".")+v):I.replace(/\*./g,v+".");F.setLookupFilterExpression(I);t.push(c.getImportFieldValue(b,F))}}else z&&z.indexOf(q)===0?(z=z.substr(q.length),t=_.map(C,function(a){return(a=jsonPath(a,z))&&a.length>0?a[0]:void 0})):t=z[0]!=="$"?_.map(C,
function(a){return(a=jsonPath(a,z))&&a.length>0?a[0]:void 0}):_.map(C,function(){var a;return(a=_.isArray(b)&&b.length>0&&z&&z.indexOf("$.0.")!==0&&z.indexOf("$[0].")!==0?jsonPath(b[0],z)||[]:jsonPath(b,z)||[])&&a.length>0?a[0]:void 0});else t=[]}else B.getLookupFilterExpression()?(t=[],t.push(c.getImportFieldValue(b,B))):t=jsonPath(b,z)||[];else t=B.getLookupFilterExpression()?_.isArray(b)&&b.length>0&&!B.getLookupFilterExpression().match(/{{0\./)&&!B.getLookupFilterExpression().match(/{{\[0\]\./)?
[c.getImportFieldValue(b[0],B)]:[c.getImportFieldValue(b,B)]:z&&z.match(/{{(.*?)}}/g)?_.isArray(b)&&b.length>0&&z&&z.indexOf("$.0.")<0&&z.indexOf("$[0].")<0&&z.indexOf("$.*.")<0&&z.indexOf("$[*].")<0?c.INTEGRATOR_IO_MAPPER?Celigo.util.ExpressionUtil.processIOExpressions(b[0],z)||[]:f(b[0],z)||[]:c.INTEGRATOR_IO_MAPPER?Celigo.util.ExpressionUtil.processIOExpressions(b,z)||[]:f(b,z)||[]:_.isArray(b)&&b.length>0&&z&&z.indexOf("$.0.")!==0&&z.indexOf("$[0].")!==0?jsonPath(b[0],z)||[]:jsonPath(b,z)||[];
_.isEmpty(t)&&(t=[""]);if(t&&t.length===1&&t[0]&&t[0].error&&t[0].error.code&&t[0].error.message){$L.errorOnCurrentJob(t[0].error.message);continue}B.getLookupFilterExpression()||(t=_.map(t,function(a){return c.getImportFieldValue(a,B)}))}else t=[c.getImportFieldValue(u,B)];o?(x.push(A),_.isUndefined(u)?(s=!1,_.each(t,function(a,b){y.length===b&&y.push({});y[b][A]=a})):r.push({sublistId:o,jsField:A,hardCodedValue:u})):k.nlobjFieldIds[A]=t[0]}}if(y&&y.length||o&&m&&m.length&&s)if((y=_.filter(y,function(a){for(var b in a)if(_.has(a,
b)&&a[b]!==void 0&&a[b]!==null&&a[b]!=="")return!0;return!1}))&&y.length||o&&m&&m.length&&s){if(r){if(!y||!y.length)y=[],y.push({});_.each(r,function(a){_.each(y,function(b){b[a.jsField]=a.hardCodedValue})})}y=_.map(y,function(a){for(var b={},c=0;c<x.length;c++){var e=x[c];a[e]!==void 0&&(b[e]=a[e])}return b});k.nlobjSublistIds[o]?k.nlobjSublistIds[o].lines=k.nlobjSublistIds[o].lines.concat(y):k.nlobjSublistIds[o]={lines:y}}}return k};this.splitDocumentIntoPartsEachMapsToOneObject=function(a){return g(c.document,
a)};this.searchBeforeSave=function(a,b){if(!_.isEmpty(b)&&!_.isEmpty(a)){var e;if((e=_.isArray(a)&&a.length>0&&!b.getLookupFilterExpression().match(/{{0\./)&&!b.getLookupFilterExpression().match(/{{\[0\]\./)?[c.getImportFieldValue(a[0],b)]:[c.getImportFieldValue(a,b)])&&_.isArray(e)&&e.length>1)throw $$.createError("MORE_THAN_ONE_MATCH_FOUND","More than one match found for the record in NetSuite");return _.isArray(e)?e[0]:e}};this.mapOneDocumentPartToJsObject=function(a,b){_.isUndefined(c.indexOfCurrentDocumentPartBeingMappedToJsObject)?
c.indexOfCurrentDocumentPartBeingMappedToJsObject=0:c.indexOfCurrentDocumentPartBeingMappedToJsObject+=1;return h(a,b)};this.generatePrintableDocumentIndex=function(){return"JSON Object Index "+(c.indexOfCurrentDocumentPartBeingMappedToJsObject+1)};this.startMapToNetSuite=function(){if(_.isString(c.document))c.document=JSON.parse(c.document)};this.beforeMapOneJsObjectToExternal=function(a,b){var c=b.getRecordIdentifiers();if(c&&!(c instanceof Celigo.integrator.mapping.model.JsonPathRecordIdentifier))throw $$.createError("INVALID_MAPPING",
"recordIdentifiers must be an instance of JsonPathRecordIdentifier Class");this.currentRecordIdentifiers=c};this.isJSONPathStr=function(a){return a&&a[0]==="$"};this.applyOutboundMapping=function(a,b,c){var e=b.getJsField();this.isJSONPathStr(e)?(e=jsonPath(c,e),e=!e||!e.length?null:e[0],e=this.getExportFieldValue(c,b,e)):e=this.getExportFieldValue(c,b);b=b.getExternalField();a[b]=e};this.attachOutput=function(a,b,c){var e=b.split(".");if(e.length<2&&e[0]!=="$")throw Error('invalid attach path "'+
b+'"');if(e.length===1&&e[0]==="$")_.extend(a,c);else for(e.shift();e.length;){var f=e.shift(),f=f.trim(),g=f.search(/\[\d*\]$/),h=f.length,q=e.length===0,b=!~g?f:f.substring(0,g);if(~g)if(h-1===g+1){if(a[b]===void 0||a[b]===null)a[b]=[];else if(a[b]&&!_.isArray(a[b]))throw Error('cannot attach to non-array object with path "'+f+'"');q?a[b].push(c):(f={},a[b].push(f),a=f)}else{g=+f.substring(g+1,h-1);if(isNaN(g))throw Error('invalid JSON path to write "'+f+'"');if(a[b]===void 0||a[b]===null)a[b]=
[];else if(a[b]&&!_.isArray(a[b]))throw Error('cannot attach to non-array object with path "'+f+'"');q?a[b][g]=c:_.isUndefined(a[b][g])?(f={},a=a[b][g]=f):a=a[b][g]}else q?a[b]=c:(_.isUndefined(a[b])&&(a[b]={}),a=a[b])}};this.mapJsToExternalWithFieldMappingSet=function(a,c,e){if(e||e===!1){e=a;if(!_.isArray(a))e=[a],this.singleOutput=!0;for(var f=0;e&&e.length&&f<e.length;f++){var g,h;this.currentRecordIdentifiers?(g=this.currentRecordIdentifiers.getJsonPath(),h=(jsonPath(e[f],g)||[])[0],b.debug("record id path",
g)):h=a;if(_.isEmpty(h))b.audit("empty data object, nothing to map");else{this.currentDoc=this.currentDoc||{};g=c.getReadPath()?jsonPath(h,c.getReadPath())||[]:_.isArray(h)?h:[h];for(h=0;h<g.length;h++){for(var o={},q=c.getFieldMappings(),r=0;q&&q.length&&r<q.length;r++)q[r].isInactive()||this.applyOutboundMapping(o,q[r],g[h]);_.isEmpty(o)||(q=c.getWritePath())&&this.attachOutput(this.currentDoc,q,o)}}}}};this.afterMapOneJsObjectToExternal=function(){if(this.singleOutput)this.document=this.currentDoc;
else{if(!this.document)this.document=[];this.document.push(this.currentDoc)}this.currentDoc=void 0};this.preProcessMapToExternalMapping=function(a){if(a instanceof Celigo.integrator.mapping.model.OutboundJSONDocumentMapping)this.outputPath=a.getOutputPath();return a};this.getMapToExternalResultDocument=function(){var a=this.document;this.outputPath&&(a=jsonPath(a,this.outputPath),_.isArray(a)&&a.length===1&&(a=a[0]));return new Celigo.integrator.model.JSONDocument({content:a})};this.mapToErrorFileImpl=
function(a,b){var e=c.mappingData.getRecordMappings(),e=e&&e.length?e[0]:null;if(!e)return $$.logExecution("debug","record mapping could not be located"),"";if(_.isString(this.document))this.document=JSON.parse(this.document);var e=this.splitDocumentIntoPartsEachMapsToOneObject(e),f=this.descend(this.document,this.objectPath);if(!e||!e.length)return $$.logExecution("debug","no document parts found"),"";for(var g={},h=0;a&&h<a.length;h++){var o=a[h].index,q=a[h].code,r=a[h].message;if(!_.isNumber(o)||
o<0||o>e.length-1||!q&&!r)$$.logExecution("debug","invalid error literal is discarded, actual document length(without headers):"+e.length+" )",a[h]);else{var p=e[o];g[String(o)]=1;if(!p.CeligoErrors)p.CeligoErrors=[];p.CeligoErrors.push({code:q,message:r})}}if(b&&f&&_.isArray(f)){var w=[];for(_.each(e,function(a,b){g[String(b)]&&w.push(a)});f.length>0;)f.pop();for(;w.length>0;)f.push(w.shift())}e=JSON.stringify(this.document);this.document=null;return e}};Celigo.integrator.mapper.json.JsonMapper.className=
"Celigo.integrator.mapper.json.JsonMapper";Celigo.integrator.mapper.json.JsonMapper.extend(Celigo.integrator.mapper.AbstractMapper);Celigo.integrator.mapper.json.JsonMapper.prototype.descend=function(a,b){if(!a||_.isEmpty(a)||!b||b[0]==="$")return a;for(var c=b[0].match(/\[(.+?)\]/g),e=a,f=c.shift();f;)f=f.replace(/[\'|\]|\[]/g,""),e=e[f],f=c.shift();return e};$.namespace("Celigo.integrator.mapper.xml");Celigo.integrator.mapper.xml.XmlMapper=function(a){a||(a={celigo_classname:"Celigo.integrator.mapper.xml.XmlMapper"});
if(!a.objectsCountToProcessBeforeYield)a.objectsCountToProcessBeforeYield=1E6;Celigo.integrator.mapper.xml.XmlMapper.superclass.constructor.call(this,a);a.errorFileNetSuiteContentType=a.errorFileNetSuiteContentType||"XMLDOC";a.errorFileExtension=a.errorFileExtension||"xml";this.getClassName=function(){return"Celigo.integrator.mapper.xml.XmlMapper"};var b=this,c=new Date(2014,11,5),e=void 0,f=void 0,g=void 0,h=void 0,j=void 0,i=void 0,k=void 0,l=["Text","Attr","Element"],m=!1,n=function(){e={};f={};
g=0;h={};k=i=j=null},o=function(){e.xml="http://www.w3.org/XML/1998/namespace";e.xmlns="http://www.w3.org/2000/xmlns/";g=2},q=function(a){a&&_.extend(e,a)},r=function(a){return a.getOwnerDocument()||a},p=function(){return b.mappingData.getUseUnnamedNamespace()===!1||_.keys(e).length>1+g},w=function(a){logUntil("XMLMapper - splitNameSpaceAndNodeTag - input",a,c);var b=null,f=null;a.indexOf(":")>0?(f=a.substring(0,a.indexOf(":")),a=a.substring(a.indexOf(":")+1)):f="CELIGO_EMPTY_XML_NAMESPACE_TOKEN";
b=e[f];if(!b&&f!=="CELIGO_EMPTY_XML_NAMESPACE_TOKEN")throw $$.createError("CELIGO_INVALID_CONFIG","Missing required namespace URI for namespace alias "+f);f==="CELIGO_EMPTY_XML_NAMESPACE_TOKEN"&&(f="");a={namespaceAlias:f,namespaceURI:b,tagName:a,qualifiedTagName:f&&(f==="xml"||f==="xmlns"||p())?f+":"+a:a};logUntil("XMLMapper - splitNameSpaceAndNodeTag - output",a,c);return a},u=function(a,b){var c=w(a);return c.namespaceURI?(c="local-name()='"+c.tagName+"' and namespace-uri()='"+c.namespaceURI+"'",
b&&(c="@*["+c+"]"),c):b?"@"+c.tagName:"name()='"+c.tagName+"'"},s=function(a){var a=a.split("/"),b=[],c=[];_.each(a,function(a){var e=a.match(/\'/g);!e||e.length%2===0?c.length===0?b.push(a):c.push(a):c.length>0?(c.push(a),b.push(c.join("/")),c=[]):c.push(a)});return b},v=function(a){try{logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - input",a,c);if(!a)throw $$.createError("ERROR","xPath can't be empty");if(!h[a]){for(var b=s(a),e=0;b&&e<b.length;e++)if(b[e]!=="text()"&&b[e].indexOf("*")!==
0&&b[e].indexOf(".")!==0&&b[e]!==""){var f=!1;b[e].indexOf("@")===0&&(f=!0,b[e]=b[e].substring(1));logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - tokens "+e+" before",b[e],c);var g=null,g=b[e].indexOf("[")>0?b[e].substring(0,b[e].indexOf("[")):b[e];logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - elementTag",g,c);var i=null,i=g.indexOf("nlapi:")===0?(f?"@":"")+g+"[":(f?"@":"")+"*["+u(g),f="";if(b[e].indexOf("[")>0)if(conditionString=b[e].substring(b[e].indexOf("[")+1,b[e].length-
1),logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - conditionString",conditionString,c),isNaN(conditionString)){Celigo.util.StringUtil.endsWith(i,"[")||(i+=" and ");var j=t(conditionString);logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - conditions",function(){return JSON.stringify(j)},c);for(var k=[],g=0;g<j.length;g++){var q=j[g].valueIsString?"'"+j[g].value+"'":""+j[g].value;j[g].isAttribute?k.push(u(j[g].name,!0)+"="+q):k.push(j[g].name+"="+q)}logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - conditionPredicates",
function(){return JSON.stringify(k)},c);i+=k.join(" and ")}else f="["+conditionString+"]";b[e]=i+"]"+f;b[e]=Celigo.util.StringUtil.removeSuffix(b[e],"[]");logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - tokens "+e+" after",b[e],c)}h[a]=b.join("/")}logUntil("XMLMapper - convertToNetSuiteCompatibleXPath - output",h[a],c);return h[a]}catch(l){throw $$.createError("CELIGO_XML_MAPPER_ERROR","Failed to convert xPath "+a+" to NetSuite-compatible xPath. Error: "+CeligoError.format(l));}},t=function(a){if(!a||
a.indexOf("=")<0)return[];logUntil("XMLMapper - parseXPathConditionString - input",a,c);var b=a.charAt(0)==="@",e=b?1:0,f=a.indexOf("="),g=a.charAt(f+1)==="'",i=f+(g?2:1),h=a.indexOf(g?"'":" ",i);if(h<0)h=a.length;if(!(e<f&&f<i&&i<h))throw $$.createError("CELIGO_CORE_ERROR","XMLMapper - parseXPathConditionString - !(conditionNameStart < conditionNameEnd && conditionNameEnd < conditionValueStart && conditionValueStart < conditionValueEnd) - input: "+a);e=a.substring(e,f);i=a.substring(i,h);h=$.trim(a.substring(h+
1));h=Celigo.util.StringUtil.removePrefix(h,"and");h=$.trim(h);if(e==="")throw $$.createError("CELIGO_CORE_ERROR","XMLMapper - parseXPathConditionString - conditionName is empty - input: "+a);var j={name:e,value:i,isAttribute:b,valueIsString:g};logUntil("XMLMapper - parseXPathConditionString - output",function(){return JSON.stringify(j)},c);return[j].concat(t(h))},y=function(a){if(a){var b={};_.each(e,function(a,c){b[a]=c});_.each(a,function(a,c){if(!b[a]){var f=c;if(e[c])for(var g=0;g<26;g++){var i=
"abcdefghijklmnopqrstuvwxyz".charAt(g);if(!e[c+i]){f=c+i;break}}e[f]=a}})}},x=function(a){return a==="text()"?"TEXT":a.indexOf("@")===0?"ATTRIBUTE":"ELEMENT"},B=function(a,e,f,g,i){logUntil(b.getClassName()+" - createNodeRecursively - xPath",e,c);var h=null;e==="."?h=a:f||(h=v(e),i?(i[h]||(i[h]=$$.selectNode(a,h)),h=i[h]):h=$$.selectNode(a,h));if(!h){var e=s(e),h=e.pop(),e=e.join("/"),j=x(h),k=!1;if(j==="TEXT"||j==="ATTRIBUTE")k=!0;h=B(a,e,f&&k,h,i)}if(g){a=null;if(x(g)==="TEXT")a=r(h).createTextNode("");
else if(x(g)==="ATTRIBUTE")a=g.substring(1),f=w(a),a=f.namespaceURI?r(h).createAttributeNS(f.namespaceURI,f.qualifiedTagName):r(h).createAttribute(f.qualifiedTagName);else if(x(g)==="ELEMENT"&&(i=g.indexOf("[")>0,h.getOwnerDocument()?(a=i?g.substring(0,g.indexOf("[")):g,f=w(a),a=f.namespaceURI?r(h).createElementNS(f.namespaceURI,f.qualifiedTagName):r(h).createElement(f.qualifiedTagName)):a=h.getDocumentElement(),i)){g=g.substring(g.indexOf("[")+1,g.lastIndexOf("]"));g=t(g);for(i=0;i<g.length;i++)g[i].isAttribute&&
(f=w(g[i].name),f.namespaceURI?a.setAttributeNS(f.namespaceURI,f.qualifiedTagName,g[i].value):a.setAttribute(f.qualifiedTagName,g[i].value))}a.getNodeType()===Celigo.enums.JavaNodeConstants.get("ATTRIBUTE_NODE")?h.setAttributeNode(a):!h.getOwnerDocument()||h.appendChild(a);h=a}return h},A=function(a){if(!a.___xmlmapper___processed){var b=a.getExternalField();if(b){var c=s(b).pop();b.charAt(0)==="/"&&(b="."+b);c!=="text()"&&c.charAt(0)!=="@"&&(b+="/text()");a.setExternalField(b);a.___xmlmapper___processed=
!0}}},z=function(a){if(!a.___xmlmapper___processed){var b=a.getExternalField();if(b){b.charAt(0)==="/"&&(b="."+b);var c=s(b);c.pop()==="text()"&&(b=c.join("/"));a.setExternalField(b);a.___xmlmapper___processed=!0}}},E=function(a,b){var c=b.getRecordIdentifiers();if(c instanceof Celigo.integrator.mapping.model.XPathRecordIdentifier)return $$.selectNodes(a,v(c.getXPath()));else throw $$.createError("INVALID_MAPPING","Type of recordIdentifiers is not supported.");},C=function(a,e){var f,g=null,i=null,
h={nlobjRecordType:e.getRecordType(),nlobjFieldIds:{},nlobjSublistIds:{}},j=[],k=e.getChildren();for(f=0;k&&f<k.length;f++){var q=k[f],l=null;q instanceof Celigo.integrator.mapping.model.FieldMappingSet?(i=g=null,l=q.getFieldMappings()):q instanceof Celigo.integrator.mapping.model.CollectionMapping&&(g=q.getCollectionIds()[0],i=q.getXPath?q.getXPath():null,l=q.getChildren()[0].getFieldMappings());j=j.concat(_.map(l,function(a){return{sublistId:g,sublistXPath:i,fieldMapping:a}}))}logUntil("XmlMapper - mapOneDocumentPartToJsObjectRecursively - allFieldMappingsAndSublistId",
j,c);k={};for(f=0;f<j.length;f++)if(g=j[f].sublistId,i=j[f].sublistXPath,fieldMapping=j[f].fieldMapping,logUntil("XmlMapper - mapOneDocumentPartToJsObjectRecursively - fieldMapping "+f,fieldMapping,c),!fieldMapping.isInactive()){z(fieldMapping);var m=fieldMapping.getJsField(),q=fieldMapping.getExternalField(),p=fieldMapping.getSubRecordMapping(),l=null;if(_.isUndefined(fieldMapping.getHardCodedValue())){if(p)q=E(a,p),l=_.map(q,function(a){return C(a,p)});else{if(g)if(i)if((l=$$.selectNodes(a,i))&&
l.length>0)var r="."+q.substr(q.indexOf(i)+i.length),l=_.map(l,function(a){return $$.selectValue(a,r)||void 0});else l=[];else l=$$.selectValues(a,q)||[];else l=$$.selectValues(a,q)||[];l=_.map(l,function(a){return b.getImportFieldValue(a,fieldMapping)})}g?(h.nlobjSublistIds[g]||(h.nlobjSublistIds[g]={lines:[]}),_.each(l,function(a,b){h.nlobjSublistIds[g].lines.length===b&&h.nlobjSublistIds[g].lines.push({});h.nlobjSublistIds[g].lines[b][m]=a})):h.nlobjFieldIds[m]=l[0]}else q=b.getImportFieldValue(fieldMapping.getHardCodedValue(),
fieldMapping),g?(k[g]||(k[g]={}),k[g][m]=q):h.nlobjFieldIds[m]=q}for(g in k)for(f=0;h.nlobjSublistIds[g]&&h.nlobjSublistIds[g].lines&&f<h.nlobjSublistIds[g].lines.length;f++)_.defaults(h.nlobjSublistIds[g].lines[f],k[g]);return h};this.beforeBeginMapJsToExternal=function(){n();a.keepXmlWrapperNodes||_.each(l,function(a){f[a]=Celigo.lang.xml[a].registry.length});xmlNodeCollection=b.jsObjects.makeEmptyCopy();o();var g=b.mappingData.getNamespaces();y(g);logUntil("XMLMapper - beforeBeginMapJsToExternal - namespaceURILookup",
function(){return JSON.stringify(e)},c);g=b.mappingData.getDocumentElementQualifiedName();if(!g)throw $$.createError("INVALID_MAPPING_DATA","Celigo.integrator.mapping.model.XmlFileMapping : required - documentElementQualifiedName");g=w(g).qualifiedTagName;logUntil("XMLMapper - mapJSObjectsToXMLDocUsingMappingsOnce - documentTopNodeName",g,c);var i='<?xml version="1.0" encoding="UTF-8"?><'+g,h;for(h in e)if(!(h==="xml"||h==="xmlns")){var j=e[h];i+=h!=="CELIGO_EMPTY_XML_NAMESPACE_TOKEN"&&p()?" xmlns:"+
h+'="'+j+'"':' xmlns="'+j+'"'}i+="></"+g+">";logUntil("XMLMapper - mapJSObjectsToXMLDocUsingMappingsOnce - xmlStr",function(){return $$.escapeXML(i)},c);b.document=$$.stringToXML(i)};this.beforeFinishMapJsToExternal=function(){n();a.keepXmlWrapperNodes||_.each(l,function(a){Celigo.lang.xml[a].registry=Celigo.lang.xml[a].registry.slice(0,f[a])})};this.beforeMapJsToExternalOneRecordMapping=function(a){var D;a=a.getRecordIdentifiers();q(a.getNamespaces());a=a.getXPath();a=s(a);j=a.pop();D=(a=a.join("/"))?
"./"+a:".",a=D;logUntil("XMLMapper - mapJSObjectsToXMLDocUsingMappingsOnce - topLevelNodeXPath",a,c);i=B(b.document,a)};this.beforeMapOneJsObjectToExternal=function(){logUntil("XMLMapper - beforeMapOneJsObjectToExternal - objectNodeTagName",j,c);k=[];if(m&&i instanceof Celigo.lang.xml.Node)log("XMLMapper - beforeMapOneJsObjectToExternal - processingUnitCount",b.getProcessingUnitCount()),m=!1,i.doNotDestroy=!0,_.each(l,function(a){for(var b=f[a];b<Celigo.lang.xml[a].registry.length;b++)Celigo.lang.xml[a].registry[b].doNotDestroy||
Celigo.lang.xml[a].registry[b].destroy();Celigo.lang.xml[a].registry=Celigo.lang.xml[a].registry.slice(0,f[a])}),Celigo.lang.xml.Element.registry.push(i),$$.logExecution("audit","XmlMapper - yield","set numberFieldMappingsExecutedBeforeYield ("+a.numberFieldMappingsExecutedBeforeYield+") to your desired value"),Celigo.BatchProcess.yield();return{parentNode:i,objectNodeTagName:j,xPath:null}};this.beforeMapOneJsToExternalWithOneMappingNodeRecursively=function(a,b,c){return{parentNode:c.roots&&c.roots.length>
0?c.roots[0]:F(c),objectNodeTagName:null,xPath:b.getXPath()}};var F=function(a){if(a.objectNodeTagName){var c=w(a.objectNodeTagName),c=c.namespaceURI?b.document.createElementNS(c.namespaceURI,c.qualifiedTagName):b.document.createElement(c.qualifiedTagName);a.parentNode.appendChild(c);k.push(c);return c}else return a.objectNodeTagName===""?a.parentNode:(c=B(a.parentNode,a.xPath,!0,null),k.push(c),c)};this.onErrorWhenMapOneJsObjectToExternal=function(){_.each(k,function(a){a&&i.removeChild(a)})};this.mapJsToExternalWithFieldMappingSet=
function(a,e,f,g){g||(g={roots:[b.document.getDocumentElement()]});a=f?_.isArray(a)?a:[a]:a.slice(0,1);for(f=0;f<a.length;f++){var i=a[f];if(!g.roots)g.roots=[];g.roots[f]||(g.roots[f]=F(g));var h=e.getFieldMappings();logUntil("XmlMapper - mapJsToExternalWithFieldMappingSet - fieldMappings",function(){return Celigo.JSON.stringify(h)},c);for(var j=0;h&&j<h.length;j++){b.incrementProcessingUnit(function(){m=!0});var k=h[j];A(k);q(k.getNamespaces());var l=k.getExternalField();logUntil("XmlMapper - mapJsToExternalWithFieldMappingSet - fieldMapping "+
j,k,c);var p=b.getExportFieldValue(i,k),r=_.isArray(p);_.isArray(p)||(p=[p]);logUntil("XmlMapper - mapJsToExternalWithFieldMappingSet - values",p,c);for(var n=0;p&&n<p.length;n++){var o=p[n];if((o||o===0||o==="")&&!(o===""&&b.mappingData.getCreateNodeForEmptyField()===!1&&!k.isMandatory())){var t=B(g.roots[f],l,r,null);t.getNodeType()===Celigo.enums.JavaNodeConstants.get("ATTRIBUTE_NODE")?t.setValue(o):t.setNodeValue(o)}}}}};this.splitDocumentIntoPartsEachMapsToOneObject=function(a){return E(b.document,
a)};this.mapOneDocumentPartToJsObject=function(a,c){_.isUndefined(b.indexOfCurrentDocumentPartBeingMappedToJsObject)?b.indexOfCurrentDocumentPartBeingMappedToJsObject=0:b.indexOfCurrentDocumentPartBeingMappedToJsObject+=1;return C(a,c)};this.generatePrintableDocumentIndex=function(){return"TODO"};this.startMapToNetSuite=function(){n();if(_.isString(b.document))b.document=$$.stringToXML(b.document)};this.endMapToNetSuite=function(){n()};this.getMapToExternalResultDocument=function(){return new Celigo.integrator.model.XmlDocument({content:b.document})};
this.testMethodDoNotUse_convertToNetSuiteCompatibleXPath=function(a){n();o();currentNamespaceAliasLookup={};return v(a)};this.mapToErrorFileImpl=function(a,c){var e=b.mappingData.getRecordMappings();if(!e||e.length===0)return $$.logExecution("debug","record mapping could not be located"),"";if(_.isString(this.document))$$.logExecution("debug","convert file content to xml"),this.document=$$.stringToXML(this.document),$$.logExecution("debug","done convert file content to xml");for(var f=[],g=0;g<e.length;g++){var i=
this.splitDocumentIntoPartsEachMapsToOneObject(e[g]);i&&i.length>0&&(f=f.concat(i))}if(!f.length)return $$.logExecution("debug","no document parts found"),"";for(var h={},g=0;a&&g<a.length;g++){var j=a[g].index,k=a[g].code,e=a[g].message;if(!_.isNumber(j)||j<0||j>f.length-1||!k&&!e)$$.logExecution("debug","invalid error literal is discarded, actual document length(without headers):"+f.length+" )",a[g]);else{i=f[j];h[String(j)]=1;var j=B(i,"./celigoErrors/error",!0),q=r(i).createElement("code");j.appendChild(q);
var l=r(i).createTextNode("");q.appendChild(l);l.setNodeValue(k);k=r(i).createElement("message");j.appendChild(k);l=r(i).createTextNode("");k.appendChild(l);l.setNodeValue(e)}}c&&_.each(f,function(a,b){try{h[String(b)]||a.getParentNode().removeChild(a)}catch(c){$$.logExecution("error","error removing successful nodes",Celigo.Error.format(c))}});f=$$.xmlToString(this.document);this.document=null;return f}};Celigo.integrator.mapper.xml.XmlMapper.className="Celigo.integrator.mapper.xml.XmlMapper";Celigo.integrator.mapper.xml.XmlMapper.extend(Celigo.integrator.mapper.AbstractMapper);
$.namespace("Celigo.integrator.model");Celigo.integrator.model.ChangeSet=function(a){this.keys=function(){return a&&a.keys||[]};this.enter=function(){return a&&a.enter||[]};this.update=function(){return a&&a.update||[]};this.exit=function(){return a&&a.exit||[]}};Celigo.integrator.model.ChangeSet(Celigo.io.PrivateStateful);Celigo.integrator.model.ChangeSet.className="Celigo.integrator.model.ChangeSet";Celigo.integrator.model.ChangeSet.make=function(a,b,c){var e=$.getExecutionLogger("Celigo.integrator.model.ChangeSet - make");
(function(a,b,c){if(!_.isArray(a)||!a.length||!_.isArray(b))throw e.error("keys requires non-empty array, entering requires array"),Error("invalid input");if(!_.isArray(c)&&!_.isFunction(c))throw e.error("existing requires either array of function that returns array"),Error("invalid existing array or getter");})(a,b,c);(function(a,b){_.each(b,function(c){var f={};_.each(a,function(a){f[String(a)]=c[String(a)]});var k=_.where(b,f);if(k.length){if(k.length>1)throw Error("data set non-unique by keys "+
a);}else e.debug("should never happen...")})})(a,b);if(_.isFunction(c))try{if(c=c(),!_.isArray(c))throw Error("expecting an array");}catch(f){throw Error("fail to call existing data getter",f.name+" - "+f.message);}return function(a,b,c){var f=[],k=[],l=[],m={},n=function(a,b,c){var e=[];if(!a)return e;_.each(a,function(a,f,g){b.call(c,a,f,g)&&e.push({value:a,index:f})});return e},o=function(a,b){return _.isEmpty(b)?[]:n(a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},b=b.slice();
_.each(c,function(c){var f={};_.each(a,function(a){f[String(a)]=String(c[String(a)])});var i=o(b,f);i.length>1?e.debug("should never happen...."):i.length?(k.push(_.extend(c,i[0].value)),b[i[0].index]=m):l.push(c)});_.each(b,function(a){a!==m&&f.push(a)});return new Celigo.integrator.model.ChangeSet({keys:a,enter:f,update:k,exit:l})}(a,b,c)};$.namespace("Celigo.integrator.model");Celigo.integrator.model.DataFlowReference=function(a){this._super(a);this.setDataFlowId=function(b){a.dataFlowId=b};this.getDataFlowId=
function(){return a.dataFlowId};this.setDataFlowInternalId=function(b){a.dataFlowInternalId=b};this.getDataFlowInternalId=function(){return a.dataFlowInternalId};this.setScheduleNewRunnerDeployment=function(b){a.scheduleNewRunnerDeployment=!!b};this.isScheduleNewRunnerDeployment=function(){return!!a.scheduleNewRunnerDeployment}};Celigo.integrator.model.DataFlowReference.extend(Celigo.io.PrivateStateful);Celigo.integrator.model.DataFlowReference.className="Celigo.integrator.model.DataFlowReference";
$.namespace("Celigo.integrator.model");Celigo.integrator.model.SavedSearchConfig=function(a){Celigo.integrator.model.SavedSearchConfig.superclass.constructor.call(this,a);this.getRecordType=function(){return a.recordType};this.setRecordType=function(b){a.recordType=b};this.getSearchId=function(){return a.searchId};this.setSearchId=function(b){a.searchId=b};this.getCheckBoxField=function(){return a.checkBoxField};this.setCheckBoxField=function(b){a.checkBoxField=b};this.getDateField=function(){return a.dateField};
this.setDateField=function(b){a.dateField=b};this.getIgnoreFilter=function(){return a.ignoreFilter};this.setIgnoreFilter=function(b){a.ignoreFilter=b};this.getRespectSorting=function(){return a.respectSorting};this.setRespectSorting=function(b){a.respectSorting=b};this.getAdditionalFilters=function(){if(!_.isArray(a.additionalFilters))a.additionalFilters=[];return a.additionalFilters};this.setAdditionalFilters=function(b){a.additionalFilters=b};this.getAdditionalColumns=function(){if(!_.isArray(a.additionalColumns))a.additionalColumns=
[];return a.additionalColumns};this.setAdditionalColumns=function(b){a.additionalColumns=b}};Celigo.integrator.model.SavedSearchConfig.extend(Celigo.io.PrivateStateful);Celigo.integrator.model.SavedSearchConfig.className="Celigo.integrator.model.SavedSearchConfig";$.namespace("Celigo.integrator.model");Celigo.integrator.model.Document=function(a){Celigo.integrator.model.Document.superclass.constructor.call(this,a);this.getContent=function(){return a.content};this.setContent=function(b){a.content=
b};this.toString=function(){return a.content}};Celigo.integrator.model.Document.extend(Celigo.io.PrivateStateful);Celigo.integrator.model.Document.className="Celigo.integrator.model.Document";$.namespace("Celigo.integrator.model");Celigo.integrator.model.XmlDocument=function(a){Celigo.integrator.model.XmlDocument.superclass.constructor.call(this,a);this.getContent=function(){if(_.isString(a.content))a.content=$$.stringToXML(a.content);return a.content};this.toString=function(){return _.isString(a.content)?
a.content:$$.xmlToString(a.content)}};Celigo.integrator.model.XmlDocument.extend(Celigo.integrator.model.Document);Celigo.integrator.model.XmlDocument.className="Celigo.integrator.model.XmlDocument";$.namespace("Celigo.integrator.model");Celigo.integrator.model.PreparedStatementDocument=function(a){Celigo.integrator.model.PreparedStatementDocument.superclass.constructor.call(this,a);this.toString=function(){return this.getContent().getStatement()}};Celigo.integrator.model.PreparedStatementDocument.extend(Celigo.integrator.model.Document);
Celigo.integrator.model.PreparedStatementDocument.className="Celigo.integrator.model.PreparedStatementDocument";$.namespace("Celigo.integrator.model");Celigo.integrator.model.JSONDocument=function(a){this._super(a);this.toString=function(){return JSON.stringify(this.getContent())}};Celigo.integrator.model.JSONDocument.extend(Celigo.integrator.model.Document);Celigo.integrator.model.JSONDocument.className="Celigo.integrator.model.JSONDocument";$.namespace("Celigo.integrator.model");Celigo.integrator.model.HttpDocument=
function(a){Celigo.integrator.model.HttpDocument.superclass.constructor.call(this,a);this.getResponse=function(){return a.response}};Celigo.integrator.model.HttpDocument.extend(Celigo.integrator.model.Document);Celigo.integrator.model.HttpDocument.className="Celigo.integrator.model.HttpDocument";$.namespace("Celigo.integrator.realtime.netsuite");Celigo.integrator.realtime.netsuite.Export=function(a){Celigo.integrator.realtime.netsuite.Export.superclass.constructor.call(this,a);(function(a){if(!a)throw new CeligoError({message:"missing configuration"});
if(!a.implClass)throw new CeligoError({message:"missing implClass"});})(a);this.getClassName=function(){return"Celigo.integrator.realtime.netsuite.Export"};this.executionLogger=$.getExecutionLogger("Celigo.integrator.realtime.netsuite.Export");this.integrationLogger=$L;this.eventType="";this.getIntegration=function(){return a.integration};this.getUseCase=function(){return a.useCase};this.getImplClass=function(){return a.implClass}};Celigo.integrator.realtime.netsuite.Export.extend(Celigo.io.PrivateStateful);
Celigo.integrator.realtime.netsuite.Export.prototype.getExecutionLogger=function(){return this.executionLogger};Celigo.integrator.realtime.netsuite.Export.prototype.setExecutionLogger=function(a){if(!(!a instanceof Celigo.core.logging.ExecutionLogger))this.executionLogger=a};Celigo.integrator.realtime.netsuite.Export.prototype.getIntegrationLogger=function(){return this.integrationLogger};Celigo.integrator.realtime.netsuite.Export.prototype.getConfiguration=function(){return this.configuration};Celigo.integrator.realtime.netsuite.Export.prototype.getEventType=
function(){return this.eventType};Celigo.integrator.realtime.netsuite.Export.prototype.setEventType=function(a){this.eventType=a};Celigo.integrator.realtime.netsuite.Export.prototype.getTarget=function(){throw new CeligoError({name:"Unimplemented Method",message:"getTarget not implemented"});};Celigo.integrator.realtime.netsuite.Export.prototype.shouldExport=function(){return!1};Celigo.integrator.realtime.netsuite.Export.prototype.shouldThrowException=function(){return!0};Celigo.integrator.realtime.netsuite.Export.prototype.doExport=
function(){throw new CeligoError({name:"Unimplemented Method",message:"doExport not implemented"});};Celigo.integrator.realtime.netsuite.Export.prototype.main=function(){if(this.shouldExport())try{this.doExport(this.getTarget())}catch(a){if(a=Celigo.Error.convert(a),this.getExecutionLogger().error(a.name,a.message),this.getIntegrationLogger().error(a,null,this.getIntegration(),$$.getRecordType(),$$.getRecordId()),this.shouldThrowException())throw a;}};$.namespace("Celigo.integrator.realtime.netsuite");
Celigo.integrator.realtime.netsuite.ExportFactory=function(){var a={TYPE:"customrecord_celigo_realtime_export",RECTYPE:"custrecord_celigo_rte_record_types",CONFIGFILE:"custrecord_celigo_rte_config_file"},b=$.getExecutionLogger("Celigo.integrator.realtime.netsuite.ExportFactory");return{loadConfigFromFileDescriptor:function(a){a=$.requireJSON(a);a=Celigo.core.dependencyInjection.StaticConfigurationInjector.getConfigurationObjectFromConfigObjects([a]);return Celigo.core.dependencyInjection.StaticConfigurationInjector.transformConfigurationObject(a,
$$.getContext().getEnvironment())},loadConfigFromRecord:function(c){if(!c)return null;if(!c)throw new CeligoError({name:"Celigo.realtime.ExportConfigurationFactory",message:"error getting record type internal id"});c=$$.searchRecord(a.TYPE,null,new nlobjSearchFilter(a.RECTYPE,null,"is",c.toLowerCase()),new nlobjSearchColumn(a.CONFIGFILE));if(!c||!c.length)return b.audit("no configuration..."),null;for(var e={},f=[],g=0,h=c.length;g<h;g++){var j=c[g].getValue(a.CONFIGFILE);e[j]||(e[j]=1,f.push(this.loadConfigFromFileDescriptor(j)))}return f},
getExportInstanceFromConfig:function(a){a.implFileIds&&_.isArray(a.implFileIds)&&$.requireAll(a.implFileIds);if(!a.implClass)throw new CeligoError({name:"missing implClass",message:"missing implClass"});return new ($.require("@"+a.implClass))(a)},getExportInstanceFromConfigFileDescriptor:function(a){return this.getExportInstanceFromConfig(this.loadConfigFromFileDescriptor(a))}}}();$.namespace("Celigo.integrator.realtime.netsuite");Celigo.integrator.realtime.netsuite.DefaultExport=function(a){Celigo.integrator.realtime.netsuite.DefaultExport.superclass.constructor.call(this,
a);(function(a){if(!a.mappingData)throw new CeligoError({message:"missing mappingData"});if(!a.mapperClass)throw new CeligoError({message:"missing mapperClass"});if(!a.senderClass)throw new CeligoError({message:"missing senderClass"});})(a);this.getClassName=function(){return"Celigo.integrator.realtime.netsuite.DefaultExport"};this.executionLogger=$.getExecutionLogger("Celigo.integrator.realtime.netsuite.DefaultExport");this.getMapperClass=function(){return a.mapperClass};this.getMappingData=function(){return a.mappingData};
this.getExportableRecordSearchId=function(){return a.exportableRecordSearchId};this.getSenderClass=function(){return a.senderClass}};Celigo.integrator.realtime.netsuite.DefaultExport.extend(Celigo.integrator.realtime.netsuite.Export);Celigo.integrator.realtime.netsuite.DefaultExport.prototype.shouldExport=function(){if(!this.getExportableRecordSearchId||!_.isFunction(this.getExportableRecordSearchId))return!1;var a=this.getExportableRecordsSearchId(),b=$$.getRecordType(),c=$$.getRecordId(),e;if(!a)throw new CeligoError({message:"missing exportableRecordsSearchId"});
try{e=$$.searchRecord(b,a,new nlobjSearchFilter("internalid",null,"is",c))}catch(f){throw f=Celigo.Error.convert(f),new CeligoError({message:"exportable search error",cause:f});}if(!e||!e.length)return this.getExecutionLogger().audit("should not Export"),!1;this.getExecutionLogger().audit("should Export");return!0};Celigo.integrator.realtime.netsuite.DefaultExport.prototype.getTarget=function(){var a,b={},c=(new Date).getTime();a=(new $R($$.getNewRecord()||$$.getOldRecord())).toJSON();b[c]={};b[c].celigoIsElement=
!0;b[c].data=[a.nlobjFieldIds];b[c].data[0].recordType=a.nlobjRecordType;b[c].data[0].id=a.id;a=new Celigo.lang.Collection(b);if(!a)throw new CeligoError({name:"empty target",message:"empty target"});return a};Celigo.integrator.realtime.netsuite.DefaultExport.prototype.doExport=function(a){_.isFunction(this.doBeforeExporting)&&this.doBeforeExporting(a);var b;b=this.getMapperClass();b=new ($.require("@"+b));if(!b||typeof b.mapJSToExternal!=="function")throw new CeligoError({name:"invalid mapper",message:"invalid mapper"});
_.isFunction(this.doBeforeMapping)&&this.doBeforeMapping(a);b=b.mapJSToExternal(a,this.getMappingData());if(!b||b.failedToMap&&b.failedToMap.length||!b.fileContents)throw new CeligoError({message:"mapping error"});var c;c=this.getSenderClass();c=new ($.require("@"+c))(this);if(!c||typeof c.send!=="function")throw new CeligoError({message:"invalid sender"});_.isFunction(this.doBeforeSending)&&this.doBeforeSending(b,a);c.send(b,a,this)};if($$.getContext().getScriptId()==="customscript_celigo_realtim_export_act")$.namespace("Celigo.integrator.realtime.netsuite"),
Celigo.integrator.realtime.netsuite.ExportEntryPoint=function(){},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.main=function(a){for(var b=Celigo.integrator.realtime.netsuite.ExportFactory.loadConfigFromRecord($$.getRecordType()),c,e=0;b&&b.length&&e<b.length;e++)c=Celigo.integrator.realtime.netsuite.ExportFactory.getExportInstanceFromConfig(b[e]),c.setEventType(a),c.main()},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.afterSubmit=function(a){this.main(a)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.beforeSubmit=
function(a){this.main(a)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.beforeLoad=function(a){this.main(a)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.workflowAction=function(){this.main(type)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.getThrowableErrorCodes=function(){return"all"};$.namespace("Celigo.integrator.realtime.netsuite");Celigo.integrator.realtime.netsuite.UserEventSender=function(){};Celigo.integrator.realtime.netsuite.UserEventSender.prototype.get=
function(){throw new CeligoError({name:"unimplemented method",message:"get unimplemented"});};Celigo.integrator.realtime.netsuite.UserEventSender.prototype.put=function(){throw new CeligoError({name:"unimplemented method",message:"put unimplemented"});};Celigo.integrator.realtime.netsuite.UserEventSender.prototype.post=function(){throw new CeligoError({name:"unimplemented method",message:"post unimplemented"});};Celigo.integrator.realtime.netsuite.UserEventSender.prototype.del=function(){throw new CeligoError({name:"unimplemented method",
message:"del unimplemented"});};Celigo.integrator.realtime.netsuite.UserEventSender.prototype.send=function(a,b,c){switch(eventType){case "create":this.post(a,b,c);break;case "edit":this.put(a,b,c);break;case "delete":this.del(a,b,c)}};$.namespace("Celigo.integrator.util");Celigo.integrator.util.IntegratorUtil=function(){var a=new Date(2013,3,15),b={flowSchedule:"flowSchedule",savedSearchConfig:"savedSearchConfig"},c={},e={},f=function(b,e){var f=$$.loadFile(b);if(!c[f.getId()]){var g=f.getValue();
Celigo.util.FileUtil.isConfigFileEncrypted(g)?(logUntil("IntegratorUtil - readAndDecryptFile - file is encrypted",b,a),g=Celigo.core.crypto.Encryptor.decrypt(g)):logUntil("IntegratorUtil - readAndDecryptFile - file not encrypted",b,a);if(e)return g;c[f.getId()]=Celigo.JSON.parse(g)}return c[f.getId()]},g=function(a){return Celigo.core.jsObject.ObjectTraverse.transformObject(a,function(a,b,c,e){_.last(b)==="mappingGUID"&&(logUntil("fn","Celigo/Integrator/Configuration/Global/Mappings/"+a+".txt"),_.defaults(e,
g(f("Celigo/Integrator/Configuration/Global/Mappings/"+a+".txt")).mapping));return a})},h=function(a,b){if(b.getSubRecordMapping()&&Object.prototype.toString.apply(b.getSubRecordMapping())==="[object String]"){var c=f("Celigo/Integrator/Configuration/Global/Mappings/"+b.getSubRecordMapping()+".txt",!0),c=Celigo.io.Serializable.revive(c);j(a,c.getRecordMapping(0));b.setSubRecordMapping(c.getRecordMapping(0));if((c=c.getStaticLookupMaps())&&!_.isEmpty(c))for(var e in c)a.setStaticLookupMap(e,c[e])}},
j=function(a,b){_.each(b.getChildren(),function(b){b instanceof Celigo.integrator.mapping.model.CollectionMapping?_.each(b.getChildren(),function(b){b instanceof Celigo.integrator.mapping.model.FieldMappingSet&&_.each(b.getFieldMappings(),function(b){h(a,b)})}):b instanceof Celigo.integrator.mapping.model.FieldMappingSet&&_.each(b.getFieldMappings(),function(b){h(a,b)})})};return{getMappingFileContent:function(a){var a=f("Celigo/Integrator/Configuration/Global/Mappings/"+a+".txt",!0),b=Celigo.io.Serializable.revive(a);
_.isFunction(b.getRecordMappings)&&_.each(b.getRecordMappings(),function(a){j(b,a)});return Celigo.JSON.stringify(b)},privateLoadConfiguration:function(a){var b=null;if(_.isNumber(a)||_.isString(a))b=a;if(!b||!e[b]){for(var c=null,c=b?f(b):a,a=["mappingData"],h=0;h<a.length;h++){var j=a[h];if(_.isString(c[j]))c[j]=f("Celigo/Integrator/Configuration/Global/Mappings/"+c[j]+".txt");else if(_.isArray(c[j]))for(var o=c[j],q=0;o&&q<o.length;q++){var r=o[q].mappingGUID;_.isString(r)&&(r=f("Celigo/Integrator/Configuration/Global/Mappings/"+
r+".txt"),o[q]=Celigo.core.dependencyInjection.StaticConfigurationInjector.getConfigurationObjectFromConfigObjects([r,o[q]]),delete o[q].mappingGUID)}else if(_.isObject(c[j])){o=c[j];q=0;for(r=_.keys(o);r&&q<r.length;q++)r[q].indexOf("mappings")===0&&_.isString(o[r[q]])&&(o[r[q]]=f("Celigo/Integrator/Configuration/Global/Mappings/"+o[r[q]]+".txt"))}c[j]&&(c[j]=g(c[j]))}a=c.productName;h={};if(a)try{h=f("Celigo/Integrator/Configuration/Global/"+a+"_Config.txt")}catch(p){h={}}c=Celigo.core.dependencyInjection.StaticConfigurationInjector.getConfigurationObjectFromConfigObjects([{scriptParams:["custscript_celigo_integrator_flowstate_1",
"custscript_celigo_integrator_flowstate_2","custscript_celigo_integrator_flowstate_3","custscript_celigo_integrator_flowstate_4","custscript_celigo_integrator_flowstate_5","custscript_celigo_integrator_flowstate_6","custscript_celigo_integrator_flowstate_7","custscript_celigo_integrator_flowstate_8","custscript_celigo_integrator_flowstate_9"],managerScriptId:"customscript_celigo_integrator_manager",managerDeploymentId:"customdeploy_celigo_integrator_manage_su",managerScriptParam:"custscript_celigo_integrator_manager_sta",
folderPathToFlowConfigs:"Celigo/Integrator/Configuration/Flows",flowConfigParameterId:"custscript_celigo_integrator_flow_config"},h,c]);c=Celigo.core.dependencyInjection.StaticConfigurationInjector.transformConfigurationObject(c,$$.getContext().getEnvironment());b&&(e[b]=c);return c}return e[b]},privateShouldFlowRunNow:function(a,c){var e=a[b.flowSchedule];if(!e)return log("flowSchedule not provided--do not run as scheduled flow"),!1;log("flowSchedule",e);c||(c=new Date);return(new Celigo.CronMatcher(e)).match(c)?
(log("flowSchedule matched"),!0):(log("flowSchedule not matched"),!1)},privateIsExportFlow:function(a){return!!a[b.savedSearchConfig]}}}();Celigo.integrator.util.IntegratorUtil.logUntilDate=new Date(2012,6,25);Celigo.integrator.util.IntegratorUtil.findConfigurationFolderID=function(){var a=$.search("folder",null,[new nlobjSearchFilter("name",null,"is","Celigo"),new nlobjSearchFilter("parent",null,"anyof","@NONE@")]),b=null;if(a&&a.length>0)b=a[0].getId();else return $$.logExecution("DEBUG","Folder Celigo not found."),
null;if((a=$.search("folder",null,[new nlobjSearchFilter("name",null,"is","Integrator"),new nlobjSearchFilter("parent",null,"is",b)]))&&a.length>0)b=a[0].getId();else return $$.logExecution("DEBUG","Folder Integrator not found"),null;if((a=$.search("folder",null,[new nlobjSearchFilter("name",null,"is","Configuration"),new nlobjSearchFilter("parent",null,"is",b)]))&&a.length>0)b=a[0].getId();else return $$.logExecution("DEBUG","Folder Configuration not found"),null;return b};Celigo.integrator.util.IntegratorUtil.findFlowsFolderID=
function(){var a=Celigo.integrator.util.IntegratorUtil.findConfigurationFolderID();if((rs=$.search("folder",null,[new nlobjSearchFilter("name",null,"is","Flows"),new nlobjSearchFilter("parent",null,"is",a)]))&&rs.length>0)a=rs[0].getId();else return $$.logExecution("DEBUG","Folder Flows not found"),null;return a};Celigo.integrator.util.IntegratorUtil.findDisabledFolderID=function(){var a=Celigo.integrator.util.IntegratorUtil.findFlowsFolderID();if((rs=$.search("folder",null,[new nlobjSearchFilter("name",
null,"is","Disabled"),new nlobjSearchFilter("parent",null,"is",a)]))&&rs.length>0)a=rs[0].getId();else return $$.logExecution("DEBUG","Folder Disabled not found"),null;return a};Celigo.integrator.util.IntegratorUtil.findFlowsBackupFolderID=function(){var a=Celigo.integrator.util.IntegratorUtil.findFlowsFolderID();if((rs=$.search("folder",null,[new nlobjSearchFilter("name",null,"is","Backup"),new nlobjSearchFilter("parent",null,"is",a)]))&&rs.length>0)a=rs[0].getId();else return $$.logExecution("DEBUG",
"Folder Backup not found"),null;return a};Celigo.integrator.util.IntegratorUtil.findGlobalFolderID=function(){var a=Celigo.integrator.util.IntegratorUtil.findConfigurationFolderID();if((rs=$.search("folder",null,[new nlobjSearchFilter("name",null,"is","Global"),new nlobjSearchFilter("parent",null,"is",a)]))&&rs.length>0)a=rs[0].getId();else return $$.logExecution("DEBUG","Folder Global not found"),null;return a};Celigo.integrator.util.IntegratorUtil.getAllEnabledFlowConfigFileIds=function(){var a=
Celigo.integratorUtil.findDisabledFolderID(),b=Celigo.integrator.util.IntegratorUtil.findFlowsBackupFolderID(),c=[],e=[];a&&e.push(a);b&&e.push(b);e.length>0&&(c=$.search({type:"file",filters:new nlobjSearchFilter("folder",null,"anyof",e)})||[],c=_.map(c,function(a){return a.getId()}));logUntil("IntegratorUtil - getAllEnabledFlowConfigFileIds - disabledConfigFileIds",c,Celigo.integrator.util.IntegratorUtil.logUntilDate);a=Celigo.integratorUtil.findFlowsFolderID();a=$.search({type:"file",filters:"folder.null.is."+
a})||[];a=_.map(a,function(a){return a.getId()});logUntil("IntegratorUtil - getAllEnabledFlowConfigFileIds - allConfigFileIds",a,Celigo.integrator.util.IntegratorUtil.logUntilDate);c=_.difference(a,c);logUntil("IntegratorUtil - getAllEnabledFlowConfigFileIds - enabledConfigFileIds",c,Celigo.integrator.util.IntegratorUtil.logUntilDate);return c};Celigo.integrator.util.IntegratorUtil.scheduleWithNextAvailableRunner=function(a){return Celigo.integrator.dataflow.Util.scheduleBatchDataFlowV1(a)};Celigo.integrator.util.IntegratorUtil.loadFlowConfiguration=
function(a){return Celigo.integrator.util.IntegratorUtil.privateLoadConfiguration(a)};Celigo.integrator.util.IntegratorUtil.loadManagerConfiguration=function(a){return Celigo.integrator.util.IntegratorUtil.privateLoadConfiguration({productName:a})};Celigo.integrator.util.IntegratorUtil.isExportFlow=function(a){return!!a.savedSearchConfig};Celigo.integrator.util.IntegratorUtil.shouldFlowRunNow=function(a){return Celigo.integrator.util.IntegratorUtil.privateShouldFlowRunNow(a)};Celigo.integrator.util.IntegratorUtil.isExportFlow=
function(a){return Celigo.integrator.util.IntegratorUtil.privateIsExportFlow(a)};Celigo.integrator.util.IntegratorUtil.isImportFlow=function(a){return!Celigo.integrator.util.IntegratorUtil.isExportFlow(a)};$.namespace("Celigo.core.integrator.util");Celigo.core.integrator.util.IntegratorUtil=Celigo.integrator.util.IntegratorUtil;Celigo.integratorUtil=Celigo.core.integrator.util.IntegratorUtil;$.namespace("Celigo.integrator.util");Celigo.integrator.util.AsynchronousReportFlowLogger=function(){var a=
{REPORT_ID:Celigo.jobExportRecordReportIdFieldName,RECORD_TYPE:"custrecord_celigo_logger_rec_type",IS_REPORT_PROCESSED:"custrecord_celigo_logger_processed_repor"};return{updateLogWithReportInfo:function(b){var c=new $R({nlobjRecordType:Celigo.util.Logger.constants.CELIGO_LOGGER_RECORD_NAME,id:b.loggerId});c.set(a.RECORD_TYPE,b.recordType);c.set(a.REPORT_ID,b.reportId);c.set(a.IS_REPORT_PROCESSED,!1);c.save()},markReportLogProcessed:function(b){b=new $R({nlobjRecordType:Celigo.util.Logger.constants.CELIGO_LOGGER_RECORD_NAME,
id:b});b.set(a.IS_REPORT_PROCESSED,!0);b.save()}}}();if($$.getContext().getScriptId()==="customscript_celigo_lic_audit")$.namespace("Celigo.suitescript.scheduled.licensingServices"),Celigo.suitescript.scheduled.licensingServices.LicensingAudit=function(){},Celigo.suitescript.scheduled.licensingServices.LicensingAudit.prototype={scheduled:function(){var a=0,b=[],c=[new nlobjSearchFilter("custrecord_celigo_batch_data_flow_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_lic",
null,"is","T"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_sid",null,"is","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_userid",null,"isempty")],e=[new nlobjSearchColumn("custrecord_celigo_batch_data_flow_sid",null,"group"),new nlobjSearchColumn("internalid",null,"count")];(c=$$.searchRecord("customrecord_celigo_batch_data_flow",null,c,e))&&(a=1*a+1*c[0].getValue("internalid",null,"count"));c=[new nlobjSearchFilter("custrecord_celigo_rt_export_system",
null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_export_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_export_sid",null,"is","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_rt_export_userid",null,"isempty")];e=[new nlobjSearchColumn("custrecord_celigo_rt_export_sid",null,"group"),new nlobjSearchColumn("internalid",null,"count")];(c=$$.searchRecord("customrecord_celigo_rt_export_flow",null,c,e))&&(a=1*a+1*c[0].getValue("internalid",null,"count"));
c=[new nlobjSearchFilter("custrecord_celigo_rt_import_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_import_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_import_sid",null,"is","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_rt_import_userid",null,"isempty")];e=[new nlobjSearchColumn("custrecord_celigo_rt_import_sid",null,"group"),new nlobjSearchColumn("internalid",null,"count")];(c=$$.searchRecord("customrecord_celigo_rt_import_flow",
null,c,e))&&(a=1*a+1*c[0].getValue("internalid",null,"count"));c=[new nlobjSearchFilter("custrecord_celigo_batch_data_flow_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_sid",null,"isnot","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_sid",null,"isnotempty",null),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_userid",null,"isempty")];e=[new nlobjSearchColumn("custrecord_celigo_batch_data_flow_sid",null,"group"),
new nlobjSearchColumn("internalid",null,"count")];c=$$.searchRecord("customrecord_celigo_batch_data_flow",null,c,e);for(e=0;c&&e<c.length;e++)b.indexOf(c[e].getValue("custrecord_celigo_batch_data_flow_sid",null,"group"))===-1&&b.push(c[e].getValue("custrecord_celigo_batch_data_flow_sid",null,"group"));c=[new nlobjSearchFilter("custrecord_celigo_rt_export_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_export_sid",null,"isnot","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_rt_export_sid",
null,"isnotempty",null),new nlobjSearchFilter("custrecord_celigo_rt_export_userid",null,"isempty")];e=[new nlobjSearchColumn("custrecord_celigo_rt_export_sid",null,"group"),new nlobjSearchColumn("internalid",null,"count")];c=$$.searchRecord("customrecord_celigo_rt_export_flow",null,c,e);for(e=0;c&&e<c.length;e++)b.indexOf(c[e].getValue("custrecord_celigo_rt_export_sid",null,"group"))===-1&&b.push(c[e].getValue("custrecord_celigo_rt_export_sid",null,"group"));c=[new nlobjSearchFilter("custrecord_celigo_rt_import_system",
null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_import_sid",null,"isnot","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_rt_import_sid",null,"isnotempty",null),new nlobjSearchFilter("custrecord_celigo_rt_import_userid",null,"isempty")];e=[new nlobjSearchColumn("custrecord_celigo_rt_import_sid",null,"group"),new nlobjSearchColumn("internalid",null,"count")];c=$$.searchRecord("customrecord_celigo_rt_import_flow",null,c,e);for(e=0;c&&e<c.length;e++)b.indexOf(c[e].getValue("custrecord_celigo_rt_import_sid",
null,"group"))===-1&&b.push(c[e].getValue("custrecord_celigo_rt_import_sid",null,"group"));for(var f=[],g=[],c=[new nlobjSearchFilter("custrecord_celigo_batch_data_flow_lmbe",null,"isnotempty",null),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_userid",null,"isempty")],e=[(new nlobjSearchColumn("lastmodified")).setSort(!0),new nlobjSearchColumn("custrecord_celigo_batch_data_flow_lmbe"),new nlobjSearchColumn("custrecord_celigo_batch_data_flow_lmbn")],c=$$.searchRecord("customrecord_celigo_batch_data_flow",
null,c,e),e=0;c&&e<c.length;e++)g.indexOf(c[e].getValue("custrecord_celigo_batch_data_flow_lmbe"))===-1&&(g.push(c[e].getValue("custrecord_celigo_batch_data_flow_lmbe")),f.push(c[e].getValue("custrecord_celigo_batch_data_flow_lmbn")));c=[new nlobjSearchFilter("custrecord_celigo_rt_export_lmbe",null,"isnotempty",null),new nlobjSearchFilter("custrecord_celigo_rt_export_userid",null,"isempty")];e=[(new nlobjSearchColumn("lastmodified")).setSort(!0),new nlobjSearchColumn("custrecord_celigo_rt_export_lmbe"),
new nlobjSearchColumn("custrecord_celigo_rt_export_lmbn")];c=$$.searchRecord("customrecord_celigo_rt_export_flow",null,c,e);for(e=0;c&&e<c.length;e++)g.indexOf(c[e].getValue("custrecord_celigo_rt_export_lmbe"))===-1&&(g.push(c[e].getValue("custrecord_celigo_rt_export_lmbe")),f.push(c[e].getValue("custrecord_celigo_rt_export_lmbn")));c=[new nlobjSearchFilter("custrecord_celigo_rt_import_lmbe",null,"isnotempty",null),new nlobjSearchFilter("custrecord_celigo_rt_import_userid",null,"isempty")];e=[(new nlobjSearchColumn("lastmodified")).setSort(!0),
new nlobjSearchColumn("custrecord_celigo_rt_import_lmbe"),new nlobjSearchColumn("custrecord_celigo_rt_import_lmbn")];c=$$.searchRecord("customrecord_celigo_rt_import_flow",null,c,e);for(e=0;c&&e<c.length;e++)g.indexOf(c[e].getValue("custrecord_celigo_rt_import_lmbe"))===-1&&(g.push(c[e].getValue("custrecord_celigo_rt_import_lmbe")),f.push(c[e].getValue("custrecord_celigo_rt_import_lmbn")));e=$$.lookupField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_lad");b={netSuiteAccountId:$$.getContext().getCompany(),
environment:$$.getContext().getEnvironment(),numLicensedFlows:a,connectors:b,users:f,emails:g,lad:e?$$.stringToDate(e,"datetimetz").getTime():0};try{var h=$$.loadConfiguration("companyinformation").getFieldValue("companyname");b.companyName=h}catch(j){$$.logExecution("error","loadConfiguration: companyinformation",j)}log("postData",b);e={"Content-Type":"application/json"};c=$$.lookupField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_iio_token");if(!c)throw Error("missing secure token in record");
if(typeof CeligoSecureHelper==="undefined"||!CeligoSecureHelper||!CeligoSecureHelper.decryptAPIToken)throw Error("missing secure token");var i;try{if(i=CeligoSecureHelper.decryptAPIToken(c),!i)throw Error("empty");}catch(k){throw logger.error("decryption error",k.name+" - "+k.message),Error("invalid API token");}e.Authorization="Bearer "+i;e=$$.requestURL("https://api.integrator.io/netsuite/v1/licenseCheck",JSON.stringify(b),e);log("res.getCode()",e.getCode());log("res.getError()",e.getError());log("res.getBody()",
e.getBody());if(e.getCode()===200&&e.getBody()){i=JSON.parse(e.getBody());if(1*i.numFlowsLicensed<1*a){a=1*a-1*i.numFlowsLicensed;log("numFlowsToUnLicense",a);c=[new nlobjSearchFilter("custrecord_celigo_batch_data_flow_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_sid",null,"is","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_userid",null,"isempty")];
e=[(new nlobjSearchColumn("custrecord_celigo_batch_data_flow_lic_t")).setSort(!0)];c=$$.searchRecord("customrecord_celigo_batch_data_flow",null,c,e);for(e=0;c&&e<c.length&&a>0;e++)$$.submitField("customrecord_celigo_batch_data_flow",c[e].getId(),"custrecord_celigo_batch_data_flow_lic","F"),a--;if(a>0){c=[new nlobjSearchFilter("custrecord_celigo_rt_export_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_export_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_export_sid",
null,"is","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_rt_export_userid",null,"isempty")];e=[(new nlobjSearchColumn("custrecord_celigo_rt_export_lic_t")).setSort(!0)];c=$$.searchRecord("customrecord_celigo_rt_export_flow",null,c,e);for(e=0;c&&e<c.length&&a>0;e++)$$.submitField("customrecord_celigo_rt_export_flow",c[e].getId(),"custrecord_celigo_rt_export_lic","F"),a--}if(a>0){c=[new nlobjSearchFilter("custrecord_celigo_rt_import_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_import_lic",
null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_import_sid",null,"is","Integrator (Custom Integration)"),new nlobjSearchFilter("custrecord_celigo_rt_import_userid",null,"isempty")];e=[(new nlobjSearchColumn("custrecord_celigo_rt_import_lic_t")).setSort(!0)];c=$$.searchRecord("customrecord_celigo_rt_import_flow",null,c,e);for(e=0;c&&e<c.length&&a>0;e++)$$.submitField("customrecord_celigo_rt_import_flow",c[e].getId(),"custrecord_celigo_rt_import_lic","F"),a--}$$.submitField("customrecord_celigo_global_cache",
1,"custrecord_celigo_gc_afl",0)}else 1*i.numFlowsLicensed>=1*a&&$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_afl",1*i.numFlowsLicensed-1*a);if(i.connectorLicenses.length===b.connectors.length)for(e=0;e<i.connectorLicenses.length;e++)if(i.connectorLicenses[e]===!1){c=[new nlobjSearchFilter("custrecord_celigo_batch_data_flow_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_sid",
null,"is",b.connectors[e]),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_userid",null,"isempty")];c=$$.searchRecord("customrecord_celigo_batch_data_flow",null,c,null);for(a=0;c&&a<c.length;a++)$$.submitField("customrecord_celigo_batch_data_flow",c[a].getId(),"custrecord_celigo_batch_data_flow_lic","F");c=[new nlobjSearchFilter("custrecord_celigo_rt_export_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_export_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_export_sid",
null,"is",b.connectors[e]),new nlobjSearchFilter("custrecord_celigo_rt_export_userid",null,"isempty")];c=$$.searchRecord("customrecord_celigo_rt_export_flow",null,c,null);for(a=0;c&&a<c.length;a++)$$.submitField("customrecord_celigo_rt_export_flow",c[a].getId(),"custrecord_celigo_rt_export_lic","F");c=[new nlobjSearchFilter("custrecord_celigo_rt_import_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_import_lic",null,"is","T"),new nlobjSearchFilter("custrecord_celigo_rt_import_sid",
null,"is",b.connectors[e]),new nlobjSearchFilter("custrecord_celigo_rt_import_userid",null,"isempty")];c=$$.searchRecord("customrecord_celigo_rt_import_flow",null,c,null);for(a=0;c&&a<c.length;a++)$$.submitField("customrecord_celigo_rt_import_flow",c[a].getId(),"custrecord_celigo_rt_import_lic","F")}else if(i.connectorLicenses[e]===!0){c=[new nlobjSearchFilter("custrecord_celigo_batch_data_flow_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_lic",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_sid",
null,"is",b.connectors[e]),new nlobjSearchFilter("custrecord_celigo_batch_data_flow_userid",null,"isempty")];c=$$.searchRecord("customrecord_celigo_batch_data_flow",null,c,null);for(a=0;c&&a<c.length;a++)$$.submitField("customrecord_celigo_batch_data_flow",c[a].getId(),"custrecord_celigo_batch_data_flow_lic","T");c=[new nlobjSearchFilter("custrecord_celigo_rt_export_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_export_lic",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_export_sid",
null,"is",b.connectors[e]),new nlobjSearchFilter("custrecord_celigo_rt_export_userid",null,"isempty")];c=$$.searchRecord("customrecord_celigo_rt_export_flow",null,c,null);for(a=0;c&&a<c.length;a++)$$.submitField("customrecord_celigo_rt_export_flow",c[a].getId(),"custrecord_celigo_rt_export_lic","T");c=[new nlobjSearchFilter("custrecord_celigo_rt_import_system",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_import_lic",null,"is","F"),new nlobjSearchFilter("custrecord_celigo_rt_import_sid",
null,"is",b.connectors[e]),new nlobjSearchFilter("custrecord_celigo_rt_import_userid",null,"isempty")];c=$$.searchRecord("customrecord_celigo_rt_import_flow",null,c,null);for(a=0;c&&a<c.length;a++)$$.submitField("customrecord_celigo_rt_import_flow",c[a].getId(),"custrecord_celigo_rt_import_lic","T")}$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_lad",$$.dateToString(new Date,"datetimetz"))}}};if($$.getContext().getScriptId()==="customscript_celigo_flow_lic")$.namespace("Celigo.suitescript.userevent.licensingServices"),
Celigo.suitescript.userevent.licensingServices.FlowLicensing=function(){var a=function(){var a=$$.lookupField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_afl");if(!a){try{nlapiCreateRecord("customrecord_celigo_global_cache")}catch(b){return nlapiLogExecution("ERROR","Record Type customrecord_celigo_global_cache doesn't exist : "+(b.name||b.getCode())+" | "+(b.message||b.getDetails())),0}throw $$.createError("CELIGO_UNEXPECTED_ERROR","availableFlowLicenses not defined in gc");}return parseInt(a,
10)},b=function(b,e,f,g,h,j,i){$$.setFieldValue(h,$$.getContext().getEmail());$$.setFieldValue(j,$$.getContext().getName());$$.getFieldValue(g)||$$.setFieldValue(g,"Integrator (Custom Integration)");if($$.getFieldValue(g)!=="Integrator (Custom Integration)"&&$$.getFieldValue(e)!=="T"&&b!=="delete"&&$$.getFieldValue("isinactive")!=="T")throw $$.createError("CONNECTOR_LICENSE_REQUIRED","Please contact your Celigo rep to acquire a license for ["+$$.getFieldValue(g)+"].",!1);else if($$.getFieldValue(g)!==
"Integrator (Custom Integration)"&&$$.getFieldValue(e)==="T")return;g=!1;b!=="delete"&&$$.getFieldValue("isinactive")!=="T"&&$$.getFieldValue(i)!=="T"&&(g=!0);if(g&&$$.getFieldValue(e)!=="T"){b=a();if(b<1)throw $$.createError("FLOW_LICENSE_REQUIRED","No flow licenses available.  Please contact your Celigo rep to acquire additional per flow licenses.",!1);$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_afl",b-1);$$.setFieldValue(e,"T");$$.setFieldValue(f,(new Date).getTime())}else!g&&
$$.getFieldValue(e)==="T"&&($$.setFieldValue(e,"F"),$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_afl",a()+1))};this.main=function(c){if(!($$.getContext().getExecutionContext()==="scheduled"||$$.getContext().getExecutionContext()==="bundleinstallation")){if(c!=="create"&&c!=="edit"&&c!=="delete")throw $$.createError("CELIGO_UNEXPECTED_ERROR","Unsupported type: "+c);var e=null;$$.getRecordType()==="customrecord_celigo_batch_data_flow"?e="custrecord_celigo_batch_data_flow_userid":
$$.getRecordType()==="customrecord_celigo_rt_export_flow"?e="custrecord_celigo_rt_export_userid":$$.getRecordType()==="customrecord_celigo_rt_import_flow"&&(e="custrecord_celigo_rt_import_userid");if(!e||!$$.getFieldValue(e))if($$.getRecordType()==="customrecord_celigo_batch_data_flow")a:{e=Celigo.integrator.batch.DataFlowMetadata;$$.setFieldValue("custrecord_celigo_batch_data_flow_lmbe",$$.getContext().getEmail());$$.setFieldValue("custrecord_celigo_batch_data_flow_lmbn",$$.getContext().getName());
$$.getFieldValue("custrecord_celigo_batch_data_flow_sid")||$$.setFieldValue("custrecord_celigo_batch_data_flow_sid","Integrator (Custom Integration)");if($$.getFieldValue("custrecord_celigo_batch_data_flow_sid")!=="Integrator (Custom Integration)"&&$$.getFieldValue("custrecord_celigo_batch_data_flow_lic")!=="T"&&c!=="delete"&&$$.getFieldValue("isinactive")!=="T")throw $$.createError("CONNECTOR_LICENSE_REQUIRED","Please contact your Celigo rep to acquire a license for ["+$$.getFieldValue("custrecord_celigo_batch_data_flow_sid")+
"].",!1);else if($$.getFieldValue("custrecord_celigo_batch_data_flow_sid")!=="Integrator (Custom Integration)"&&$$.getFieldValue("custrecord_celigo_batch_data_flow_lic")==="T")break a;var f=!1;c!=="delete"&&$$.getFieldValue("isinactive")!=="T"&&$$.getFieldValue("custrecord_celigo_batch_data_flow_disabl")!=="T"&&(c=null,$$.getFieldValue(e.getFlowFldConfiguration())?c=Celigo.integratorUtil.loadFlowConfiguration(JSON.parse($$.getFieldValue(e.getFlowFldConfiguration()))):$$.getFieldValue(e.getFlowFldConfig())&&
(c=Celigo.integratorUtil.loadFlowConfiguration($$.getFieldValue(e.getFlowFldConfig()))),c&&c.connector&&c.connector.celigo_classname!=="Celigo.integrator.connectors.file.FileCabinetConnector"?f=!0:c&&c.flowSchedule?f=!0:$$.getFieldValue("custrecord_celigo_batch_data_flow_sch")&&(f=!0));if(f&&$$.getFieldValue("custrecord_celigo_batch_data_flow_lic")!=="T"){c=a();if(c<1)throw $$.createError("FLOW_LICENSE_REQUIRED","No flow licenses available.  Please contact your Celigo rep to acquire additional per flow licenses.",
!1);$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_afl",c-1);$$.setFieldValue("custrecord_celigo_batch_data_flow_lic","T");$$.setFieldValue("custrecord_celigo_batch_data_flow_lic_t",(new Date).getTime())}else!f&&$$.getFieldValue("custrecord_celigo_batch_data_flow_lic")==="T"&&($$.setFieldValue("custrecord_celigo_batch_data_flow_lic","F"),$$.submitField("customrecord_celigo_global_cache",1,"custrecord_celigo_gc_afl",a()+1))}else $$.getRecordType()==="customrecord_celigo_rt_export_flow"?
b(c,"custrecord_celigo_rt_export_lic","custrecord_celigo_rt_export_lic_t","custrecord_celigo_rt_export_sid","custrecord_celigo_rt_export_lmbe","custrecord_celigo_rt_export_lmbn","custrecord_celigo_rt_export_disabl"):$$.getRecordType()==="customrecord_celigo_rt_import_flow"&&b(c,"custrecord_celigo_rt_import_lic","custrecord_celigo_rt_import_lic_t","custrecord_celigo_rt_import_sid","custrecord_celigo_rt_import_lmbe","custrecord_celigo_rt_import_lmbn","custrecord_celigo_rt_import_disabl")}}},Celigo.suitescript.userevent.licensingServices.FlowLicensing.prototype=
{getThrowableErrorCodes:function(){return"all"},beforeSubmit:function(a){this.main(a)}};$.namespace("Celigo.event.dispatcher.integrator.batch");Celigo.event.dispatcher.integrator.batch.ImportDispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.batch.ImportDispatcher"});$.namespace("Celigo.event.dispatcher.integrator.batch");Celigo.event.dispatcher.integrator.batch.ExportDispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.batch.ExportDispatcher"});
$.namespace("Celigo.event.dispatcher.integrator.realtime");Celigo.event.dispatcher.integrator.realtime.ExportDispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.realtime.ExportDispatcher"});$.namespace("Celigo.event.dispatcher.integrator.realtime");Celigo.event.dispatcher.integrator.realtime.ImportDispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.realtime.ImportDispatcher"});$.namespace("Celigo.event.dispatcher.integrator.connectors");
Celigo.event.dispatcher.integrator.connectors.ConnectorDispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.connectors.ConnectorDispatcher"});$.namespace("Celigo.event.dispatcher.integrator.mapping");Celigo.event.dispatcher.integrator.mapping.Dispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.mapping.Dispatcher"});$.namespace("Celigo.integrator.mapping");Celigo.integrator.mapping.Dispatcher=Celigo.event.dispatcher.integrator.mapping.Dispatcher;
$.namespace("Celigo.integrator");Celigo.integrator.IDataFlow=function(){};Celigo.integrator.IDataFlow.prototype={getIntegration:null,getUseCase:null,getCache:null,setCache:null,getInvocationContext:null,setInvocationContext:null,getInvocationContextByKey:null,setInvocationContextByKey:null,getNextDataFlow:null,setNextDataFlow:null};$.namespace("Celigo.integrator");Celigo.integrator.DataFlow=function(a){this._super(a);this.getEventDispatcher=function(){return this.eventDispatcher};this.getExecutionLogger=
function(){if(!this.executionLogger)this.executionLogger=$.getExecutionLogger(this.getClassName());return this.executionLogger};this.getIntegration=function(){return a.integration};this.getUseCase=function(){return a.useCase};this.isSystem=function(){return!!a.system};this.setSystem=function(b){a.system=!!b};this.getName=function(){return this.getIntegration()+" - "+this.getUseCase()};this.getCache=function(){if(!a.cache)a.cache={};return a.cache};this.setCache=function(b){a.cache=b};this.getCacheByKey=
function(b){return!a.cache||!b?void 0:a.cache[b]};this.setCacheByKey=function(a,c){this.getCache()[a]=c};this.setInvocationContext=function(a){this.invocationContext=a};this.getInvocationContext=function(){if(!this.invocationContext)this.invocationContext={};return this.invocationContext};this.setInvocationContextByKey=function(a,c){if(!this.invocationContext)this.invocationContext={};this.invocationContext[a]=c};this.getInvocationContextByKey=function(a){return!this.invocationContext||!a?void 0:
this.invocationContext[a]};this.getNextDataFlow=function(){return this.nextDataFlow||a.nextDataFlow};this.getInitialDataFlow=function(){var a,c,e=100;if(!this.getInvocationContextByKey("dataFlowSequence")||!this.getInvocationContextByKey("previousDataFlow")||this.getInvocationContextByKey("dataFlowSequence")===1)return this;a=this;do{--e;a=a.getInvocationContextByKey("previousDataFlow");c=a.getInvocationContextByKey("dataFlowSequence");if(!c)break;_.isNumber(c)||(c=+c);if(c===1||isNaN(c))break}while(e>
0&&a.getInvocationContextByKey("previousDataFlow"));return a};this.setNextDataFlow=function(a){this.nextDataFlow=a};this.getConnector=function(){return a.connector};this.setConnector=function(b){a.connector=b};this.getRequestMappingRef=function(){return a.requestMappingRef};this.setRequestMappingRef=function(b){a.requestMappingRef=b};this.getRequestMapper=function(){return a.requestMapper};this.setRequestMapper=function(b){a.requestMapper=b};this.getResponseMappingRef=function(){return a.responseMappingRef};
this.getResponseMapper=function(){return a.responseMapper};this.setResponseMapper=function(b){a.responseMapper=b};this.setResponseMappingRef=function(b){a.responseMappingRef=b};this.getRequestCollection=function(){return this.requestCollection};this.setRequestCollection=function(a){this.requestCollection=a};this.getResponseCollection=function(){return this.responseCollection};this.setResponseCollection=function(a){this.responseCollection=a};this.getRequestDocument=function(){return this.requestDocument};
this.setRequestDocument=function(a){this.requestDocument=a};this.getResponseDocument=function(){return this.responseDocument};this.setResponseDocument=function(a){this.responseDocument=a};this.getRequestMessage=function(){return this.requestMessage};this.setRequestMessage=function(a){this.requestMessage=a};this.getResponseMessage=function(){return this.responseMessage};this.setResponseMessage=function(a){this.responseMessage=a};this.getPlugins=function(){return a.plugins};this.setPlugins=function(b){a.plugins=
b}};Celigo.integrator.DataFlow.implement(Celigo.integrator.IDataFlow);Celigo.integrator.DataFlow.className="Celigo.integrator.DataFlow";Celigo.integrator.DataFlow.extend(Celigo.io.PrivateStateful);$.namespace("Celigo.integrator");Celigo.integrator.Hook=function(){var a=$.getExecutionLogger("Celigo.integrator.Hook"),b={};return{should:function(a,b){return!(!a&&!b)},invokeWithFile:function(c,e,f){if(!c)throw Error("hook name is required");if(!e&&!f)throw Error("missing argument fileId and/or funcname");
a.audit(c,f+" in file "+e);var g;g=Array.prototype.slice.call(arguments,3);var h;if(e&&!b[e]){try{var j=$$.loadFile(e)}catch(i){throw a.error("error loading file",i),g=Error("failed to load file: "+e+"; caused by: "+i.message),g.code=i&&(i.getCode&&i.getCode()||i.code||i.name)||"unexpected_error",g;}a.audit("file ",j.getName()+"("+j.getType()+")");if(j.getType()!=="JAVASCRIPT")throw g=Error('file type "JAVASCRIPT" is required'),g.code="invalid_hook_file_type",g;try{h=(0,eval)(j.getValue())}catch(k){throw a.error("error evaluating",
k),g=Error("hook file error - "+k.name+": "+k.message),g.code=k&&(k.getCode&&k.getCode()||k.code||k.name)||"unexpected_error",g;}b[e]=h||!0}else e&&(h=b[e]);h=h?h[f]:void 0;typeof h!=="function"&&(h=$.require("@"+f));if(typeof h!=="function")throw g=Error('invalid hook function "'+f+'"'),g.code="invalid_hook_function",g;j=Function("return this")();try{return h.apply(j,g)}catch(l){throw a.error("error calling hook func",l),g=Error("hook function error: "+l.message),g.code=l&&(l.getCode&&l.getCode()||
l.code||l.name)||"unexpected_error",g;}},isCanonicalDataResp:function(a){if(!a||!_.isArray(a))return!1;for(var b=0;b<a.length;b++)if(!a[b])return!1;return!0},merge:function(a,b,f){for(var g,h,j,i=0;i<b.length;i++){h=a[i];j=b[i];if(g=!!j.data)h[f]=j.data,h.statusCode=200;if(j.errors&&j.errors.length){if(!g)h.statusCode=422;_.each(j.errors,function(a){if(a&&!a.source)a.source="suitescript_hook";h.errors.push(a)})}if(!g&&(!h.errors||!h.errors.length))h.statusCode=304,h.ignored=!0}},defaultPreSendHandler:function(a){return!a||
!a.data?void 0:{data:a.data}},defaultCanonicalHandler:function(a){var b=[];if(!a||!a.data)return b;for(var f=0;f<a.data.length;f++)b.push({data:a.data[f]});return b},nonFatalPreSendHandler:function(a){if(a&&a.data&&a.data.length)return{errors:_.map(a.data,function(){return{code:"no_can_do",message:"simply create an error for each thing in data"}})}},nonFatalFlippingPreSendHandler:function(a){if(a&&a.data&&a.data.length){var b=!0,f=[],g=[];_.each(a.data,function(a){b?f.push(a):g.push({code:"no_can_do",
message:"simply create an error for each thing in data"});b=!b});return{data:f,errors:g}}},fatalPreSendHandler:function(){var a=Error("simply fails with an error");a.code="BOOM!";throw a;}}}();$.namespace("Celigo.integrator.dataflow");Celigo.integrator.dataflow.Status={INPROGRESS:"In Progress",COMPLETED:"Completed",COMPLETEDWITHERROR:"Completed (with Errors)",COMPLETEDWITHWARNING:"Completed (with Warnings)",FAILED:"Failed",PENDING:"Pending",PENDING_RESPONSE:"Pending Response"};$.namespace("Celigo.integrator.dataflow");
Celigo.integrator.dataflow.InvocationContext=function(){return{dataFlowType:"dataFlowType",dataFlowDirection:"dataFlowDirection",dataFlowRecordType:"dataFlowRecordType",dataFlowRecordId:"dataFlowRecordId",integration:"integration",useCase:"useCase",jobRecordId:"jobRecordId",integrationLogId:"integrationLogId",runByRunner:"runByRunner",dataFlowSequence:"dataFlowSequence",previousDataFlow:"previousDataFlow",initImportWithFile:"initImportWithFile",resumeImportFromCallback:"resumeImportFromCallback",
importFileId:"importFileId",cacheFileId:"cacheFileId",testResultId:"testResultId",invokedByDataFlow:"invokedByDataFlow",invokedDepth:"invokedDepth",lastBranch:"lastBranch",previouslyUsedQueues:"previouslyUsedQueues",eventType:"eventType",executionType:"executionType",pageIndex:"pageIndex",reportId:"reportId",timesRan:"timesRan",muteLogging:"muteLogging",integratorIOFlowId:"integratorIOFlowId"}}();$.namespace("Celigo.integrator.dataflow");Celigo.integrator.dataflow.Metadata=function(a){this._super(a,
!0)};Celigo.integrator.dataflow.Metadata.className="Celigo.integrator.dataflow.Metadata";Celigo.integrator.dataflow.Metadata.extend(Celigo.io.PrivateStateful);$.namespace("Celigo.integrator.dataflow");Celigo.integrator.dataflow.ImportJobRecordMetadata=new Celigo.integrator.dataflow.Metadata({jobRecType:"customrecord_celigo_job_import",jobFldIntegration:"custrecord_celigo_ji_integration",jobFldUseCase:"custrecord_celigo_ji_usecase",jobFldStatus:"custrecord_celigo_ji_status",jobFldStartTime:"custrecord_celigo_ji_start_time",
jobFldEndTime:"custrecord_celigo_ji_end_time",jobFldNumOfRecords:"custrecord_celigo_ji_imported",jobFldNumOfErrors:"custrecord_celigo_ji_failed",jobFldFile:"custrecord_celigo_ji_results",jobFldErrorFile:"custrecord_celigo_ji_error_file",jobFldMemo:"custrecord_celigo_ji_memo",jobFldIntegrationLog:"custrecord_celigo_ji_log",jobFldStatusList:{FAILED:"1",INPROGRESS:"4",COMPLETED:"3",COMPLETEDWITHERROR:"2",COMPLETEDWITHWARNING:"6",PENDING:"7"}});$.namespace("Celigo.integrator.dataflow");Celigo.integrator.dataflow.ExportJobRecordMetadata=
new Celigo.integrator.dataflow.Metadata({jobRecType:"customrecord_celigo_job_export",jobFldIntegration:"custrecord_celigo_je_integration",jobFldUseCase:"custrecord_celigo_je_usecase",jobFldStatus:"custrecord_celigo_je_status",jobFldStartTime:"custrecord_celigo_je_start_time",jobFldEndTime:"custrecord_celigo_je_end_time",jobFldNumOfRecords:"custrecord_celigo_je_exp_rec_count",jobFldNumOfErrors:"custrecord_celigo_je_failed",jobFldFile:"custrecord_celigo_je_out_file",jobFldMemo:"custrecord_celigo_je_memo",
jobFldIntegrationLog:"custrecord_celigo_je_log",jobFldState:"custrecord_celigo_je_integration_state",jobFldStatusList:{FAILED:"3",INPROGRESS:"2",COMPLETED:"4",COMPLETEDWITHERROR:"5",COMPLETEDWITHWARNING:"6"}});$.namespace("Celigo.integrator.dataflow");Celigo.integrator.dataflow.Util=function(){var a=$.getExecutionLogger("Celigo.integrator.dataflow.Util"),b=void 0,c=void 0,e=function(a){a&&(a=_.map(a.split(","),function(a){return _.isNaN(parseInt(a,10))?0:a}),a=_.reject(a,function(a){a=parseInt(a,
10);return a<1||a>$.getQueueCount()}));if(!a||a.length===0)a=_.map(_.range(1,$.getQueueCount()+1),function(a){return a.toString()});return a},f=function(a,b){var c;c=a?e(a):e($$.getContext().getSetting("SCRIPT","custscript_celigo_batch_data_flow_queues"));var f={};_.each(b,function(a){f[a]=(f[a]||0)+1});_.sortBy(c,function(a){return f[a]?f[a]:0});return c[0]},g=function(a){var b=[new nlobjSearchFilter("scriptid","script","is",a)],c=[(new nlobjSearchColumn("datecreated")).setSort(!0),new nlobjSearchColumn("internalid",
"scriptdeployment"),new nlobjSearchColumn("status")],b=$$.searchRecord("scheduledscriptinstance",null,b,c),b=_.filter((new Celigo.util.NlobjSearchResultConverter).toJS(b),function(a){return a.status_val!=="Complete"&&a.status_val!=="Failed"}),e={};_.each(b,function(a){e[a.internalid_scriptdeployment_val]=!0});b=[new nlobjSearchFilter("scriptid","script","is",a)];c=[(new nlobjSearchColumn("internalid")).setSort(!1),new nlobjSearchColumn("status")];b=$$.searchRecord("scriptdeployment",null,b,c);return _.first(_.shuffle(_.filter((new Celigo.util.NlobjSearchResultConverter).toJS(b.slice(0,
1E3)),function(a){return a.status_val==="NOTSCHEDULED"&&!e[a.id]}))).id},h=function(a,h,i,j){var k;if($.getQueueCount()>1)try{var l;if(j)l=f(a,j);else if(a)a=e(a),$$.logExecution("debug","flowQueueAllocationPref",a),l=a[_.random(a.length-1)];else{if(!b){b=e($$.getContext().getSetting("SCRIPT","custscript_celigo_batch_data_flow_queues"));$$.logExecution("debug","globalQueueAllocationPref",b);for(c=[];b.length>0;){var m=_.random(b.length-1);c.push(b[m]);b.splice(m,1)}$$.logExecution("debug","queuesToUse",
c)}var o=c.shift();c.push(o);l=o}j=!1;for(m=0;m<5;m++){var n=g(h),x=$$.loadRecord("scriptdeployment",n),B=x.getFieldValue("scriptid");x.setFieldValue("queueid",l);$$.submitRecord(x);k=$$.scheduleScript(h,B,i);if(k==="QUEUED"){j=!0;break}}j||($$.logExecution("debug","unable to kick off specific deployments after 5 tries"),k=$$.scheduleScript(h,null,i))}catch(A){$$.logExecution("debug","unable to use new multi-queue logic",Celigo.Error.format(A)),k=$$.scheduleScript(h,null,i)}else k=$$.scheduleScript(h,
null,i);return k},j=function(a,b){var c=Celigo.integrator.batch.DataFlowMetadata,e={},f=a.batchDataFlowId;if(isNaN(+f)){var g=$$.searchRecord(c.getFlowRecType(),null,[new nlobjSearchFilter(c.getFlowFldFlowId(),null,"is",f)]);if(g&&g.length===1)f=g[0].getId();else throw new Celigo.Error({name:"invalid flow id",message:(g&&g.length>1?"Multiple Data Flow Records found":"Data Flow Record not found")+" in NetSuite for the Flow Id: "+f});}f=$$.lookupField(c.getFlowRecType(),f,c.getFlowFldQueues());e[c.getFlowRunnerConfigParamId()]=
JSON.stringify(a);return h(f,c.getFlowRunnerScriptId(),e,b)},i=function(a){return a instanceof Celigo.integrator.batch.Import},k=function(a){return a instanceof Celigo.integrator.batch.Export},l=function(a){return a instanceof Celigo.integrator.realtime.Import},m=function(a){return a instanceof Celigo.integrator.realtime.Export},n=function(a,b){b instanceof Celigo.integrator.mapping.model.RecordMapping&&(recordType=b.getRecordType());for(var c=b.getChildren(),e=0;c&&e<c.length;e++)if(c[e]){var f=
[];if(c[e]instanceof Celigo.integrator.mapping.model.FieldMappingSet){var g=c[e].getFieldMappings();recordType&&a[recordType].mapping&&c[e].addFieldMapping(a[recordType].mapping);f=f.concat(g)}else if(c[e]instanceof Celigo.integrator.mapping.model.CollectionMapping)for(var g=c[e].getChildren(),h=0;h<g.length;h++)g[h]&&g[h]instanceof Celigo.integrator.mapping.model.FieldMappingSet&&(f=f.concat(g[h].getFieldMappings()));for(g=0;f&&g<f.length;g++)f[g].getSubRecordMapping()&&n(a,f[g].getSubRecordMapping(),
recordType)}},o=function(a,b){if(Celigo.util.isPlainObject(b)||_.isArray(b)){if(b.nlobjRecordType&&a[b.nlobjRecordType]){var c;switch(a[b.nlobjRecordType].operation){case "add":if(b.id||b.nlobjFieldIds&&b.nlobjFieldIds.internalid)if(a[b.nlobjRecordType].ignoreExistingRecordsOnAdd)throw $$.createError("CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT","ignoreExistingRecordsOnAdd is true");else throw Error('cannot "add" record with internalid');break;case "update":if(!b.id&&(!b.nlobjFieldIds||!b.nlobjFieldIds.internalid))if(a[b.nlobjRecordType].ignoreNonExistingRecordsOnUpdate)throw $$.createError("CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT",
"ignoreNonExistingRecordsOnUpdate is true");else throw Error('cannot "update" record without internalid');}}for(c in b)b.hasOwnProperty(c)&&o(a,b[c])}};return{isBatchImport:i,isImportFlow:i,isBatchExport:k,isExportFlow:k,isRealtimeImport:l,isRealtimeExport:m,isImport:function(a){return i(a)||l(a)},isExport:function(a){return k(a)||m(a)},isBatch:function(a){return i(a)||k(a)},isRealtime:function(a){return l(a)||m(a)},getFlowName:function(a){return a.getIntegration()+" - "+a.getUseCase()},getCeligoRootFolderId:function(){var a=
$$.searchRecord("folder",null,[new nlobjSearchFilter("name",null,"is","Celigo"),new nlobjSearchFilter("parent",null,"anyof","@NONE@")]);return!a||!a.length?void 0:a[0].getId()},scheduleBatchDataFlowById:function(a,b){b||(b={});b.batchDataFlowId=a;if(j(b)!=="QUEUED")throw new Celigo.Error({name:"FAILED_TO_RUN_FLOW",message:"Batch Data Flow Scheduler failed to find an available runner deployment to run the batch flow record "+a});},scheduleBatchDataFlowByInstance:function(a,b){if(!Celigo.integrator.dataflow.Util.isBatch(a))throw new Celigo.Error({name:"FAILED_TO_SCHEDULE",
message:"only batch data flow can be scheduled"});var c=Celigo.integrator.dataflow.InvocationContext,e={};e.batchDataFlowId=a.getInvocationContextByKey(c.dataFlowRecordId);if(e.batchDataFlowId){var f=null;$.currentQueue&&((f=a.getInvocationContextByKey(c.previouslyUsedQueues))||(f=[]),f.push($.currentQueue),a.setInvocationContextByKey(c.previouslyUsedQueues,f));if(!b||!Celigo.util.isPlainObject(b))b={};if(a.getInvocationContextByKey("testResultId"))b.testResultId=a.getInvocationContextByKey("testResultId");
_.each(b,function(a,b){e[b]=a});a.setInvocationContextByKey(c.lastBranch,!1);var g=a.getInvocationContextByKey(c.invokedDepth);if(!g||isNaN(+g))g=0;g=+g+1;e[c.invokedByDataFlow]=a.getInvocationContext();e[c.invokedDepth]=g;if(j(e,f)!=="QUEUED")throw a.setInvocationContextByKey(c.lastBranch,!0),new Celigo.Error({name:"FAILED_TO_RUN_FLOW",message:"Batch Data Flow Scheduler failed to find an available runner deployment to run the batch flow record "+a.getInvocationContextByKey("dataFlowRecordId")});
}},scheduleBatchDataFlowV1:function(a){var b=Celigo.JSON.parse(a.flowConfig).flowConfigFileId,b=Celigo.integrator.util.IntegratorUtil.loadFlowConfiguration(b);log("IntegratorUtil.scheduleWithNextAvailableRunner - flowConfigObject",b);var c={};c[b.flowConfigParameterId]=a.flowConfig||"";c[b.scriptParams[0]]=a.flowState||"";return h(b.queues,b.managerScriptId,c)==="QUEUED"?!0:!1},persistDataFlowCache:function(b){if(b&&_.isFunction(b.getCache)&&b.getCache()){var c;try{c=Celigo.JSON.stringify(b.getCache())}catch(e){throw new Celigo.Error({name:"ERROR_STRINGIFY_DATA_FLOW_CACHE",
message:"Can't stringify data flow cache",cause:e});}if(c&&c!=="{}"){b=Celigo.integrator.dataflow.Util.getFlowName(b)+String((new Date).getTime())+Celigo.integrator.dataflow.Util.generateSRN(10)+".txt";c=$$.createFile(b,"PLAINTEXT",c);var f=Celigo.integrator.dataflow.Util.getCeligoRootFolderId()||"-15";c.setFolder(f);c=$$.submitFile(c);a.debug("persisted into file "+b);if(!c)throw new Celigo.Error({message:"null file id after persistence"});return c}}},loadDataFlowCache:function(b,c){if(c&&b&&_.isFunction(b.setCache)){var e,
f;e=$$.loadFile(c).getValue();try{f=Celigo.JSON.parse(e)}catch(g){throw new Celigo.Error({name:"ERROR_PARSE_PERSISTED_DATA_FLOW_CACHE",message:"data flow cache is not valid JSON string",cause:g});}finally{try{$$.deleteFile(c)}catch(h){}}a.debug("initial data flow cache is overwritten from cache file");f&&!_.isEmpty(f)&&Celigo.util.objectExtend(!0,b.getCache(),f)}},setJobRecordType:function(a,b){this.isImport(b)?a.convertToImportStatusLogger():this.isExport(b)&&a.convertToExportStatusLogger()},isLastJobRunning:function(a){return a.getJobStatusLoggerInstance().isLastJobStillRunning()?
!0:!1},getImportFileFromJobRecord:function(a){return $$.lookupField(Celigo.integrator.dataflow.ImportJobRecordMetadata.getJobRecType(),a.getJobRecordId(),Celigo.integrator.dataflow.ImportJobRecordMetadata.getJobFldFile())},attachImportFileToJobRecord:function(a,b){!b&&_.isFunction(a.getMessage)&&a.getMessage()instanceof Celigo.integrator.connectors.model.Message&&a.getMessage().getFileId()&&(b=a.getMessage().getFileId());if(b)return $$.submitField(Celigo.integrator.dataflow.ImportJobRecordMetadata.getJobRecType(),
a.getJobRecordId(),Celigo.integrator.dataflow.ImportJobRecordMetadata.getJobFldFile(),b)},convertErrorArrayToLiterals:function(a,b){for(var c=[],e,f,g=0,h=b.length;g<h;g++)if(b[g]){f=e=void 0;var i=b[g];if(_.isFunction(i.getIndexNumber)&&_.isNumber(i.getIndexNumber()))e=i.getIndexNumber(),i=i.getError();else if(_.isFunction(i.getDocumentIndex)&&_.isNumber(i.getDocumentIndex()))e=i.getDocumentIndex(),f=i.getAllIndex();else if(_.isNumber(b[g].documentIndex))e=b[g].documentIndex;if(e||e===0){e={index:e,
code:_.isFunction(i.getCode)?i.getCode():i.name,message:i.message};if(f)e.allIndex=f;c.push(e)}}return c},logErrorArrayOnJobRecord:function(a,b){for(var c,e,f,g,h=0,i=b.length;h<i;h++)if(e=f=null,b[h]){g=b[h];var j=new Celigo.lang.NetSuiteError({error:g instanceof Celigo.integrator.mapping.model.MappingError?g.getError():g});c=j.getCode()+" | "+j.getDetails();g instanceof Celigo.integrator.mapping.model.MappingError?c="Mapping error at index: "+(g.getExternalId()||g.getIndex())+" | "+c:(_.isFunction(g.getRecordType)&&
(e=g.getRecordType()),_.isFunction(g.getRecordId)&&(f=g.getRecordId()),_.isFunction(g.getExternalId)&&g.getExternalId()&&(c="Error at index: "+g.getExternalId()+" | "+c));$L.error(c,a.getIntegrationLogId(),a.getIntegration(),e,f,a.getUseCase(),j.getHelpLink());$$.logExecution("ERROR","Error",c+" | "+j.getStackTrace())}},initializeJobRecord:function(a){if(!_.isUndefined(a.getJobRecordId())&&!_.isUndefined(a.getIntegrationLogId()))a.getExecutionLogger().debug("initializeJobRecord","job record and integration log record for this flow have already been initialized!");
else{var b=a.getJobStatusLoggerInstance(),c=$L.newJob(a.getIntegration()+"-"+a.getUseCase(),a.getIntegration(),null,a.getUseCase());a.getExecutionLogger().debug("initializeJobRecord - integrationLoggerID",c);b.setIntegrationLog(c);b.setInProgressStatus();_.isFunction(a.getMessage)&&a.getMessage()instanceof Celigo.integrator.connectors.model.Message&&a.getMessage().getFileId()&&(b.setRecordFile(a.getMessage().getFileId()),a.getExecutionLogger().debug("attaching receive message file",a.getMessage().getFileId()));
b=b.logStatus();a.getExecutionLogger().debug("initializeJobRecord - statusLoggerID",b);a.setJobRecordId(b);a.setIntegrationLogId(c)}},initializeHandlingResponseJob:function(a){var b=a.getJobStatusLoggerInstance();b.setJobStatusLoggerID(a.getJobRecordId());a.state.successCount=b.getNumberOfSuccesses();b.setNumberOfSuccesses(a.state.successCount);b.setHandlingResponseStatus();b.logStatus()},initializeInactivePendingJobRecord:function(a){var b=a.getJobStatusLoggerInstance();b.setPendingStatus();b.setInactive(!0);
b=b.logStatus();a.setJobRecordId(b)},startJobRecord:function(a){var b=a.getJobStatusLoggerInstance();b.setJobStatusLoggerID(a.getJobRecordId());b.setStartTime(new Date);b.logStatus()},failInactivePendingJobRecord:function(a,b,c){var b=b.id,e=a.getJobStatusLoggerInstance();e.setJobStatusLoggerID(b);e.setFailedStatus();e.setInactive(!1);e.setFailureMessage(c||"Please check integration logs for details.");e.setEndTime(new Date);e.setNumberOfSuccesses(a.getSuccessedProcessObjectsCount());e.logStatus()},
resumeInactivePendingJobRecord:function(a,b){var c=b.id,e=a.getJobStatusLoggerInstance();e.setJobStatusLoggerID(c);var f=$L.newJob(a.getIntegration()+"-"+a.getUseCase(),a.getIntegration(),null,a.getUseCase());e.setIntegrationLog(f);e.setInProgressStatus();e.setInactive(!1);e.logStatus();a.setJobRecordId(c);a.setIntegrationLogId(f)},finalizeJobRecord:function(a){if(a&&a.getJobRecordId&&a.getJobRecordId()){var b=a.getJobRecordId(),c=a.getJobStatusLoggerInstance();c.setJobStatusLoggerID(b);b=a.getErrorCount();
c.setNumberOfErrors(b);if(a.state.status===Celigo.integrator.dataflow.Status.PENDING_RESPONSE)try{c.setPendingResponseStatus(),c.incResponseBatchRanTimes()}catch(e){$.log("error",e.message||e.getMessage());return}else b>0?(c.setCompletedWithErrorsStatus(),c.setFailureMessage("Please check integration logs for details.")):c.setCompletedStatus();a.getErrorFileId&&a.getErrorFileId()&&c.setErrorFile(a.getErrorFileId());c.setEndTime(new Date);c.setNumberOfSuccesses(a.getSuccessedProcessObjectsCount());
c.logStatus()}},failJobRecord:function(a,b){if(a&&a.getJobRecordId&&a.getJobRecordId()){var c=a.getJobRecordId(),e=a.getJobStatusLoggerInstance();e.setJobStatusLoggerID(c);e.setFailedStatus();e.setFailureMessage(b||"Please check integration logs for details.");a.getErrorFileId&&a.getErrorFileId()&&e.setErrorFile(a.getErrorFileId());e.setEndTime(new Date);e.setNumberOfSuccesses(a.getSuccessedProcessObjectsCount());e.logStatus()}},generateSRN:function(){return function(a){for(var a=a||32,b="",c=0;c<
a;c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random()*62));return b}}(),encryptFlowCallbackToken:function(a){if(!a||!a.getInvocationContextByKey("batchDataFlowId")||!a.getJobRecordId())throw new CeligoError({name:"INVALID_FLOW_DATA",message:"batch data flow record id and job record id are mandatory for callback token"});var b=$$.getContext(),c=[];c.push(String((new Date).getTime()));c.push(b.getCompany());c.push(b.getEnvironment());c.push(a.getInvocationContextByKey("batchDataFlowId"));
c.push(a.getJobRecordId());c.push("1F02CB7EB58F658B0442419A6C61DBCF05713D0A3E05D9E46463357F3E98998E");c.push(Celigo.integrator.batch.Util.generateSRN());return $$.encrypt(c.join("|"),"aes","2B282AAAE33EA52FBAB5343BF9BE1CCD")},decryptFlowCallbackToken:function(a){if(!a)throw new CeligoError({name:"INVALID_CALLBACK_TOKEN",message:"cipher text is required"});try{var b=$$.decrypt(a,"aes","2B282AAAE33EA52FBAB5343BF9BE1CCD");if(!b)throw new CeligoError({name:"INVALID_CALLBACK_TOKEN",message:"invalid callback token"});
return b}catch(c){throw new CeligoError({name:"INVALID_CALLBACK_TOKEN",message:"invalid callback token",error:c});}},validateAndParseFlowCallbackToken:function(a){var b=a.split("|");if(b.length!==7)throw new CeligoError({name:"INVALID_CALLBACK_TOKEN",message:"invalid callback token"});var a=b[0],c=b[1],e=b[2],f=b[3],g=b[4],h=b[5],b=b[6],i=$$.getContext();if((new Date).getTime()-+a>=36E5)throw new CeligoError({name:"INVALID_CALLBACK_TOKEN",message:"invalid callback token"});if(c!==i.getCompany()||
e!==i.getEnvironment()||isNaN(+f)||b.length!==32||h!=="1F02CB7EB58F658B0442419A6C61DBCF05713D0A3E05D9E46463357F3E98998E")throw new CeligoError({name:"INVALID_CALLBACK_TOKEN",message:"invalid callback token"});return{timestamp:a,companyId:c,environment:e,dataFlowId:f,jobRecordId:g}},validateNonEmptyDocumentInMessage:function(a){var b=null;a instanceof Celigo.integrator.connectors.model.Message||(b="message should be an instance of Celigo.integrator.connectors.model.Message");a.getData()||(b="message does not contain data");
a.getData()instanceof Celigo.integrator.model.Document||(b="message should contain an instance of Celigo.integrator.model.Document");if(b)throw $$.logExecution("ERROR","validateNonEmptyDocumentInMessage",b),$$.createError("NO_DATA","There is no data to import.");},validateResponseMappingResult:function(a){if(!a||!(a instanceof Celigo.integrator.mapping.model.MapToNetSuiteResult))throw new Celigo.Error({name:"invalid response mapping result",message:"mapping result should be an instance of Celigo.integrator.mapping.model.MapToNetSuiteResult"});
},isValidConnectorMethod:function(a){return!(!a||!(a instanceof Celigo.integrator.connectors.Connector)||!_.isString(a.getMethod()))},flatternData:function(a){a=_.clone(a);if(a.nlobjRecordType)a.recordType=a.nlobjRecordType,delete a.nlobjRecordType;a.nlobjFieldIds&&(_.extend(a,a.nlobjFieldIds),delete a.nlobjFieldIds);return a},makeAckCollectionFromResponseCollection:function(a,b){var c=[];a.each(function(a){c.push([Celigo.integrator.dataflow.Util.flatternData(a)])});b&&_.isArray(b)&&_.each(b,function(a){c.push([Celigo.integrator.dataflow.Util.flatternData(a)])});
return Celigo.lang.Collection.arrayOrObjectToCollection(c)},newIntegration:function(a){return(new $R({nlobjRecordType:"customrecord_celigo_integration",nlobjFieldIds:{name:a}})).save()},newUseCase:function(a){return(new $R({nlobjRecordType:"customrecord_celigo_integration_usecase",nlobjFieldIds:{name:a}})).save()},trimInvocationHistory:function(a,b,c){if(a&&b&&c){for(c=+c;c>0;)if(--c,a=a[b],!a)return;a[b]=void 0}},mergeOperationMappings:function(a,b){if(a&&!_.isEmpty(a)){for(var c in a)if(a[c]){var e=
a[c].operation;if(e!=="add"&&e!=="update"&&e!=="addupdate")throw Error('invalid import operation, needs to be one of "add, update, addupdate"');var e=a[c].operation,f=a[c].mapping;if(f||e!=="add"){if(!(a[c].mapping instanceof Celigo.integrator.mapping.model.FieldMapping))throw Error("invalid operation mapping for type :"+c);if(f.isInactive())throw Error("operation mapping cannot be inactive");if(!f.getJsField()||f.getJsField().toLowerCase()!=="id"&&f.getJsField().toLowerCase()!=="internalid")throw Error("only internal id field is allowed");
f.setLookupAllowFailures(!0)}}if(!b||!(b instanceof Celigo.integrator.mapping.model.DocumentMapping))throw Error("response mapping is not valid, check mapping configuration");c=b.getRecordMappings();if(!c||!c.length)throw Error("no record mapping to merge with, check mapping configuration");for(e=0;e<c.length;e++)n(a,c[e])}},validateImportOperationForRecordConfig:function(a,b){a&&!_.isEmpty(a)&&o(a,b)}}}();Celigo.integrator.batch.Util=Celigo.integrator.dataflow.Util;$.namespace("Celigo.integrator.dataflow");
Celigo.integrator.dataflow.Factory=function(){var a=$.getExecutionLogger("Celigo.integrator.dataflow.Factory"),b=Celigo.integrator.dataflow.InvocationContext,c=function(a,b){var c=a.metadata;if(a.lib&&(_.isString(a.lib)||_.isNumber(a.lib)||_.isArray(a.lib))){var e="recmach"+c.getFlowLibFldParent();b.nlobjSublistIds={};b.nlobjSublistIds[e]=[];var f=b.nlobjSublistIds[e];_.isString(a.lib)||_.isNumber(a.lib)?(e={},e[c.getFlowLibFldFile()]=a.lib,f.push(e)):_.each(a.lib,function(a){var b={};b[c.getFlowLibFldFile()]=
a;f.push(b)})}},e=function(a,b,c){_.each(a.config,function(a,b){b.indexOf("custrecord")===0&&(c[b]=a)});if(a.config.hiddenConfig)c[b.getFlowFldSolutionId()]=a.config.hiddenConfig.flowFldSolutionId,c[b.getFlowFldLicensed()]=a.config.hiddenConfig.flowFldLicensed,delete a.config.hiddenConfig;c[b.getFlowFldIntegration()]=a.config.integration;c[b.getFlowFldUseCase()]=a.config.useCase;c[b.getFlowFldFlowId()]=a.flowId||a.config.flowFldFlowId;c[b.getFlowFldConfig()]=a.configFileId;c[b.getFlowFldConfiguration()]=
Celigo.JSON.stringify(a.config);c.isinactive=a.config.isinactive;if(!c[b.getFlowFldDisabled()])c[b.getFlowFldDisabled()]=a.config.flowFldDisabled;b.getFlowFldEnvironment&&(c[b.getFlowFldEnvironment()]=a.environment||a.config.flowFldEnvironment||$$.getContext().getEnvironment().toUpperCase());if(b.getFlowFldNoCache)c[b.getFlowFldNoCache()]=a.config.flowFldNoCache;if(b.getFlowFldRecordType)c[b.getFlowFldRecordType()]=a.config.flowFldRecordType},f=function(b){var f=b.metadata,g={nlobjRecordType:f.getFlowRecType(),
nlobjFieldIds:{}},h=g.nlobjFieldIds;e(b,f,h);h[f.getFlowFldSchedule()]=b.schedule||b.config.flowFldSchedule;h[f.getFlowFldTimezone()]=b.timezone||b.config.flowFldTimezone;h[f.getFlowFldType()]=b.type;h[f.getFlowFldVersion()]="V2";c(b,g);a.debug("object to save",g);return(new $R(g)).save()},g=function(b){var f=b.metadata,g={nlobjRecordType:f.getFlowRecType(),nlobjFieldIds:{}},h=g.nlobjFieldIds;e(b,f,h);h[f.getFlowFldEventType()]=b.config.flowFldEventType;h[f.getFlowFldExecutionType()]=b.config.flowFldExecutionType;
h[f.getFlowFldExecutionContext()]=b.config.flowFldExecutionContext;h[f.getFlowFldAsync()]=b.async||b.config.async;h[f.getFlowFldRequestedSublists()]=b.config.flowFldRequestedSublists;h[f.getFlowFldQualifier()]=b.config.flowFldQualifier;c(b,g);a.debug("object to save",g);return(new $R(g)).save()},h=function(b){var f=b.metadata,g={nlobjRecordType:f.getFlowRecType(),nlobjFieldIds:{}};e(b,f,g.nlobjFieldIds);c(b,g);a.debug("object to save",g);return(new $R(g)).save()};return{createDataFlowRecord:function(a){if(!a||
!a.configFileId&&!a.config)throw new Celigo.Error({name:"MISSING_ARGS",message:"Please provide data object"});if(!a.config)a.config=JSON.parse($$.loadFile(a.configFileId).getValue());var b;switch(a.config.celigo_classname){case "Celigo.integrator.batch.Export":b=f;a.metadata=Celigo.integrator.batch.DataFlowMetadata;a.type="Export";break;case "Celigo.integrator.batch.Import":b=f;a.metadata=Celigo.integrator.batch.DataFlowMetadata;a.type="Import";break;case "Celigo.integrator.realtime.Export":b=g;a.metadata=
Celigo.integrator.realtime.ExportMetadata;break;case "Celigo.integrator.realtime.Import":b=h;a.metadata=Celigo.integrator.realtime.ImportMetadata;break;default:throw new Celigo.Error({name:"INVALID_DATA_FLOW_TYPE",message:"Please provide type and data object, valid types are: batchExport, batchImport, realtimeExport, realtimeImport"});}return b(a)},getDataFlowByConfigFileId:function(a,b){var c=Celigo.integrator.util.IntegratorUtil.loadFlowConfiguration(a);b&&(c=_.extend(c,b));return Celigo.io.Serializable.revive(JSON.stringify(c),
!1)},getDataFlowByConfigObject:function(a,b){var c=Celigo.integrator.util.IntegratorUtil.loadFlowConfiguration(a);b&&(c=_.extend(c,b));return Celigo.io.Serializable.revive(JSON.stringify(c),!1)},getDataFlowByRecordId:function(c,e,f,g,h){if(!c)throw new Celigo.Error({name:"invalid record id",message:"record id is mandatory"});if(!e||!(e instanceof Celigo.integrator.dataflow.Metadata))throw new Celigo.Error({name:"invalid metadata",message:"metadata needs to be an instance of Celigo.integrator.dataflow.Metadata"});
if(isNaN(+c)){var n=$.search(e.getFlowRecType(),null,[new nlobjSearchFilter(e.getFlowFldFlowId(),null,"is",c)]);if(n&&n.length===1)c=n[0].getId();else throw new Celigo.Error({name:"invalid flow id",message:(n&&n.length>1?"Multiple Data Flow Records found":"Data Flow Record not found")+" in NetSuite for the Flow Id: "+c});}n=$$.loadRecord(e.getFlowRecType(),c);h&&h.call(this,n);var o=!1,q,r=h="";e===Celigo.integrator.batch.DataFlowMetadata?(h="batch",r=n.getFieldText(e.getFlowFldType()).toLowerCase()):
e===Celigo.integrator.realtime.ExportMetadata?(h="realtime",r="export"):e===Celigo.integrator.realtime.ImportMetadata&&(h="realtime",r="import");if((q=e.getFlowFldEnvironment&&e.getFlowFldEnvironment()?n.getFieldTexts(e.getFlowFldEnvironment()):[])&&q.length){for(var p=$$.getContext().getEnvironment().toUpperCase(),w=!1,u=0;u<q.length;u++)if(q[u]&&q[u].toUpperCase()===p){w=!0;break}if(!w)throw new Celigo.Error({name:"invalid environment",message:"Data Flow Record "+c+" should not run in the current environment "+
p});}e.getFlowFldNoCache&&_.isFunction(e.getFlowFldNoCache)&&n.getFieldValue(e.getFlowFldNoCache())==="T"&&(o=!0);for(q=1;q<=n.getLineItemCount("recmach"+e.getFlowLibFldParent());++q){p=n.getLineItemValue("recmach"+e.getFlowLibFldParent(),e.getFlowLibFldFile(),q);if(!p)throw new Celigo.Error({name:"missing flow lib file",message:"lib file on line "+q+" is missing, the file must have been removed from the file cabinet"});w=n.getLineItemText("recmach"+e.getFlowLibFldParent(),e.getFlowLibFldFile(),q);
a.debug("loading lib file ("+p+") "+w);o?$.require(p,0,!0):$.require(p)}var s,p=n.getFieldValue(e.getFlowFldConfiguration()),o={integration:n.getFieldText(e.getFlowFldIntegration()),useCase:n.getFieldText(e.getFlowFldUseCase()),system:n.getFieldValue(e.getFlowFldSystem())==="T"};if(h==="realtime"&&r==="export"&&n.getFieldValue(e.getFlowFldAsync())==="T")o.async=!0;q=n.getFieldValue(e.getFlowFldMuteLogging())==="T";g&&Celigo.util.isPlainObject(g)?s=Celigo.integrator.dataflow.Factory.getDataFlowByConfigObject(g,
o):p?s=Celigo.integrator.dataflow.Factory.getDataFlowByConfigObject(JSON.parse(p),o):(g=n.getFieldValue(e.getFlowFldConfig()),s=Celigo.integrator.dataflow.Factory.getDataFlowByConfigFileId(g,o));s.setInvocationContextByKey(b.dataFlowType,h);s.setInvocationContextByKey(b.dataFlowDirection,r);s.setInvocationContextByKey(b.dataFlowRecordType,e.getFlowRecType());s.setInvocationContextByKey(b.dataFlowRecordId,c);s.setInvocationContextByKey(b.integration,s.getIntegration());s.setInvocationContextByKey(b.useCase,
s.getUseCase());s.setInvocationContextByKey(b.muteLogging,q);s.setInvocationContextByKey(b.lastBranch,!0);f&&Celigo.util.isPlainObject(f)&&_.each(f,function(a,c){b[c]&&s.setInvocationContextByKey(c,a)});if(f&&Celigo.util.isPlainObject(f)&&f.cacheFileId)try{Celigo.integrator.dataflow.Util.loadDataFlowCache(s,f.cacheFileId)}catch(v){throw a.error("failed to load persisted cache file by id "+f.cacheFileId,Celigo.Error.format(v)),$L.error("failed to load persisted cache file by id "+f.cacheFileId+" "+
Celigo.Error.format(v)),v;}return s},getDataFlowByRecordIdErrorOnInactiveOrDisabled:function(a,b,c,e){return Celigo.integrator.dataflow.Factory.getDataFlowByRecordId(a,b,c,e,function(c){if(c.getFieldValue("isinactive")==="T")throw new Celigo.Error({name:"inactive data flow",message:"Data Flow Record "+a+" is inactive"});if(c.getFieldValue(b.getFlowFldDisabled())==="T")throw new Celigo.Error({name:"disabled data flow",message:"Data Flow Record "+a+" is disabled"});})}}}();$.namespace("Celigo.integrator.dataflow");
Celigo.integrator.dataflow.Runner=function(){var a=$.getExecutionLogger("Celigo.integrator.dataflow.Runner"),b=Celigo.integrator.dataflow.Util,c=Celigo.integrator.dataflow.InvocationContext,e=!1,f=-1;return{runDataFlow:function(g){if(!g||!b.isImport(g)&&!b.isExport(g))throw new Celigo.Error({name:"invalid flow instance",message:"null or invalid flow instance"});var h=!1;do{e=!1;++f;a:{var j=g,i=void 0,k=0,l=void 0,m=!0,n=void 0,o=Celigo.suitescript.scheduled.BatchProcess.yield,q=!1;do{++k;if(j.getInvocationContextByKey(c.muteLogging))Celigo.MUTE_DATA_FLOW_FW_LOGGING=
!0;b.isBatch(j)?m=!0:b.isRealtime(j)&&(m=!1);_.isFunction(j.isAllowConcurrency)&&j.isAllowConcurrency()&&(m=!1);try{if(i=b.getFlowName(j),m&&b.isBatch(j)&&(!j.getJobRecordId()||!j.getIntegrationLogId())){if($.getQueueCount()>1)var r=$$.encrypt(i,"sha1").substring(0,10),n=new Celigo.util.Locker("DF_JOB_CHECK_"+r,45E3);else n=void 0;for(var p=0;p<10&&n;){if(n.lock())break;++p;o()}if(b.isLastJobRunning(j)){a.audit("current data flow cannot run because last job is still running");n&&n.unlock();h=void 0;
break a}b.initializeJobRecord(j);n&&n.unlock()}}catch(w){n&&n.unlock();a.error("error checking last job status for data flow "+(i||"no_name")+". "+Celigo.Error.format(w));if(m&&b.isBatch(j)&&j.getJobRecordId()){var u;if(b.isBatchImport(j))u=Celigo.integrator.dataflow.ImportJobRecordMetadata;else if(b.isBatchExport(j))u=Celigo.integrator.dataflow.ExportJobRecordMetadata;try{u&&$$.deleteRecord(u.getJobRecType(),j.getJobRecordId())}catch(s){}}throw w;}j.setInvocationContextByKey(c.dataFlowSequence,k);
j.setInvocationContextByKey(c.runByRunner,Celigo.integrator.dataflow.Runner);k>1&&j.getInvocationContextByKey(c.previousDataFlow)&&_.extend(j.getCache(),j.getInvocationContextByKey(c.previousDataFlow).getCache());try{a.audit("data flow starts",i,!0),q=j.run(),a.audit("data flow finishes",i,!0)}catch(v){if(typeof j.shouldContinueToNextFlowOnFailure==="function"&&j.shouldContinueToNextFlowOnFailure())a.audit("data flow has error but configured to continue on failure",i,!0);else throw v;}try{if(l=j,
(j=j.getNextDataFlow())&&j instanceof Celigo.integrator.model.DataFlowReference){if(!j.getDataFlowId()&&!j.getDataFlowInternalId())throw new Celigo.Error({name:"MISSING_REQUIRED_PARAM",message:"Either data flow id or internal id is required in next data flow reference"});j.isScheduleNewRunnerDeployment();b.scheduleBatchDataFlowById(j.getDataFlowId()||j.getDataFlowInternalId());break}else j&&(b.isImport(j)||b.isExport(j))?j.setInvocationContextByKey(c.previousDataFlow,l):(j&&a.audit("Invalid next data flow instance to run."),
j=null),l=null}catch(t){a.error("Exception occurred when getting next data flow: "+Celigo.Error.format(t)),l=j=null}Celigo.MUTE_DATA_FLOW_FW_LOGGING=!1}while(j&&k<100);h=k<=1?q:void 0}}while(e&&f<=10);return h},setRepeat:function(a){e=!!a}}}();$.namespace("Celigo.integrator.batch");Celigo.integrator.batch.DataFlowMetadata=new Celigo.integrator.dataflow.Metadata({flowRecType:"customrecord_celigo_batch_data_flow",flowFldIntegration:"custrecord_celigo_batch_data_flow_integr",flowFldUseCase:"custrecord_celigo_batch_data_flow_usecas",
flowFldSchedule:"custrecord_celigo_batch_data_flow_sch",flowFldTimezone:"custrecord_celigo_batch_data_flow_tz",flowFldEnvironment:"custrecord_celigo_batch_data_flow_env",flowFldQueues:"custrecord_celigo_batch_data_flow_queues",flowFldType:"custrecord_celigo_batch_data_flow_type",flowFldConfig:"custrecord_celigo_batch_data_flow_config",flowFldConfiguration:"custrecord_celigo_batch_data_flow_conf",flowFldFlowId:"custrecord_celigo_batch_data_flow_flowid",flowFldVersion:"custrecord_celigo_batch_data_flow_versio",
flowLibRecType:"customrecord_celligo_batch_data_flow_lib",flowLibFldParent:"custrecord_celigo_batch_data_flow_libpar",flowLibFldFile:"custrecord_celigo_batch_data_flowlibfile",flowSchedulerScriptId:"customscript_celigo_batch_data_flow_sch",flowRunnerScriptId:"customscript_celigo_batch_data_flow_run",flowRunnerConfigParamId:"custscript_celigo_batch_data_flow_param",flowFldLicensed:"custrecord_celigo_batch_data_flow_lic",flowFldSolutionId:"custrecord_celigo_batch_data_flow_sid",flowFldRecordType:"custrecord_celigo_batch_data_flow_record",
flowFldSystem:"custrecord_celigo_batch_data_flow_system",flowFldMuteLogging:"custrecord_celigo_mute_fw_logging",flowFldDisabled:"custrecord_celigo_batch_data_flow_disabl",flowFldIntegratorIOFlowId:"custrecord_celigo_iio_rt_flow_id"});$.namespace("Celigo.integrator.batch");Celigo.integrator.batch.Import=function(a){this._super(a);this.eventDispatcher=Celigo.event.dispatcher.integrator.batch.ImportDispatcher;var b=this,c=Celigo.integrator.dataflow.InvocationContext,e=Celigo.integrator.dataflow.Util,
f=!1;if(!_.isBoolean(a.allowConcurrency))a.allowConcurrency=$.getQueueCount()===1?!1:!0;this.getEventDispatcher=function(){return this.eventDispatcher};this.getProductName=function(){return a.productName||"Integrator (Custom Integration)"};this.getExecutionLogger=function(){if(!this.executionLogger)this.executionLogger=$.getExecutionLogger(this.getClassName());return this.executionLogger};this.getUtil=function(){return e};this.getIntegration=function(){return a.integration};this.getUseCase=function(){return a.useCase};
this.getRequestMapper=function(){return a.requestMapper};this.getResponseMapper=function(){return a.responseMapper};this.setResponseMapper=function(b){a.responseMapper=b};this.setConnector=function(b){a.connector=b};this.getConnector=function(){return a.connector};this.getRequestMappingRef=function(){return a.requestMappingRef};this.getResponseMappingRef=function(){return a.responseMappingRef};this.getCache=function(){if(!a.cache)a.cache={};return a.cache};this.setCache=function(b){a.cache=b};this.isKeepResponseMessageAfterMappingToRecords=
function(){return a.keepResponseMessageAfterMappingToRecords||!1};this.setKeepResponseMessageAfterMappingToRecords=function(b){a.keepResponseMessageAfterMappingToRecords=b};this.setInvocationContext=function(a){this.invocationContext=a};this.getInvocationContext=function(){if(!this.invocationContext)this.invocationContext={};return this.invocationContext};this.setInvocationContextByKey=function(a,b){if(!this.invocationContext)this.invocationContext={};this.invocationContext[a]=b};this.getInvocationContextByKey=
function(a){return!this.invocationContext?void 0:this.invocationContext[a]};this.state={successCount:0,isBatchProcessState:!0,status:null};this.publicState={reserved:{}};this.getErrors=function(){return this.getErrorCache().RESPONSE};this.getSuccessedProcessObjectsCount=function(){return this.state.successCount};this.getErrorCount=function(){var a=this.getErrorCache().RESPONSE;return a&&a.length?a.length:0};this.getRequestCollection=function(){return this.requestCollection};this.setRequestCollection=
function(a){this.requestCollection=a};this.getRequestDocument=function(){return this.requestDocument};this.setRequestDocument=function(a){this.requestDocument=a};this.getResponseMappingResult=function(){return this.responseMappingResult};this.setResponseMappingResult=function(a){this.getUtil().validateResponseMappingResult(a);this.responseMappingResult=a};this.getResponseCollection=function(){return this.responseCollection};this.setResponseCollection=function(a){this.responseCollection=a};this.getNextDataFlow=
function(){return this.nextDataFlow||a.nextDataFlow};this.setNextDataFlow=function(a){this.nextDataFlow=a};this.getNextObject=function(){var a=this.getResponseCollection().getProcessedCount(),b=this.getResponseCollection().getOriginalSize();if(a<b){try{$$.getContext().setPercentComplete(Math.round(a/b*1E4)/100)}catch(c){Celigo.Error.convert(c)}return this.getResponseCollection().getNextObject()}return null};this.getCurrentObject=function(){return this.currentObject};this.setCurrentObject=function(a){if(a){var b=
this.getResponseCollection().getCurrentObjectIndex();if(b>-1)this.getResponseCollection().setElementData(b,a),this.currentObject=this.getResponseCollection().getCurrentObject();else throw new Celigo.Error({message:"invalid index "+b});}else this.currentObject=null,this.getResponseCollection().removeLastObject()};this.getMessage=function(){return this.message};this.setMessage=function(a){this.message=a};this.getJobRecordId=function(){return this.state.jobRecordId};this.setJobRecordId=function(a){this.state.jobRecordId=
a;this.publicState.reserved.statusLoggerID=a};this.getIntegrationLogId=function(){return this.state.integrationLogRecId};this.setIntegrationLogId=function(a){this.state.integrationLogRecId=a};this.getReportId=function(){return this.getInvocationContextByKey("reportId")};this.isAsyncResponseImportFlow=function(){if(_.isUndefined(this.isAsyncResponseImportFlow._isAsyncFlow))this.isAsyncResponseImportFlow._isAsyncFlow=!!this.getReportId();return this.isAsyncResponseImportFlow._isAsyncFlow};this.getJobStatusLoggerType=
function(){return b.isAsyncResponseImportFlow()?"export":"import"};this.repeat=function(){this.getInvocationContextByKey("runByRunner")&&this.getInvocationContextByKey("runByRunner")===Celigo.integrator.dataflow.Runner&&Celigo.integrator.dataflow.Runner.setRepeat(!0)};this.fork=function(){var a=this.getInvocationContextByKey(c.previousDataFlow);if(!a||!e.isImport(a)){+this.getInvocationContextByKey(c.invokedDepth)>100&&(e.trimInvocationHistory(this.getInvocationContextByKey(c.invokedByDataFlow),c.invokedByDataFlow,
100),this.getExecutionLogger().audit("discarded old invocation history"));var a=this.getUtil().persistDataFlowCache(this),b={cacheFileId:a};this.getExecutionLogger().audit(b);try{e.scheduleBatchDataFlowByInstance(this,b||void 0)}catch(f){this.getExecutionLogger().error("failed to fork...",f.message);try{$$.deleteFile(a)}catch(i){}throw f;}}};this.getErrorCache=function(){if(!this.errorCache)this.errorCache={};return this.errorCache};this.cacheError=function(a,b){if(a){var b=b?String(b):"OTHER",c=
this.getErrorCache();c[b]||(c[b]=[]);c[b].push(a)}};this.setErrorFileId=function(a){this.errorFileId=a};this.getErrorFileId=function(){return this.errorFileId};this.getErrorFolder=function(){return a.errorFolder};this.setErrorFolder=function(b){a.errorFolder=b};this.getBackupFolder=function(){return a.backupFolder};this.setBackupFolder=function(b){a.backupFolder=b};this.getAttachmentFolder=function(){return a.attachmentFolder};this.setAttachmentFolder=function(b){a.attachmentFolder=b};this.isAllowConcurrency=
function(){return a.allowConcurrency};this.setAllowConcurrency=function(b){a.allowConcurrency=!!b};this.isForkAutomatically=function(){return a.forkAutomatically===!1?!1:!0};this.setForkAutomatically=function(b){a.forkAutomatically=!!b};this.isLeaveFileOnServer=function(){return a.leaveFileOnServer===!0?!0:!1};this.setLeaveFileOnServer=function(b){a.leaveFileOnServer=!!b};this.getAcknowledgmentMapper=function(){return a.acknowledgmentMapper};this.setAcknowledgmentMapper=function(b){a.acknowledgmentMapper=
b};this.getAcknowledgmentMappingRef=function(){return a.acknowledgmentMappingRef};this.setAcknowledgmentMappingRef=function(b){a.acknowledgmentMappingRef=b};this.getPreAcknowledgmentMappingRef=function(){return a.preAcknowledgmentMappingRef};this.setPreAcknowledgmentMappingRef=function(b){a.preAcknowledgmentMappingRef=b};this.getAcknowledgmentConnector=function(){return a.acknowledgmentConnector};this.setAcknowledgmentConnector=function(b){a.acknowledgmentConnector=b};this.getAcknowledgmentError=
function(){return this.ackError};this.setAcknowledgmentError=function(a){this.ackError=a};this.hasPreAcknowledgment=function(){return this.getAcknowledgmentConnector()&&this.getAcknowledgmentMapper()&&this.getPreAcknowledgmentMappingRef()};this.hasAcknowledgment=function(){return this.getAcknowledgmentConnector()&&this.getAcknowledgmentMapper()&&this.getAcknowledgmentMappingRef()};this.getIntegrationName=this.getIntegration;this.getUseCaseName=this.getUseCase;this.getRawObjects=this.getRawMessage=
this.getMessage;this.setRawObjects=this.setRawMessage=this.setMessage;this.getCollection=this.getResponseCollection;this.setCollection=this.setResponseCollection;this.createAdditionalSplunkLogs=function(){try{var a=[];this.getProductName()&&a.push('productName="'+this.getProductName()+'"');var b=this.getResponseMapper();b&&a.push(', responseMapper="'+b.getClassName()+'"');var c=this.getResponseMappingRef();if(c){a.push(', responseMappingRef="'+c.getClassName()+'"');var e=c.getRecordMappings();a.push(", responseMappingRefRecordMappingsCount="+
e.length);if(e.length>0)for(b=0;b<e.length;b++){var f=e[0];f.getRecordType()&&a.push(", responseMappingRefRecordMappingRecordType"+b+"="+f.getRecordType())}}var l=c.getUiProperties();l&&(l.generatedFromUI&&a.push(", responseMappingRefUiPropertiesGeneratedFromUI="+l.generatedFromUI),l.mapper&&a.push(", responseMappingRefUiPropertiesMapper="+l.mapper));var m=this.getConnector();m&&a.push(', connector="'+m.getClassName()+'"');var n=this.getGeneratedFromUI();n&&a.push(", generatedFromUI="+n);var o=this.getUiProperties();
o&&(a.push(", uiPropertiesFrequency="+o.frequency),a.push(', uiPropertiesUi_mapping="'+o.ui_mapping+'"'));return a.join("")}catch(q){return a=Celigo.Error.convert(q),'createAdditionalSplunkLogsErrorCode="'+a.getCode()+'", createAdditionalSplunkLogsErrorDetails="'+a.getDetails()+'"'}};this.mapToAck=function(a,b){var c=this.getAcknowledgmentMapper().mapToExternal(a,b);c&&c instanceof Celigo.integrator.mapping.model.MapToExternalResult&&c.getMappingErrors()&&c.getMappingErrors().length&&_.each(c.getMappingErrors(),
function(a){this.cacheError(a,"RESPONSE")});return c.getDocument()};this.doTrailingFork=function(){if(f){f=!1;this.getExecutionLogger().audit("trailing fork");try{this.fork()}catch(a){$L.error(Celigo.Error.format(new Celigo.Error({name:"ERROR_FORK_BATCH_IMPORT_DATA_FLOW",message:"there are more data to be processed but the data flow fails to schedule a new instance. The data will be processed at a later time. However, if problem persists, please contact Celigo Support",cause:a})),this.getIntegrationLogId(),
this.getIntegration(),null,null,this.getUseCase())}}};this.start=function(){e.mergeOperationMappings(a.operationMappings,this.getResponseMappingRef());var g=!1,h=!1,j=null;_.isUndefined(this.getInvocationContextByKey(c.initImportWithFile))||(g=!!this.getInvocationContextByKey(c.initImportWithFile));_.isUndefined(this.getInvocationContextByKey(c.resumeImportFromCallback))||(h=!!this.getInvocationContextByKey(c.resumeImportFromCallback));if(g||h){if(!this.getJobRecordId()||!this.getIntegrationLogId()){this.getExecutionLogger().error("cannot resume or init with file without job record set");
return}this.getInvocationContextByKey(c.importFileId)&&this.getUtil().attachImportFileToJobRecord(this,this.getInvocationContextByKey(c.importFileId));j=this.getUtil().getImportFileFromJobRecord(this);if(!j){this.getExecutionLogger().error("cannot resume or init with file without file attached to job");this.getUtil().failJobRecord(this);return}}this.getExecutionLogger().debug("initializing job records...");this.getUtil().initializeJobRecord(this);this.isAsyncResponseImportFlow()?this.getUtil().initializeHandlingResponseJob(this):
this.getUtil().startJobRecord(this);this.getExecutionLogger().debug("done initializing job records");try{if(!g&&!h){var i=this.getInvocationContextByKey(c.invokedByDataFlow);this.setInvocationContextByKey(c.pageIndex,(i&&i.pageIndex?i.pageIndex:0)+1);this.getEventDispatcher().emit("BATCH_IMPORT:INIT",this);this.state.status=Celigo.integrator.dataflow.Status.INPROGRESS;this.getEventDispatcher().emit("BATCH_IMPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_MESSAGE",this);if(this.getRequestMapper()){var k=this.getRequestMappingRef();
mappingInput=this.getRequestCollection();var l=this.getRequestMapper().mapToExternal(mappingInput,k);l&&l instanceof Celigo.integrator.mapping.model.MapToExternalResult&&l.getMappingErrors()&&l.getMappingErrors().length&&_.each(l.getMappingErrors(),function(a){this.cacheError(a,"REQUEST")});this.setRequestDocument(l.getDocument())}else this.getEventDispatcher().emit("BATCH_IMPORT:EMPTY_REQUEST_MAPPER",this);this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_MAP_COLLECTION_TO_REQUEST_MESSAGE",this);
var m=new Celigo.integrator.connectors.model.Message({data:this.getRequestDocument()});this.getEventDispatcher().emit("BATCH_IMPORT:BEFORE_RECEIVE_MESSAGE",this,m);try{if(this.getUtil().isValidConnectorMethod(this.getConnector())){try{this.isLeaveFileOnServer()&&_.isFunction(this.getConnector().setLeaveFileOnServer)&&this.getConnector().setLeaveFileOnServer(!0)}catch(n){this.getExecutionLogger().error("fail to propagate configs to connector",Celigo.Error.format(n))}var g=void 0,o=this.getUtil().getFlowName(this);
try{if($.getQueueCount()>1)var q=$$.encrypt(o,"sha1").substring(0,10),g=new Celigo.util.Locker("DF_CONNECTOR_FIRE_"+q,6E5);if(g&&!g.lockOrYield())throw $$.createError("CELIGO_UNABLE_TO_OBTAIN_LOCK","Two or more instances of the same Import flow are attempting to call the connector at the same time. We can only let one of them execute.");this.isAsyncResponseImportFlow()&&this.getConnector().setReportId.call(this.getConnector(),this.getReportId());this.message=this.getConnector().fire.call(this.getConnector(),
m,this);g&&g.unlock()}catch(r){throw g&&g.unlock(),r;}}else this.getEventDispatcher().emit("BATCH_IMPORT:EMPTY_CONNECTOR",this,m)}catch(p){if(p.name!=="CELIGO_REQUEST_TIME_OUT_PENDING")throw p;this.getUtil().initializeInactivePendingJobRecord(this);this.state.status=Celigo.integrator.dataflow.Status.PENDING;this.getEventDispatcher().emit("BATCH_IMPORT:BEFORE_PENDING_CONNECTOR_CALLBACK",this);return}}else if(g&&!h)this.getEventDispatcher().emit("BATCH_IMPORT:INIT_WITH_FILE",this,j),this.setMessage(new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:$$.loadFile(j).getValue()})}));
else if(h&&!g)this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_RECEIVE_CONNECTOR_CALLBACK",this,j),this.setMessage(new Celigo.integrator.connectors.model.Message({data:new Celigo.integrator.model.Document({content:$$.loadFile(j).getValue()})}));else{this.getExecutionLogger().error("cannot resume and init with file at the same time, check invocation context");this.getUtil().failJobRecord(this);return}this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_RECEIVE_MESSAGE",this,this.getMessage());this.getExecutionLogger().audit('checking if connector returns "hasMore"');
if(this.getMessage()&&(this.getMessage().isLastPart()===!1&&(this.getMessage().setHasMore(!0),this.setInvocationContextByKey(c.pageIndex,this.getMessage().getPartNumber())),this.getMessage().hasMore()&&this.isForkAutomatically()))if(this.isAllowConcurrency()){this.getExecutionLogger().audit("concurrent fork");try{this.fork()}catch(w){this.getExecutionLogger().error("concurrent fork failed, retry trailing fork"),f=!0}}else this.getExecutionLogger().audit("trailing fork"),f=!0;if(!this.getMessage()||
!this.getMessage().getData()||!this.getMessage().getData().toString()){this.getExecutionLogger().audit("No objects received.");if(this.isAsyncResponseImportFlow())if(this.getExecutionLogger().audit("Failed to fetch response."),this.getExecutionLogger().debug("timesRan",this.getInvocationContextByKey("timesRan")),this.getInvocationContextByKey("timesRan")>=6){this.state.successCount=0;this.getUtil().failJobRecord(this,"Failed to get export status");return}else this.state.status=Celigo.integrator.dataflow.Status.PENDING_RESPONSE;
else this.state.status=Celigo.integrator.dataflow.Status.COMPLETED;this.getUtil().finalizeJobRecord(this);this.doTrailingFork();return}}catch(u){this.state.status=Celigo.integrator.dataflow.Status.FAILED,this.getExecutionLogger().error("flow failed during REQUEST processing stage",Celigo.Error.format(u)),this.cacheError(u,"REQUEST")}try{this.getUtil().validateNonEmptyDocumentInMessage(this.getMessage());this.isAsyncResponseImportFlow()||(this.getExecutionLogger().debug("attaching message file to job record..."),
this.getUtil().attachImportFileToJobRecord(this),this.getExecutionLogger().debug("done attaching message file to job record"));this.getEventDispatcher().emit("BATCH_IMPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS",this,this.getMessage().getData());if(this.getResponseMapper()){this.setResponseMappingResult(this.getResponseMapper().mapToNetSuite(this.getMessage().getData(),this.getResponseMappingRef()));var s=this.getResponseMappingResult();s&&s instanceof Celigo.integrator.mapping.model.MapToNetSuiteResult&&
s.getMappingErrors()&&s.getMappingErrors().length&&_.each(s.getMappingErrors(),function(a){b.cacheError(a,"RESPONSE")})}else this.getEventDispatcher().emit("BATCH_IMPORT:EMPTY_RESPONSE_MAPPER",this,this.getMessage().getData());this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS",this,this.getResponseMappingResult(),this.getMessage().getData());this.isKeepResponseMessageAfterMappingToRecords()||this.setMessage(null);this.setResponseCollection(this.getResponseMappingResult().getJsObjects());
this.getExecutionLogger().debug("records to import",this.getResponseCollection());if(!this.getResponseCollection()){this.getExecutionLogger().audit("No records to import.");this.state.status=Celigo.integrator.dataflow.Status.COMPLETED;this.getUtil().finalizeJobRecord(this);return}if(!this.getResponseCollection()instanceof Celigo.oop.Collection)throw new Celigo.Error({message:"objects are not a Collection"});var v,t,y,x,B;if(this.hasPreAcknowledgment())if(this.getResponseCollection().reset(),v=this.getUtil().makeAckCollectionFromResponseCollection(this.getResponseCollection()),
this.getExecutionLogger().audit("pre acknowledgments",v),t=this.mapToAck(v,this.getPreAcknowledgmentMappingRef()),!t||!(t instanceof Celigo.integrator.model.Document)||!t.getContent())this.getExecutionLogger().audit("empty acknowledgment document, no acknowledgment sent.");else{x=new Celigo.integrator.connectors.model.Message({data:t});y=this.getAcknowledgmentConnector();if(!this.getUtil().isValidConnectorMethod(y))throw new Celigo.Error({name:"PRE_ACKNOWLEDGMENT_ERROR",message:"missing or invalid acknowledgment connector"});
B=y.fire.call(y,x,this);this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_RECEIVE_PRE_ACK_MESSAGE",this,B,t,v);if(this.getAcknowledgmentError())throw new Celigo.Error({name:"ACKNOWLEDGMENT_ERROR",message:this.getAcknowledgmentError().message});}else this.getExecutionLogger().audit("No pre acknowledgment expected.");!this.getResponseCollection()||!this.getResponseCollection().getSize()?this.currentObject=null:(this.getResponseCollection().reset(),this.currentObject=this.getNextObject());for(var A,
m=[],o={error:!1};this.currentObject;){try{this.getEventDispatcher().emit("BATCH_IMPORT:PROCESS_EACH_RECORD_CONFIG",this,this.currentObject);if(!this.currentObject){this.getExecutionLogger("audit","current record config is discarded");this.currentObject=this.getNextObject();continue}try{e.validateImportOperationForRecordConfig(a.operationMappings,this.currentObject)}catch(z){if(z.getCode&&z.getCode()==="CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT"){this.getExecutionLogger("audit","current record config is discarded due to CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT");
this.setCurrentObject(null);this.currentObject=this.getNextObject();continue}else throw z;}try{A=new $R(this.currentObject)}catch(E){throw this.getExecutionLogger().error("failed to convert record config to record"+Celigo.Error.format(E)),E;}if(this.isAsyncResponseImportFlow())o.error=!1,this.getEventDispatcher().emit("BATCH_IMPORT:HANDLE_EXPORT_RESPONSE",this,A,o);else{this.getEventDispatcher().emit("BATCH_IMPORT:BEFORE_SUBMIT_EACH_RECORD",this,A);if(!this.currentObject){this.getExecutionLogger("audit",
"current record config is discarded");this.currentObject=this.getNextObject();continue}var C=A.save();this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_SUBMIT_EACH_RECORD",this,A,C,this.currentObject);this.state.successCount+=1}A=null;this.getExecutionLogger().audit("successfully processed object");this.currentObject.nssuccess=!0;o.error&&(this.state.successCount-=1,this.cacheError(o.message,"RESPONSE"));this.currentObject.id=C;this.currentObject.errorMessage=""}catch(F){if(this.currentObject){this.currentObject.nssuccess=
!1;this.currentObject.errorMessage="[NetSuite Import Error]"+F.message;F=new Celigo.lang.RecordError({error:F});F.setDocumentIndex(this.currentObject.documentIndex);this.currentObject.allIndex&&F.setAllIndex(this.currentObject.allIndex);s=q=null;if(A)q=A.getRecordType(),s=A.getId();else if(this.currentObject)q=this.currentObject.nlobjRecordType,s=this.currentObject.id;F.setRecordType(q);F.setRecordId(s);if(!s&&this.currentObject&&this.currentObject.nlobjFieldIds){var I=this.currentObject.nlobjTransformId||
this.currentObject.nlobjFieldIds.celigo_nlobjTransformId,L=this.currentObject.nlobjTransformType||this.currentObject.nlobjFieldIds.celigo_nlobjTransformType;L&&I&&(F.setRecordType(L),F.setRecordId(I))}F.setExternalId(this.currentObject.externalId)}try{this.getEventDispatcher().emit("BATCH_IMPORT:ON_EACH_RECORD_ERROR",this,F,this.currentObject,A,C)}catch(M){this.getExecutionLogger().error('unhandled error in "ON_EACH_RECORD_ERROR"',Celigo.Error.format(M))}this.getExecutionLogger().error("error processing object",
Celigo.Error.format(F));this.cacheError(F,"RESPONSE");m.push(this.currentObject);this.currentObject&&this.getResponseCollection().removeLastObject()}this.currentObject=this.getNextObject()}if(!this.hasAcknowledgment()||!this.getResponseCollection()||!this.getResponseCollection().getSize()&&!m.length)this.getExecutionLogger().audit("No acknowledgment expected.");else if(this.getResponseCollection().reset(),v=this.getUtil().makeAckCollectionFromResponseCollection(this.getResponseCollection(),m),t=this.mapToAck(v,
this.getAcknowledgmentMappingRef()),!t||!(t instanceof Celigo.integrator.model.Document)||!t.getContent())this.getExecutionLogger().audit("empty acknowledgment document, no acknowledgment sent.");else if(x=new Celigo.integrator.connectors.model.Message({data:t}),this.getEventDispatcher().emit("BATCH_IMPORT:BEFORE_SEND_ACK_MESSAGE",this,x,t,v),this.getAcknowledgmentConnector()!==null){y=this.getAcknowledgmentConnector();if(!this.getUtil().isValidConnectorMethod(y))throw new Celigo.Error({name:"ACKNOWLEDGMENT_ERROR",
message:"missing or invalid acknowledgment connector"});B=y.fire.call(y,x,this);this.getEventDispatcher().emit("BATCH_IMPORT:AFTER_RECEIVE_ACK_MESSAGE",this,B,t,v);if(this.getAcknowledgmentError())throw new Celigo.Error({name:"ACKNOWLEDGMENT_ERROR",message:this.getAcknowledgmentError().message});}else this.getExecutionLogger().audit("acknowledge connector unset, no acknowledgment sent.");this.state.status=Celigo.integrator.dataflow.Status.COMPLETED}catch(J){this.state.status=Celigo.integrator.dataflow.Status.FAILED,
this.getExecutionLogger().error("flow failed during RESPONSE processing stage",Celigo.Error.format(J)),this.cacheError(J,"RESPONSE")}v=this.getErrorCache();t=["REQUEST","RESPONSE","OTHER"];for(y=0;y<t.length;y++)x=t[y],v&&v[x]&&v[x].length&&this.getUtil().logErrorArrayOnJobRecord(this,v[x]);try{if(v&&v.RESPONSE&&v.RESPONSE.length){var G=this.getUtil().convertErrorArrayToLiterals(this,v.RESPONSE);this.getExecutionLogger().audit(G.length+" errors to map to file",G);if(G.length&&this.getResponseMapper())if(j=
this.getUtil().getImportFileFromJobRecord(this)){var H=this.getResponseMapper().mapToErrorFile(new Celigo.integrator.model.Document({content:$$.loadFile(j).getValue()}),this.getResponseMappingRef(),G,!0);if(H){var K;(K=this.getErrorFolder())||(K=this.getUtil().getCeligoRootFolderId());if(K){H.setFolder(K);var D=$$.submitFile(H);this.setErrorFileId(D);this.getExecutionLogger().audit("error file saved",D)}}}else this.getExecutionLogger().audit("no back up file is attached to the job, error mapping will not be executed.")}}catch(P){this.state.status=
Celigo.integrator.dataflow.Status.COMPLETEDWITHERROR,j="failed to map and persist error file "+Celigo.Error.format(P),this.getExecutionLogger().error(j),$L.error(j,this.getIntegrationLogId(),this.getIntegration(),null,null,this.getUseCase())}this.getExecutionLogger().audit("ending flow status",this.state.status);if(this.state.status!==Celigo.integrator.dataflow.Status.PENDING&&this.state.status!==Celigo.integrator.dataflow.Status.INPROGRESS){try{this.getEventDispatcher().emit("BATCH_IMPORT:COMPLETE",
this)}catch(N){j="error in BATCH_IMPORT:COMPLETE event handler "+Celigo.Error.format(N),this.state.status=Celigo.integrator.dataflow.Status.FAILED,this.getExecutionLogger().error(j),$L.error(j,this.getIntegrationLogId(),this.getIntegration(),null,null,this.getUseCase())}b.getJobStatusLoggerInstance().setAdditionalSplunkLogs(b.createAdditionalSplunkLogs());this.state.status===Celigo.integrator.dataflow.Status.FAILED?this.getUtil().failJobRecord(this):(this.getExecutionLogger().audit("Total success counts",
this.getSuccessedProcessObjectsCount()),this.getExecutionLogger().audit("Total error counts",this.getErrorCount()),this.state.status=this.getErrorCount()>0?Celigo.integrator.dataflow.Status.COMPLETEDWITHERROR:Celigo.integrator.dataflow.Status.COMPLETED,this.getUtil().finalizeJobRecord(this),this.doTrailingFork())}}};Celigo.integrator.batch.Import.extend(Celigo.suitescript.scheduled.LoggingBatchProcess);Celigo.integrator.batch.Import.implement(Celigo.integrator.IDataFlow);Celigo.integrator.batch.Import.className=
"Celigo.integrator.batch.Import";Celigo.integrator.batch.Import.__events__={"BATCH_IMPORT:INIT":"BATCH_IMPORT:INIT","BATCH_IMPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_MESSAGE":"BATCH_IMPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_MESSAGE","BATCH_IMPORT:EMPTY_REQUEST_MAPPER":"BATCH_IMPORT:EMPTY_REQUEST_MAPPER","BATCH_IMPORT:AFTER_MAP_COLLECTION_TO_REQUEST_MESSAGE":"BATCH_IMPORT:AFTER_MAP_COLLECTION_TO_REQUEST_MESSAGE","BATCH_IMPORT:BEFORE_RECEIVE_MESSAGE":"BATCH_IMPORT:BEFORE_RECEIVE_MESSAGE","BATCH_IMPORT:EMPTY_CONNECTOR":"BATCH_IMPORT:EMPTY_CONNECTOR",
"BATCH_IMPORT:BEFORE_PENDING_CONNECTOR_CALLBACK":"BATCH_IMPORT:BEFORE_PENDING_CONNECTOR_CALLBACK","BATCH_IMPORT:AFTER_RECEIVE_CONNECTOR_CALLBACK":"BATCH_IMPORT:AFTER_RECEIVE_CONNECTOR_CALLBACK","BATCH_IMPORT:INIT_WITH_FILE":"BATCH_IMPORT:INIT_WITH_FILE","BATCH_IMPORT:AFTER_RECEIVE_MESSAGE":"BATCH_IMPORT:AFTER_RECEIVE_MESSAGE","BATCH_IMPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS":"BATCH_IMPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS","BATCH_IMPORT:EMPTY_RESPONSE_MAPPER":"BATCH_IMPORT:EMPTY_RESPONSE_MAPPER",
"BATCH_IMPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS":"BATCH_IMPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS","BATCH_IMPORT:PROCESS_EACH_RECORD_CONFIG":"BATCH_IMPORT:PROCESS_EACH_RECORD_CONFIG","BATCH_IMPORT:BEFORE_SUBMIT_EACH_RECORD":"BATCH_IMPORT:BEFORE_SUBMIT_EACH_RECORD","BATCH_IMPORT:AFTER_SUBMIT_EACH_RECORD":"BATCH_IMPORT:AFTER_SUBMIT_EACH_RECORD","BATCH_IMPORT:ON_EACH_RECORD_ERROR":"BATCH_IMPORT:ON_EACH_RECORD_ERROR","BATCH_IMPORT:COMPLETE":"BATCH_IMPORT:COMPLETE","BATCH_IMPORT:AFTER_RECEIVE_PRE_ACK_MESSAGE":"BATCH_IMPORT:AFTER_RECEIVE_PRE_ACK_MESSAGE",
"BATCH_IMPORT:BEFORE_SEND_ACK_MESSAGE":"BATCH_IMPORT:BEFORE_SEND_ACK_MESSAGE","BATCH_IMPORT:AFTER_RECEIVE_ACK_MESSAGE":"BATCH_IMPORT:AFTER_RECEIVE_ACK_MESSAGE","BATCH_IMPORT:HANDLE_EXPORT_RESPONSE":"BATCH_IMPORT:HANDLE_EXPORT_RESPONSE",error:null};Celigo.util.namespace("Celigo.integrator.batch.netsuite");Celigo.integrator.batch.Export=function(a){a.shouldBehaveAsInScheduledScript=!0;Celigo.BatchProcess.staticState.reserved["Celigo.integrator.batch.netsuite.Export"]=null;Celigo.integrator.batch.Export.superclass.constructor.call(this,
a);var b=this,c=0,e=0,f=null,g=null,h=null,j=null,i=null,k={},l=function(a,c){if(b.getSavedSearches()&&b.getSavedSearches().length===1)return[b.getSavedSearches()[0].getSearchId()];if(!i.getSavedSearchIdsByRecordTypeAndId){i.getSavedSearchIdsByRecordTypeAndId={};var e=b.getCollection();e.each(function(){var a=e.getCurrentObjectIndex(),b=a[0],a=a[1];i.getSavedSearchIdsByRecordTypeAndId[a]||(i.getSavedSearchIdsByRecordTypeAndId[a]=[]);i.getSavedSearchIdsByRecordTypeAndId[a].push(b)})}return i.getSavedSearchIdsByRecordTypeAndId[a+
"_"+c]},m=function(a,c,e){var f=null;if(c){var g=b.getSavedSearches();if(g&&g.length===1){if(!i.singleSearchInternalIdCache){i.singleSearchInternalIdCache={};var h=g[0].getSearchId(),g=b.getCollection().getData(),g=g[h],j;for(j in g){var k=j.replace(/.*_/i,"");i.singleSearchInternalIdCache[k]=g[j].data}}if(i.singleSearchInternalIdCache[String(c)])f||(f={}),f[h]=i.singleSearchInternalIdCache[String(c)],e.nlobjRecordType=f[h][0].recordType}else(e=l(a,c))&&_.each(e,function(e){var g=b.getCollection().getElementData([e,
a+"_"+c]);g&&(f||(f={}),f[e]=g)})}return f},n=function(a,c,e,f,g){a=new Celigo.lang.NetSuiteError({error:a});c="Error Code: "+a.getCode()+" ("+c+") | Error Message: "+a.getDetails();g&&(c=c+" | "+g);try{$L.error(c,b.publicState.reserved.integrationLoggerID,b.getIntegrationName(),e,f,b.getUseCaseName(),a.getHelpLink())}catch(h){$$.logExecution("ERROR","Could not create error log for recordType "+e+" and recordId "+f,"now trying to create without linking to record"),$L.error(c+"("+e+" - "+f+")",b.publicState.reserved.integrationLoggerID,
b.getIntegrationName(),null,null,b.getUseCaseName(),a.getHelpLink())}$$.logExecution("ERROR","Export - error",c+" | Stack Trace: "+a.getStackTrace())};this.increaseErrorCount=function(a){c+=a||1};this.setCurrentSearchResultSubset=function(a){if(a){var b=this.getCollection().getCurrentObjectIndex();if(b.length>0)this.getCollection().setElementData(b,a);else throw new Celigo.Error({message:"invalid index "+b});}else this.getCollection().removeLastObject()};this.getProductName=function(){return a.productName||
"Integrator (Custom Integration)"};this.getIntegration=function(){return a.integration};this.getUseCase=function(){return a.useCase};this.getSavedSearches=function(){return a.savedSearches};this.setSavedSearches=function(b){a.savedSearches=b};this.getRequestMapper=function(){return a.requestMapper};this.getRequestMappingRef=function(){return a.requestMappingRef};this.setConnector=function(b){a.connector=b};this.getConnector=function(){return a.connector};this.getResponseMapper=function(){return a.responseMapper};
this.getResponseMappingRef=function(){return a.responseMappingRef};this.getFileName=function(){return a.fileName};this.getFileExtension=function(){return a.fileExtension};this.getIterationCount=function(){return this.getPageSize()?this.getPageSize()+1:2E3};this.getPageSize=function(){this.validateConfigType("pageSize","number",!1,!0);return a.pageSize||2E3};this.getMaxResults=function(){this.validateConfigType("maxResults","number",!1,!0);return a.maxResults||0};this.getRecordCountToBeProcessedBeforeYield=
function(){this.validateConfigType("recordCountToBeProcessedBeforeYield","number",!1,!0);return a.recordCountToBeProcessedBeforeYield||1E4};this.useSingleJobRecord=function(){return a.useSingleJobRecord};this.setToUseSingleJobRecord=function(b){a.useSingleJobRecord=b};this.shouldYieldBeforeGetAllObjects=function(){if(b.getPageSize()>=b.getRecordCountToBeProcessedBeforeYield())return!1;if(e<b.getRecordCountToBeProcessedBeforeYield())return e+=b.getPageSize(),!1;e=b.getPageSize();return!0};this.setMapToExternalResult=
function(a){f=a};this.getMapToExternalResult=function(){return f};this.setMapToNetSuiteResult=function(a){g=a};this.getMapToNetSuiteResult=function(){return g};this.setConnectorResponseMessage=function(a){h=a};this.getConnectorResponseMessage=function(){return h};this.getNextDataFlow=function(){return this.nextDataFlow||a.nextDataFlow};this.setNextDataFlow=function(a){this.nextDataFlow=a};this.getCache=function(){if(!a.cache)a.cache={};return a.cache};this.setInvocationContext=function(a){this.invocationContext=
a};this.getInvocationContext=function(){if(!this.invocationContext)this.invocationContext={};return this.invocationContext};this.setInvocationContextByKey=function(a,b){if(!this.invocationContext)this.invocationContext={};this.invocationContext[a]=b};this.getInvocationContextByKey=function(a){return!this.invocationContext?void 0:this.invocationContext[a]};this.state={errors:[],successCount:0,isBatchProcessState:!0,status:null};this.getJobRecordId=function(){return this.state.jobRecordId};this.setJobRecordId=
function(a){this.state.jobRecordId=a};this.getIntegrationLogId=function(){return this.state.integrationLogRecId};this.setIntegrationLogId=function(a){this.state.integrationLogRecId=a};this.getRawObjects=this.getRawMessage=this.getMessage;this.setRawObjects=this.setRawMessage=this.setMessage;this.getExecutionLogger=function(){if(!this.executionLogger)this.executionLogger=$.getExecutionLogger("ExportV2");return this.executionLogger};this.getListOfRunnableClassnames=function(){return["Celigo.integrator.batch.ExportRunnable"]};
this.getFlowConfiguration=function(){return{integration:b.getIntegration(),useCase:b.getUseCase(),scriptParams:[]}};this.getNextBatchProcess=function(){return{classname:null,passAllObjects:!0,additionalContext:null,publicMethodsToPass:[]}};this.getAsyncReportMethod=function(){return a.asyncResponseMethod};this.createAdditionalSplunkLogs=function(){try{var a=[];b.getProductName()&&a.push('productName="'+b.getProductName()+'"');var c=b.getFileExtension();c&&a.push(', fileExtension="'+c+'"');var e=b.getFileName();
e&&a.push(', fileName="'+e+'"');var f=b.getRequestMapper();f&&a.push(', requestMapper="'+f.getClassName()+'"');var g=b.getRequestMappingRef();g&&a.push(', requestMappingRef="'+g.getClassName()+'"');var h=b.getConnector();h&&a.push(', connector="'+h.getClassName()+'"');var i=b.getSavedSearches();if(i&&(a.push(", savedSearchesCount="+i.length),i.length>0))for(c=0;c<i.length;c++){var j=i[c];j.getRecordType()&&a.push(", savedSearchRecordType"+c+"="+j.getRecordType())}var k=b.getGeneratedFromUI();k&&a.push(", generatedFromUI="+
k);var l=b.getUiProperties();l&&(a.push(", uiPropertiesFrequency="+l.frequency),a.push(', uiPropertiesUi_mapping="'+l.ui_mapping+'"'));return a.join("")}catch(m){return a=Celigo.Error.convert(m),'createAdditionalSplunkLogsErrorCode="'+a.getCode()+'", createAdditionalSplunkLogsErrorDetails="'+a.getDetails()+'"'}};this.setUp=function(){Celigo.event.dispatcher.integrator.batch.ExportDispatcher.emit("BATCH_EXPORT:_____INTERNAL_DO_NOT_USE_____SETUP_FUNCTION",b);i={};c=0};this.flowSpecificPreProcess=function(){var c=
a.operationMappings;c&&!_.isEmpty(c)&&Celigo.event.dispatcher.integrator.batch.ExportDispatcher.emit("BATCH_EXPORT:MERGE_OPERATION_MAPPINGS",b,c);Celigo.event.dispatcher.integrator.batch.ExportDispatcher.emit("BATCH_EXPORT:INIT",b)};this.postProcess=function(){var a=!1,e={};h=g=f=null;var i=b.getCollection(),p=Celigo.event.dispatcher.integrator.batch.ExportDispatcher;log("ExportV2 - postProcess - collection",i);p.emit("BATCH_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT",b,i);var w=0;if(b.getRequestMapper()){if(i.getSize()>
0){i.getSize()>10&&p.listeners("BATCH_EXPORT:PRE_PROCESS_EACH_SEARCH_RESULT_SUBSET").length>0&&Celigo.BatchProcess.yield();b.setMapToExternalResult(b.getRequestMapper().mapToExternal(i,b.getRequestMappingRef()));var u=b.getMapToExternalResult();if(u&&u instanceof Celigo.integrator.mapping.model.MapToExternalResult&&u.getMappingErrors()&&u.getMappingErrors().length){var s,u=u.getMappingErrors(),w=u.length;_.each(u,function(a){var c=new Celigo.lang.NetSuiteError({error:a.getError()});s="Mapping error at index: "+
a.getIndex()+" | Error Code: "+c.getCode()+" | Error Message: "+c.getDetails();b.publicState.reserved.integrationLoggerID&&$L.error(s,b.publicState.reserved.integrationLoggerID,b.getIntegration(),null,null,b.getUseCase(),c.getHelpLink());$$.logExecution("ERROR","Export - error",s+" | Stack Trace: "+c.getStackTrace())})}}}else p.emit("BATCH_EXPORT:EMPTY_REQUEST_MAPPER",b,i);p.emit("BATCH_EXPORT:AFTER_MAP_COLLECTION_TO_REQUEST_DOCUMENT",b,i,b.getMapToExternalResult());if(b.getMapToExternalResult()){var v=
b.getMapToExternalResult().getDocument();log("ExportV2 - postProcess - document",v);a=new Celigo.integrator.connectors.model.Message({name:this.getExportFileName({integration:this.getIntegration(),useCase:this.getUseCase(),fileName:this.getFileName(),fileExtension:this.getFileExtension()}),data:v});log("ExportV2 - postProcess - requestMessage",a);p.emit("BATCH_EXPORT:BEFORE_SEND_MESSAGE",b,a);b.getConnector()?(j?b.setConnector(Celigo.io.Serializable.revive(j)):(j=Celigo.JSON.stringify(b.getConnector()),
log("ExportV2 | connectorBackupCopy",j)),b.setConnectorResponseMessage(b.getConnector().fire(a))):p.emit("BATCH_EXPORT:EMPTY_CONNECTOR",b,a);p.emit("BATCH_EXPORT:AFTER_SEND_MESSAGE",b,b.getConnectorResponseMessage());a=!!b.getAsyncReportMethod();log("ExportV2 - postProcess - hasAsyncResonseImport",a);a&&(p.emit("BATCH_EXPORT:BEFORE_SET_REPSONSE_ID",b,b.getConnectorResponseMessage(),e),b.getConnector()&&_.extend(e,b.getConnector()[b.getAsyncReportMethod()](b.getConnectorResponseMessage())),log("ExportV2 - postProcess - hasAsyncResonseImport responseDetails",
e),p.emit("BATCH_EXPORT:AFTER_SET_REPSONSE_ID",b,b.getConnectorResponseMessage(),e));if(!(b.getConnectorResponseMessage()instanceof Celigo.integrator.connectors.model.Message))throw $$.createError("CELIGO_INVALID_VALUE","ExportV2 - connectorResponseMessage is empty. Either the connector doesn't produce any output or you are not using a connector and didn't call flow.setConnectorResponseMessage()");log("ExportV2 - postProcess - sender responseObject",b.getConnectorResponseMessage());v=b.getConnectorResponseMessage().getData();
a||(p.emit("BATCH_EXPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS",b,v),b.getResponseMapper()?(b.setMapToNetSuiteResult(b.getResponseMapper().mapToNetSuite(v,b.getResponseMappingRef())),(u=b.getMapToNetSuiteResult())&&u instanceof Celigo.integrator.mapping.model.MapToNetSuiteResult&&u.getMappingErrors()&&u.getMappingErrors().length&&_.each(u.getMappingErrors(),function(a){var c=new Celigo.lang.NetSuiteError({error:a.getError()});s="Mapping error at index: "+a.getIndex()+" | Error Code: "+c.getCode()+
" | Error Message: "+c.getDetails();b.publicState.reserved.integrationLoggerID&&$L.error(s,b.publicState.reserved.integrationLoggerID,b.getIntegration(),null,null,b.getUseCase(),c.getHelpLink());$$.logExecution("ERROR","Export - error",s+" | Stack Trace: "+c.getStackTrace())})):p.emit("BATCH_EXPORT:EMPTY_RESPONSE_MAPPER",b,v),p.emit("BATCH_EXPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS",b,v,b.getMapToNetSuiteResult()),log("ExportV2 - postProcess - response mapped result",b.getMapToNetSuiteResult()))}var v=
i.getSize(),t={};_.each(b.getSavedSearches(),function(a){a.getCheckBoxField()&&(t[a.getSearchId()]=a.getCheckBoxField())});$$.logExecution("AUDIT","ExportV2 - postProcess - checkBoxFieldBySavedSearchId",t);var y={},x=[],B=p.listeners("BATCH_EXPORT:PROCESS_EACH_EXPORTED_RECORD_CONFIG").concat(p.listeners("BATCH_EXPORT:BEFORE_SUBMIT_EACH_EXPORTED_RECORD")).concat(p.listeners("BATCH_EXPORT:AFTER_SUBMIT_EACH_EXPORTED_RECORD")).concat(p.listeners("BATCH_EXPORT:ON_ERROR_PROCESSING_EACH_EXPORTED_RECORD"));
if(b.getMapToNetSuiteResult())for(var u=b.getMapToNetSuiteResult().getJsObjects(),A=u.getNextObject();A;)try{if(!A.id)A.id=A.nlobjFieldIds?A.nlobjFieldIds.id:void 0;var z=m(A.nlobjRecordType,A.id,A);z||(p.emit("BATCH_EXPORT:BEFORE_DISCARD_EACH_UNMATCHED_RESPONSE_RECORD",b,A),z=m(A.nlobjRecordType,A.id,A));if(z&&(!_.isEmpty(t)||B.length>0||A.nlobjFieldIds.errorMessage))y[A.nlobjRecordType+"$"+A.id]=!0,x.push({jsObject:A,searchResultSubsets:z})}catch(E){b.increaseErrorCount(),n(E,"processing acknowledgment")}finally{A=
u.getNextObject()}if(!_.isEmpty(t)||B.length>0){var C={};i.each(function(a){var b=a[0].recordType,c=a[0].id;if(!y[b+"$"+c]){var e=i.getCurrentObjectIndex()[0];if(C[b+"$"+c])C[b+"$"+c].searchResultSubsets[e]=a;else{var f={jsObject:{nlobjRecordType:b,id:c,nlobjFieldIds:{},nlobjSublistIds:{}},searchResultSubsets:{}};f.searchResultSubsets[e]=a;C[b+"$"+c]=f;x.push(f)}}})}for(var F=0,I={},L={},u=0;u<x.length;u++){var A=x[u].jsObject,M=A.nlobjRecordType,J=A.id,z=x[u].searchResultSubsets,G=l(M,J),H=null,
K=G.join("$");if(L[K])H=I[K];else{for(var D=0;D<G.length;D++){var P=t[G[D]];P&&(H||(H=[]),H.push(P))}H&&(H=_.uniq(H));I[K]=H;L[K]=!0}P=K=null;try{for(D=0;H&&D<H.length;D++)A.nlobjFieldIds[H[D]]=!0;for(var N in z)p.emit("BATCH_EXPORT:PROCESS_EACH_EXPORTED_RECORD_CONFIG",b,A,z[N],N);if(!_.isEmpty(A.nlobjFieldIds)||!_.isEmpty(A.nlobjSublistIds)){var O=A.nlobjFieldIds.errorMessage;if(O){$L.error("Failed to process in external system : "+O,b.publicState.reserved.integrationLoggerID,b.getIntegration(),
M,J,b.getUseCase());for(D=0;D<G.length;D++)i.removeElement([G[D],M+"_"+J])}else if(B.length)K=new $R(A),p.emit("BATCH_EXPORT:BEFORE_SUBMIT_EACH_EXPORTED_RECORD",b,K),P=K.save(),p.emit("BATCH_EXPORT:AFTER_SUBMIT_EACH_EXPORTED_RECORD",b,K,P);else if(H){z=[];for(D=0;D<H.length;D++)z.push("T");$$.submitField(A.nlobjRecordType,A.id,H,z)}}}catch(Q){try{this.getExecutionLogger().error(Celigo.Error.format(Q));for(D=0;D<G.length;D++)i.removeElement([G[D],M+"_"+J]);p.emit("BATCH_EXPORT:ON_ERROR_PROCESSING_EACH_EXPORTED_RECORD",
b,Q,A,K,P);b.increaseErrorCount();n(Q,"after export",M,J,"critical error, record was exported but failed to mark the checkbox, please fix, otherwise record will be exported again")}catch(R){z="Record "+M+" id "+J+" was exported, then we tried to mark the checkbox, but an error has happenned ("+(Q.name||Q.getCode())+"-"+(Q.message||Q.getDetails())+"). While trying to create an error log, we got another error : ("+(R.name||R.getCode())+"-"+(R.message||R.getDetails())+"). Please contact Celigo for further assistance.",
nlapiLogExecution("ERROR","An unexpected error has happened to Celigo Integrator Data Flow",z),$$.sendEmail(-5,-5,"An unexpected error has happened to Celigo Integrator Data Flow",z)}}++F;F===this.getRecordCountToBeProcessedBeforeYield()&&(F=0,Celigo.BatchProcess.yield())}D=b.getJobStatusLoggerInstance();D.setJobStatusLoggerID(b.publicState.reserved.statusLoggerID);u=null;this.getConnectorResponseMessage()&&(u=this.getConnectorResponseMessage().getFileId());N=i.getSize();w=b.getErrorCount()+w+v-N+
c;if(b.useSingleJobRecord()){if(u){if(!k.outboundFileIds)k.outboundFileIds=[];k.outboundFileIds.push(u)}N+=k.numberOfSuccesses||0;k.numberOfSuccesses=N;w+=k.numberOfErrors||0;k.numberOfErrors=w}$$.logExecution("AUDIT","ExportV2 - postProcess - numberOfSuccesses",N);$$.logExecution("AUDIT","ExportV2 - postProcess - numberOfErrors",w);a&&(D.setReportId(e.reportId),D.setFlowId(this.getInvocationContextByKey("dataFlowRecordId")),D.setResponseBatchRanTimes(0));D.setNumberOfSuccesses(N);D.setNumberOfErrors(w);
if(!b.useSingleJobRecord()||b.isLastPage()){if(b.useSingleJobRecord()){if(e=k.outboundFileIds)if(e.length===1)D.setRecordFile(e[0]);else{N=null;O="";for(u=0;e&&u<e.length;u++)if(v=$$.loadFile(e[u]),u===0&&(N=v),O+=v.getValue(),O.length>5E6)break;O.length>0&&O.length<=5E6&&(v=$$.createFile(N.getName(),N.getType(),O),v.setFolder(N.getFolder()),D.setRecordFile($$.submitFile(v)))}}else u&&D.setRecordFile(u);a?D.setPendingResponseStatus():w>0?(D.setCompletedWithErrorsStatus(),D.setFailureMessage("Please check integration logs for details.")):
D.setCompletedStatus();D.setEndTime(new Date);D.setAdditionalSplunkLogs(b.createAdditionalSplunkLogs())}D.logStatus();a=a!==!0?"BATCH_EXPORT:COMPLETE":"BATCH_EXPORT:PENDING_RESPONSE";try{p.emit(a,b)}catch(S){p="error in "+a+" event handler "+Celigo.Error.format(S),$$.logExecution("ERROR","ExportV2 - postProcess - error",p),$L.error(p,b.getIntegrationLogId(),b.getIntegration(),null,null,b.getUseCase())}}};Celigo.integrator.batch.Export.extend(Celigo.integrator.batch.netsuite.DefaultExport);Celigo.integrator.batch.Export.implement(Celigo.integrator.IDataFlow);
Celigo.integrator.batch.Export.className="Celigo.integrator.batch.Export";Celigo.integrator.batch.Export.__events__={"BATCH_EXPORT:_____INTERNAL_DO_NOT_USE_____SETUP_FUNCTION":"BATCH_EXPORT:_____INTERNAL_DO_NOT_USE_____SETUP_FUNCTION","BATCH_EXPORT:MERGE_OPERATION_MAPPINGS":"BATCH_EXPORT:MERGE_OPERATION_MAPPINGS","BATCH_EXPORT:INIT":"BATCH_EXPORT:INIT","BATCH_EXPORT:PRE_PROCESS_SAVED_SEARCHES":"BATCH_EXPORT:PRE_PROCESS_SAVED_SEARCHES","BATCH_EXPORT:AFTER_RECEIVE_SEARCH_RESULTS":"BATCH_EXPORT:AFTER_RECEIVE_SEARCH_RESULTS",
"BATCH_EXPORT:PRE_PROCESS_EACH_SEARCH_RESULT_SUBSET":"BATCH_EXPORT:PRE_PROCESS_EACH_SEARCH_RESULT_SUBSET","BATCH_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT":"BATCH_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT","BATCH_EXPORT:EMPTY_REQUEST_MAPPER":"BATCH_EXPORT:EMPTY_REQUEST_MAPPER","BATCH_EXPORT:AFTER_MAP_COLLECTION_TO_REQUEST_DOCUMENT":"BATCH_EXPORT:AFTER_MAP_COLLECTION_TO_REQUEST_DOCUMENT","BATCH_EXPORT:BEFORE_SEND_MESSAGE":"BATCH_EXPORT:BEFORE_SEND_MESSAGE","BATCH_EXPORT:EMPTY_CONNECTOR":"BATCH_EXPORT:EMPTY_CONNECTOR",
"BATCH_EXPORT:AFTER_SEND_MESSAGE":"BATCH_EXPORT:AFTER_SEND_MESSAGE","BATCH_EXPORT:BEFORE_SET_REPSONSE_ID":"BATCH_EXPORT:BEFORE_SET_REPSONSE_ID","BATCH_EXPORT:AFTER_SET_REPSONSE_ID":"BATCH_EXPORT:AFTER_SET_REPSONSE_ID","BATCH_EXPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS":"BATCH_EXPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS","BATCH_EXPORT:EMPTY_RESPONSE_MAPPER":"BATCH_EXPORT:EMPTY_RESPONSE_MAPPER","BATCH_EXPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS":"BATCH_EXPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS",
"BATCH_EXPORT:BEFORE_DISCARD_EACH_UNMATCHED_RESPONSE_RECORD":"BATCH_EXPORT:BEFORE_DISCARD_EACH_UNMATCHED_RESPONSE_RECORD","BATCH_EXPORT:PROCESS_EACH_EXPORTED_RECORD_CONFIG":"BATCH_EXPORT:PROCESS_EACH_EXPORTED_RECORD_CONFIG","BATCH_EXPORT:BEFORE_SUBMIT_EACH_EXPORTED_RECORD":"BATCH_EXPORT:BEFORE_SUBMIT_EACH_EXPORTED_RECORD","BATCH_EXPORT:AFTER_SUBMIT_EACH_EXPORTED_RECORD":"BATCH_EXPORT:AFTER_SUBMIT_EACH_EXPORTED_RECORD","BATCH_EXPORT:ON_ERROR_PROCESSING_EACH_EXPORTED_RECORD":"BATCH_EXPORT:ON_ERROR_PROCESSING_EACH_EXPORTED_RECORD",
"BATCH_EXPORT:COMPLETE":"BATCH_EXPORT:COMPLETE","BATCH_EXPORT:PENDING_RESPONSE":"BATCH_EXPORT:PENDING_RESPONSE",error:null};Celigo.integrator.batch.ExportRunnable=function(a){Celigo.integrator.batch.ExportRunnable.superclass.constructor.call(this,a);var b=0;this.run=function(a,e,f,g){Celigo.event.dispatcher.integrator.batch.ExportDispatcher.emit("BATCH_EXPORT:PRE_PROCESS_EACH_SEARCH_RESULT_SUBSET",g,a);++b;b===g.getRecordCountToBeProcessedBeforeYield()&&(b=0,Celigo.BatchProcess.yield())}};Celigo.integrator.batch.ExportRunnable.extend(Celigo.suitescript.scheduled.Runnable);
$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.ImportMetadata=new Celigo.integrator.dataflow.Metadata({flowRecType:"customrecord_celigo_rt_import_flow",flowFldIntegration:"custrecord_celigo_rt_import_integration",flowFldUseCase:"custrecord_celigo_rt_import_usecase",flowFldConfig:"custrecord_celigo_rt_import_flow_config",flowFldConfiguration:"custrecord_celigo_rt_import_flow_conf",flowFldRecordType:"custrecord_celigo_rt_import_recordtype",flowFldFlowId:"custrecord_celigo_rt_import_flowid",
flowFldNoCache:"custrecord_celigo_rt_import_nocache",flowLibRecType:"customrecord_celigo_rt_import_flow_lib",flowLibFldParent:"custrecord_celigo_rt_import_lib_parent",flowLibFldFile:"custrecord_celigo_rt_import_lib_file",flowFldLicensed:"custrecord_celigo_rt_import_lic",flowFldSolutionId:"custrecord_celigo_rt_import_sid",flowFldSystem:"custrecord_celigo_rt_import_system",flowFldMuteLogging:"custrecord_celigo_mute_fw_logging_rt_i",flowFldDisabled:"custrecord_celigo_rt_import_disabl",flowFldIntegratorIOFlowId:"custrecord_celigo_iio_rt_import_id",
flowFldHookPreMapFile:"custrecord_celigo_hook_pre_map_file",flowFldHookPreMapFunc:"custrecord_celigo_hook_pre_map_func",flowFldHookPreMapConfig:"custrecord_celigo_hook_pre_map_config",flowFldHookPostMapFile:"custrecord_celigo_hook_post_map_file",flowFldHookPostMapFunc:"custrecord_celigo_hook_post_map_func",flowFldHookPostMapConfig:"custrecord_celigo_hook_post_map_config",flowFldHookPostSubmitFile:"custrecord_celigo_hook_post_submit_file",flowFldHookPostSubmitFunc:"custrecord_celigo_hook_post_submit_func",
flowFldHookPostSubmitConfig:"custrecord_celigo_hook_post_submit_confi"});$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.Import=function(a){this._super(a);this.eventDispatcher=Celigo.event.dispatcher.integrator.realtime.ImportDispatcher;this.getRequestMappingResult=function(){return this.requestMappingResult};this.setRequestMappingResult=function(a){this.requestMappingResult=a};this.getResponseMappingResult=function(){return this.responseMappingResult};this.setResponseMappingResult=
function(a){this.responseMappingResult=a};this.getNextObject=function(){var a=this.getRequestCollection().getProcessedCount(),c=this.getRequestCollection().getOriginalSize();return a<c?this.getRequestCollection().getNextObject():null};this.getCurrentObject=function(){return this.currentObject};this.setCurrentObject=function(a){if(a){var c=this.getRequestCollection().getCurrentObjectIndex();if(c>-1)this.getRequestCollection().setElementData(c,a),this.currentObject=this.getRequestCollection().getCurrentObject();
else throw new Celigo.Error({message:"invalid index "+c});}else this.currentObject=null,this.getRequestCollection().removeLastObject()};this.getOperationMappings=function(){return a.operationMappings};this.getBackupFolder=function(){return a.backupFolder};this.setBackupFolder=function(b){a.backupFolder=b};this.getAttachmentFolder=function(){return a.attachmentFolder};this.setAttachmentFolder=function(b){a.attachmentFolder=b};this.getExternalConnector=function(){return a.externalConnector}};Celigo.integrator.realtime.Import.className=
"Celigo.integrator.realtime.Import";Celigo.integrator.realtime.Import.extend(Celigo.integrator.DataFlow);Celigo.integrator.realtime.Import.prototype.run=function(){_.each(this.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.connect()});var a=0,b=0;this.getIntegration()!=="Magento"&&Celigo.integrator.dataflow.Util.mergeOperationMappings(this.getOperationMappings(),this.getRequestMappingRef());var c=null,e=(new Date).getTime();try{c=$L.newRealTimeJob(this.getIntegration()+"-"+this.getUseCase(),
this.getIntegration(),null,this.getUseCase())}catch(f){$$.logExecution("ERROR","Realtime Import can't create log record",Celigo.Error.format(f))}try{var g=[];this.getEventDispatcher().emit("REALTIME_IMPORT:INIT",this);this.getEventDispatcher().emit("REALTIME_IMPORT:AFTER_RECEIVE_MESSAGE",this,this.getRequestMessage());if(!this.getRequestMessage()||!this.getRequestMessage().getData())throw this.getExecutionLogger().audit("No objects received"),new Celigo.Error({name:"CELIGO_INVALID_REQUEST_DATA_ERROR",
message:"No objects received"});this.getExecutionLogger().debug("received objects",this.getRequestMessage());this.getEventDispatcher().emit("REALTIME_IMPORT:BEFORE_MAP_REQUEST_DOCUMENT_TO_RECORDS",this,this.getRequestMessage().getData());Celigo.integrator.dataflow.Util.validateNonEmptyDocumentInMessage(this.getRequestMessage());if(this.getRequestMapper()){if(!this.getRequestMappingRef())throw this.getExecutionLogger().audit("No Request Mapping Ref defined in Configuration File"),new Celigo.Error({name:"CELIGO_INVALID_FLOW_CONFIG_ERROR",
message:"No Request Mapping Ref defined in Configuration File"});this.setRequestMappingResult(this.getRequestMapper().mapToNetSuite(this.getRequestMessage().getData(),this.getRequestMappingRef()))}else this.getEventDispatcher().emit("REALTIME_IMPORT:EMPTY_REQUEST_MAPPER",this,this.getRequestMessage().getData());this.getEventDispatcher().emit("REALTIME_IMPORT:AFTER_MAP_REQUEST_DOCUMENT_TO_RECORDS",this,this.getRequestMappingResult(),this.getRequestMessage().getData());this.getRequestMappingResult()||
this.setRequestMappingResult(new Celigo.integrator.mapping.model.MapToNetSuiteResult({jsObjects:null,mappingErrors:null}));if(this.getRequestMappingResult()&&this.getRequestMappingResult()instanceof Celigo.integrator.mapping.model.MapToNetSuiteResult&&this.getRequestMappingResult().getMappingErrors()&&this.getRequestMappingResult().getMappingErrors().length){var h,j;_.each(this.getRequestMappingResult().getMappingErrors(),function(a){b++;h="Mapping error at index: "+a.getIndex()+" | "+Celigo.Error.format(a.getError());
$L.errorOnCurrentJob(h);if((j=a.getIndex().match(/\d+/g))&&j.length)j=parseInt(j[0],10)-1,g[j]={error:{code:a.getError().name,message:a.getError().message}}})}this.setRequestCollection(this.getRequestMappingResult().getJsObjects());if(!this.getRequestCollection())throw this.getExecutionLogger().audit("Request Mapper returned no objects"),new Celigo.Error({name:"CELIGO_INVALID_MAPPER_DATA_ERROR",message:"Request Mapper returned no objects"});if(!this.getRequestCollection()instanceof Celigo.oop.Collection)throw new Celigo.Error({name:"CELIGO_INVALID_MAPPER_DATA_ERROR",
message:"Request Collection is not a valid Celigo.oop.Collection"});for(this.currentObject=this.getNextObject();this.currentObject;)try{if(this.getEventDispatcher().emit("REALTIME_IMPORT:PROCESS_EACH_RECORD_CONFIG",this,this.currentObject),this.currentObject){if(this.getIntegration()!=="Magento")try{Celigo.integrator.dataflow.Util.validateImportOperationForRecordConfig(this.getOperationMappings(),this.currentObject)}catch(i){if(i.getCode&&i.getCode()==="CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT"){this.getExecutionLogger("audit",
"current record config is discarded due to CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT");this.setCurrentObject(null);this.currentObject=this.getNextObject();continue}else throw i;}var k=null;nlapiLogExecution("DEBUG","currentObject",JSON.stringify(this.currentObject));var l=new $R(this.currentObject);if(this.getInvocationContextByKey("httpMethod")==="POST"||this.getInvocationContextByKey("httpMethod")==="PUT")this.getEventDispatcher().emit("REALTIME_IMPORT:BEFORE_SUBMIT_EACH_RECORD",this,l),k=l.save(),
this.getExecutionLogger().audit("Record Successfully Submitted","Current Record Id: "+k),this.getEventDispatcher().emit("REALTIME_IMPORT:AFTER_SUBMIT_EACH_RECORD",this,l,k,this.currentObject),g[this.currentObject.documentIndex]={result:k};else if(this.getInvocationContextByKey("httpMethod")==="DELETE")this.getEventDispatcher().emit("REALTIME_IMPORT:BEFORE_DELETE_EACH_RECORD",this,l),l.destroy(),this.getEventDispatcher().emit("REALTIME_IMPORT:AFTER_DELETE_EACH_RECORD",this);else if(this.getInvocationContextByKey("httpMethod")===
"GET"){this.getEventDispatcher().emit("REALTIME_IMPORT:BEFORE_RETURN_EACH_RECORD",this,l);return}a++;this.getExecutionLogger().audit("successfully processed object")}else this.getExecutionLogger("audit","current record config is discarded"),this.currentObject=this.getNextObject()}catch(m){b++;if(this.currentObject&&this.currentObject.externalId)m.message=m.message+" | Error at index: "+this.currentObject.externalId;m=new Celigo.Error({name:"CELIGO_PROCESS_OBJECT_ERROR",message:"error occurred processing object",
error:m});this.getRequestCollection().removeLastObject();var n=this.getEventDispatcher().listeners("error");n&&n.length&&this.getEventDispatcher().emit("error",this,m);this.getExecutionLogger().error("error processing object",Celigo.Error.format(m));var o=this.currentObject.id||(this.currentObject.nlobjFieldIds?this.currentObject.nlobjFieldIds.internalid:null);if(o)m.message=m.message+" | NetSuite RecordType: "+this.currentObject.nlobjRecordType+" , NetSuite RecordId: "+o;$L.errorOnCurrentJob(Celigo.Error.format(m));
var q={error:{code:m.name,message:m.message}};if(k)q.result=k;g[this.currentObject.documentIndex]=q}finally{this.currentObject=this.getNextObject()}this.setResponseCollection(Celigo.lang.Collection.arrayOrObjectToCollection(g));this.getEventDispatcher().emit("REALTIME_IMPORT:BEFORE_MAP_RECORDS_TO_RESPONSE_DOCUMENT",this,this.getResponseCollection());this.getResponseMapper()&&this.getResponseMappingRef()?this.setResponseMappingResult(this.getResponseMapper().mapToExternal(this.getResponseCollection(),
this.getResponseMappingRef())):this.getEventDispatcher().emit("REALTIME_IMPORT:EMPTY_RESPONSE_MAPPER",this,this.getResponseCollection());this.getResponseMappingResult()||this.setResponseMappingResult(new Celigo.integrator.mapping.model.MapToExternalResult({document:new Celigo.integrator.model.Document({content:g}),mappingErrors:null}));this.getResponseMappingResult()&&this.getResponseMappingResult()instanceof Celigo.integrator.mapping.model.MapToExternalResult&&this.getResponseMappingResult().getMappingErrors()&&
this.getResponseMappingResult().getMappingErrors().length&&_.each(this.getResponseMappingResult().getMappingErrors(),function(a){h="Mapping error at index: "+a.getIndex()+" | "+Celigo.Error.format(a.getError());$L.errorOnCurrentJob(h)});this.getExecutionLogger().debug("Response Mapping Result",this.getResponseMappingResult());this.setResponseDocument(this.getResponseMappingResult().getDocument());this.getEventDispatcher().emit("REALTIME_IMPORT:AFTER_MAP_RECORDS_TO_RESPONSE_DOCUMENT",this,this.getResponseDocument(),
this.getResponseCollection());if(!this.getResponseDocument()||!this.getResponseDocument().getContent())throw this.getExecutionLogger().audit("Response Mapper returned no results"),new Celigo.Error({name:"CELIGO_INVALID_MAPPER_DATA_ERROR",message:"Response Mapper returned no results"});this.setResponseMessage(new Celigo.integrator.connectors.model.Message({data:this.getResponseDocument()}));this.getEventDispatcher().emit("REALTIME_IMPORT:BEFORE_COMPLETE",this)}catch(r){throw $L.errorOnCurrentJob(Celigo.Error.format(r)),
r;}finally{this.getEventDispatcher().emit("REALTIME_IMPORT:COMPLETE",this),_.each(this.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.disconnect()}),c&&(q=$$.createRecord("customrecord_celigo_job_realtime"),q.setFieldText("custrecord_celigo_jrt_type","Import"),q.setFieldText("custrecord_celigo_jrt_integration",this.getIntegration()),q.setFieldText("custrecord_celigo_jrt_use_case",this.getUseCase()),q.setFieldValue("custrecord_celigo_jrt_success",a),q.setFieldValue("custrecord_celigo_jrt_failure",
b),q.setFieldValue("custrecord_celigo_jrt_log",c),q.setFieldValue("custrecord_celigo_jrt_start",e),q.setFieldValue("custrecord_celigo_jrt_end",(new Date).getTime()),$$.submitRecord(q)),this.getExecutionLogger().audit("Flow Complete")}return this.getResponseMessage()};Celigo.integrator.realtime.Import.__events__={"REALTIME_IMPORT:INIT":"REALTIME_IMPORT:INIT","REALTIME_IMPORT:AFTER_RECEIVE_MESSAGE":"REALTIME_IMPORT:AFTER_RECEIVE_MESSAGE","REALTIME_IMPORT:BEFORE_MAP_REQUEST_DOCUMENT_TO_RECORDS":"REALTIME_IMPORT:BEFORE_MAP_REQUEST_DOCUMENT_TO_RECORDS",
"REALTIME_IMPORT:EMPTY_REQUEST_MAPPER":"REALTIME_IMPORT:EMPTY_REQUEST_MAPPER","REALTIME_IMPORT:AFTER_MAP_REQUEST_DOCUMENT_TO_RECORDS":"REALTIME_IMPORT:AFTER_MAP_REQUEST_DOCUMENT_TO_RECORDS","REALTIME_IMPORT:PROCESS_EACH_RECORD_CONFIG":"REALTIME_IMPORT:PROCESS_EACH_RECORD_CONFIG","REALTIME_IMPORT:BEFORE_RETURN_EACH_RECORD":"REALTIME_IMPORT:BEFORE_RETURN_EACH_RECORD","REALTIME_IMPORT:BEFORE_SUBMIT_EACH_RECORD":"REALTIME_IMPORT:BEFORE_SUBMIT_EACH_RECORD","REALTIME_IMPORT:AFTER_SUBMIT_EACH_RECORD":"REALTIME_IMPORT:AFTER_SUBMIT_EACH_RECORD",
"REALTIME_IMPORT:BEFORE_DELETE_EACH_RECORD":"REALTIME_IMPORT:BEFORE_DELETE_EACH_RECORD","REALTIME_IMPORT:AFTER_DELETE_EACH_RECORD":"REALTIME_IMPORT:AFTER_DELETE_EACH_RECORD","REALTIME_IMPORT:BEFORE_MAP_RECORDS_TO_RESPONSE_DOCUMENT":"REALTIME_IMPORT:BEFORE_MAP_RECORDS_TO_RESPONSE_DOCUMENT","REALTIME_IMPORT:EMPTY_RESPONSE_MAPPER":"REALTIME_IMPORT:EMPTY_RESPONSE_MAPPER","REALTIME_IMPORT:AFTER_MAP_RECORDS_TO_RESPONSE_DOCUMENT":"REALTIME_IMPORT:AFTER_MAP_RECORDS_TO_RESPONSE_DOCUMENT","REALTIME_IMPORT:BEFORE_COMPLETE":"REALTIME_IMPORT:BEFORE_COMPLETE",
"REALTIME_IMPORT:COMPLETE":"REALTIME_IMPORT:COMPLETE",error:null};$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.ExportMetadata=new Celigo.integrator.dataflow.Metadata({flowRecType:"customrecord_celigo_rt_export_flow",flowLibRecType:"customrecord_celigo_rt_export_flow_lib",flowFldIntegration:"custrecord_celigo_rt_export_integration",flowFldUseCase:"custrecord_celigo_rt_export_usecase",flowFldRecordType:"custrecord_celigo_rt_export_recordtype",flowFldFlowId:"custrecord_celigo_rt_export_flowid",
flowFldEnvironment:"custrecord_celigo_rt_export_env",flowFldEventType:"custrecord_celigo_rt_export_eventtypes",flowFldExecutionType:"custrecord_celigo_rt_export_exectypes",flowFldConfig:"custrecord_celigo_rt_export_config",flowFldConfiguration:"custrecord_celigo_rt_export_conf",flowFldNoCache:"custrecord_celigo_rt_export_nocache",flowLibFldParent:"custrecord_celigo_rt_export_lib_parent",flowLibFldFile:"custrecord_celigo_rt_export_lib_file",flowFldLicensed:"custrecord_celigo_rt_export_lic",flowFldSolutionId:"custrecord_celigo_rt_export_sid",
flowFldSystem:"custrecord_celigo_rt_export_system",flowFldAsync:"custrecord_celigo_rt_async",flowFldExecutionContext:"custrecord_celigo_rt_async_ctx",flowFldMuteLogging:"custrecord_celigo_mute_fw_logging_rt_e",flowFldDisabled:"custrecord_celigo_rt_export_disabl",flowFldDerivedSublists:"custrecord_celigo_derived_subs",flowFldRequestedSublists:"custrecord_celigo_requested_subs",flowFldQualifier:"custrecord_celigo_qualifier",flowFldIntegratorIOFlowId:"custrecord_celigo_iio_rt_flow_id",flowFldForceReload:"custrecord_celigo_force_reload",
flowFldPlugins:"custrecord_celigo_rt_plugins",flowFldToken:"custrecord_celigo_rt_export_iio_token",flowFldUid:"custrecord_celigo_rt_export_userid",flowFldHookPreSendFile:"custrecord_celigo_hook_pre_send_file",flowFldHookPreSendFunc:"custrecord_celigo_hook_pre_send_func",flowFldHookPreSendConfig:"custrecord_celigo_hook_pre_send_config",flowFldHookSettings:"custrecord_celigo_rt_settings",flowFldSkipScriptQueue:"custrecord_celigo_rt_skip_script_queue",flowFldIsStaging:"custrecord_celigo_rt_iio_env_is_staging",
flowFldEventTypeList:{beforeload:"1",beforesubmit:"2",aftersubmit:"3"},flowFldExecutionTypeList:{create:"1",edit:"2","delete":"3",xedit:"4",copy:"5",view:"6",cancel:"7",approve:"8",reject:"9",pack:"10",ship:"11",markcomplete:"12",reassign:"13",editforecast:"14",dropship:"15",specialorder:"16",orderitems:"17",paybills:"18",print:"19",email:"20"},flowFldContextTypeList:{userinterface:"1",webservices:"2",csvimport:"3",offlineclient:"4",portlet:"5",scheduled:"6",suitelet:"7",custommassupdate:"8",workflow:"9",
webstore:"10",userevent:"11",mapreduce:"12",restlet:"13"}});$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.Export=function(a){this._super(a);this.eventDispatcher=Celigo.event.dispatcher.integrator.realtime.ExportDispatcher;this.getEventType=function(){return this.eventType};this.setEventType=function(a){this.eventType=a};this.getExecutionType=function(){return this.executionType};this.setExecutionType=function(a){this.executionType=a};this.isCancelled=function(){return!!this.cancelled};
this.setCancelled=function(a){this.cancelled=!!a};this.makeCurrentRecordCollection=function(){var b={},c=(new Date).getTime(),e=(new $R($$.getNewRecord()||$$.getOldRecord())).toJSON();if(a.syncIncludeSublist===!0)return Celigo.lang.Collection.arrayOrObjectToCollection([e]);b[c]={};b[c].celigoIsElement=!0;b[c].data=[e.nlobjFieldIds];b[c].data[0].recordType=e.nlobjRecordType;b[c].data[0].id=e.id;return new Celigo.lang.Collection(b)};this.makeCollectionWithJSON=function(a){return Celigo.lang.Collection.arrayOrObjectToCollection([a])};
this.setCurrentObject=function(a){if(a){var c=this.getResponseCollection().getCurrentObjectIndex();if(c>-1)this.getResponseCollection().setElementData(c,a),this.currentObject=this.getResponseCollection().getCurrentObject();else throw new Celigo.Error({message:"invalid index "+c});}else this.currentObject=null,this.getResponseCollection().removeLastObject()};this.isAsync=function(){return a.async===!0};this.setAsync=function(b){a.async=!!b};this.getMessageToConsume=function(){return this.messageToConsume};
this.setMessageToConsume=function(a){if(!a||!(a instanceof Celigo.io.Message))throw Error("only valid Celigo.io.Message instance can be consumed");this.messageToConsume=a};this.initRealtimeJob=function(){try{return $L.newRealTimeJob(this.getIntegration()+"-"+this.getUseCase(),this.getIntegration(),null,this.getUseCase())}catch(a){$$.logExecution("ERROR","Realtime Export can't create log record",Celigo.Error.format(a))}};this.getRecordType=function(){return $$.getRecordType()||this.recordType};this.getRecordId=
function(){return $$.getRecordId()||this.recordId};this.setRecordType=function(a){this.recordType=a};this.setRecordId=function(a){this.recordId=a};this.getOperationMappings=function(){return a.operationMappings}};Celigo.integrator.realtime.Export.className="Celigo.integrator.realtime.Export";Celigo.integrator.realtime.Export.extend(Celigo.integrator.DataFlow);Celigo.integrator.realtime.Export.prototype.run=function(){var a=this;_.each(a.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&
a.connect()});var b=1,c=null,e=(new Date).getTime(),f=a.getMessageToConsume(),g,h=a.getOperationMappings();h&&!_.isEmpty(h)&&a.getEventDispatcher().emit("REALTIME_EXPORT:MERGE_OPERATION_MAPPINGS",a,h);if(!f&&!a.isAsync()&&(a.getEventDispatcher().emit("REALTIME_EXPORT:INIT",a),a.isCancelled())){a.getExecutionLogger().audit(Celigo.integrator.dataflow.Util.getFlowName(a)+" is NOT set to run");_.each(a.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.disconnect()});return}try{if(f){a.getExecutionLogger().audit("start consuming message...");
try{g=typeof f.getPayload()==="string"?JSON.parse(f.getPayload()):f.getPayload()}catch(j){throw Error("expecting message to be a NetSuite record json repr");}a.setRecordType(g.recordtype);a.setRecordId(g.id);a.getEventDispatcher().emit("REALTIME_EXPORT:ASYNC_INIT",a,g);if(a.isCancelled()){a.getExecutionLogger().audit(Celigo.integrator.dataflow.Util.getFlowName(a)+" is NOT set to run");_.each(a.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.disconnect()});return}a.setRequestCollection(a.makeCollectionWithJSON(g));
c=a.initRealtimeJob()}else a.isAsync()||(c=a.initRealtimeJob()),a.setRequestCollection(a.makeCurrentRecordCollection());a.getEventDispatcher().emit("REALTIME_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT",a,a.getRequestCollection());h=null;if(a.getRequestMapper())if(a.getRequestCollection()&&a.getRequestMappingRef()){h=a.getRequestMapper().mapToExternal(a.getRequestCollection(),a.getRequestMappingRef());if(!h||!_.isFunction(h.getDocument))throw new Celigo.Error({name:"invalid request mapping result",
message:"request mapping result is expected to be an instanceof MapToExternalResult"});if(h&&h instanceof Celigo.integrator.mapping.model.MapToExternalResult&&h.getMappingErrors()&&h.getMappingErrors().length){var i;_.each(h.getMappingErrors(),function(c){i="Mapping error at index: "+c.getIndex()+" | "+Celigo.Error.format(c.getError());$L.errorOnCurrentJob(i,a.getIntegration(),a.getRecordType(),a.getRecordId(),a.getUseCase());b=0})}a.setRequestDocument(h.getDocument())}else a.getExecutionLogger().audit("cannot map without request collection and/or request mapping reference, proceeding without mapping");
else a.isSystem()?(a.getExecutionLogger().audit("handling system flow request"),a.setRequestDocument(new Celigo.integrator.model.JSONDocument({content:{header:f.getHeaders(),payload:g}}))):a.getEventDispatcher().emit("REALTIME_EXPORT:EMPTY_REQUEST_MAPPER",a);a.getEventDispatcher().emit("REALTIME_EXPORT:AFTER_MAP_COLLECTION_TO_REQUEST_DOCUMENT",a,a.getRequestCollection(),h);a.setRequestMessage(new Celigo.integrator.connectors.model.Message({data:a.getRequestDocument()}));a.getEventDispatcher().emit("REALTIME_EXPORT:BEFORE_SEND_MESSAGE",
a,a.getRequestMessage());if(a.getConnector()){var k=a.getConnector().getContext();k||(k={});k.dataFlowInvocation=a.getInvocationContext();a.getConnector().setContext(k);a.setResponseMessage(a.getConnector().fire.call(a.getConnector(),a.getRequestMessage()),a)}else a.getEventDispatcher().emit("REALTIME_EXPORT:EMPTY_CONNECTOR",a,a.getRequestMessage());a.getEventDispatcher().emit("REALTIME_EXPORT:AFTER_SEND_MESSAGE",a,a.getResponseMessage());a.setResponseDocument(a.getResponseMessage().getData());a.getEventDispatcher().emit("REALTIME_EXPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS",
a,a.getResponseDocument());if(a.getResponseMapper())if(a.getResponseMappingRef()&&a.getResponseDocument()){h=a.getResponseMapper().mapToNetSuite(a.getResponseDocument(),a.getResponseMappingRef());if(!h||!_.isFunction(h.getJsObjects))throw new Celigo.Error({name:"invalid response mapping result",message:"response mapping result is expected to be an instanceof MapToNetSuiteResult"});h&&h instanceof Celigo.integrator.mapping.model.MapToNetSuiteResult&&h.getMappingErrors()&&h.getMappingErrors().length&&
_.each(h.getMappingErrors(),function(b){i="Mapping error at index: "+b.getIndex()+" | "+Celigo.Error.format(b.getError());$L.errorOnCurrentJob(i,a.getIntegration(),a.getRecordType(),a.getRecordId(),a.getUseCase())});a.setResponseCollection(h.getJsObjects())}else a.getExecutionLogger().audit("cannot map without response document and/or response document, proceed without mapping");else a.getEventDispatcher().emit("REALTIME_EXPORT:EMPTY_RESPONSE_MAPPER",a,a.getResponseDocument());a.getEventDispatcher().emit("REALTIME_EXPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS",
a,a.getResponseDocument(),h);if(!a.getResponseCollection()||!a.getResponseCollection().getSize())a.getExecutionLogger().audit("no response collection to process");else for(a.currentObject=a.getResponseCollection().getNextObject();a.currentObject;){try{if(a.getExecutionLogger().debug("cur record config",a.currentObject),a.getEventDispatcher().emit("REALTIME_EXPORT:PROCESS_EACH_RECORD_CONFIG",a,a.currentObject),!a.currentObject){b=0;a.getExecutionLogger("audit","current record config is discarded");
continue}}catch(l){var m=Celigo.Error.format(l);a.getExecutionLogger().error(m);$L.errorOnCurrentJob(m,a.getIntegration(),a.getRecordType(),a.getRecordId(),a.getUseCase());b=0}a.currentObject=a.getResponseCollection().getNextObject()}}catch(n){if(m=Celigo.Error.format(n),a.getExecutionLogger().error(m),$L.errorOnCurrentJob(m,a.getIntegration(),a.getRecordType(),a.getRecordId(),a.getUseCase()),b=0,n.name==="REMOTE_UNAVAILABLE")throw n;}finally{a.getEventDispatcher().emit("REALTIME_EXPORT:COMPLETE",
a),c&&(f=$$.createRecord("customrecord_celigo_job_realtime"),f.setFieldText("custrecord_celigo_jrt_type","Export"),f.setFieldText("custrecord_celigo_jrt_integration",a.getIntegration()),f.setFieldText("custrecord_celigo_jrt_use_case",a.getUseCase()),f.setFieldValue("custrecord_celigo_jrt_success",b),f.setFieldValue("custrecord_celigo_jrt_failure",b?0:1),f.setFieldValue("custrecord_celigo_jrt_log",c),f.setFieldValue("custrecord_celigo_jrt_start",e),f.setFieldValue("custrecord_celigo_jrt_end",(new Date).getTime()),
$$.submitRecord(f)),_.each(a.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.disconnect()})}};Celigo.integrator.realtime.Export.__events__={"REALTIME_EXPORT:MERGE_OPERATION_MAPPINGS":null,"REALTIME_EXPORT:INIT":null,"REALTIME_EXPORT:ASYNC_INIT":null,"REALTIME_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT":null,"REALTIME_EXPORT:EMPTY_REQUEST_MAPPER":null,"REALTIME_EXPORT:AFTER_MAP_COLLECTION_TO_REQUEST_DOCUMENT":null,"REALTIME_EXPORT:BEFORE_SEND_MESSAGE":null,"REALTIME_EXPORT:EMPTY_CONNECTOR":null,
"REALTIME_EXPORT:AFTER_SEND_MESSAGE":null,"REALTIME_EXPORT:BEFORE_MAP_RESPONSE_DOCUMENT_TO_RECORDS":null,"REALTIME_EXPORT:EMPTY_RESPONSE_MAPPER":null,"REALTIME_EXPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS":null,"REALTIME_EXPORT:PROCESS_EACH_RECORD_CONFIG":null,"REALTIME_EXPORT:COMPLETE":null,error:null};$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.JobAccumulator=function(){var a=$$.getContext().getSetting("SCRIPT","custscript_celigo_accumulate_interval"),b=a?a:36E5,c=new Celigo.logging.SplunkStormRestClient,
e=[],f="",g=function(a){var c={},f=[];_.each(a,function(a){var g=a.getText("custrecord_celigo_jrt_type"),h=a.getText("custrecord_celigo_jrt_integration"),n=a.getText("custrecord_celigo_jrt_use_case"),o=a.getValue("custrecord_celigo_jrt_success"),q=a.getValue("custrecord_celigo_jrt_failure"),r=a.getValue("custrecord_celigo_jrt_log"),p=a.getValue("custrecord_celigo_jrt_start"),w=a.getValue("custrecord_celigo_jrt_end");if(g&&h&&n&&o&&q&&r&&p){var u=Math.floor(p/b);c[g]||(c[g]={});c[g][h]||(c[g][h]={});
c[g][h][n]||(c[g][h][n]={});c[g][h][n][u]||(c[g][h][n][u]={type:g,integration:h,useCase:n,time:u,success:0,failure:0,log:[]},f.push(c[g][h][n][u]));c[g][h][n][u].success+=parseInt(o,10);c[g][h][n][u].failure+=parseInt(q,10);c[g][h][n][u].log.push(r);var u=g==="Export"?"outbound":"inbound",g=g==="Export"?"numExported":"numImported",s=[Celigo.logging.SplunkStormRestClient.makeSplunkStormEventDateStringinGMT(new Date)];s.push(" logName=RealTime, direction="+u);s.push(', integration="'+h+'"');s.push(', usecase="'+
n+'"');s.push(", "+g+"="+o);s.push(", numErrors="+q);s.push(", startTime=");s.push('"');s.push(p?Celigo.logging.SplunkStormRestClient.makeSplunkStormFieldValueDateString(new Date(parseInt(p,10))):"!EMPTY!");s.push('"');s.push(", endTime=");s.push('"');s.push(w?Celigo.logging.SplunkStormRestClient.makeSplunkStormFieldValueDateString(new Date(parseInt(w,10))):"!EMPTY!");s.push('"');s.push(", logId="+r);s.push(", ");s.push(Celigo.logging.SplunkStormRestClient.makeSplunkStormSuiteScriptContextKeyValueString());
e.push(s.join(""))}$$.deleteRecord("customrecord_celigo_job_realtime",a.getId())});$$.logExecution("DEBUG","timeBucketLength ",b);log("bucketMap",c);log("buckets",f);_.each(f,function(a){var c=a.type,e=a.integration,f=a.useCase,g=a.time,h=a.success,i=a.failure,a=a.log,j=new Celigo.JobStatusLogger;c==="Export"?j.convertToExportStatusLogger():j.convertToImportStatusLogger();masterLog=a.shift();j.setIntegration(e);j.setUseCase(f);j.setIntegrationLog(masterLog);j.setNumberOfSuccesses(h);j.setNumberOfErrors(i);
j.setStartTime(new Date(g*b));j.setEndTime(new Date((g+1)*b-1));i>0?j.setCompletedWithErrorsStatus():j.setCompletedStatus();j.setSendToSplunk(!1);j.logStatus();if(a.length>0){c=masterLog;e=$$.searchRecord("customrecord_celigo_logger",null,[new nlobjSearchFilter("custrecord_celigo_logger_parent",null,"anyof",a)]);for(f=0;e&&f<e.length;f++)log("attach log "+e[f].getId(),"to master log "+c),$$.submitField("customrecord_celigo_logger",e[f].getId(),"custrecord_celigo_logger_parent",c)}})};this.getLastSplunkStormMultiLinePostBody=
function(){return f};this.main=function(){for(var a=!0;;){var j=Math.floor((new Date).getTime()/b)*b;if((j=$$.searchRecord("customrecord_celigo_job_realtime",null,[new nlobjSearchFilter("custrecord_celigo_jrt_start",null,"lessthan",j.toString())],[(new nlobjSearchColumn("custrecord_celigo_jrt_start")).setSort(!1),new nlobjSearchColumn("custrecord_celigo_jrt_end"),new nlobjSearchColumn("custrecord_celigo_jrt_type"),new nlobjSearchColumn("custrecord_celigo_jrt_integration"),new nlobjSearchColumn("custrecord_celigo_jrt_use_case"),
new nlobjSearchColumn("custrecord_celigo_jrt_success"),new nlobjSearchColumn("custrecord_celigo_jrt_failure"),new nlobjSearchColumn("custrecord_celigo_jrt_log")]))&&j.length>0){if(a?a=!1:Celigo.BatchProcess.yield(),g(j),j.length<1E3)break}else break}log("stormMultiLinePostBodyEventBuffer",e);for(j=a=0;j<e.length;)if(f+=e[j],j<e.length-1&&(f+="\n"),a++,j++,a>=100||j>=e.length)log("stormMultiLinePostBodyString",f),c.sendToSplunk(f),j<e.length&&(f=""),a=0}};if($$.getContext().getScriptId()==="customscript_celigo_rt_job_accumulator")Celigo.integrator.realtime.JobAccumulator.prototype.getThrowableErrorCodes=
function(){return"all"},Celigo.integrator.realtime.JobAccumulator.prototype.scheduled=function(){this.main()},Celigo.RealtimeJobAccumulator=Celigo.integrator.realtime.JobAccumulator;$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.ExportSublistParser=function(){var a=$.getExecutionLogger("Celigo.integrator.realtime.ExportSublistParser"),b=function(a){for(var b=[],c=0;c<a.length;c++)a[c]!==""&&b.push(a[c]);return b},c=function(a){if(a&&a.search(/_billingaddress_|_shippingaddress_/i)===
0)return"addressbook"},e=/\.+|\[.*\]\.?/;this.parse=function(f){var g={},h=-1,j=null;(new Celigo.integrator.mapping.Traverser(f)).traverse(function(f,k,l){h>0&&l<h&&(h=-1,j=null);if(f instanceof Celigo.integrator.mapping.model.FieldMappingSet){h=l;if(typeof f.getReadPath!=="function"||!f.getReadPath()){j=null;return}a.debug("read path",f.getReadPath());k=f.getReadPath().trim().toLowerCase().split(e);j=(k=b(k))&&k.length>1&&k[0]==="$"?k[1]:null;a.debug("setPrefix",j);j&&(g[j]=1)}if(f instanceof Celigo.integrator.mapping.model.FieldMapping&&
!(h>0&&l>h&&j)&&(f=f.getJsField()))a.debug("js field",f),k=f.trim().toLowerCase().split(e),_.isArray(k)&&((k=b(k))&&k.length>1&&k[0]==="$"&&c(k[1])?(f=c(k[1]),a.debug("dummy field "+k[1],"sublist "+f),g[f]=1):k&&k.length>2&&k[0]==="$"&&(a.debug("field sublist",k[1]),g[k[1]]=1))},this);return Object.keys(g)}};$.namespace("Celigo.integrator.util");Celigo.integrator.util.SalesOrderImportUtil=function(){var a=new Date(2012,6,5),b={},c=[],e=null,f=null,g=null,h=null,j=function(){b={};c=[];h=g=f=e=null},
i=function(a){return(a=a.match(/\d+/g))&&a.length>0?(a=a.join(""),a.length<7?"":a):""},k=function(a){e=a;f=e.nlobjFieldIds;if(g=e.nlobjSublistIds)h=g.item;if(!h||h.length===0)throw $$.createError("CELIGO_MISSING_FIELD","Item Sublist is required");},l=function(a){if(a&&(a=Celigo.util.trim(a)))if(/^[A-Za-z0-9-._+]{1,}@{1}[A-Za-z0-9-._]{1,}[.][a-zA-Z]{2,6}$/.test(a))return a;else c.push("Email address "+a+" is invalid.")},m=function(a){_.each(a,function(a){if(!a.state&&a.stateTemp)a.state=a.stateTemp;
if(a.addr1&&!a.addr2&&a.addr1.indexOf("\n")!==-1){var b=a.addr1.indexOf("\n");a.addr2=a.addr1.substring(b+1);a.addr1=a.addr1.substring(0,b)}})},n=function(b,c){if(c.lines)c=c.lines;m(c);var e=[],f={},g=_.some(c,function(a){return a.defaultbilling}),h=_.some(c,function(a){return a.defaultshipping});_.each(c,function(a,b){var j=$.trim(a.addressee||""),k=$.trim(a.attention||""),l=$.trim(a.addr1||""),m=$.trim(a.addr2||""),n=$.trim(a.addr3||""),o=$.trim(a.city||""),q=$.trim(a.state||""),p=$.trim(a.zip||
""),r=$.trim(a.country||""),v=i(a.phone||""),s=j+k+l+m+n+o+q+p+r+v;if($.trim(s)){var u=null;if(f[s]){u=f[s].indexInAddressConfigs;e[u].indicesInOriginalAddressList.push(b);if(a.defaultshipping)e[u].defaultshipping=!0;if(a.defaultbilling)e[u].defaultbilling=!0;if(a.isresidential)e[u].isresidential=!0}else f[s]={indexInAddressConfigs:e.length},e.push({defaultbilling:a.defaultbilling||!1,defaultshipping:a.defaultshipping||!1,isresidential:a.isresidential||!1,addressee:j,attention:k,addr1:l,addr2:m,addr3:n,
city:o,state:q,zip:p,country:r,phone:v,indicesInOriginalAddressList:[b]}),u=e.length-1;if(b===c.length-1&&!g&&!h)e[u].defaultbilling=!0,e[u].defaultshipping=!0}});logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - addressConfigs after deduped",e,a);var j=[];_.isEmpty(e)||(j=b.get("addressbook"));logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - existingAddresses",j,a);_.each(j,function(a,c){var g=$.trim(a.addressee||""),h=$.trim(a.attention||""),j=$.trim(a.addr1||""),k=$.trim(a.addr2||
""),l=$.trim(a.addr3||""),m=$.trim(a.city||""),n=$.trim(a.state||""),o=$.trim(a.zip||""),q=$.trim(a.country||""),p=i(a.phone||""),g=g+h+j+k+l+m+n+o+q+p;if(f[g])g=f[g].indexInAddressConfigs,e[g].addressBookLineNum=c+1,(e[g].defaultbilling&&a.defaultbilling!=="T"||e[g].defaultshipping&&a.defaultshipping!=="T"||e[g].isresidential&&a.isresidential!=="T")&&b.set({addressbook:[{linenum:c+1,defaultbilling:e[g].defaultbilling,defaultshipping:e[g].defaultshipping,isresidential:e[g].isresidential}]})});logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - addressConfigs after matched w existing",
e,a);_.each(e,function(a){if(!a.addressBookLineNum)b.set({addressbook:[{defaultshipping:a.defaultshipping||!1,defaultbilling:a.defaultbilling||!1,isresidential:a.isresidential||!1,addressee:a.addressee,attention:a.attention,addr1:a.addr1,addr2:a.addr2,addr3:a.addr3,city:a.city,state:a.state,zip:a.zip,country:a.country,phone:a.phone}]}),a.addressBookLineNum=b.get("addressbook").length});logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - addressConfigs after add non-existing",e,a);return e},
o=function(b,c,e){logUntil("SalesOrderImportUtil - processAddressWithIds - addressFieldId to be used",e,a);if(c.lines)c=c.lines;m(c);var f={},g={},h=[],j=[];b.get("addressbook")&&(j=b.get("addressbook"));logUntil("SalesOrderImportUtil - processAddressWithIds - existingAddresses",j,a);j.length>0&&_.each(j,function(a){var b=$.trim(a.addressee||""),c=$.trim(a.attention||""),h=$.trim(a.addr1||""),j=$.trim(a.addr2||""),k=$.trim(a.addr3||""),l=$.trim(a.city||""),m=$.trim(a.state||""),n=$.trim(a.zip||""),
o=$.trim(a.country||""),q=i(a.phone||""),p=$.trim(a[e]||""),a=$.trim(a.id),b=b+c+h+j+k+l+m+n+o+q;$.trim(b)&&(f[b]||(f[b]=a),p&&!g[p]&&(g[p]=a))});_.each(c,function(a){var b=$.trim(a.addressee||""),c=$.trim(a.attention||""),j=$.trim(a.addr1||""),k=$.trim(a.addr2||""),l=$.trim(a.addr3||""),m=$.trim(a.city||""),n=$.trim(a.state||""),o=$.trim(a.zip||""),q=$.trim(a.country||""),p=i(a.phone||""),r=$.trim(a[e]||""),b=b+c+j+k+l+m+n+o+q+p;a.id=g[r]?g[r]:f[b]?f[b]:null;a.stateTemp=null;_.each(["defaultbilling",
"defaultshipping","isresidential"],function(b){_.isUndefined(a[b])&&(a[b]=!1)});_.each(["addressee","attention","addr1","addr2","addr3","city","state","zip","country","phone"],function(b){_.isUndefined(a[b])&&(a[b]="")});h.push(a)});b.set({addressbook:h})},q=function(c,e){logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - start customerRConfig",c,a);logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - start allAddresses",e,a);for(var f=b.baseSavedSearchId,g=b.fieldsToMatch,h=
c.nlobjFieldIds,i=[],j=0;g&&j<g.length;j++){var k=g[j],l=h[k];l&&i.push(new nlobjSearchFilter(k,null,"is",l))}logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - search filters",i,a);j=[new nlobjSearchColumn("internalid")];j[0].setSort(!0);j=$.search("customer",f,i,j);logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - customer search","found "+(j?j.length:0)+" customer",a);f=null;j&&j.length>0?(f=j[0].getId(),j.length>1&&b.selectMatchedCustomerRule&&(f=b.selectMatchedCustomerRule(j)),
f=new $R({nlobjRecordType:"customer",id:f,nlobjFieldIds:h})):f=new $R(c);h=n(f,e);f.save({reloadAfterSubmit:!0});i=f.get("addressbook");for(j=0;h&&j<h.length;j++){g=i[h[j].addressBookLineNum-1].addressid;k=h[j].indicesInOriginalAddressList;for(l=0;k&&l<k.length;l++)e[k[l]].addressid=g}logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - allAddresses final",e,a);logUntil("SalesOrderImportUtil - findCustomerAndAllAddresses - customer final",f.toString(),a);return{customer:f,allAddresses:e}},
r=function(a){b=a||{};b.taxTotalVarianceField=b.taxTotalVarianceField||"custbody_celigo_tax_total_variance";b.shipTotalVarianceField=b.shipTotalVarianceField||"custbody_celigo_ship_total_variance";b.discountTotalVarianceField=b.discountTotalVarianceField||"custbody_celigo_disc_total_variance";b.orderTotalVarianceField=b.orderTotalVarianceField||"custbody_celigo_order_total_variance"},p=function(a){var b=f.entity;if(b&&(b=b.nlobjFieldIds)){if(!a.addressee){var c=b.firstname,e=b.middlename,g=b.lastname,
h="";c&&(h+=c);e&&(h+=" "+e);g&&(h+=" "+g);a.addressee=h||""}if(!a.attention)a.attention=b.companyname||"";if(!a.phone)a.phone=b.phone||""}},w=function(a,b){if(b.lines)b=b.lines;for(var c=!1,e=0;b&&e<b.length;e++)if(b[e].taxrate1&&parseFloat(b[e].taxrate1)>0)c=b[e].istaxable=!0;if(c)a.istaxable=!0},u=function(a,b,c){var e=a.get("taxtotal")||0,f=a.get("shippingcost")||0,g=a.get("discounttotal")||0,a=a.get("total")||0,h=b.get("taxtotal")||0,i=b.get("shippingcost")||0,j=b.get("discounttotal")||0,k=b.get("total")||
0;b.set(c.taxTotalVarianceField,h-e);b.set(c.shipTotalVarianceField,i-f);b.set(c.discountTotalVarianceField,j-g);b.set(c.orderTotalVarianceField,k-a)},s=function(){var a=f.entity;a.nlobjSublistIds&&a.nlobjSublistIds.addressbook&&_.each(a.nlobjSublistIds.addressbook,function(a){p(a)});h&&_.each(h,function(a){a.shipaddress&&p(a.shipaddress)});f.shipaddress&&p(f.shipaddress);if(h&&h.length>0){var b=null;if(!_.any(h,function(a){if(a.shipaddress){var c=Celigo.util.trim(a.shipaddress.addressee||""),e=Celigo.util.trim(a.shipaddress.attention||
""),f=Celigo.util.trim(a.shipaddress.addr1||""),g=Celigo.util.trim(a.shipaddress.addr2||""),h=Celigo.util.trim(a.shipaddress.addr3||""),j=Celigo.util.trim(a.shipaddress.city||""),k=Celigo.util.trim(a.shipaddress.state||""),l=Celigo.util.trim(a.shipaddress.zip||""),m=Celigo.util.trim(a.shipaddress.country||""),a=i(a.shipaddress.phone||""),c=c+e+f+g+h+j+k+l+m+a;if(b)return c!==b;else b=c}return!1})&&(a=_.find(h,function(a){return!!a.shipaddress})))a=a.shipaddress,f.shipaddress=a,_.each(h,function(a){delete a.shipaddress})}for(var c=
[],a=!1,g=0;h&&g<h.length;g++)h[g].shipaddress&&(c.push(h[g].shipaddress),a=!0);a?f.ismultishipto=!0:f.shipaddress&&c.push(f.shipaddress);c=q(f.entity,c);f.entity=parseInt(c.customer.getId(),10);c=c.allAddresses;_.each(c,function(a){if(_.isString(a.addressid))a.addressid=parseInt(a.addressid,10)});if(a)for(g=0;h&&g<h.length;g++)h[g].shipaddress=c[g].addressid;else if(c&&c.length)f.shipaddresslist=c[0].addressid;$.log("so linkCustomerAndAddressesesAndWrapperIn$R",e);e=new $R(e)};return{inner_calculateVariances:function(a,
b,c){u(a,b,c)},inner_setOrderIsTaxable:function(a,b){w(a,b)},inner_processAddressWithIds:function(a,b,c){o(a,b,c)},inner_processAddressBook:function(a,b){n(a,b)},inner_linkCustomerAndAddresseses:function(a,b){j();r(b);k(a);s();return e},inner_linkCustomerAndAddressesesAndCalculateVariances:function(g,i){j();r(i);k(g);w(f,h);f.email=l(f.email);for(var m=0;h&&m<h.length;m++)h[m].giftcertrecipientemail=l(h[m].giftcertrecipientemail);s();logUntil("SalesOrderImportUtil - linkCustomerAndAddressesesAndCalculateVariances - sales order before save",
e.toString(),a);var m=e.save(),n=new $R({nlobjRecordType:"salesorder",id:m});u(e,n,b);c.length>0&&Celigo.Logger.error("Warnings: "+c.join(" | "),"last","salesorder",m);logUntil("SalesOrderImportUtil - linkCustomerAndAddressesesAndCalculateVariances - sales order final",n.toString(),a);return n}}}();Celigo.integrator.util.SalesOrderImportUtil.linkCustomerAndAddressesesAndCalculateVariances=function(a,b){return Celigo.integrator.util.SalesOrderImportUtil.inner_linkCustomerAndAddressesesAndCalculateVariances(a,
b)};Celigo.integrator.util.SalesOrderImportUtil.linkCustomerAndAddresseses=function(a,b){return Celigo.integrator.util.SalesOrderImportUtil.inner_linkCustomerAndAddresseses(a,b)};Celigo.integrator.util.SalesOrderImportUtil.processAddressBook=function(a,b){return Celigo.integrator.util.SalesOrderImportUtil.inner_processAddressBook(a,b)};Celigo.integrator.util.SalesOrderImportUtil.setOrderIsTaxable=function(a,b){return Celigo.integrator.util.SalesOrderImportUtil.inner_setOrderIsTaxable(a,b)};Celigo.integrator.util.SalesOrderImportUtil.calculateVariances=
function(a,b,c){return Celigo.integrator.util.SalesOrderImportUtil.inner_calculateVariances(a,b,c)};Celigo.integrator.util.SalesOrderImportUtil.processAddressWithIds=function(a,b,c){return Celigo.integrator.util.SalesOrderImportUtil.inner_processAddressWithIds(a,b,c)};$.namespace("Celigo.core.integrator.util");Celigo.core.integrator.util.SalesOrderImportUtil=Celigo.integrator.util.SalesOrderImportUtil;if($$.getContext().getScriptId()==="customscript_celigo_ftp_manager"||$$.getContext().getScriptId()===
"customscript_celigo_ftp_manager_s")$.namespace("Celigo.integrator.batch.file.poller"),Celigo.integrator.batch.file.poller.BatchFilePollerEntryPoint=function(){},Celigo.integrator.batch.file.poller.BatchFilePollerEntryPoint.prototype.scheduled=function(a){Celigo.connectors.poller.BatchFilePoller.scheduled(a)},Celigo.integrator.batch.file.poller.BatchFilePollerEntryPoint.prototype.suitelet=function(a,b){Celigo.connectors.poller.BatchFilePoller.suitelet(a,b)},Celigo.integrator.batch.file.poller.BatchFilePollerEntryPoint.prototype.getTestConfig=
function(){return{scheduled:{param:"custscript_celigo_ftp_manager_sta"}}};if($$.getContext().getScriptId()==="customscript_celigo_integrator_manager"||$$.getContext().getScriptId()==="customscript_celigo_integrator_manager_s")$.namespace("Celigo.integrator.batch.manager"),Celigo.integrator.batch.manager.IntegratorBatchManagerEntryPoint=function(){},Celigo.integrator.batch.manager.IntegratorBatchManagerEntryPoint.prototype.scheduled=function(a){(new Celigo.integrator.batch.manager.IntegratorBatchManager({})).scheduledScriptEntryPoint(a)},
Celigo.integrator.batch.manager.IntegratorBatchManagerEntryPoint.prototype.suitelet=function(a,b){(new Celigo.integrator.batch.manager.IntegratorBatchManager({})).suiteletScriptEntryPoint(a,b)};$.namespace("Celigo.integrator.logging");Celigo.integrator.logging.FailJobRunnable=function(a){Celigo.integrator.logging.FailJobRunnable.superclass.constructor.call(this,a);this.run=function(a){var c=new Celigo.integrator.logging.JobStatusLogger;a.recordType==="I"?c.convertToImportStatusLogger():a.recordType===
"E"&&c.convertToExportStatusLogger();c.setJobStatusLoggerID(a.id);c.setFailedStatus();c.setFailureMessage(a.staleReason);c.setEndTime(new Date);c.setNumberOfSuccesses(0);c.logStatus();$$.logExecution("AUDIT",'*** Setting Job to "Failed" status ***',a.staleReason);var e,f,g;a.recordType==="I"?(c=$$.loadRecord("customrecord_celigo_job_import",a.id),e=c.getFieldValue("custrecord_celigo_ji_log"),f=c.getFieldValue("custrecord_celigo_ji_integration"),g=c.getFieldValue("custrecord_celigo_ji_usecase")):a.recordType===
"E"&&(c=$$.loadRecord("customrecord_celigo_job_export",a.id),e=c.getFieldValue("custrecord_celigo_je_log"),f=c.getFieldValue("custrecord_celigo_je_integration"),g=c.getFieldValue("custrecord_celigo_je_usecase"));e&&Celigo.util.Logger.error(a.staleReason,e,f,null,null,g)}};Celigo.integrator.logging.FailJobRunnable.extend(Celigo.Runnable);$.namespace("Celigo.integrator.logging");Celigo.integrator.logging.IntegrationBatchJobLogManager=function(a){a=a||{};Celigo.integrator.logging.IntegrationBatchJobLogManager.superclass.constructor.call(this,
a);var b=null,c=null,e=function(a){b||(b=$$.loadConfiguration("companyinformation").getFieldValue("timezone"));if(b)a=$.dateUtil.convertDateToNewTimeZone(a,b).date;return a},f=e(new Date),g=null,h=function(a){var b=!1,h=null,j=a.getAllColumns(),n=a.getValue(j[2]),o=a.getValue(j[3]);if(n!=="T")o?(o=parseInt(o,10),(new Date).getTime()-o>36E5&&(b=!0,h="it resumed more than an hour ago and didn't yield, resume timestamp = "+o)):(o=null,n=new Date,(o=a.getValue("lastmodified"))&&(n=$$.stringToDate(o)),
n=e(n),$$.logExecution("DEBUG","now.getTime()",f.getTime()),$$.logExecution("DEBUG","lmd.getTime()",n.getTime()),$$.logExecution("DEBUG",f.getTime()-n.getTime(),c*36E5),f.getTime()-n.getTime()>c*36E5&&(b=!0,h="it has not been updated since "+n));else{var n=a.getValue(j[1]),q=a.getValue(j[4]),r=$$.createSearch("scheduledscriptinstance",[["datecreated","onorafter","yesterday"],"AND",["status","noneof","COMPLETE","FAILED"],"AND",["script.scriptid","is",q],"AND",["scriptdeployment.scriptid","is",n]]),
r=r.runSearch().getResults(0,1),b=!0;if(r&&r.length>0){if(r=$$.createSearch("customrecord_celigo_job_import",[["created","onorafter","yesterday"],"AND",["custrecord_celigo_ji_script_id","is",q],"AND",["custrecord_celigo_ji_deploy_id","is",n],"AND",["custrecord_celigo_ji_resume_ts","greaterthan",o]]),j=r.runSearch().getResults(0,1),!j||j.length===0)if(r=$$.createSearch("customrecord_celigo_job_export",[["created","onorafter","yesterday"],"AND",["custrecord_celigo_je_script_id","is",q],"AND",["custrecord_celigo_je_deploy_id",
"is",n],"AND",["custrecord_celigo_je_resume_ts","greaterthan",o]]),j=r.runSearch().getResults(0,1),!j||j.length===0)b=!1}else if($.sleep(),r=$$.loadRecord(a.getRecordType(),a.getId()),q=r.getFieldValue(j[2].getName()),j=r.getFieldValue(j[3].getName()),q==="F"||j!==o)b=!1;b&&(h="it yielded but the script deployment "+n+" is not in the queue anymore")}b&&(g="Job ID: "+a.getId()+" is stale because "+h,$$.logExecution("AUDIT","*** STALE JOB FOUND ***",g));return b},j=function(b){if(a.useCaseNameFilterForTestingPurpose){var c=
b.getSearchType()==="customrecord_celigo_job_import"?"custrecord_celigo_ji_usecase":"custrecord_celigo_je_usecase";b.addFilter(new nlobjSearchFilter("name",c,"startswith",a.useCaseNameFilterForTestingPurpose))}},c=a.JOB_IS_STALE_AFTER_HOURS||a.JOB_IS_STALE_AFTER_HOURS===0?a.JOB_IS_STALE_AFTER_HOURS:12;this.getListOfRunnableClassnames=function(){return["Celigo.integrator.logging.FailJobRunnable"]};this.getAllObjects=function(){var a,b=[];a=new Celigo.suitescript.Search;a.setSearchType("customrecord_celigo_job_import");
a.addFilter(new nlobjSearchFilter("custrecord_celigo_ji_status",null,"anyof",["4","7"]));j(a);a.addColumns([(new nlobjSearchColumn("lastmodified")).setSort(),new nlobjSearchColumn("custrecord_celigo_ji_deploy_id"),new nlobjSearchColumn("custrecord_celigo_ji_yielded"),new nlobjSearchColumn("custrecord_celigo_ji_resume_ts"),new nlobjSearchColumn("custrecord_celigo_ji_script_id")]);_.each(a.getResults(1E5),function(a){a&&h(a)&&b.push({recordType:"I",id:a.getId(),staleReason:g})});a=new Celigo.suitescript.Search;
a.setSearchType("customrecord_celigo_job_export");a.addFilter(new nlobjSearchFilter("custrecord_celigo_je_status",null,"anyof",["2","7"]));j(a);a.addColumns([(new nlobjSearchColumn("lastmodified")).setSort(),new nlobjSearchColumn("custrecord_celigo_je_deploy_id"),new nlobjSearchColumn("custrecord_celigo_je_yielded"),new nlobjSearchColumn("custrecord_celigo_je_resume_ts"),new nlobjSearchColumn("custrecord_celigo_je_script_id")]);_.each(a.getResults(1E5),function(a){a&&h(a)&&b.push({recordType:"E",
id:a.getId(),staleReason:g})});$$.logExecution("AUDIT","*** PREPARING TO FAIL JOBS ***",b.length);return b};this._testing_only_isStaleJob=h};Celigo.integrator.logging.IntegrationBatchJobLogManager.extend(Celigo.suitescript.scheduled.BatchProcess);if($$.getContext().getScriptId()==="customscript_celigo_int_job_checker")Celigo.integrator.logging.IntegrationBatchJobLogManager.prototype={getEmailsToNotifyOnError:function(){return["clinton@celigo.com"]},getThrowableErrorCodes:function(){return["all"]},
scheduled:function(){this.start()}};$.namespace("Celigo.integrator.logging");Celigo.integrator.logging.DeleteLogsAction=function(a){this.deleteLog=function(a){var c=0;if(a.amazonProcessingReports)for(c=0;c<a.amazonProcessingReports.length;c+=1)try{$$.deleteRecord("customrecord_celigo_amazon_processreport",a.amazonProcessingReports[c])}catch(e){}if(a.je)for(c=0;c<a.je.length;c+=1)try{$$.deleteRecord("customrecord_celigo_job_export",a.je[c])}catch(f){}if(a.ji)for(c=0;c<a.ji.length;c+=1)try{$$.deleteRecord("customrecord_celigo_job_import",
a.ji[c])}catch(g){}if(a.files)for(c=0;c<a.files.length;c+=1)try{$$.deleteFile(a.files[c])}catch(h){}try{$$.deleteRecord("customrecord_celigo_logger",a.id)}catch(j){}};Celigo.integrator.logging.DeleteLogsAction.superclass.constructor.call(this,a);this.run=function(a,c,e,f){this.deleteLog(a);if(c.reserved.runUntil<(new Date).getTime())$$.logExecution("AUDIT","TERMINATING SCRIPT - Out of time frame"),c.reserved.needToReschedule=!1,f.terminate()}};Celigo.integrator.logging.DeleteLogsAction.extend(Celigo.Runnable);
$.namespace("Celigo.integrator.logging");Celigo.integrator.logging.DeleteLogsBatch=function(a){Celigo.integrator.logging.DeleteLogsBatch.superclass.constructor.call(this,a);var b=this;$$.getContext();var c={daysAgo:90,startHours:0,endHours:6,startMinutes:0,endMinutes:0,maxRecords:2E3},e={EXPORT:"EXPORT",IMPORT:"IMPORT"},f=function(a,b){var c=0,f,g,m,c=[],n={},o,q=(new Date).getTime();c.push((new nlobjSearchColumn("internalid")).setSort(!0));a===e.EXPORT?(f="customrecord_celigo_job_export",g="custrecord_celigo_je_log",
c.push(new nlobjSearchColumn("custrecord_celigo_je_out_file"))):a===e.IMPORT&&(f="customrecord_celigo_job_import",g="custrecord_celigo_ji_log",c.push(new nlobjSearchColumn("custrecord_celigo_ji_error_file")),c.push(new nlobjSearchColumn("custrecord_celigo_ji_results")));c.push(new nlobjSearchColumn(g));m=$.search({type:f,filters:[new nlobjSearchFilter(g,null,"anyof",b)],columns:c});for(c=0;m&&c<m.length;c+=1)f=m[c].getValue(g),n.hasOwnProperty(f)||(n[f]=[]),a===e.EXPORT?o={id:m[c].getId(),exportFileId:m[c].getValue("custrecord_celigo_je_out_file")}:
a===e.IMPORT&&(o={id:m[c].getId(),errorFileId:m[c].getValue("custrecord_celigo_ji_error_file"),importFileId:m[c].getValue("custrecord_celigo_ji_results")}),n[f].push(o);$$.logExecution("AUDIT",a+" job search time",(new Date).getTime()-q);return n},g=function(a){var b,c={},e=[new nlobjSearchColumn("custrecord_celigo_mws_procrepor_jobexpor"),new nlobjSearchColumn("custrecord_celigo_mws_procrepor_file")],f=[new nlobjSearchFilter("custrecord_celigo_mws_procrepor_jobexpor",null,"anyof",a)],g=null;if(a.length===
0)return c;try{g=$.search({type:"customrecord_celigo_amazon_processreport",filters:f,columns:e})}catch(n){}_.each(g,function(a){b=a.getValue("custrecord_celigo_mws_procrepor_jobexpor");c.hasOwnProperty()||(c[b]={processingReportIds:[],processingReportFiles:[]});c[b].processingReportIds.push(a.getId());a.getValue("custrecord_celigo_mws_procrepor_file")&&c[b].processingReportFiles.push(a.getValue("custrecord_celigo_mws_procrepor_file"))});return c};this.getLogsAssociatedInfo=function(a){var b,c=0,k,
l=0,m=[],n=0,o=[],q,r,p,w=!1,u=0,s,v,t;q=f(e.EXPORT,a);r=f(e.IMPORT,a);_.each(q,function(a){_.each(a,function(a){o.push(a.id)})});b=g(o);for(l=0;a&&l<a.length;l+=1){p=a[l];m.push({id:p});s=[];v=[];t=[];c=0;if(q.hasOwnProperty(p)&&q[p].length>0){s=q[p];for(n=0;s&&n<s.length;n+=1)if(v.push(s[n].id),s[n].exportFileId&&t.push(s[n].exportFileId),k=b[s[n].id]){if(k.processingReportIds.length>0)m[l].amazonProcessingReports=k.processingReportIds,c+=k.processingReportIds.length;k.processingReportFiles.length>
0&&(t=t.concat(k.processingReportFiles))}m[l].je=v}if(r.hasOwnProperty(p)&&r[p].length>0){v=[];s=r[p];for(n=0;s&&n<s.length;n+=1)v.push(s[n].id),s[n].errorFileId&&t.push(s[n].errorFileId),s[n].importFileId&&t.push(s[n].importFileId);m[l].ji=v}m[l].files=t;u+=v.length*4+t.length*10+c*4;u+=4;if(u>=9900){w=!0;break}}w&&m.splice(l-1);return m};this.canRunTheScriptNow=function(a,c,e){var f;if(f=$$.loadConfiguration("companyinformation").getFieldValue("timezone"))e=$.dateUtil.convertDateToNewTimeZone(e,
f).date;f=$$.dateToString(e,"date");a=$$.stringToDate(f+" "+a);c=$$.stringToDate(f+" "+c);c.setMilliseconds(999);c.setSeconds(59);c.getTime()<a.getTime()&&(e.getTime()<c.getTime()?a.setTime(a.getTime()-864E5):c.setTime(c.getTime()+864E5));b.publicState.reserved.runUntil=(new Date).getTime()+(c.getTime()-e.getTime());$$.logExecution("AUDIT","START DATE",$$.dateToString(a,"datetimetz"));$$.logExecution("AUDIT","END DATE",$$.dateToString(c,"datetimetz"));$$.logExecution("AUDIT","NOW DATE",$$.dateToString(e,
"datetimetz"));$$.logExecution("AUDIT","Start Date",a.getTime());$$.logExecution("AUDIT","End Date",c.getTime());$$.logExecution("AUDIT","Now Date",e.getTime());return a.getTime()<=e.getTime()&&e.getTime()<=c.getTime()};this.getListOfRunnableClassnames=function(){return["Celigo.integrator.logging.DeleteLogsAction"]};this.getAllObjects=function(){var a=0,a=[],e=[],f,g,l,m,n;b.publicState.reserved.needToReschedule=!1;g=$$.getContext().getSetting("SCRIPT","custscript_celigo_delete_int_log_start");l=
$$.getContext().getSetting("SCRIPT","custscript_celigo_delete_int_log_end");f=$$.getContext().getSetting("SCRIPT","custscript_celigo_delete_int_log_daysago");n=c.maxRecords;g||(m=new Date,m.setHours(c.startHours),m.setMinutes(c.startMinutes),g=$$.dateToString(m,"timeofday"));l||(m=new Date,m.setHours(c.endHours),m.setMinutes(c.endMinutes),l=$$.dateToString(m,"timeofday"));if(!f)f=c.daysAgo;$$.logExecution("AUDIT","Params",{startTime:g,endTime:l,maxRecords:n,daysAgo:f});if(this.canRunTheScriptNow(g,
l,new Date)){$$.logExecution("AUDIT","RUNNING","SCRIPT");f={daysAgo:f,maxResults:n};g=[];a=(new Date).getTime();g.push(new nlobjSearchColumn("internalid"));g[0].setSort(!0);g.push(new nlobjSearchColumn("custrecord_celigo_logger_parent"));f=$.search({type:"customrecord_celigo_logger",filters:[new nlobjSearchFilter("created",null,"before","daysago"+f.daysAgo)],columns:g,maxResults:f.maxResults});$$.logExecution("AUDIT","Log search time/results",(new Date).getTime()-a+"ms/"+(f?f.length:0));if(!f||f.length===
0)return $$.logExecution("AUDIT","No logs to delete!"),[];b.publicState.reserved.needToReschedule=!0;for(a=0;f&&a<f.length;a+=1)e.push(f[a].getId());a=this.getLogsAssociatedInfo(e)}else $$.logExecution("AUDIT","TERMINATING SCRIPT - Out of time frame");return a};this.postProcess=function(){b.publicState.reserved.needToReschedule&&$$.scheduleScript($$.getContext().getScriptId(),$$.getContext().getDeploymentId())}};Celigo.integrator.logging.DeleteLogsBatch.extend(Celigo.BatchProcess);if($$.getContext().getScriptId()===
"customscript_celigo_integration_log_mgr")Celigo.integrator.logging.DeleteLogsBatch.prototype={getEmailsToNotifyOnError:function(){return["anshul.gupta@celigo.com","shiva.alluri@celigo.com"]},getThrowableErrorCodes:function(){return"all"},scheduled:function(){this.start()}};if($$.getContext().getScriptId()==="customscript_celigo_sdk_bundle_installat")$.namespace("Celigo.bundleinstall.integrator"),Celigo.bundleinstall.integrator.IntegratorBundleManagerEP=function(){},Celigo.bundleinstall.integrator.IntegratorBundleManagerEP.prototype=
{beforeInstall:function(a,b){(new Celigo.bundleinstall.integrator.IntegratorBundleManager).beforeInstall(a,b)},afterInstall:function(a,b){(new Celigo.bundleinstall.integrator.IntegratorBundleManager).afterInstall(a,b)},beforeUpdate:function(a,b){(new Celigo.bundleinstall.integrator.IntegratorBundleManager).beforeUpdate(a,b)},afterUpdate:function(a,b){(new Celigo.bundleinstall.integrator.IntegratorBundleManager).afterUpdate(a,b)},beforeUninstall:function(a){(new Celigo.bundleinstall.integrator.IntegratorBundleManager).beforeUninstall(a)}};
if($$.getContext().getScriptId()==="customscript_celigo_flow_recordtype_set")$.namespace("Celigo.suitescript.userevent.integrator"),Celigo.suitescript.userevent.integrator.Flow=function(){this.main=function(a){if($$.getContext().getExecutionContext()!=="scheduled"){if(a!=="create"&&a!=="edit"&&a!=="delete")throw $$.createError("CELIGO_UNEXPECTED_ERROR","Unsupported type: "+a);if($$.getRecordType()==="customrecord_celigo_batch_data_flow"){var b;b=null;if(a!=="delete"){a=Celigo.integrator.batch.DataFlowMetadata;
new Celigo.suitelet.services.integrator.configurator.DataFlowManager;if($$.getFieldValue(a.getFlowFldConfiguration()))b=$$.getFieldValue(a.getFlowFldConfiguration());else if($$.getFieldValue(a.getFlowFldConfig()))try{b=$$.loadFile($$.getFieldValue(a.getFlowFldConfig())).getValue()}catch(c){}b&&(b=(new Celigo.suitelet.services.integrator.configurator.DataFlowManager).getRecordTypesFromFlowConfig(b))&&b.length>0&&$$.setFieldValue("custrecord_celigo_batch_data_flow_record",b.join(","))}}}}},Celigo.suitescript.userevent.integrator.Flow.prototype=
{getThrowableErrorCodes:function(){return"all"},beforeSubmit:function(a){this.main(a)}};if($$.getContext().getScriptId()==="customscript_celigo_integrator_job_impor")$.namespace("Celigo.suitescript.userevent.integrator"),Celigo.suitescript.userevent.integrator.JobImport=function(){var a={COMPLETED:"3",COMPLETED_WITH_ERRORS:"2",COMPLETED_WITH_WARNINGS:"6",FAILED:"1",IN_PROGRESS:"4"};this.main=function(b){if(["create","edit"].indexOf(b)>-1){var c,e,f,b=nlapiGetFieldText("custrecord_celigo_ji_integration");
f=nlapiGetFieldText("custrecord_celigo_ji_usecase");e=nlapiGetFieldValue("custrecord_celigo_ji_status");if(["Manual Imports","Simple Imports"].indexOf(b)>-1&&f!=="CSV Files"&&[a.COMPLETED,a.COMPLETED_WITH_ERRORS,a.COMPLETED_WITH_WARNINGS,a.FAILED].indexOf(e.toString())>-1){nlapiSetFieldText("custrecord_celigo_ji_usecase","CSV Files");$$.submitField($$.getRecordType(),$$.getRecordId(),"custrecord_celigo_ji_usecase",nlapiGetFieldValue("custrecord_celigo_ji_usecase"));nlapiGetFieldValue("custrecord_celigo_ji_log")&&
(c=$$.searchRecord("customrecord_celigo_logger",null,[["internalid","is",nlapiGetFieldValue("custrecord_celigo_ji_log")],"OR",["custrecord_celigo_logger_parent","is",nlapiGetFieldValue("custrecord_celigo_ji_log")]]));if(c&&c.length>0)for(e=0;e<c.length&&$$.getContext().getRemainingUsage()>30;e+=1)try{$$.submitField("customrecord_celigo_logger",c[e].getId(),"custrecord_celigo_logger_usecase",nlapiGetFieldValue("custrecord_celigo_ji_usecase"))}catch(g){}if((c=$$.searchRecord("customrecord_celigo_batch_data_flow",
null,[["isinactive","is","T"],"AND",["custrecord_celigo_batch_data_flow_integr.name","is",b],"AND",["custrecord_celigo_batch_data_flow_usecas.name","is",f]],[new nlobjSearchColumn("custrecord_celigo_batch_data_flow_usecas")]))&&c.length>0){try{$$.deleteRecord(c[0].getRecordType(),c[0].getId())}catch(h){}try{$$.deleteRecord("customrecord_celigo_integration_usecase",c[0].getValue("custrecord_celigo_batch_data_flow_usecas"))}catch(j){}}}}}},Celigo.suitescript.userevent.integrator.JobImport.prototype=
{getThrowableErrorCodes:function(){return"all"},beforeSubmit:function(a){this.main(a)}};if(nlapiGetContext().getScriptId()==="customscript_celigo_auto_creat_rt_runner")$.namespace("Celigo.suitescript.userevent.integrator"),Celigo.suitescript.userevent.integrator.CreateRealTimeDeployment=function(){var a,b,c,e=function(c,e,f,i){c&&(e=e&&!f?b:a,nlapiLogExecution("debug","create deployment scriptid",e),(f=nlapiSearchRecord("scriptdeployment",null,[new nlobjSearchFilter("script",null,"is",e),new nlobjSearchFilter("recordtype",
null,"is",c)]))&&f.length?(nlapiLogExecution("audit","already deployed to record",c),i==="3"&&(nlapiLogExecution("audit","needs to update role to admin"),e=nlapiLoadRecord("scriptdeployment",f[0].getId()),e.getFieldValue("runasrole")!=="3"&&(e.setFieldValue("runasrole","3"),i=nlapiSubmitRecord(e),nlapiLogExecution("audit","updated deployment for record type"+c,i)))):(e=nlapiCreateRecord("scriptdeployment",{script:e}),e.setFieldValue("recordtype",c),e.setFieldValue("isdeployed","T"),e.setFieldValue("status",
"RELEASED"),e.setFieldValue("loglevel","AUDIT"),e.setFieldValue("allroles","T"),e.setFieldValue("runasrole",i),i=nlapiSubmitRecord(e),nlapiLogExecution("audit","created deployment for record type "+c,i)))},f=function(c,e,f,i){if(c){var k=e&&!f?b:a;nlapiLogExecution("debug","delete deployment scriptid",k);nlapiLogExecution("debug","delete deployment record type",c);if((e=nlapiSearchRecord("customrecord_celigo_rt_export_flow",null,[["custrecord_celigo_rt_export_recordtype","is",c],"and",["internalid",
"noneof",i],"and",e&&!f?[["custrecord_celigo_rt_async","is","T"],"and",["custrecord_celigo_rt_skip_script_queue","is","F"]]:[["custrecord_celigo_rt_async","is","F"],"or",["custrecord_celigo_rt_skip_script_queue","is","T"]]]))&&e.length)nlapiLogExecution("audit","deployment used by other data flows("+e.length+")");else if(e=nlapiSearchRecord("scriptdeployment",null,[new nlobjSearchFilter("script",null,"is",k),new nlobjSearchFilter("recordtype",null,"is",c)]),!e||!e.length)nlapiLogExecution("audit",
"no existing deployment(s)");else{try{nlapiDeleteRecord("scriptdeployment",e[0].getId())}catch(l){if(l&&l.getCode&&l.getCode()==="RCRD_DSNT_EXIST")return;throw l;}nlapiLogExecution("audit","deleted deployment for record type "+c+" with id "+e[0].getId())}}};this.updateDeployments=function(g){var h=nlapiGetFieldValue("custrecord_celigo_rt_export_sid"),j=nlapiGetFieldValue("custrecord_celigo_rt_export_flowid");if(h==="Magento Connector"&&j!=="MAGENTO_RT_FULFILLMENT_EXPORT"&&j!=="MAGENTO_RT_BILLING_EXPORT"||
h==="Magento Connector Plus"||h==="eBay Connector")nlapiLogExecution("audit","solution id indicates product with separate runner script : "+h);else{c||(c=nlapiGetContext());a=c.getSessionObject("celigo_sync_export_ue_id");if(!a){h=nlapiSearchRecord("script",null,[new nlobjSearchFilter("scriptid",null,"is","customscript_celigo_rt_export_flow_run")]);if(!h||!h.length)throw Error("Celigo Sync Export Script Not Found");c.setSessionObject("celigo_sync_export_ue_id",h[0].getId());a=c.getSessionObject("celigo_sync_export_ue_id")}b=
c.getSessionObject("celigo_async_export_ue_id");if(!b){h=nlapiSearchRecord("script",null,[new nlobjSearchFilter("scriptid",null,"is","customscript_celigo_async_rt_runner")]);if(!h||!h.length)throw Error("Celigo Async Export Script Not Found");c.setSessionObject("celigo_async_export_ue_id",h[0].getId());b=c.getSessionObject("celigo_async_export_ue_id")}if(!a||!b)throw Error("missing script ids");nlapiLogExecution("debug","script ids",a+", "+b);var h=nlapiGetFieldValue("custrecord_celigo_rt_export_recordtype")||
"",h=h.toUpperCase(),j=nlapiGetFieldValue("custrecord_celigo_rt_async")==="T",i=nlapiGetFieldValue("custrecord_celigo_rt_skip_script_queue")==="T",k=nlapiGetFieldValue("custrecord_celigo_rt_export_runasrole"),l=nlapiGetFieldValue("custrecord_celigo_rt_export_disabl")==="T";j&&!i&&(k="3");switch(g){case "create":l||e(h,j,i,k);break;case "delete":f(h,j,i,nlapiGetRecordId());break;case "edit":var m=nlapiGetOldRecord(),g=m.getFieldValue("custrecord_celigo_rt_export_recordtype")||"",g=g.toUpperCase(),
n=m.getFieldValue("custrecord_celigo_rt_async")==="T",o=m.getFieldValue("custrecord_celigo_rt_skip_script_queue")==="T",q=m.getFieldValue("custrecord_celigo_rt_export_runasrole"),m=m.getFieldValue("custrecord_celigo_rt_export_disabl")==="T";n&&(q="3");nlapiLogExecution("debug","old role "+q,"new role "+k);n!==j||g!==h||o!==i?(f(g,n,o,nlapiGetRecordId()),l||e(h,j,i,k)):k!==q&&k==="3"?l||e(h,j,i,k):m&&!l?e(h,j,i,k):!m&&l&&f(g,n,o,nlapiGetRecordId())}}};this.deriveSublists=function(){var a=[],b,c;try{var e=
nlapiGetFieldValue("custrecord_celigo_rt_export_conf");if(!e){var f=nlapiGetFieldValue("custrecord_celigo_rt_export_config");f&&(e=$$.loadFile(f).getValue())}e&&(b=JSON.parse(e))}catch(l){$$.logExecution("error","failed to get config string",l.message)}if(b&&b.requestMappingRef)try{c=Celigo.io.Serializable.revive(JSON.stringify(b.requestMappingRef))}catch(m){$$.logExecution("error","failed to instantiate mapping",m.message)}c&&(a=(new Celigo.integrator.realtime.ExportSublistParser).parse(c));$$.logExecution("audit",
"derived sublists",a);$$.submitField("customrecord_celigo_rt_export_flow",nlapiGetRecordId(),"custrecord_celigo_derived_subs",a.join(","))}},Celigo.suitescript.userevent.integrator.CreateRealTimeDeployment.prototype={getThrowableErrorCodes:function(){return"all"},afterSubmit:function(a){a!=="create"&&a!=="edit"&&a!=="delete"||(a!=="delete"&&this.deriveSublists(),this.updateDeployments(a))}};if($$.getContext().getScriptId()==="customscript_celigo_integrationerrorlog")$.namespace("Celigo.suitescript.userevent.integrator.notification"),
Celigo.suitescript.userevent.integrator.notification.IntegrationErrorLogNotification=function(){var a={TYPE:"customrecord_celigo_logger",FIELDS:{LEVEL:"custrecord_celigo_logger_level",MSG:"custrecord_celigo_logger_message",INTEGRATION:"custrecord_celigo_logger_integration",RECTYPE:"custrecord_celigo_logger_rec_type",RECID:"custrecord_celigo_logger_rec_id"}};return{beforeLoad:function(b,c){if(!(b!=="view"||$$.getContext().getExecutionContext()!=="userinterface"||!c||$$.getContext().getSetting("SCRIPT",
"custscript_celigo_disable_error_on_rec")==="T")){try{var e;var f=$$.getRecordType(),g=$$.getRecordId();if(!f||!g)e=null;else{var h=[new nlobjSearchColumn(a.FIELDS.MSG),new nlobjSearchColumn(a.FIELDS.INTEGRATION),new nlobjSearchColumn("internalid")];h[2].setSort(!0);var j=[new nlobjSearchFilter(a.FIELDS.RECTYPE,null,"is",f),new nlobjSearchFilter(a.FIELDS.RECID,null,"is",g),new nlobjSearchFilter(a.FIELDS.LEVEL,null,"anyof","2")],i=$$.searchRecord(a.TYPE,null,j,h);e=!i||!i.length?null:i[0]}var k;if(e){var l=
e.getText(a.FIELDS.INTEGRATION),m=e.getValue(a.FIELDS.MSG)+'<div><a target="_blank" href="'+$$.resolveURL("record",a.TYPE,e.getId())+'">view and resolve error</a></div>';k="<script type=\"text/javascript\">try{var alertEl = document.getElementById(\"div_celigo_alert\"); if(!alertEl){alertEl = document.createElement('div'); alertEl.id = 'div_celigo_alert'; document.getElementById('div__header').appendChild(alertEl);} showAlertBox('div_celigo_alert', '"+l.replace(/\n/g,"<br/>")+"', '"+m.replace(/\n/g,
"<br/>")+"', NLAlertDialog.TYPE_HIGH_PRIORITY,  '100%', null, null, null);}catch(e){};<\/script>"}else k=""}catch(n){$$.logExecution("error",n.name,n.message)}k&&(c.addField("custpage_celigo_integrationerrorlog","inlinehtml",null).setLayoutType("outsideabove","startrow"),c.setFieldValues({custpage_celigo_integrationerrorlog:k}))}}}}();if($$.getContext().getScriptId()==="customscript_celigo_rt_import_rest"||$$.getContext().getScriptId()==="customscript_celigo_mg_rt_import_rest"||$$.getContext().getScriptId()===
"customscript_celigo_ll_rt_import_rest"||$$.getContext().getScriptId()==="customscript_celigo_ebay_rt_import")$.namespace("Celigo.realtime.manager"),Celigo.realtime.manager.RestletDataFlowManager=function(){var a=Celigo.integrator.realtime.ImportMetadata,b=Celigo.integrator.dataflow.Factory,c=$.getExecutionLogger("Celigo.realtime.manager.RestletDataFlowManager");this.main=function(e,f){var g=null,h=null,j=null,i,k,l,m={},n=!1,o=null;try{try{if(!e)throw new Celigo.Error({name:"CELIGO_EMPTY_REQUEST_DATA_ERROR",
message:"Request is missing the request body"});if(o=$$.getContext().getSetting("SCRIPT","custscript_celigo_rt_import_flow_id"))h=o,j=e;else if(e.flowId==="ping")return{};else if(e.flowId==="markExported")return(new Celigo.integrator.hercules.Exported).markExported(e.data,e.booleanField);else if(e.jsonrpc){if(!e.id||!e.method||!e.params||!_.isArray(e.params))throw new Celigo.Error({name:"CELIGO_INVALID_REQUEST_DATA_ERROR",message:"Request is not a valid JSON-RPC Call."});if(e.params.length<2||!e.params[0].realtimeDataFlowId||
!e.params[1])throw new Celigo.Error({name:"CELIGO_INVALID_REQUEST_DATA_ERROR",message:"JSON-RPC Request is not in the correct format."});h=e.params[0].realtimeDataFlowId;j=e.params[1];m.id=e.id;m.jsonrpc=e.jsonrpc}else if(e.integrator)n=!0,g=new Celigo.integrator.hercules.Export({}),j=e;else if(e.flowId||e.import_da)n=!0,h=e.flowId,j=e.data,i=e.settings,k=e._importId,l=e.import_da;else{if(!e.metadata||!e.metadata.realtimeDataFlowId||!e.data)throw new Celigo.Error({name:"CELIGO_INVALID_REQUEST_DATA_ERROR",
message:"Request Missing Required Parameters : Realtime Data Flow Id and Flow Data."});h=e.metadata.realtimeDataFlowId;j=e.data}Celigo.event.dispatcher.Util.removeAllListeners();if(l)l.hooks=l.hooks||{},l.hooks.preMap=l.hooks.preMap||{},l.hooks.postMap=l.hooks.postMap||{},l.hooks.postSubmit=l.hooks.postSubmit||{},g=b.getDataFlowByConfigObject(l,{});g||(g=b.getDataFlowByRecordIdErrorOnInactiveOrDisabled(h,a))}catch(q){throw $L.error("Error loading flow due to Invalid Request Data ("+JSON.stringify(e)+
")\n"+Celigo.Error.format(q)),q;}var r=new Celigo.integrator.model.Document({content:j});g.setRequestDocument(r);var p=new Celigo.integrator.connectors.model.Message({data:g.getRequestDocument()});g.setRequestMessage(p);g.setInvocationContextByKey("httpMethod",f);i&&g.setInvocationContextByKey("herculesSettings",i);k&&g.setInvocationContextByKey("herculesImportId",k);c.audit("flow starts");var w=g.run();c.debug(w);c.audit("flow finishes");w instanceof Celigo.integrator.connectors.model.Message?o?
m=w.getData().getContent():m.result=w.getData().getContent():m=w}catch(u){c.error("Flow failed to run",Celigo.Error.format(u)),n?m={errors:[{code:u.name||u.getCode(),message:u.message||u.getDetails(),source:"adaptor"}]}:m.error={code:u.name,message:u.message}}return m}},Celigo.realtime.manager.RestletDataFlowManager.prototype.doGET=function(a){$$.logExecution("Debug","GET Request Recieved",a);return this.main(a,"GET")},Celigo.realtime.manager.RestletDataFlowManager.prototype.doPOST=function(a){$$.logExecution("Debug",
"POST Request Recieved",a);return this.main(a,"POST")},Celigo.realtime.manager.RestletDataFlowManager.prototype.doPUT=function(a){$$.logExecution("Debug","PUT Request Recieved",a);return this.main(a,"PUT")},Celigo.realtime.manager.RestletDataFlowManager.prototype.doDELETE=function(a){$$.logExecution("Debug","DELETE Request Recieved",a);return this.main(a,"DELETE")};if($$.getContext().getScriptId()==="customscript_celigo_batch_data_flow_rest")$.namespace("Celigo.integrator.batch"),Celigo.integrator.batch.RestletDataFlowRunner=
function(){var a=Celigo.integrator.batch.DataFlowMetadata,b=$.getExecutionLogger("Celigo.integrator.batch.RestletDataFlowRunner");Celigo.lang.require.setScriptSettingTTL(0);Celigo.lang.require.setScriptSettingPurge(!0);this.main=function(c){try{try{if(!c||!c.batchDataFlowId)throw new CeligoError({message:"missing batch data flow id"});Celigo.event.dispatcher.Util.removeAllListeners();var e=Celigo.integrator.dataflow.Factory.getDataFlowByRecordIdErrorOnInactiveOrDisabled(c.batchDataFlowId,a,c)}catch(f){throw b.error(CeligoError.format(f)),
$L.error("Error loading flow("+JSON.stringify(c)+")\n"+CeligoError.format(f)),f;}Celigo.integrator.dataflow.Runner.runDataFlow(e);return{success:!0}}catch(g){return{success:!1,errorCode:g.name,errorMessage:CeligoError.format(g)}}}},Celigo.integrator.batch.RestletDataFlowRunner.prototype.doPOST=function(a){return this.main(a)},Celigo.integrator.batch.RestletDataFlowRunner.prototype.doGET=function(a){return this.main(a)};if($$.getContext().getScriptId()==="customscript_celigo_batch_data_flow_run")$.namespace("Celigo.integrator.batch"),
Celigo.integrator.batch.ScheduledDataFlowRunner=function(){var a=Celigo.integrator.batch.DataFlowMetadata,b=Celigo.integrator.batch.Util,c=$.getExecutionLogger("Celigo.integrator.batch.ScheduledDataFlowRunner");this.u=b;this.logger=c;Celigo.lang.require.setScriptSettingTTL(0);Celigo.lang.require.setScriptSettingPurge(!0);this.main=function(){try{var b=$$.getContext().getSetting("SCRIPT",a.getFlowRunnerConfigParamId()),f=JSON.parse(b),g,h;if(!f||!f.batchDataFlowId)throw new Celigo.Error({message:"missing batch data flow id"});
Celigo.event.dispatcher.Util.removeAllListeners();c.debug("message ->","inside scheduled config -> "+JSON.stringify(f));if(f.reportId){var j=f.batchDataFlowId,b=f,i=$$.lookupField(a.getFlowRecType(),j,a.getFlowFldConfiguration());c.debug("response flow export config string",i);var k=JSON.parse(i);if(k.connector&&!k.asyncDownloadMethod)throw new Celigo.lang.NetSuiteError({name:"CELIGO_FLOW_CONFIG_ERROR",message:"Attribute asyncDownloadMethod must be specified for an Export flow with Async Response import."});
k.celigo_classname="Celigo.integrator.batch.Import";delete k.requestMapper;delete k.requestMappingRef;delete k.savedSearches;delete k.maxResults;if(k.connector)k.connector.method=k.asyncDownloadMethod;delete k.asyncResponseMethod;delete k.asyncDownloadMethod;_.extend(k,b);c.debug("running a response flow with config",k);g=k}h=Celigo.integrator.dataflow.Factory.getDataFlowByRecordId(f.batchDataFlowId,a,f,g);c.debug("message ->","inside scheduled config -> "+JSON.stringify(f));f.jobRecordId&&(h.setJobRecordId(f.jobRecordId),
c.debug("message ->","job record id must *not* be empty -> "+h.getJobRecordId()));f.integrationLogId&&(h.setIntegrationLogId(f.integrationLogId),c.debug("message ->","integration log record id must *not* be empty -> "+h.getIntegrationLogId()))}catch(l){c.error(CeligoError.format(l));if(f.jobRecordId&&f.jobRecordType){var m;switch(f.jobRecordType){case "import":m=Celigo.integrator.dataflow.ImportJobRecordMetadata;break;case "export":m=Celigo.integrator.dataflow.ExportJobRecordMetadata}m&&$$.submitField(m.getJobRecType(),
f.jobRecordId,[m.getJobFldStatus(),m.getJobFldMemo()],[m.getJobFldStatusList().FAILED,"data flow cannot be started"])}throw l;}try{Celigo.integrator.dataflow.Runner.runDataFlow(h)}catch(n){c.error(CeligoError.format(n)),this.setTestPrepFinished(h)}this.setTestPrepFinished(h)}},Celigo.integrator.batch.ScheduledDataFlowRunner.prototype.scheduled=function(){this.main()},Celigo.integrator.batch.ScheduledDataFlowRunner.prototype.setTestPrepFinished=function(a){!a||!_.isFunction(a.getInvocationContext)||
this.u.isBatchExport(a)?Celigo.ScriptManager.Test.setTestPrepFinished():(a=a.getInvocationContext(),this.logger.debug("dump context for test prep",a),a.lastBranch&&Celigo.ScriptManager.Test.setTestPrepFinished())},Celigo.integrator.batch.ScheduledDataFlowRunner.prototype.getTestConfig=function(){return{scheduled:{param:["custscript_celigo_batch_data_flow_param"]}}};if($$.getContext().getScriptId()==="customscript_celigo_batch_data_flow_suit"||$$.getContext().getScriptId()==="customscript_celigo_batch_data_flow_su_t")$.namespace("Celigo.integrator.batch"),
Celigo.integrator.batch.SuiteletDataFlowRunner=function(){var a=Celigo.integrator.batch.DataFlowMetadata,b=$.getExecutionLogger("Celigo.integrator.batch.SuiteletDataFlowRunner");Celigo.lang.require.setScriptSettingTTL(0);Celigo.lang.require.setScriptSettingPurge(!0);this.main=function(c,e){try{var f=c.getParameter("config");try{var g,h=!0;if(f)g=JSON.parse(f);else{g={};var j=c.getAllParameters(),i;for(i in j)_.has(j,i)&&(g[i]=c.getParameter(i),g[i]==="true"?g[i]=!0:g[i]==="false"&&(g[i]=!1))}if(!g||
_.isEmpty(g)||!g.batchDataFlowId)throw new Celigo.Error({message:"missing batch data flow id"});g.delegate===!1&&(h=!1);if(h){var k=Celigo.integrator.dataflow.Util,l=Celigo.integrator.dataflow.Factory.getDataFlowByRecordId(g.batchDataFlowId,a);if(k.isLastJobRunning(l)){b.audit("New job of data flow cannot be initiated because the last job is still in progress. Flow terminated.");e.setContentType("PLAINTEXT");e.write(JSON.stringify({success:!1,errorCode:"LAST_JOB_STILL_RUNNING",errorMessage:"New job of data flow cannot be initiated because the last job is still in progress. Flow terminated."}));
return}k.initializeJobRecord(l);if(!l.getJobRecordId())throw new Celigo.Error({name:"JOB_RECORD_INIT_ERROR",message:"job record should have been created"});if(!l.getIntegrationLogId())throw new Celigo.Error({name:"INTEGRATION_LOG_INIT_ERROR",message:"integration log should have been created"});g=_.extend(g,{jobRecordId:l.getJobRecordId(),integrationLogId:l.getIntegrationLogId(),jobRecordType:l.getJobStatusLoggerType()});Celigo.integrator.dataflow.Util.scheduleBatchDataFlowById(g.batchDataFlowId,g);
e.write(JSON.stringify({success:!0,delegate:h}));return}Celigo.event.dispatcher.Util.removeAllListeners();l=Celigo.integrator.dataflow.Factory.getDataFlowByRecordId(g.batchDataFlowId,a,g)}catch(m){throw b.error(CeligoError.format(m)),$L.error("Error loading flow("+f+")\n"+CeligoError.format(m)),m;}Celigo.integrator.dataflow.Runner.runDataFlow(l);e.setContentType("PLAINTEXT");e.write(JSON.stringify({success:!0,delegate:h}))}catch(n){e.setContentType("PLAINTEXT"),e.write(JSON.stringify({success:!1,
errorCode:n.name,errorMessage:CeligoError.format(n)}))}}},Celigo.integrator.batch.SuiteletDataFlowRunner.prototype.suitelet=function(a,b){a.getMethod()!=="POST"&&a.getMethod()!=="GET"||this.main(a,b)};$.namespace("Celigo.model.netsuite");Celigo.model.netsuite.Field=function(){var a,b,c;this.init=function(c,f){a=c;b=f};this.initWithNSField=function(a){c=a};this.getName=function(){return c?c.getName():a};this.getType=function(){return c?c.getType():b}};$.namespace("Celigo.model.netsuite");Celigo.model.netsuite.RecordJSONifier=
function(){this.logger=$.getExecutionLogger("Celigo.model.netsuite.RecordJSONifier")};Celigo.model.netsuite.RecordJSONifier.prototype.jsonifyField=function(a,b,c,e,f){this.fieldCount++;var g=!(!c||!e),h=a.getName(),j=function(){return f&&g?f.getLineItemValue(c,h,e):g?nlapiGetLineItemValue(c,h,e):f?f.getFieldValue(h):nlapiGetFieldValue(h)},i=function(a){return a.indexOf(String.fromCharCode(5))>-1?a.split(String.fromCharCode(5)):a.split("\r\n")},k=function(){var a;return f&&g?(a=f.getLineItemText(c,
h,e))?i(a):null:g?(a=nlapiGetLineItemText(c,h,e))?i(a):null:f?f.getFieldTexts(h):nlapiGetFieldTexts(h)};try{var l,m;switch(a.getType()){case "summary":case "subrecord":var n;n=f&&g?f.viewLineItemSubrecord(c,h,e):g?nlapiViewLineItemSubrecord(c,h,e):f?f.viewSubrecord(h):nlapiViewSubrecord(h);if(!n)break;for(var o=n.getAllFields(),a={},q=0;o&&q<o.length;q++){var r=n.getField(o[q]);if(r){var p=new Celigo.model.netsuite.Field;p.initWithNSField(r);this.jsonifyField(p,a,null,null,n)}}_.isEmpty(a)||(b[h]=
a,c==="addressbook"&&_.extend(b,a));break;case "checkbox":case "radio":l=j()==="T";b[h]=l;break;case "currency":case "float":case "posfloat":case "integer":l=j();l!==null&&l!==void 0&&l!==""&&(b[h]=+l);break;case "select":l=j();m=f&&g?f.getLineItemText(c,h,e):g?nlapiGetLineItemText(c,h,e):f?f.getFieldText(h):nlapiGetFieldText(h);l&&(b[h]={name:m,internalid:l});break;case "multiselect":l=f&&g?f.getLineItemValues(c,h,e):g?nlapiGetLineItemValues(c,h,e):f?f.getFieldValues(h):nlapiGetFieldValues(h);m=
k();if(l!==null&&l!==void 0&&l!==""&&l.length){b[h]=[];for(q=0;q<l.length;q++){var w={internalid:l[q]};if(m&&m[q])w.name=m[q];b[h].push(w)}}break;case "date":case "datetime":(l=j())&&a.getType()==="date"?l=this.convToDateSystemFormat(l):l&&a.getType()==="datetime"&&(l=this.convToDatetimeSystemFormat(l));l!==null&&l!==void 0&&l!==""&&(b[h]=l);break;default:l=j(),l!==null&&l!==void 0&&l!==""&&(b[h]=l)}}catch(u){this.logger.debug("error getting field "+(h?h:"unknown")+(c?" in sublist "+c:""))}};Celigo.model.netsuite.RecordJSONifier.prototype.jsonifySublist=
function(a,b,c,e){this.sublistCount++;c[a]=[];for(var f=this.__isUE__?this.getLineItemCount(a):this.getLineItemCount(a,e),g=1;g<=f;g++){this.sublistLineCount++;for(var h={},j=0;j<b.length;j++)this.__isUE__===!0?this.jsonifyField(b[j],h,a,g):this.jsonifyField(b[j],h,a,g,e);c[a].push(h);if(a==="addressbook"){if(h&&h.state&&!h.dropdownstate)h.dropdownstate={name:h.state};if(h&&h.country&&h.country.internalid==="US"&&h.dropdownstate&&h.dropdownstate.internalid==="WA"&&h.dropdownstate.name==="Western Australia")h.dropdownstate.name=
"Washington";if(h.defaultbilling)for(var i in h)if(h.hasOwnProperty(i)&&i!=="defaultbilling"&&(c["_billingaddress_"+i]=h[i],i==="addressbookaddress"&&h[i].dropdownstate))c._billingaddress_dropdownstate=h[i].dropdownstate;if(h.defaultshipping)for(i in h)if(h.hasOwnProperty(i)&&i!=="defaultshipping"&&(c["_shippingaddress_"+i]=h[i],i==="addressbookaddress"&&h[i].dropdownstate))c._shippingaddress_dropdownstate=h[i].dropdownstate}}};Celigo.model.netsuite.RecordJSONifier.prototype.getLineItemCount=function(a,
b){return!a?0:this.__isUE__===!0?nlapiGetLineItemCount(a):!b?0:b.getLineItemCount(a)};Celigo.model.netsuite.RecordJSONifier.prototype.jsonifyUE=function(a){this.__isUE__=!0;return this.jsonify(nlapiGetNewRecord()||nlapiGetOldRecord(),nlapiGetRecordType(),nlapiGetRecordId(),a)};Celigo.model.netsuite.RecordJSONifier.prototype.jsonifyRec=function(a,b){if(!a||typeof a.getRecordType!=="function"||typeof a.getId!=="function")return null;var c=a.getRecordType();if(!c)return null;var e=a.getId()||"";this.__isUE__=
!1;return this.jsonify(a,c,e,b)};Celigo.model.netsuite.RecordJSONifier.prototype.jsonify=function(a,b,c,e){if(a&&b){e=e||{};this.logger.debug("sublists specified",Object.keys(e));this.startts=(new Date).getTime();this.fieldCount=this.sublistLineCount=this.sublistCount=0;for(var f={recordtype:b,id:c,internalid:c},g=a.getAllFields()||[],h=!1,j=!1,i=0;i<g.length;i++){g[i]==="billingaddress"&&(h=!0);g[i]==="shippingaddress"&&(j=!0);try{var k=a.getField(g[i])}catch(l){this.logger.error('error getting value for field "'+
g[i]+'"');continue}if(k){var m=new Celigo.model.netsuite.Field;m.initWithNSField(k);this.__isUE__===!0?this.jsonifyField(m,f):this.jsonifyField(m,f,null,null,a)}}if(Celigo.model.netsuite.RecordJSONifier.TRANSACTIONTYPES[b.toLowerCase()]){g=[];h||g.push("billingaddress");j||g.push("shippingaddress");for(i=0;i<g.length;i++)h=new Celigo.model.netsuite.Field,h.init(g[i],"summary"),this.__isUE__===!0?this.jsonifyField(h,f):this.jsonifyField(h,f,null,null,a)}if(b.toLowerCase()==="customer"&&f.currency)f.primarycurrency=
f.currency;i=(i=a.getAllSublists())?i.slice():null;for(h=0;i&&h<i.length;h++)if(j=i[h].toString(),e[j.toLowerCase()])if(g=(g=a.getAllLineItemFields(j))?g.slice():null,!g||!g&&j.toLowerCase()==="usernotes"){j=[new nlobjSearchFilter("internalidnumber",null,"equalto",c)];g=[new nlobjSearchColumn("internalid","usernotes"),new nlobjSearchColumn("direction","usernotes")];if((j=$$.searchRecord(b,null,j,g))&&j.length){g=[];k=new Celigo.model.netsuite.RecordJSONifier;for(m=0;m<j.length;m++)try{var n=j[m].getValue("internalid",
"usernotes"),o=$$.loadRecord("note",n),q=k.jsonifyRec(o),r={incoming:"1",outgoing:"2"};if(q){var p=j[m].getValue("direction","usernotes");if(p)q.direction={name:p,internalid:r[p.toLowerCase()]||0};g.push(q)}}catch(w){this.logger.error("fail to serialize user notes:"+w.message)}if(g&&g.length)f.usernotes=g}this.sublistCount++}else{for(var u=[],k=0;g&&k<g.length;k++){try{var s=a.getLineItemField(j,g[k],1)}catch(v){this.logger.error('error getting value for line field "'+j+'"');continue}s&&(m=new Celigo.model.netsuite.Field,
m.initWithNSField(s),u.push(m))}+nlapiGetContext().getVersion()>=2014.2&&j==="addressbook"&&(m=new Celigo.model.netsuite.Field,m.init("addressbookaddress","subrecord"),u.push(m));+nlapiGetContext().getVersion()>=2015.1&&b==="itemfulfillment"&&j==="item"&&(g=new Celigo.model.netsuite.Field,g.init("inventorydetail","subrecord"),u.push(g));u.length&&this.getLineItemCount(j,a)&&this.jsonifySublist(j,u,f,a)}if(f&&f.tranid&&f.tranid.toLowerCase&&f.tranid.toLowerCase()=="to be generated"){try{u=$$.lookupField("transaction",
c,["tranid","status"]),f.tranid=u.tranid,f.status=u.status}catch(t){this.logger.error("failed to look up non-initialized transaction fields(tranid)")}if(f.id&&f.item&&_.isArray(f.item)&&f.item.length)for(e=0;e<f.item.length;e++)if(!f.item[e].id)f.item[e].id=f.id+"_"+(e+1)}try{var y=$$.lookupField(b,c,"datecreated"),y=this.convToDatetimeSystemFormat(y);f.datecreated=y}catch(x){this.logger.error("failed to look up datecreated field",x.message)}if(!f.status&&(b==="invoice"||b==="creditmemo"||b==="customerpayment"||
b==="customerdeposit"))try{f.status=$$.lookupField("transaction",c,"status")}catch(B){this.logger.error("failed to look up non-initialized transaction fields(status)")}if(Celigo.model.netsuite.RecordJSONifier.TRANSACTIONTYPES[b.toLowerCase()]){var A=this;_.map(["billattention","billaddressee","billphone","billaddr1","billaddr2","billcity","billstate","billcountry","billzip","shipattention","shipaddressee","shipphone","shipaddr1","shipaddr2","shipcity","shipstate","shipcountry","shipzip"],function(b){try{var c=
new Celigo.model.netsuite.Field;c.init(b,"text");A.__isUE__===!0?A.jsonifyField(c,f):A.jsonifyField(c,f,null,null,a);_.each(["billattention","billaddressee","billphone","billaddr1","billaddr2","billcity","billstate","billcountry","billzip"],function(a){f[a]&&(f["_billingaddress_"+a]=f[a])});_.each(["shipattention","shipaddressee","shipphone","shipaddr1","shipaddr2","shipcity","shipstate","shipcountry","shipzip"],function(a){f[a]&&(f["_shippingaddress_"+a]=f[a])})}catch(e){}})}try{var z;if((z=a?a.getField("salesrep"):
nlapiGetField("salesrep"))&&z.type==="integer"){var E=a?a.getFieldValue("salesrep"):nlapiGetFieldValue("salesrep");if(E){var C=$$.lookupField("employee",E,"entityId");if(C)f.salesrep={internalid:E,name:C}}}}catch(F){}this.logger.audit("stats",["sublists",this.sublistCount,"sublist lines",this.sublistLineCount,"fields",this.fieldCount,"time",(new Date).getTime()-this.startts].join(" "));f.internalid=f.id;return f}};Celigo.model.netsuite.RecordJSONifier.prototype.getDateTimeFormats=function(){if(this.DATE_USER_FORMAT==
null)try{var a=nlapiLoadConfiguration("userpreferences");this.DATE_USER_FORMAT=(a.getFieldValue("DATEFORMAT")||"").replace(/Month/i,"MMMM").replace(/Mon/i,"MMM");this.TIME_USER_FORMAT=Celigo.model.netsuite.RecordJSONifier.convToMomentTimeFormat(a.getFieldValue("TIMEFORMAT")||"");if(this.DATE_USER_FORMAT&&this.TIME_USER_FORMAT)this.DATETIME_USER_FORMAT=this.DATE_USER_FORMAT+" "+this.TIME_USER_FORMAT;a=nlapiLoadConfiguration("companypreferences");this.DATE_SYSTEM_FORMAT=(a.getFieldValue("DATEFORMAT")||
"").replace(/Month/i,"MMMM").replace(/Mon/i,"MMM");this.TIME_SYSTEM_FORMAT=Celigo.model.netsuite.RecordJSONifier.convToMomentTimeFormat(a.getFieldValue("TIMEFORMAT")||"");if(this.DATE_SYSTEM_FORMAT&&this.TIME_SYSTEM_FORMAT)this.DATETIME_SYSTEM_FORMAT=this.DATE_SYSTEM_FORMAT+" "+this.TIME_SYSTEM_FORMAT;this.logger.audit("date format",this.DATE_USER_FORMAT+" -> "+this.DATE_SYSTEM_FORMAT);this.logger.audit("date time format",this.DATETIME_USER_FORMAT+" -> "+this.DATETIME_SYSTEM_FORMAT)}catch(b){this.logger.error("fail to get date/time formats",
b.message)}};Celigo.model.netsuite.RecordJSONifier.prototype.convToDateSystemFormat=function(a){this.getDateTimeFormats();if(!this.DATE_USER_FORMAT||!this.DATE_SYSTEM_FORMAT||this.DATE_USER_FORMAT===this.DATE_SYSTEM_FORMAT)return a;try{var b=moment(a,this.DATE_USER_FORMAT).format(this.DATE_SYSTEM_FORMAT);if(b==="Invalid Date")throw Error("invalid date conversion("+this.DATE_USER_FORMAT+"->"+this.DATE_SYSTEM_FORMAT+"): "+a);return b}catch(c){return this.logger.error("error converting to system date",
c.message),a}};Celigo.model.netsuite.RecordJSONifier.prototype.convToDatetimeSystemFormat=function(a){this.getDateTimeFormats();if(!this.DATETIME_USER_FORMAT||!this.DATETIME_SYSTEM_FORMAT||this.DATETIME_USER_FORMAT===this.DATETIME_SYSTEM_FORMAT)return a;try{var b=moment(a,this.DATETIME_USER_FORMAT).format(this.DATETIME_SYSTEM_FORMAT);if(b==="Invalid Date")throw Error("invalid datetime conversion("+this.DATETIME_USER_FORMAT+"->"+this.DATETIME_SYSTEM_FORMAT+"): "+a);return b}catch(c){return this.logger.error("error converting to system datetime",
c.message),a}};Celigo.model.netsuite.RecordJSONifier.convToMomentTimeFormat=function(a){switch(a){case "fmHH24-fmMI":return"HH-mm";case "fmHH24:fmMI":return"HH-mm";case "fmHH-fmMI am":return"hh-mm a";case "fmHH:fmMI am":return"hh:mm a";default:return a}};Celigo.model.netsuite.RecordJSONifier.TRANSACTIONTYPES={salesorder:!0,opportunity:!0,estimate:!0,assemblybuild:!0,assemblyunbuild:!0,cashrefund:!0,cashsale:!0,check:!0,creditmemo:!0,customerdeposit:!0,customerpayment:!0,customerrefund:!0,depositapplication:!0,
expensereport:!0,intercompanyjournalentry:!0,inventoryadjustment:!0,invoice:!0,itemfulfillment:!0,itemreceipt:!0,journalentry:!0,purchaseorder:!0,returnauthorization:!0,timebill:!0,vendorbill:!0,vendorcredit:!0,vendorpayment:!0,vendorreturnauthorization:!0,workorder:!0,transferorder:!0,inventorytransfer:!0};$.namespace("Celigo.integrator.realtime.async");Celigo.integrator.realtime.async.CriteriaChecker=function(){var a=function(){function a(b,c){return b!==c}function b(a,c){return a>c}function c(a,
b){return a>=b}function e(a,b){return a<b}function f(a,b){return a<=b}function g(a,b){return String(a==null?"":a).indexOf(String(b==null?"":b))>-1}return{and:function(a,b){return a===!0&&b===!0},or:function(a,b){return a===!0||b===!0},"=":function(a,b){return a===b},"<>":a,"&lt;&gt;":a,"!=":a,">":b,"&gt;":b,gt:b,">=":c,"&gt;=":c,ge:c,"<":e,"&lt;":e,lt:e,"<=":f,"&lt;=":f,le:f,"?":function(a,b){return RegExp(b,"ig").test(String(a))},empty:function(a,b){return b!==!0&&b!==!1?!1:(a==null||a==""||_.isArray(a)&&
!a.length)===b},contains:g,doesNotContain:function(a,b){return!g(a,b)}}}(),b=function(){return{text:function(a,b,c){return c?c.text[a]:b?b.getFieldText(a):nlapiGetFieldText(a)},val:function(a,b,c){return c?c.val[a]:b?b.getFieldValue(a):nlapiGetFieldValue(a)},texts:function(a,b,c){return c?c.texts[a]:b?b.getFieldTexts(a):nlapiGetFieldTexts(a)},vals:function(a,b,c){return c?c.vals[a]:b?b.getFieldValues(a):nlapiGetFieldValues(a)}}}(),c=function(a,b){var c=Error(b);c.name=a;throw c;},e=function(a){return _.isArray(a)&&
a.length},f,g=function(h,i,k){h.length!==3&&c("PARSE_ERROR","invalid number of operands");(!_.isString(h[1])||!a[h[1]])&&c("PARSE_ERROR","invalid operation "+h[1]);if(e(h[0]))i&&g(h[0],i,k);else if(_.isString(h[0])){var l=h[0];_.isString(l)||c("PARSE_ERROR","field identifier must be string");(l=l.trim().toLowerCase())||c("PARSE_ERROR","field identifier cannot be empty");var m=l.split(":"),n,o;m.length===1?(n="val",o=l):m.length===2?(n=m[0],b[n]||c("PARSE_ERROR","invalid field operation "+n),o=m[1]):
c("PARSE_ERROR","cannot understand field and/or operation "+l);if(k&&(l=o)&&n)f=f||{},f[n]||(f[n]={}),f[n][l]=1}else c("PARSE_ERROR","cannot understand field identifier "+h[0]);e(h[2])&&i&&g(h[2],i,k)},h=function(c,f,k){g(c,!1,!1);var l;if(e(c[0]))l=h(c[0],f,k);else{l=c[0].trim().toLowerCase().split(":");var m,n;l.length===1?(m=b.val,n=l[0]):l.length===2&&(m=b[l[0]],n=l[1]);l=m(n,f,k)}m=a[c[1]];if(m===a.and&&l!==!0)return!1;if(m===a.or&&l===!0)return!0;c=e(c[2])?h(c[2],f,k):c[2];if(!(_.isArray(l)||
Object.prototype.toString.call(l)==="[object JavaArray]")||m===a.empty)return m(l,c);for(f=0;f<l.length;f++)if(m(l[f],c)===!0)return!0;return!1};this.evaluate=function(a,b,g){var l;try{l=JSON.parse(a)}catch(m){c("INVALID_EXPR",m.message)}(!l||!e(l))&&c("INVALID_EXPR","invalid expression");f=null;return h(l,b,g)};this.parseFields=function(a){var b;try{b=JSON.parse(a)}catch(h){c("INVALID_EXPR",h.message)}(!b||!e(b))&&c("INVALID_EXPR","invalid expression");f=null;g(b,!0,!0);return f}};$.namespace("Celigo.integrator.realtime.async");
Celigo.integrator.realtime.async.Export=function(){this.logger=$.getExecutionLogger("Celigo.integrator.realtime.async.Export")};Celigo.integrator.realtime.async.Export.prototype.getRecordType=function(){var a=nlapiGetRecordType();return{noninventorysaleitem:"noninventoryitem",noninventoryresaleitem:"noninventoryitem",noninventorypurchaseitem:"noninventoryitem",servicesaleitem:"serviceitem",serviceresaleitem:"serviceitem",servicepurchaseitem:"serviceitem"}[a]||a};Celigo.integrator.realtime.async.Export.prototype.getRecordId=
function(){return nlapiGetRecordId()};Celigo.integrator.realtime.async.Export.prototype.getRecordJSONObject=function(a){return(new Celigo.model.netsuite.RecordJSONifier).jsonifyUE(a)};Celigo.integrator.realtime.async.Export.prototype.scheduleRunner=function(){var a=!0;try{var b=1;try{b=$$.getContext().getQueueCount()}catch(c){}if(b===1)a=!1,nlapiScheduleScript("customscript_celigo_consumer_runner");else{var e=$$.getContext().getSetting("SCRIPT","custscript_celigo_batch_data_flow_queues");if(!e||!e.length)a=
!1,nlapiScheduleScript("customscript_celigo_consumer_runner");else if(e=_.filter(e.split(","),function(a){return a&&!_.isNaN(+a)&&+a>=1&&+a<=b}),e.length){for(var f=[new nlobjSearchFilter("scriptid","script","is","customscript_celigo_consumer_runner"),new nlobjSearchFilter("status",null,"noneof",["COMPLETE","FAILED"])],g=[(new nlobjSearchColumn("datecreated")).setSort(!0),new nlobjSearchColumn("internalid","scriptdeployment"),new nlobjSearchColumn("status")],h=nlapiSearchRecord("scheduledscriptinstance",
null,f,g),j={},i=0;h&&i<h.length;++i)j[h[i].getValue("internalid","scriptdeployment")]=1;f=[new nlobjSearchFilter("scriptid","script","is","customscript_celigo_consumer_runner"),new nlobjSearchFilter("status",null,"anyof","NOTSCHEDULED"),new nlobjSearchFilter("isdeployed",null,"is","T")];g=[new nlobjSearchColumn("internalid"),new nlobjSearchColumn("status"),new nlobjSearchColumn("queueid"),new nlobjSearchColumn("scriptid")];h=$$.searchRecord("scriptdeployment",null,f,g);if(!h||!h.length)nlapiLogExecution("DEBUG",
"no deployment found","Deploy atleast one deployment of Celigo Consumer Runner");else{for(i=0;i<h.length;++i)if(e.indexOf(h[i].getValue("queueid"))>-1&&!j[h[i].getId()]){a=!1;nlapiScheduleScript("customscript_celigo_consumer_runner",h[i].getValue("scriptid"));return}nlapiLogExecution("DEBUG","no proper deployment found","Either no deployment found on appropriate queue with Not Scheduled status or all deployments are busy")}}}}catch(k){a&&nlapiScheduleScript("customscript_celigo_consumer_runner")}};
Celigo.integrator.realtime.async.Export.prototype.main=function(a,b,c,e,f,g,h){if(!a||!b||!c||!e||!f||!g)this.logger.error("missing parameter(s), expecting event type, execution type, environment, company id, role)",Array.prototype.join.call(arguments,","));else{var j=(this.getRecordType()||"").toLowerCase();if(j){var i=(b||"").toLowerCase(),k=(a||"").toLowerCase(),l=(c||"").toUpperCase(),m=(g||"").toLowerCase();this.logger.debug("event type: "+k+"; execution type: "+i+"; execution context: "+m);
var n=Celigo.integrator.realtime.ExportMetadata,o=n.getFlowFldExecutionTypeList()[i];if(o){var q=n.getFlowFldEventTypeList()[k];if(q){var r=n.getFlowFldContextTypeList()[m];if(r)if(m=[new nlobjSearchFilter(n.getFlowFldAsync(),null,"is","T"),new nlobjSearchFilter(n.getFlowFldRecordType(),null,"is",j),new nlobjSearchFilter(n.getFlowFldEventType(),null,"anyof",q),new nlobjSearchFilter(n.getFlowFldExecutionType(),null,"anyof",o),new nlobjSearchFilter(n.getFlowFldExecutionContext(),null,"anyof",["@NONE@",
r]),new nlobjSearchFilter("name",n.getFlowFldEnvironment(),"is",l),new nlobjSearchFilter("isinactive",null,"is","F"),new nlobjSearchFilter(n.getFlowFldDisabled(),null,"is","F")],h?m.push(new nlobjSearchFilter(n.getFlowFldSkipScriptQueue(),null,"is","T")):m.push(new nlobjSearchFilter(n.getFlowFldSkipScriptQueue(),null,"is","F")),o=[new nlobjSearchColumn(n.getFlowFldIntegration()),new nlobjSearchColumn(n.getFlowFldDerivedSublists()),new nlobjSearchColumn(n.getFlowFldRequestedSublists()),new nlobjSearchColumn(n.getFlowFldQualifier()),
new nlobjSearchColumn(n.getFlowFldIntegratorIOFlowId()),new nlobjSearchColumn(n.getFlowFldForceReload()),new nlobjSearchColumn(n.getFlowFldPlugins()),new nlobjSearchColumn(n.getFlowFldHookPreSendFile()),new nlobjSearchColumn(n.getFlowFldHookPreSendFunc()),new nlobjSearchColumn(n.getFlowFldHookPreSendConfig()),new nlobjSearchColumn(n.getFlowFldIsStaging())],m=nlapiSearchRecord(n.getFlowRecType(),null,m,o),!m||!m.length)this.logger.audit("no valid data flow is found");else{this.logger.audit("data flow records",
m.length);for(var o=[],p={},q=new Celigo.integrator.realtime.async.CriteriaChecker,w,r=!1,u=0;u<m.length;u++){var s=m[u].getValue(n.getFlowFldQualifier());if(s&&s.trim())if(i==="xedit"&&k==="aftersubmit")try{var v=q.parseFields(s);this.logger.debug("fields",JSON.stringify(v));if(v){var t=_.keys(v.val||{}),y=_.keys(v.text||{}),x=_.keys(v.vals||{}),B=_.keys(v.texts||{});if(x.length||B.length){if(!w&&!r){try{this.logger.debug("loading record..."),w=nlapiLoadRecord(this.getRecordType(),this.getRecordId())}catch(A){this.logger.error("qualification reload exception:"+
A.name+" - "+A.message),this.logger.audit("in memory record serialization is used")}r=!0}if(w){if(!q.evaluate(s,w))continue}else if(!q.evaluate(s))continue}else{var z={};if(t.length){var E=nlapiLookupField(j,nlapiGetRecordId(),t);z.val={};_.each(E,function(a,b){z.val[b]=a})}if(y.length){var C=nlapiLookupField(j,nlapiGetRecordId(),y,!0);z.text={};_.each(C,function(a,b){z.text[b]=a})}this.logger.debug("valMap",JSON.stringify(z));if(!q.evaluate(s,null,z))continue}}}catch(F){this.logger.error("qualifier exception "+
m[u].getId(),F.name+" - "+F.message);continue}else try{if(!q.evaluate(s,i==="delete"?nlapiGetOldRecord():void 0))continue}catch(I){this.logger.error("qualifier exception "+m[u].getId(),I.name+" - "+I.message);continue}this.logger.debug("qualified "+m[u].getId(),s.trim());o.push(m[u]);var s=(m[u].getValue(n.getFlowFldDerivedSublists())||"").split(","),L=(m[u].getValue(n.getFlowFldRequestedSublists())||"").split(",");_.each(s.concat(L),function(a){a&&(p[a]=1)})}m=o;if(m.length){for(var j=this.getRecordJSONObject(p),
M,v=Celigo.integrator.dataflow.InvocationContext,t=new Celigo.io.MessageManager,y=new Celigo.integrator.consumer.IntegratorIOConsumer,x=!1,B=0;B<m.length;B++){o=m[B];E={};E[v.dataFlowType]="realtime";E[v.dataFlowDirection]="export";E[v.dataFlowRecordType]=n.getFlowRecType();E[v.dataFlowRecordId]=o.getId();E[v.eventType]=k;E[v.executionType]=i;E.timestamp=(new Date).getTime();E.environment=l;E.company=e;E.uuid=$.uuid(16);E.forceReload=o.getValue(n.getFlowFldForceReload())==="T";E.sublists=JSON.stringify(p);
C=j;if(E.forceReload&&this.getRecordType()&&this.getRecordId()&&i!=="xedit"&&!(i==="delete"&&k==="aftersubmit")&&!(i==="create"&&k==="beforesubmit")){if(!M)try{this.logger.debug("loading record...");var J;J=w?w:nlapiLoadRecord(this.getRecordType(),this.getRecordId());M=(new Celigo.model.netsuite.RecordJSONifier).jsonifyRec(J,p)}catch(G){this.logger.error("force reload exception:"+G.name+" - "+G.message),this.logger.audit("in memory record serialization is used"),M=j}C=M}if(o.getValue(n.getFlowFldIntegratorIOFlowId())){if(E[v.integratorIOFlowId]=
o.getValue(n.getFlowFldIntegratorIOFlowId()),E.isStaging=o.getValue(n.getFlowFldIsStaging())==="T",E.consumerType="Celigo.integrator.consumer.IntegratorIOConsumer",E=new Celigo.io.Message({header:JSON.stringify(E),payload:C?JSON.stringify(C):""}),C=!!o.getValue(n.getFlowFldPlugins()),o=!(!o.getValue(n.getFlowFldHookPreSendFile())&&!o.getValue(n.getFlowFldHookPreSendFunc())),q=$$.lookupField("customrecord_celigo_global_cache",1,"custrecord_iio_api_down_at"),+q===NaN&&(q=0),(q=!!((new Date).getTime()-
+q<9E5))&&this.logger.audit("backing off in-line delivery attempts"),h||i!=="xedit"&&!C&&!o&&!q)try{if(y.setEmitEvents(!!h),y.setInvokeHook(!!h),y.consumeMessage(E)){this.logger.audit("message delivered to IntegratorIO successfully");continue}}catch(H){this.logger.error("error attempting in-line delivery, caused by: "+H.name+" - "+H.message)}}else if(E.consumerType="Celigo.integrator.consumer.DataFlowMessageConsumer",E=new Celigo.io.Message({header:JSON.stringify(E),payload:C?JSON.stringify(C):""}),
h)try{t.consumeOnce(E)}catch(K){this.logger.error("error attempting in-line execution, caused by: "+K.name+" - "+K.message)}h||(t.enqueueMessage(E),this.logger.audit("message queued with id "+E.getMessageProperty("id")),x=!0)}!h&&x&&this.scheduleRunner()}else this.logger.audit("no data flow is qualified")}else this.logger.error("invalid execution context",m)}else this.logger.error("invalid event type",k)}else this.logger.error("invalid execution type",i)}else this.logger.error("no record type...")}};
var afterSubmit=function(a){try{var b=nlapiGetContext(),c=b.getScriptId()==="customscript_celigo_rt_export_flow_run";(new Celigo.integrator.realtime.async.Export).main("afterSubmit",a,b.getEnvironment(),b.getCompany(),b.getRole(),b.getExecutionContext(),c)}catch(e){nlapiLogExecution("error",e.name,e.message)}};$.namespace("Celigo.integrator.realtime");Celigo.integrator.realtime.ExportDataFlowRunner=function(){this.executionLogger=$.getExecutionLogger("Celigo.integrator.realtime.ExportDataFlowRunner")};
Celigo.integrator.realtime.ExportDataFlowRunner.config={customscript_celigo_rt_export_flow_run:null,customscript_celigo_mg_rt_export_runner:"Magento",customscript_celigo_ebay_export_runner:"eBay"};Celigo.integrator.realtime.ExportDataFlowRunner.isRealTimeExportScript=function(){return!_.isUndefined(Celigo.integrator.realtime.ExportDataFlowRunner.config[$$.getContext().getScriptId()])};Celigo.integrator.realtime.ExportDataFlowRunner.prototype.main=function(a,b){var c=Celigo.integrator.realtime.ExportMetadata,
e=($$.getRecordType()||"").toLowerCase(),f=b.toLowerCase(),g=a.toLowerCase(),h=$$.getContext().getEnvironment().toUpperCase();if(!e||!f||!g)this.executionLogger.error("something is missing( record type, execution type, event type)",e+","+f+","+g);else{var j=c.getFlowFldExecutionTypeList()[f];if(j){var i=c.getFlowFldEventTypeList()[g];if(i)if(this.executionLogger.debug("event type id: "+i+"; execution type id: "+j),e=[new nlobjSearchFilter(c.getFlowFldAsync(),null,"is","F"),new nlobjSearchFilter(c.getFlowFldRecordType(),
null,"is",e),new nlobjSearchFilter(c.getFlowFldEventType(),null,"anyof",i),new nlobjSearchFilter(c.getFlowFldExecutionType(),null,"anyof",j),new nlobjSearchFilter("name",c.getFlowFldEnvironment(),"is",h),new nlobjSearchFilter("isinactive",null,"is","F"),new nlobjSearchFilter(c.getFlowFldDisabled(),null,"is","F")],(h=Celigo.integrator.realtime.ExportDataFlowRunner.config[$$.getContext().getScriptId()])&&e.push(new nlobjSearchFilter("name",c.getFlowFldIntegration(),"is",h)),e=$$.searchRecord(c.getFlowRecType(),
null,e),!e||!e.length)this.executionLogger.audit("no valid data flow is found");else{this.executionLogger.audit("data flow records",e.length);var k=Celigo.integrator.dataflow.Runner,l=Celigo.integrator.dataflow.Factory;_.each(e,function(a){a=l.getDataFlowByRecordId(a.getId(),c);a.setEventType(g);a.setExecutionType(f);a.setInvocationContextByKey(Celigo.integrator.dataflow.InvocationContext.eventType,g);a.setInvocationContextByKey(Celigo.integrator.dataflow.InvocationContext.executionType,f);k.runDataFlow(a)})}else this.executionLogger.error("unsupported event type",
g)}else this.executionLogger.error("unsupported execution type",f)}};if($$.getContext().getScriptId()==="customscript_celigo_rt_export_flow_run"||$$.getContext().getScriptId()==="customscript_celigo_mg_rt_export_runner"||$$.getContext().getScriptId()==="customscript_celigo_ebay_export_runner")Celigo.integrator.realtime.ExportDataFlowRunner.prototype.beforeLoad=function(a){this.main("beforeload",a)},Celigo.integrator.realtime.ExportDataFlowRunner.prototype.beforeSubmit=function(a){this.main("beforesubmit",
a)},Celigo.integrator.realtime.ExportDataFlowRunner.prototype.afterSubmit=function(a){this.main("aftersubmit",a);var b=nlapiGetContext();(new Celigo.integrator.realtime.async.Export).main("afterSubmit",a,b.getEnvironment(),b.getCompany(),b.getRole(),b.getExecutionContext(),!0)},Celigo.RealtimeExportRunner=Celigo.integrator.realtime.ExportDataFlowRunner;if($$.getContext().getScriptId()==="customscript_celigo_realtim_export_act")$.namespace("Celigo.integrator.realtime.netsuite"),Celigo.integrator.realtime.netsuite.ExportEntryPoint=
function(){},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.main=function(a){for(var b=Celigo.integrator.realtime.netsuite.ExportFactory.loadConfigFromRecord($$.getRecordType()),c,e=0;b&&b.length&&e<b.length;e++)c=Celigo.integrator.realtime.netsuite.ExportFactory.getExportInstanceFromConfig(b[e]),c.setEventType(a),c.main()},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.afterSubmit=function(a){this.main(a)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.beforeSubmit=
function(a){this.main(a)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.beforeLoad=function(a){this.main(a)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.workflowAction=function(){this.main(type)},Celigo.integrator.realtime.netsuite.ExportEntryPoint.prototype.getThrowableErrorCodes=function(){return"all"};$.namespace("Celigo.integrator.scheduling");Celigo.integrator.scheduling.TimeEmulator=function(){var a=Array.prototype.slice.call(arguments);(function(a){if(!a[0]||
!(a[0]instanceof Date)||"Invalid Date"===a[0].toString())throw Error("invalid anchor date");if(!a[1]||_.isNaN(a[1])||a[1]<0||Math.floor(a[1])!==a[1])throw Error("invalid tick");})(a);this.__anchor__=new Date(a[0].getTime());this.__tick__=a[1];this.__last__=void 0};Celigo.integrator.scheduling.TimeEmulator.prototype.getAnchor=function(){return new Date(this.__anchor__.getTime())};Celigo.integrator.scheduling.TimeEmulator.prototype.getTick=function(){return this.__tick__};Celigo.integrator.scheduling.TimeEmulator.prototype.getLast=
function(){return new Date((this.__last__||this.__anchor__).getTime())};Celigo.integrator.scheduling.TimeEmulator.prototype.toJSON=function(){return{last:this.getLast().getTime(),tick:this.getTick()}};Celigo.integrator.scheduling.TimeEmulator.prototype.roundBackward=function(){var a=this.__anchor__;this.__anchor__=new Date(a.getTime()-a.getTime()%this.__tick__)};Celigo.integrator.scheduling.TimeEmulator.prototype.roundForward=function(){var a=this.__anchor__,b=a.getTime()%this.__tick__;if(b!==0)this.__anchor__=
new Date(a.getTime()+this.__tick__-b)};Celigo.integrator.scheduling.TimeEmulator.prototype.rewind=function(){this.__last__=new Date(this.getLast().getTime()-this.__tick__);return this.getLast()};Celigo.integrator.scheduling.TimeEmulator.prototype.fastforward=function(a){var b=this.getLast().getTime()+this.__tick__;if(!(a&&b>(new Date).getTime()))return this.__last__=new Date(this.getLast().getTime()+this.__tick__),this.getLast()};$.namespace("Celigo.integrator.scheduling.PersistenceHandler");Celigo.integrator.scheduling.PersistenceHandler=
function(a,b,c){if(!a||!_.isString(a)||!b||!_.isString(b))throw Error("require preference name of last run time and tick");var e=$.getExecutionLogger("Celigo.integrator.scheduling.PersistenceHandler"),f=0,g=!1,h,j,i;this.load=function(){var b=$$.getContext().getEnvironment().toUpperCase();c||(c=b);b=[new nlobjSearchColumn("internalid"),new nlobjSearchColumn(a)];b[0].setSort();var e=[new nlobjSearchFilter("name",null,"is",c)],f=$$.searchRecord("customrecord_celigo_global_params",null,e,b);if(!f||!f.length)f=
$$.createRecord("customrecord_celigo_global_params"),f.setFieldValue("name",c),$$.submitRecord(f,!0,!0),f=$$.searchRecord("customrecord_celigo_global_params",null,e,b);if(!f||!f.length)throw new Celigo.Error({name:"FAIL_TO_LOCATE_GLOBAL_PARAM",message:"cannot find a valid global parameter record corresponding to environment: "+c});h=f[0].getId();j=f[0].getValue(b[1]);i=void 0;g=!0};this.save=function(b){var c=$$.loadRecord("customrecord_celigo_global_params",h);c.setFieldValue(a,String(b));$$.submitRecord(c,
!0,!0);c=$$.loadRecord("customrecord_celigo_global_params",h);b=c.getFieldValue(a);e.debug("old value(string):"+j+"| new value(string):"+b);c=!j||isNaN(+j)||"Invalid Date"===(new Date(+j)).toString()?0:+j;if(b===j||isNaN(+b)||"Invalid Date"===(new Date(+b)).toString()||+b<=c)throw Error("last run should have been increased");j=b;i=void 0};this.getLastRunTimestamp=function(){g||this.load();return j};this.getTick=function(){g||this.load();return i};this.persist=function(a){for(f=0;f<3;){++f;try{this.save(a);
return}catch(b){e.error("persistence attempt #"+f+" failed",Celigo.Error.format(b))}}throw Error("persist failed after 3 attempts");}};$.namespace("Celigo.integrator.scheduling");Celigo.integrator.scheduling.Scheduler=function(){this.m=Celigo.integrator.batch.DataFlowMetadata;this.logger=$.getExecutionLogger("Celigo.integrator.scheduling.Scheduler");this.__LOCKNAME__="DATAFLOWSCHEDULER";this.__LOCKTTL__=9E5;this.__isSuiteCloudPlus__=!1;var a;try{a=$$.getContext().getQueueCount()}catch(b){a=1}if(a>
1)this.__isSuiteCloudPlus__=!0};Celigo.integrator.scheduling.Scheduler.prototype.setLastRunPrefName=function(a){this.__lastRunPrefName__=a};Celigo.integrator.scheduling.Scheduler.prototype.setTickPrefName=function(a){this.__tickPrefName__=a};Celigo.integrator.scheduling.Scheduler.prototype.setTestIntegrationName=function(a){this.__testIntegrationName__=a};Celigo.integrator.scheduling.Scheduler.prototype.scheduleDataFlowByInternalId=function(a){Celigo.integrator.dataflow.Util.scheduleBatchDataFlowById(a);
this.logger.audit("scheduled data flow "+a)};Celigo.integrator.scheduling.Scheduler.prototype.getActiveDataFlows=function(){var a=this,b=$$.getContext().getEnvironment().toUpperCase(),b=[new nlobjSearchFilter("isinactive",null,"is","F"),new nlobjSearchFilter(this.m.getFlowFldDisabled(),null,"is","F"),new nlobjSearchFilter("name",this.m.getFlowFldEnvironment(),"is",b),new nlobjSearchFilter(this.m.getFlowFldVersion(),null,"anyof",["2","@NONE@"])];this.__testIntegrationName__&&b.push(new nlobjSearchFilter("name",
this.m.getFlowFldIntegration(),"is",this.__testIntegrationName__));b=$$.searchRecord(this.m.getFlowRecType(),null,b,[new nlobjSearchColumn(this.m.getFlowFldSchedule()),new nlobjSearchColumn(this.m.getFlowFldTimezone())]);return!b||!b.length?[]:_.map(b,function(b){return{schedule:b.getValue(a.m.getFlowFldSchedule()),timezone:b.getValue(a.m.getFlowFldTimezone()),id:b.getId()}})};Celigo.integrator.scheduling.Scheduler.prototype.matchResponseFlowSchedules=function(a){var b=[],c=this,e=$$.loadConfiguration("companyinformation").getFieldValue("timezone"),
f=new Date;_.each(a,function(a){c.logger.debug("flow.lastRunTime",a.lastRunTime);var h=$.dateUtil.convertNetSuiteDateTimeStringToJSDateObject(a.lastRunTime,e,"datetimetz"),h=f.getTime()-h.getTime();h===0&&b.push(a);9E5<<a.timesRan<=h?(c.logger.debug("pushing flow - tick",9E5<<a.timesRan),c.logger.debug("pushing flow - diff",h),b.push(a)):(c.logger.debug("skipping flow - job record details",a),c.logger.debug("skipping flow - tick",9E5<<a.timesRan),c.logger.debug("skipping flow - diff",h))});return b};
Celigo.integrator.scheduling.Scheduler.prototype.getActiveResponseFlows=function(){var a;a=this.matchResponseFlowSchedules(Celigo.integrator.logging.JobStatusLogger.getPendingJobs());this.logger.debug("active response flows",a.length);return a};Celigo.integrator.scheduling.Scheduler.prototype.matchDataFlowSchedules=function(a,b){var b=new Date(b.getTime()),c=this,e,f=[];_.each(a,function(a){if(a.schedule&&!a.error){try{var h=a.timezone;h||(h="America/Los_Angeles");e=Celigo.util.dateUtil.convertDateToNewTimeZone(b,
h).date;c.logger.debug("converted timezone",""+e);var j=(new Celigo.util.CronMatcher(a.schedule)).match(e)}catch(i){c.logger.error("cron matching error with flow "+a.id,Celigo.Error.format(i)),j=!1,a.error=!0}j&&f.push(a.id)}});return f};Celigo.integrator.scheduling.Scheduler.prototype.scheduleResponseFlows=function(a){var b=0,c=this;_.each(a,function(a){try{Celigo.integrator.dataflow.Util.scheduleBatchDataFlowById(a.flowId,{jobRecordId:a.jobId,integrationLogId:a.integrationId,jobRecordType:"export",
reportId:a.reportId,batchDataFlowId:a.flowId,timesRan:a.timesRan}),c.logger.audit("scheduled a response flow for a export flow with Id",a.flowId),++b}catch(f){c.logger.error(f.message||f.getMessage()),c.logger.error(CeligoError.format(f)),$L.error("Failed to schedule runner for Flow(BatchDataFlow Record Id: "+a.flowId+")\n"+Celigo.Error.format(f))}});return b};Celigo.integrator.scheduling.Scheduler.prototype.scheduleDataFlows=function(a){var b=this,c=0;_.each(a,function(a){try{b.scheduleDataFlowByInternalId(a),
++c}catch(f){b.logger.error(CeligoError.format(f)),$L.error("Failed to schedule runner for Flow(BatchDataFlow Record Id: "+a+")\n"+Celigo.Error.format(f))}});return c};Celigo.integrator.scheduling.Scheduler.prototype.getLagLimit=function(){return(new Date).getTime()-864E5};Celigo.integrator.scheduling.Scheduler.prototype.run=function(){try{if(!this.__lastRunPrefName__)throw Error("requires last run time preference name");if(!this.__tickPrefName__)throw Error("requires tick preference name");var a;
if(this.__isSuiteCloudPlus__&&(a=new Celigo.util.Locker(this.__LOCKNAME__,this.__LOCKTTL__),!a.lock()&&($.sleep(Math.floor(Math.random()*10)+1),!a.lock()))){this.logger.audit("multiple queues present and failed to acquire lock, done");return}var b=new Celigo.integrator.scheduling.PersistenceHandler(this.__lastRunPrefName__,this.__tickPrefName__),c=b.getLastRunTimestamp(),e=b.getTick();this.logger.audit("last run timestamp",c);this.logger.audit("tick",e);e||(e=9E5);var f;c===void 0||c===null?f=void 0:
c===""||c.trim&&c.trim()===""||isNaN(+c)||"Invalid Date"===(new Date(+c)).toString()||(new Date(+c)).getTime()<this.getLagLimit()?(f=new Celigo.integrator.scheduling.TimeEmulator(new Date,e),f.roundBackward()):(f=new Celigo.integrator.scheduling.TimeEmulator(new Date(+c),e),f.roundForward(),+c===f.getAnchor().getTime()&&f.fastforward())}catch(g){this.logger.audit("warning : failed to emulate time, actual time will be used",Celigo.Error.format(g)),f=void 0}var h;if(f)if(h=f.getLast(),this.logger.debug("initialized emulated time",
""+h),h&&h.getTime()>(new Date).getTime()){this.logger.audit("emulated time is ahead of actual time, done");a&&a.unlock();return}else try{b.persist(h.getTime())}catch(j){this.logger.error("failed to persist emulated time",Celigo.Error.format(j));$$.scheduleScript($$.getContext().getScriptId())!=="QUEUED"?this.logger.audit("failed to schedule another scheduler, wait for nex run"):this.logger.audit("successfully scheduled another scheduler, done");a&&a.unlock();return}else h=new Date;c=this.getActiveDataFlows()||
[];e=this.getActiveResponseFlows();if(!c.length&&!e.length)this.logger.audit("No active data flow configuration to schedule"),a&&a.unlock();else{var i={},k=0;if(c.length>0){do{++k;this.logger.debug("iteration count: "+k,"using time: "+h);if((h=this.matchDataFlowSchedules(c,h))&&h.length)for(var l=0;l<h.length;l++)i[String(h[l])]=!0;if(f)if(h=f.fastforward(!0),h===void 0){this.logger.audit("emulated time is ahead of actual time, iteration ends");break}else try{b.persist(h.getTime())}catch(m){f=h=void 0,
this.logger.error("failed to persist emulated time, iteration ends",Celigo.Error.format(m))}else h=void 0}while(h&&k<100)}a&&a.unlock();e&&e.length?this.scheduleResponseFlows(e):this.logger.audit("No response flow to run");i=Object.keys(i);if(!i||!i.length)this.logger.audit("No scheduled data flow to run");else return this.scheduleDataFlows(i)}};if($$.getContext().getScriptId().search(/customscript_celigo_batch_data_flow_sch/)===0)Celigo.integrator.batch.DataFlowScheduler=function(){},Celigo.integrator.batch.DataFlowScheduler.prototype.scheduled=
function(){var a=$$.getContext(),b=a.getSetting("SCRIPT","custscript_celigo_batch_data_flow_sch_tp"),c=null;if(b)b=JSON.parse(b),c=b.testIntegrationName;else if(a.getCompany()==="TSTDRV841073"){$$.logExecution("AUDIT","script doesn't run in Storm");return}a=new Celigo.integrator.scheduling.Scheduler;a.setLastRunPrefName("custrecord_df_last_run");a.setTickPrefName("custscript_celigo_global_df_sch_tick");a.setTestIntegrationName(c);a.run();Celigo.ScriptManager.Test.setTestPrepFinished();try{var e=$$.getContext().getEnvironment().toUpperCase(),
f=(new Date).getTime(),g=$$.lookupField("customrecord_celigo_global_cache",1,["custrecord_celigo_gc_env","custrecord_celigo_gc_env_ts"])[0];if(g&&g.toUpperCase()!==e)for(var h=$$.searchRecord("customrecord_celigo_connection",null,new nlobjSearchFilter("custrecord_celigo_connection_system",null,"is","F")),c=0;h&&c<h.length;c++)try{var j=h[c].getId();(new Celigo.io.CredentialsManager({id:j})).clear()}catch(i){}$$.submitField("customrecord_celigo_global_cache",1,["custrecord_celigo_gc_env","custrecord_celigo_gc_env_ts"],
[e,f])}catch(k){$$.logExecution("error","environment check error",k.message)}},Celigo.integrator.batch.DataFlowScheduler.prototype.getTestConfig=function(){return{scheduled:{param:["custscript_celigo_batch_data_flow_sch_tp"]}}};$.namespace("Celigo.integrator.plugins.exportflow");Celigo.integrator.plugins.exportflow.MarkExportedWithCustomRecordPlugin=function(a){this._super(a);var b={},c=function(b,c){_.each(c,function(b){if(!b.getIgnoreFilter()){var c=a.savedSearchIdToExportedRecordFieldIdMap[b.getSearchId()];
c&&(b.setIgnoreFilter(!0),b.setAdditionalFilters(b.getAdditionalFilters().concat(["internalid."+c+".anyof.@NONE@"])))}})},e=function(a,c,e,f){b[f]||(b[f]=[]);b[f].push(c.id)},f=function(){$$.logExecution("AUDIT","MarkExportedWithCustomRecordPlugin - trackedRecords",b);var c=[],e={};_.each(a.savedSearchIdToExportedRecordFieldIdMap,function(a,f){b[f]&&(b[f]=_.uniq(b[f]),_.each(b[f],function(b){e[a]||(e[a]=0);if(e[a]<c.length)c[e[a]][a]=parseInt(b,10);else{var f={};f[a]=parseInt(b,10);c.push(f)}e[a]++}))});
$$.logExecution("AUDIT","MarkExportedWithCustomRecordPlugin - rows",c);if(c.length>0){var f="recmach"+a.parentFieldId,i={nlobjRecordType:a.customRecordId,nlobjFieldIds:c[0]};if(c.length>1)i.sublistIds=[f],i.nlobjSublistIds={},i.nlobjSublistIds[f]=c.slice(1);(new $R(i)).save()}};this.getEventHandlers=function(){return[{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:PRE_PROCESS_SAVED_SEARCHES",method:"on",handler:c},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,
event:"BATCH_EXPORT:PROCESS_EACH_EXPORTED_RECORD_CONFIG",method:"on",handler:e},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:COMPLETE",method:"on",handler:f}]}};Celigo.integrator.plugins.exportflow.MarkExportedWithCustomRecordPlugin.className="Celigo.integrator.plugins.exportflow.MarkExportedWithCustomRecordPlugin";Celigo.integrator.plugins.exportflow.MarkExportedWithCustomRecordPlugin.extend(Celigo.lang.Plugin);$.namespace("Celigo.integrator.plugins.exportflow");
Celigo.integrator.plugins.exportflow.ChainedExportPlugin=function(a){this._super(a);_.defaults(a,{passMappingFailures:!1,passNonMappingFailures:!1,passCollection:!0,markExported:!0,autoApplyIdFilterIfSameType:!0,continueIfFlowFails:!1});var b=[],c=null,e=null,f=function(a){c===null&&(c=!a.getInvocationContextByKey(Celigo.integrator.dataflow.InvocationContext.previousDataFlow));log("ChainedExportPlugin - isFirstFlow",c);if(c&&e)a.getCache().ChainedExportPlugin={},Celigo.suitescript.scheduled.BatchProcess.staticState.reserved.pagination=
e;a.resetPublicState();log("ChainedExportPlugin - ssPagination",Celigo.suitescript.scheduled.BatchProcess.staticState.reserved.pagination)},g=function(){var a=Celigo.suitescript.scheduled.BatchProcess.staticState.reserved.pagination;if(c&&a.hasMoreData)e=a,Celigo.suitescript.scheduled.BatchProcess.staticState.reserved.pagination={hasMoreData:!1,lastPageReached:!1},Celigo.integrator.dataflow.Runner.setRepeat(!0)},h=function(a){a=a.getCache();if(!a.ChainedExportPlugin)a.ChainedExportPlugin={};return a.ChainedExportPlugin},
j=function(a){_.each(a.getSavedSearches(),function(a){a.setCheckBoxField(null)})},i=function(b){if(b.getNextDataFlow()){var c=h(b);a.passCollection?_.extend(c,b.getCollection().getData()):_.each(b.getCollection().getData(),function(a,b){delete c[b]});log("ChainedExportPlugin - saveDataCollectionToCache cache",c);b.getNextDataFlow().getCache().ChainedExportPlugin=c}},k=function(a,c){var e=h(a);log("ChainedExportPlugin - modifySearchConfigToExcludeSearchWhoseDataInCache cache",e);_.each(c,function(a,
f){var g=a.getSearchId();e[g]&&(b.push(a),c[f]=null)});c=_.compact(c);log("ChainedExportPlugin - modified searches",c);a.setSavedSearches(c)},l=function(a,c,e){var f=h(a);log("ChainedExportPlugin - addSearchDataFromCache cache",f);_.each(b,function(a){var b=a.getSearchId();c.push(a);e.getData()[b]=f[b]});log("ChainedExportPlugin - restored searches",c);e.reset()};this.getEventHandlers=function(){var b=[];a.markExported||b.push({dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,
event:"BATCH_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT",method:"on",handler:j});return b.concat([{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:_____INTERNAL_DO_NOT_USE_____SETUP_FUNCTION",method:"on",handler:f},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:COMPLETE",method:"on",handler:i},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:PRE_PROCESS_SAVED_SEARCHES",
method:"on",handler:k},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:AFTER_RECEIVE_SEARCH_RESULTS",method:"on",handler:l},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:AFTER_RECEIVE_SEARCH_RESULTS",method:"on",handler:g}])}};Celigo.integrator.plugins.exportflow.ChainedExportPlugin.className="Celigo.integrator.plugins.exportflow.ChainedExportPlugin";Celigo.integrator.plugins.exportflow.ChainedExportPlugin.extend(Celigo.lang.Plugin);
$.namespace("Celigo.integrator.plugins.exportflow");Celigo.integrator.plugins.exportflow.OneFileExportAllPlugin=function(a){this._super(a);var b=null,c=0,e=null,f=null,g=function(a){a.setToUseSingleJobRecord(!0);a.setParentJobId(null);e&&a.setJobRecordId(e);f&&a.setIntegrationLogId(f)},h=function(a){e=a.getJobRecordId();f=a.getIntegrationLogId()},j=function(a){c++;c>1&&a.getRequestMappingRef().setFileHasHeaders(!1);log("OneFileExportAllPlugin - pageNumber",c);log("OneFileExportAllPlugin - flow.getRequestMappingRef()",
a.getRequestMappingRef())},i=function(a,e){!b&&a.isLastPage()?a.getConnector().setMethod("upload"):(b&&e.setBatchId(b),e.setPartNumber(c),e.setLastPart(a.isLastPage()),a.getConnector().setMethod("multipartUpload"));log("OneFileExportAllPlugin - flow.getConnector()",a.getConnector())},k=function(a,c){log("OneFileExportAllPlugin - responseMessage",c);b=c.getBatchId()};this.getEventHandlers=function(){return[{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:INIT",
method:"on",handler:g},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:COMPLETE",method:"on",handler:h},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT",method:"on",handler:j},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,event:"BATCH_EXPORT:BEFORE_SEND_MESSAGE",method:"on",handler:i},{dispatcher:Celigo.event.dispatcher.integrator.batch.ExportDispatcher,
event:"BATCH_EXPORT:AFTER_SEND_MESSAGE",method:"on",handler:k}]}};Celigo.integrator.plugins.exportflow.OneFileExportAllPlugin.className="Celigo.integrator.plugins.exportflow.OneFileExportAllPlugin";Celigo.integrator.plugins.exportflow.OneFileExportAllPlugin.extend(Celigo.lang.Plugin);$.namespace("Celigo.integrator.plugins.realtimeExport");Celigo.integrator.plugins.realtimeExport.CheckboxCancel=function(a){this._super(a);var b=$.getExecutionLogger(this.getClassName()),c=this;this.getCheckboxField=
function(){return a.checkboxField};this.setCheckboxField=function(b){a.checkboxField=b};this.getEventHandlers=function(){return[{dispatcher:Celigo.event.dispatcher.integrator.realtime.ExportDispatcher,event:"REALTIME_EXPORT:INIT",method:"once",handler:this.checkCancel},{dispatcher:Celigo.event.dispatcher.integrator.realtime.ExportDispatcher,event:"REALTIME_EXPORT:ASYNC_INIT",method:"once",handler:this.asyncCheckCancel}]};this.checkCancel=function(a){var f=$$.getFieldValue(c.getCheckboxField());b.debug("checking checkbox value..."+
f);f!=="T"&&(b.debug("canceling..."),a.setCancelled(!0))};this.asyncCheckCancel=function(a,f){f&&f[c.getCheckboxField()]!==!0&&(b.debug("canceling..."),a.setCancelled(!0))}};Celigo.integrator.plugins.realtimeExport.CheckboxCancel.className="Celigo.integrator.plugins.realtimeExport.CheckboxCancel";Celigo.integrator.plugins.realtimeExport.CheckboxCancel.extend(Celigo.lang.Plugin);$.namespace("Celigo.integrator.hercules");Celigo.integrator.hercules.Export=function(a){this._super(a)};Celigo.integrator.hercules.Export.className=
"Celigo.integrator.io.Export";Celigo.integrator.hercules.Export.extend(Celigo.integrator.DataFlow);Celigo.integrator.hercules.Export.prototype.run=function(){var a;try{var b=this.getRequestMessage().getData().getContent(),c=b.recordType;if(!c||!_.isString(c))throw nlapiCreateError("CELIGO_CONFIG_ERROR","Celigo.integrator.io.Export - searchType is required.");var e=b.searchId;if(!e||!_.isString(e))throw nlapiCreateError("CELIGO_CONFIG_ERROR","Celigo.integrator.io.Export - searchId is required.");var f=
+b.pageSize||1E3;f>1E3?f=1E3:f<1&&(f=1);try{var g=nlapiLoadSearch(c,e)}catch(h){return a={code:String(h&&(h.getCode&&h.getCode()||h.code||h.name)||"unexpected_error").toLowerCase(),message:h.message||h.getDetails(),source:"netsuite"},{fatal:a,errors:[a]}}for(var j=g.getFilterExpression(),i=!1,k=0;j&&k<j.length;k++)if(_.isString(j[k])&&j[k].toUpperCase()==="OR"){i=!0;break}j=null;if(b.delta&&b.delta.dateField){var l=b.delta.dateField,m=b.delta.time;if(!_.isNumber(m))throw nlapiCreateError("CELIGO_CONFIG_ERROR",
"For delta export type, time value is required.");var m=Celigo.dateUtil.convertDateToTimeStamp(new Date(m),"datetime",nlapiGetContext().getPreference("timezone"),!0),n=null,o,q=l.split(".");q.length===1?o=l:(n=q[0],o=q.slice(1).join("."));Celigo.util.appendFilter(g,o,n,"onorafter",m);j=[o,n,"onorafter",m]}else if(b.once&&b.once.booleanField)n=b.once.booleanField,Celigo.util.appendFilter(g,n,null,"is","F"),j=[n,null,"is","F"];if(b.criteria&&b.criteria.length)for(k=0;k<b.criteria.length;k++){var r=
b.criteria[k];Celigo.util.appendFilter(g,r.field,r.join,r.operator,r.searchValue,r.searchValue2)}var p,k=!1,w=!!b.skipGrouping,u=b.state||{},s,v,l=0;if(!u.lastInternalId&&!u.pageIndex)w?v=1:s=-1E9;else if(w){if(v=+u.pageIndex,!v||v<1)throw nlapiCreateError("CELIGO_CONFIG_ERROR","pageIndex is required for skipGrouping search.");}else if(s=+u.lastInternalId,!s)throw nlapiCreateError("CELIGO_CONFIG_ERROR","lastInternalId is required for grouping search.");if(w){var t=(v-1)*f;nlapiLogExecution("debug",
"searching...");try{var y=g.runSearch();p=y.getResults(t,t+1E3)||[];p=p.slice(0,p.length);l++;nlapiLogExecution("debug","done searching",l);if(p.length<f||p.length===f&&f<1E3)k=!0;else if(p.length>f)k=!1,p.length=f;else{var x=y.getResults(t+p.length,t+p.length+1E3);l++;k=x&&x.length?!1:!0}}catch(B){return t="",B&&typeof B.getId==="function"&&B.getId()&&(t="(NetSuite error id: "+B.getId()+")"),a={code:String(B&&(B.getCode&&B.getCode()||B.code||B.name)||"unexpected_error").toLowerCase(),message:String(B.message||
B.getDetails())+t,source:"netsuite"},{fatal:a,errors:[a]}}}else{nlapiLogExecution("debug","searching...");try{m=!1;if(["3959483"].indexOf(nlapiGetContext().getCompany())>-1&&!i&&s===-1E9&&(i=[],j&&j.length&&i.push(new nlobjSearchFilter(j[0],j[1],j[2],j[3])),i.length||(i=null),p=nlapiSearchRecord(c,e,i),!p||p.length<f))p=p||[],p=p.slice(0,p.length),m=!0;m||(s>-1E9&&Celigo.util.appendFilter(g,"internalidnumber",null,"greaterthan",s),y=g.runSearch(),p=y.getResults(0,f)||[],p=p.slice(0,p.length));l++;
nlapiLogExecution("debug","done searching",l);if(p.length<f)k=!0;else{var A=this.INTERNALID_COL;if(!p[0].getId()&&(A=_.find(p[0].getAllColumns(),function(a){return a.getName().toLowerCase()==="internalid"&&!a.getJoin()&&a.getSummary()&&a.getSummary().toLowerCase()==="group"}),!A))throw nlapiCreateError("search_not_sorted",'Your NetSuite Saved Search must be sorted by Internal Id in ASCENDING order. This is required to logically group search result rows into common records. If grouping is not needed then please enable "Skip Grouping" to ignore this validation.');
var z=this.getLastIdIndex(p,A);if(z>0)k=!1,p.length=z;else{var E=this.getIdNumber(p[z],A),f=0;do{nlapiLogExecution("debug","searching more...");x=y.getResults(p.length,p.length+1E3)||[];l++;f++;nlapiLogExecution("debug","done searching more",f);if(f>=20)throw nlapiCreateError("unexpected_error","Too many rows with identical internalid.");g=!1;for(c=0;c<x.length;c++)if(this.getIdNumber(x[c],A)===E)p.push(x[c]);else{k=!1;g=!0;break}if(g)break;if(x.length<1E3){k=!0;break}}while(1)}}}catch(C){return t=
"",C&&typeof C.getId==="function"&&C.getId()&&(t="(NetSuite error id: "+C.getId()+")"),a={code:String(C&&(C.getCode&&C.getCode()||C.code||C.name)||"unexpected_error").toLowerCase(),message:String(C.message||C.getDetails())+t,source:C&&C.source||"netsuite"},{fatal:a,errors:[a]}}}nlapiLogExecution("audit","usage after search",nlapiGetContext().getRemainingUsage());y=[];p.length&&(y=(new Celigo.util.NlobjSearchResultConverter).toJSGroupedById({results:p,skipGroupingById:!0,verifySortOrder:!1}),_.each(y,
function(a){try{a.dataURI=nlapiResolveURL("RECORD",a.recordType,a.id)}catch(b){nlapiLogExecution("error","error generating dataURI: "+b.message)}}),!w&&y.length&&y[0].id&&(y=this.groupById(y)));var F=_.last(y)||{},I=_.isArray(F)?F[0].id:F.id;if(k)u={};else if(w)u.pageIndex=v+1;else{if(I==u.lastInternalId)return a={code:"loop_detected",source:"adaptor",messsage:"Loop in search state is detected. Please check saved search or contact Celigo."},{fatal:a,errors:[a],lastPage:!0};u.lastInternalId=I}var L=
b.hooks&&b.hooks.preSend&&b.hooks.preSend.fileInternalId,M=b.hooks&&b.hooks.preSend&&b.hooks.preSend["function"],J=b.hooks&&b.hooks.preSend&&b.hooks.preSend.configuration;if(Celigo.integrator.Hook.should(L,M)){try{var G=Celigo.integrator.Hook.invokeWithFile("preSend",L,M,{data:JSON.parse(JSON.stringify(y)),preview:!!b.preview,settings:b.settings||{},_exportId:b._exportId,recordType:b.recordType,searchId:b.searchId,skipGrouping:w,delta:b.delta||void 0,once:b.once||void 0,configuration:J||{}})}catch(H){return a=
{source:"suitescript_hook"},a.code=H&&(H.getCode&&H.getCode()||H.code||H.name)||"unexpected_error",a.code=String(a.code).toLowerCase(),a.message=H&&H.message||"unexpected exception in hook invocation.",{fatal:a,errors:[a],lastPage:k,state:u}}if(G&&G.errors&&G.errors.length)for(a=0;a<G.errors.length;a++)if(G.errors[a]&&(G.errors[a].source="suitescript_hook",G.errors[a].code&&G.errors[a].code.toLowerCase))G.errors[a].code=G.errors[a].code.toLowerCase();var K=G&&G.errors&&G.errors.length?G.errors:void 0,
y=G&&G.data}nlapiLogExecution("audit","usage after preSend",nlapiGetContext().getRemainingUsage());return{data:y,errors:K,state:u,lastPage:k,searchCount:l}}catch(D){return a={code:String(D&&(D.getCode&&D.getCode()||D.code||D.name)||"unexpected_error").toLowerCase(),message:D.message||D.getDetails(),source:D&&D.source||"adaptor"},{fatal:a,errors:[a]}}};Celigo.integrator.hercules.Export.prototype.INTERNALID_COL={};Celigo.integrator.hercules.Export.prototype.getIdNumber=function(a,b){return+(b===this.INTERNALID_COL?
a.getId():a.getValue(b))};Celigo.integrator.hercules.Export.prototype.getLastIdIndex=function(a,b){for(var c=0,e=this.getIdNumber(a[0],b),f,g=1;g<a.length;g++){f=this.getIdNumber(a[g],b);if(f<e)throw c=nlapiCreateError("search_not_sorted",'Your NetSuite Saved Search must be sorted by Internal Id in ASCENDING order. This is required to logically group search result rows into common records. If grouping is not needed then please enable "Skip Grouping" to ignore this validation.'),c.source="netsuite",
c;f>e&&(c=g,e=f)}return c};Celigo.integrator.hercules.Export.prototype.groupById=function(a){for(var b=[],c=[a[0]],e=1;e<a.length;e++)c[0].id===a[e].id?c.push(a[e]):(b.push(c),c=[a[e]]);b.push(c);return b};$.namespace("Celigo.event.dispatcher.integrator.hercules");Celigo.event.dispatcher.integrator.hercules.ImportDispatcher=new Celigo.event.dispatcher.Dispatcher({name:"Celigo.event.dispatcher.integrator.hercules.ImportDispatcher"});$.namespace("Celigo.integrator.hercules");Celigo.integrator.hercules.Import=
function(a){this._super(a);this.eventDispatcher=Celigo.event.dispatcher.integrator.hercules.ImportDispatcher;this.getRequestMappingResult=function(){return this.requestMappingResult};this.setRequestMappingResult=function(a){this.requestMappingResult=a};this.getNextObject=function(){var a=this.getRequestCollection().getProcessedCount(),c=this.getRequestCollection().getOriginalSize();return a<c?this.getRequestCollection().getNextObject():null};this.getCurrentObject=function(){return this.currentObject};
this.setCurrentObject=function(a){if(a){var c=this.getRequestCollection().getCurrentObjectIndex();if(c>-1)this.getRequestCollection().setElementData(c,a),this.currentObject=this.getRequestCollection().getCurrentObject();else throw new Celigo.Error({message:"invalid index "+c});}else this.currentObject=null,this.getRequestCollection().removeLastObject()};this.getOperationMappings=function(){return a.operationMappings};this.getUnitTestParams=function(){return a.unitTestParams};this.getConfigHooks=function(){return a.hooks}};
Celigo.integrator.hercules.Import.className="Celigo.integrator.io.Import";Celigo.integrator.hercules.Import.extend(Celigo.integrator.DataFlow);Celigo.integrator.hercules.Import.prototype.run=function(){_.each(this.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.connect()});var a=function(a){return a.statusCode!==304&&a.statusCode!==401&&a.statusCode!==422},b=this.getEventDispatcher(),c=this.getExecutionLogger(),e=function(a,b){if(a&&b){for(var c=a,e=b.split(".");e.length>1;)c=c[e.shift()];
delete c[e.shift()]}},f=function(a){if(!a)return a;var b={gt:">",lt:"<",amp:"&",quot:'"'};return a.replace(/&(#(?:x[0-9a-f]+|\d+)|[a-z]+);?/gi,function(a,c){return c[0]==="#"?String.fromCharCode(c[1].toLowerCase()==="x"?parseInt(c.substr(2),16):parseInt(c.substr(1),10)):b.hasOwnProperty(c)?b[c]:a})},g=function(a,b,c){var e,f;for(f in a)e=b?b+"."+f:f,typeof a[f]==="object"?g(a[f],e,c):c.push({name:f,path:e,value:a[f]})},h=function(a){for(var b=[],a=a.getChildren(),c=null,e=null,f=null,g=0;a&&g<a.length;g++)c=
a[g],f=e=null,c instanceof Celigo.integrator.mapping.model.FieldMappingSet?f=c.getFieldMappings():c instanceof Celigo.integrator.mapping.model.CollectionMapping&&(e=c.getCollectionIds()[0],f=c.getChildren()[0].getFieldMappings()),b.push({sublistId:e,mappings:f});return b},j=function(a,b,i,j,k,l){i.length===0&&g(a,null,i);j.length===0&&(j=h(k.getRecordMapping(0)));k=b.message;errorFieldRegex=/field: (.*)/;errorFieldValueRegex=/Invalid Field Value (.*?) for the following field/;errFieldName=errorFieldRegex.exec(k)||
[];errFieldValue=errorFieldValueRegex.exec(k);J=!1;matchingFields=[];errFieldName=errFieldName.length>=1?errFieldName[1]:null;errFieldValue=errFieldValue.length>=1?errFieldValue[1]:null;errFieldValue=f(errFieldValue);c.audit("errFieldName# "+errFieldName+" | errFieldValue# "+errFieldValue);if(!errFieldName)return J;for(k=0;k<i.length;k++)i[k].name.toLowerCase()===errFieldName.toLowerCase()&&String(i[k].value)===String(errFieldValue)&&matchingFields.push(i[k]);_.each(matchingFields,function(c){var f=
null,g={};_.str.startsWith(c.path,"nlobjSublistIds")?(f=c.path.split(".")[1])&&(g=_.find(j,function(a){if(a.sublistId===f)return!0})):g=_.find(j,function(a){if(!a.sublistId)return!0});if(g&&(g=_.find(g.mappings,function(a){if(a.getJsField()===c.name&&!a.isImmutable())return!0}))){var h=g.getExternalField()||null;h?h=h.replace(/\$\./g,""):g.getHardCodedValue()&&(h=g.getHardCodedValue());l.push({code:b.name,message:b.message,source:"netsuite",extract:h,extracted:c.value,generated:c.value,generate:c.path?
c.path.replace(/^(nlobjFieldIds|nlobjSublistIds)\./,""):null});e(a,c.path);J=!0}});return J};Celigo.integrator.dataflow.Util.mergeOperationMappings(this.getOperationMappings(),this.getRequestMappingRef());try{var i,k=this.getConfigHooks(),l=this.getInvocationContextByKey("dataFlowRecordId"),m=Celigo.integrator.realtime.ImportMetadata;if(k)i={},i[m.getFlowFldHookPreMapFile()]=k.preMap.fileInternalId,i[m.getFlowFldHookPreMapFunc()]=k.preMap["function"],i[m.getFlowFldHookPreMapConfig()]=k.preMap.configuration,
i[m.getFlowFldHookPostMapFile()]=k.postMap.fileInternalId,i[m.getFlowFldHookPostMapFunc()]=k.postMap["function"],i[m.getFlowFldHookPostMapConfig()]=k.postMap.configuration,i[m.getFlowFldHookPostSubmitFile()]=k.postSubmit.fileInternalId,i[m.getFlowFldHookPostSubmitFunc()]=k.postSubmit["function"],i[m.getFlowFldHookPostSubmitConfig()]=k.postSubmit.configuration;else if(l){try{i=$$.lookupField(m.getFlowRecType(),l,[m.getFlowFldHookPreMapFile(),m.getFlowFldHookPreMapFunc(),m.getFlowFldHookPreMapConfig(),
m.getFlowFldHookPostMapFile(),m.getFlowFldHookPostMapFunc(),m.getFlowFldHookPostMapConfig(),m.getFlowFldHookPostSubmitFile(),m.getFlowFldHookPostSubmitFunc(),m.getFlowFldHookPostSubmitConfig()])}catch(n){i=$$.lookupField(m.getFlowRecType(),l,[m.getFlowFldHookPreMapFile(),m.getFlowFldHookPreMapFunc(),m.getFlowFldHookPostMapFile(),m.getFlowFldHookPostMapFunc(),m.getFlowFldHookPostSubmitFile(),m.getFlowFldHookPostSubmitFunc()]),i[m.getFlowFldHookPreMapConfig()]=void 0,i[m.getFlowFldHookPostMapConfig()]=
void 0,i[m.getFlowFldHookPostSubmitConfig()]=void 0}for(var k=["PreMap","PostMap","PostSubmit"],o=0;o<k.length;o++){var q=m["getFlowFldHook"+k[o]+"Config"]();if(i[q])try{i[q]=JSON.parse(i[q])}catch(r){c.error("Invalid "+k[o]+" hook configuration JSON",r.message)}}}else i=this.getUnitTestParams()&&this.getUnitTestParams().hookParams?this.getUnitTestParams().hookParams:void 0;var p={preMap:{file:i&&i[m.getFlowFldHookPreMapFile()]||void 0,func:i&&i[m.getFlowFldHookPreMapFunc()]||void 0,config:i&&i[m.getFlowFldHookPreMapConfig()]||
{}},postMap:{file:i&&i[m.getFlowFldHookPostMapFile()]||void 0,func:i&&i[m.getFlowFldHookPostMapFunc()]||void 0,config:i&&i[m.getFlowFldHookPostMapConfig()]||{}},postSubmit:{file:i&&i[m.getFlowFldHookPostSubmitFile()]||void 0,func:i&&i[m.getFlowFldHookPostSubmitFunc()]||void 0,config:i&&i[m.getFlowFldHookPostSubmitConfig()]||{}}};c.debug("hooks",JSON.stringify(p));var w=this.getInvocationContextByKey("herculesSettings")||{},u=this.getInvocationContextByKey("herculesImportId"),s=[],v=this.getRequestMessage().getData().getContent();
_.isArray(v)||(v=[v]);_.each(v,function(a,b){s.push({source:a,statusCode:200,errors:[],index:b})});v=void 0;if(Celigo.integrator.Hook.should(p.preMap.file,p.preMap.func)){var t=Celigo.integrator.Hook.invokeWithFile("preMap",p.preMap.file,p.preMap.func,{data:JSON.parse(JSON.stringify(_.pluck(s,"source"))),settings:w,_importId:u,configuration:p.preMap.config});if(!Celigo.integrator.Hook.isCanonicalDataResp(t)||t.length!==s.length)throw Error("invalid preMap hook response: expecting canonical data response with same size");
Celigo.integrator.Hook.merge(s,t,"source")}var y=_.filter(s,a);this.getRequestMessage().getData().setContent(_.pluck(y,"source"));this.getRequestMapper().INTEGRATOR_IO_MAPPER=!0;this.setRequestMappingResult(this.getRequestMapper().mapToNetSuite(this.getRequestMessage().getData(),this.getRequestMappingRef()));b.emit("HERCULES_IMPORT:AFTER_MAP_REQUEST_DOCUMENT_TO_RECORDS",this,this.getRequestMappingResult(),this.getRequestMessage().getData());if(this.getRequestMappingResult()&&this.getRequestMappingResult()instanceof
Celigo.integrator.mapping.model.MapToNetSuiteResult&&this.getRequestMappingResult().getMappingErrors()&&this.getRequestMappingResult().getMappingErrors().length){var x;_.each(this.getRequestMappingResult().getMappingErrors(),function(a){c.error("Mapping error at index: "+a.getIndex()+" | "+Celigo.Error.format(a.getError()));if((x=a.getIndex().match(/\d+/g))&&x.length)x=parseInt(x[0],10)-1,y[x].statusCode=422,y[x].errors.push({source:"adaptor",code:a.getError().name,message:a.getError().message})})}this.setRequestCollection(this.getRequestMappingResult().getJsObjects());
if(!this.getRequestCollection())throw c.audit("Request Mapper returned no objects"),new Celigo.Error({name:"CELIGO_INVALID_MAPPER_DATA_ERROR",message:"Request Mapper returned no objects"});if(!this.getRequestCollection()instanceof Celigo.oop.Collection)throw new Celigo.Error({name:"CELIGO_INVALID_MAPPER_DATA_ERROR",message:"Request Collection is not a valid Celigo.oop.Collection"});var B=_.filter(y,a),A=0;this.getRequestCollection().each(function(a){B[A].mapped=a;A++});this.getRequestCollection().reset();
if(B.length&&Celigo.integrator.Hook.should(p.postMap.file,p.postMap.func)){t=Celigo.integrator.Hook.invokeWithFile("postMap",p.postMap.file,p.postMap.func,{postMapData:JSON.parse(JSON.stringify(_.pluck(B,"mapped"))),preMapData:JSON.parse(JSON.stringify(_.pluck(B,"source"))),settings:w,_importId:u,configuration:p.postMap.config});if(!Celigo.integrator.Hook.isCanonicalDataResp(t)||t.length!==B.length)throw Error("invalid postMap hook response: expecting canonical data response with same size");Celigo.integrator.Hook.merge(B,
t,"mapped")}var z=_.filter(s,a);this.setRequestCollection(Celigo.lang.Collection.arrayOrObjectToCollection(_.pluck(z,"mapped")));this.currentObject=this.getNextObject();i=a=null;for(x=-1;this.currentObject;){x++;try{var m=i=this.currentObject.id||(this.currentObject.nlobjFieldIds?this.currentObject.nlobjFieldIds.internalid:null),E=this.currentObject.exportedDoc;E&&delete this.currentObject.exportedDoc;c.debug("importing record "+x,this.currentObject);var C=this.getOperationMappings()&&this.currentObject.nlobjRecordType&&
this.getOperationMappings()[this.currentObject.nlobjRecordType]?this.getOperationMappings()[this.currentObject.nlobjRecordType]:{},F=C.operation?C.operation:"";if(F&&F.length&&(F==="addupdate"||F==="update")&&!m)try{var I=this.getRequestMapper().searchBeforeSave(E,C.mapping);if(I)c.debug("Duplicate record found ",I),m=this.currentObject.nlobjFieldIds.internalid=I}catch(L){z[x].statusCode=200;z[x].ignored=!0;z[x].errors.push({source:"netsuite",code:L.name,message:L.message});continue}b.emit("HERCULES_IMPORT:PROCESS_EACH_RECORD_CONFIG",
this,this.currentObject);q=!1;if(this.currentObject)try{Celigo.integrator.dataflow.Util.validateImportOperationForRecordConfig(this.getOperationMappings(),this.currentObject)}catch(M){if(M.getCode&&M.getCode()==="CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT")c.audit("current record config is discarded due to CELIGO_FLOW_CONTROL_DISCARD_THIS_OBJECT"),q=!0;else throw M;}else c.audit("current record config is discarded"),q=!0;if(q){if(z[x].statusCode=200,z[x].ignored=!0,i)z[x].id=i}else for(var q=0,v=[],
k=[],l=[],J=!0,G=!1;q<=3&&J;){c.debug("retryCount# "+q);q++;G=J=!1;a=null;try{a=new $R(this.currentObject)}catch(H){z[x].statusCode=422,z[x].errors.push({source:"netsuite",code:H.name,message:H.message}),a=null,c.error("$R creation error | Invalid Target",JSON.stringify(H)),H.name==="INVALID_FLD_VALUE"&&(J=j(this.currentObject,H,v,k,this.getRequestMappingRef(),l),c.audit("Should Retry with updated target # "+J,JSON.stringify(this.currentObject)),J&&z[x].errors.pop())}if(a){b.emit("HERCULES_IMPORT:BEFORE_SUBMIT_EACH_RECORD",
this,a);try{$$.getContext().getLogLevel()==="DEBUG"&&c.debug("saving record",JSON.stringify(a.getNSRecord())),i=a.save(),G=!0}catch(K){z[x].statusCode=422,z[x].errors.push({source:"netsuite",code:K.name,message:K.message}),c.error("$R save exception",JSON.stringify(K)),K.name==="INVALID_FLD_VALUE"&&(J=j(this.currentObject,K,v,k,this.getRequestMappingRef(),l),c.audit("Should Retry with updated target # "+J,JSON.stringify(this.currentObject)),J&&z[x].errors.pop())}if(G){c.audit("Record Successfully Submitted",
"Current Record Id: "+i);b.emit("HERCULES_IMPORT:AFTER_SUBMIT_EACH_RECORD",this,a,i,this.currentObject);z[x].statusCode=200;z[x].isUpdate=!!m;z[x].recordType=this.currentObject.nlobjRecordType;c.debug("record type",z[x].recordType);z[x].id=i;z[x].errors=l;J=!1;c.audit("successfully processed object");break}}nlapiLogExecution("DEBUG","toSubmit before updating errors",JSON.stringify(z));if(!G&&!J)z[x].errors=l.concat(z[x].errors);nlapiLogExecution("DEBUG","toSubmit before updating errors",JSON.stringify(z))}}catch(D){z[x].statusCode=
422,z[x].errors.push({source:"adaptor",code:D.name,message:D.message})}finally{this.currentObject=this.getNextObject()}}b.emit("HERCULES_IMPORT:BEFORE_COMPLETE",this);var P=[],N=_.map(s,function(a){var b={id:a.id,statusCode:a.statusCode===304?200:a.statusCode,ignored:a.ignored,errors:a.errors};a.statusCode===200?(b._json={id:a.id},P.push({id:a.id})):P.push(void 0);if(a.isUpdate||a.statusCode===200&&a.errors&&a.errors.length)try{b.dataURI=$$.resolveURL("RECORD",a.recordType,a.id)}catch(e){c.error("error generating dataURI: "+
e.message)}return b});if(Celigo.integrator.Hook.should(p.postSubmit.file,p.postSubmit.func)){t=Celigo.integrator.Hook.invokeWithFile("postSubmit",p.postSubmit.file,p.postSubmit.func,{responseData:JSON.parse(JSON.stringify(N)),postMapData:JSON.parse(JSON.stringify(_.pluck(s,"mapped"))),preMapData:JSON.parse(JSON.stringify(_.pluck(s,"source"))),settings:w,_importId:u,configuration:p.postSubmit.config});if(!Celigo.integrator.Hook.isCanonicalDataResp(t)||t.length!==s.length)throw Error("invalid postSubmit hook response: expecting canonical data response with same size");
for(o=0;t&&o<t.length;o++){var O=t[o];if(!O.statusCode)throw Error("postSubmit hook response must contain statusCode");if(O.statusCode===304)O.statusCode=200;if(!O._json&&P[o])O._json=P[o]}N=t}}catch(Q){throw Q;}finally{b.emit("HERCULES_IMPORT:COMPLETE",this),_.each(this.getPlugins()||[],function(a){a instanceof Celigo.lang.Plugin&&a.disconnect()}),c.audit("Flow Complete")}return N};Celigo.integrator.hercules.Import.__events__={"HERCULES_IMPORT:AFTER_MAP_REQUEST_DOCUMENT_TO_RECORDS":"HERCULES_IMPORT:AFTER_MAP_REQUEST_DOCUMENT_TO_RECORDS",
"HERCULES_IMPORT:PROCESS_EACH_RECORD_CONFIG":"HERCULES_IMPORT:PROCESS_EACH_RECORD_CONFIG","HERCULES_IMPORT:BEFORE_SUBMIT_EACH_RECORD":"HERCULES_IMPORT:BEFORE_SUBMIT_EACH_RECORD","HERCULES_IMPORT:AFTER_SUBMIT_EACH_RECORD":"HERCULES_IMPORT:AFTER_SUBMIT_EACH_RECORD","HERCULES_IMPORT:BEFORE_COMPLETE":"HERCULES_IMPORT:BEFORE_COMPLETE","HERCULES_IMPORT:COMPLETE":"HERCULES_IMPORT:COMPLETE",error:null};$.namespace("Celigo.integrator.hercules");Celigo.integrator.hercules.Export=function(a){this._super(a)};
Celigo.integrator.hercules.Export.className="Celigo.integrator.io.Export";Celigo.integrator.hercules.Export.extend(Celigo.integrator.DataFlow);Celigo.integrator.hercules.Export.prototype.run=function(){var a;try{var b=this.getRequestMessage().getData().getContent(),c=b.recordType;if(!c||!_.isString(c))throw nlapiCreateError("CELIGO_CONFIG_ERROR","Celigo.integrator.io.Export - searchType is required.");var e=b.searchId;if(!e||!_.isString(e))throw nlapiCreateError("CELIGO_CONFIG_ERROR","Celigo.integrator.io.Export - searchId is required.");
var f=+b.pageSize||1E3;f>1E3?f=1E3:f<1&&(f=1);try{var g=nlapiLoadSearch(c,e)}catch(h){return a={code:String(h&&(h.getCode&&h.getCode()||h.code||h.name)||"unexpected_error").toLowerCase(),message:h.message||h.getDetails(),source:"netsuite"},{fatal:a,errors:[a]}}for(var j=g.getFilterExpression(),i=!1,k=0;j&&k<j.length;k++)if(_.isString(j[k])&&j[k].toUpperCase()==="OR"){i=!0;break}j=null;if(b.delta&&b.delta.dateField){var l=b.delta.dateField,m=b.delta.time;if(!_.isNumber(m))throw nlapiCreateError("CELIGO_CONFIG_ERROR",
"For delta export type, time value is required.");var m=Celigo.dateUtil.convertDateToTimeStamp(new Date(m),"datetime",nlapiGetContext().getPreference("timezone"),!0),n=null,o,q=l.split(".");q.length===1?o=l:(n=q[0],o=q.slice(1).join("."));Celigo.util.appendFilter(g,o,n,"onorafter",m);j=[o,n,"onorafter",m]}else if(b.once&&b.once.booleanField)n=b.once.booleanField,Celigo.util.appendFilter(g,n,null,"is","F"),j=[n,null,"is","F"];if(b.criteria&&b.criteria.length)for(k=0;k<b.criteria.length;k++){var r=
b.criteria[k];Celigo.util.appendFilter(g,r.field,r.join,r.operator,r.searchValue,r.searchValue2)}var p,k=!1,w=!!b.skipGrouping,u=b.state||{},s,v,l=0;if(!u.lastInternalId&&!u.pageIndex)w?v=1:s=-1E9;else if(w){if(v=+u.pageIndex,!v||v<1)throw nlapiCreateError("CELIGO_CONFIG_ERROR","pageIndex is required for skipGrouping search.");}else if(s=+u.lastInternalId,!s)throw nlapiCreateError("CELIGO_CONFIG_ERROR","lastInternalId is required for grouping search.");if(w){var t=(v-1)*f;nlapiLogExecution("debug",
"searching...");try{var y=g.runSearch();p=y.getResults(t,t+1E3)||[];p=p.slice(0,p.length);l++;nlapiLogExecution("debug","done searching",l);if(p.length<f||p.length===f&&f<1E3)k=!0;else if(p.length>f)k=!1,p.length=f;else{var x=y.getResults(t+p.length,t+p.length+1E3);l++;k=x&&x.length?!1:!0}}catch(B){return t="",B&&typeof B.getId==="function"&&B.getId()&&(t="(NetSuite error id: "+B.getId()+")"),a={code:String(B&&(B.getCode&&B.getCode()||B.code||B.name)||"unexpected_error").toLowerCase(),message:String(B.message||
B.getDetails())+t,source:"netsuite"},{fatal:a,errors:[a]}}}else{nlapiLogExecution("debug","searching...");try{m=!1;if(["3959483"].indexOf(nlapiGetContext().getCompany())>-1&&!i&&s===-1E9&&(i=[],j&&j.length&&i.push(new nlobjSearchFilter(j[0],j[1],j[2],j[3])),i.length||(i=null),p=nlapiSearchRecord(c,e,i),!p||p.length<f))p=p||[],p=p.slice(0,p.length),m=!0;m||(s>-1E9&&Celigo.util.appendFilter(g,"internalidnumber",null,"greaterthan",s),y=g.runSearch(),p=y.getResults(0,f)||[],p=p.slice(0,p.length));l++;
nlapiLogExecution("debug","done searching",l);if(p.length<f)k=!0;else{var A=this.INTERNALID_COL;if(!p[0].getId()&&(A=_.find(p[0].getAllColumns(),function(a){return a.getName().toLowerCase()==="internalid"&&!a.getJoin()&&a.getSummary()&&a.getSummary().toLowerCase()==="group"}),!A))throw nlapiCreateError("search_not_sorted",'Your NetSuite Saved Search must be sorted by Internal Id in ASCENDING order. This is required to logically group search result rows into common records. If grouping is not needed then please enable "Skip Grouping" to ignore this validation.');
var z=this.getLastIdIndex(p,A);if(z>0)k=!1,p.length=z;else{var E=this.getIdNumber(p[z],A),f=0;do{nlapiLogExecution("debug","searching more...");x=y.getResults(p.length,p.length+1E3)||[];l++;f++;nlapiLogExecution("debug","done searching more",f);if(f>=20)throw nlapiCreateError("unexpected_error","Too many rows with identical internalid.");g=!1;for(c=0;c<x.length;c++)if(this.getIdNumber(x[c],A)===E)p.push(x[c]);else{k=!1;g=!0;break}if(g)break;if(x.length<1E3){k=!0;break}}while(1)}}}catch(C){return t=
"",C&&typeof C.getId==="function"&&C.getId()&&(t="(NetSuite error id: "+C.getId()+")"),a={code:String(C&&(C.getCode&&C.getCode()||C.code||C.name)||"unexpected_error").toLowerCase(),message:String(C.message||C.getDetails())+t,source:C&&C.source||"netsuite"},{fatal:a,errors:[a]}}}nlapiLogExecution("audit","usage after search",nlapiGetContext().getRemainingUsage());y=[];p.length&&(y=(new Celigo.util.NlobjSearchResultConverter).toJSGroupedById({results:p,skipGroupingById:!0,verifySortOrder:!1}),_.each(y,
function(a){try{a.dataURI=nlapiResolveURL("RECORD",a.recordType,a.id)}catch(b){nlapiLogExecution("error","error generating dataURI: "+b.message)}}),!w&&y.length&&y[0].id&&(y=this.groupById(y)));var F=_.last(y)||{},I=_.isArray(F)?F[0].id:F.id;if(k)u={};else if(w)u.pageIndex=v+1;else{if(I==u.lastInternalId)return a={code:"loop_detected",source:"adaptor",messsage:"Loop in search state is detected. Please check saved search or contact Celigo."},{fatal:a,errors:[a],lastPage:!0};u.lastInternalId=I}var L=
b.hooks&&b.hooks.preSend&&b.hooks.preSend.fileInternalId,M=b.hooks&&b.hooks.preSend&&b.hooks.preSend["function"],J=b.hooks&&b.hooks.preSend&&b.hooks.preSend.configuration;if(Celigo.integrator.Hook.should(L,M)){try{var G=Celigo.integrator.Hook.invokeWithFile("preSend",L,M,{data:JSON.parse(JSON.stringify(y)),preview:!!b.preview,settings:b.settings||{},_exportId:b._exportId,recordType:b.recordType,searchId:b.searchId,skipGrouping:w,delta:b.delta||void 0,once:b.once||void 0,configuration:J||{}})}catch(H){return a=
{source:"suitescript_hook"},a.code=H&&(H.getCode&&H.getCode()||H.code||H.name)||"unexpected_error",a.code=String(a.code).toLowerCase(),a.message=H&&H.message||"unexpected exception in hook invocation.",{fatal:a,errors:[a],lastPage:k,state:u}}if(G&&G.errors&&G.errors.length)for(a=0;a<G.errors.length;a++)if(G.errors[a]&&(G.errors[a].source="suitescript_hook",G.errors[a].code&&G.errors[a].code.toLowerCase))G.errors[a].code=G.errors[a].code.toLowerCase();var K=G&&G.errors&&G.errors.length?G.errors:void 0,
y=G&&G.data}nlapiLogExecution("audit","usage after preSend",nlapiGetContext().getRemainingUsage());return{data:y,errors:K,state:u,lastPage:k,searchCount:l}}catch(D){return a={code:String(D&&(D.getCode&&D.getCode()||D.code||D.name)||"unexpected_error").toLowerCase(),message:D.message||D.getDetails(),source:D&&D.source||"adaptor"},{fatal:a,errors:[a]}}};Celigo.integrator.hercules.Export.prototype.INTERNALID_COL={};Celigo.integrator.hercules.Export.prototype.getIdNumber=function(a,b){return+(b===this.INTERNALID_COL?
a.getId():a.getValue(b))};Celigo.integrator.hercules.Export.prototype.getLastIdIndex=function(a,b){for(var c=0,e=this.getIdNumber(a[0],b),f,g=1;g<a.length;g++){f=this.getIdNumber(a[g],b);if(f<e)throw c=nlapiCreateError("search_not_sorted",'Your NetSuite Saved Search must be sorted by Internal Id in ASCENDING order. This is required to logically group search result rows into common records. If grouping is not needed then please enable "Skip Grouping" to ignore this validation.'),c.source="netsuite",
c;f>e&&(c=g,e=f)}return c};Celigo.integrator.hercules.Export.prototype.groupById=function(a){for(var b=[],c=[a[0]],e=1;e<a.length;e++)c[0].id===a[e].id?c.push(a[e]):(b.push(c),c=[a[e]]);b.push(c);return b};$.namespace("Celigo.integrator.hercules");Celigo.integrator.hercules.Exported=function(a){this._super(a);this.markExported=function(a,c){if(!_.isArray(a)||a.length===0)throw nlapiCreateError("CELIGO_INVALID_REQUEST","Request.data must be an array of size > 1.");if(!c)throw nlapiCreateError("CELIGO_INVALID_REQUEST",
"booleanField is required.");for(var e=[],f=0;f<a.length;f++){var g=a[f].id,h=a[f].recordType;if(!g||!h)throw nlapiCreateError("CELIGO_INVALID_REQUEST","Can't mark exported without id or type.");try{nlapiSubmitField(h,g,c,"T")}catch(j){e.push({source:"netsuite",code:String(j.name||j.getCode()).toLowerCase(),message:j.message||j.getDetails(),index:f})}}return{errors:e}}};Celigo.integrator.hercules.Exported.className="Celigo.integrator.io.Exported";Celigo.integrator.hercules.Exported.extend(Celigo.io.PrivateStateful);
$.namespace("Celigo.products.thirdpartylogistics.batch.exportflow");Celigo.products.thirdpartylogistics.batch.exportflow.OrderLineLevelExportPlugin=function(a){function b(a,b){f.debug(a,b)}function c(a){a=parseFloat(a);_.isNaN(a)&&(a=0);return a}var e=this;a.quantityExportedField=a.quantityExportedField||"custcol_celigo_quantity_exported";a.quantityPendingExportField=a.quantityPendingExportField||"custcol_celigo_quantity_pending_expor";a.exportCount=a.exportCount||"custbody_celigo_export_count";this._super(a);
var f=$.getExecutionLogger("Celigo 3PL OrderLineLevelExportPlugin"),g=[{event:"BATCH_EXPORT:PRE_PROCESS_SAVED_SEARCHES",method:"once",handler:function(a,f){if(!_.isArray(f))throw new Celigo.Error({name:"CELIGO_3PL_CONFIGURATION_ERROR",message:"the saved search configuration must be an array"});_.each(f,function(a){if(!a instanceof Celigo.integrator.model.SavedSearchConfig)throw new Celigo.Error({name:"CELIGO_3PL_CONFIGURATION_ERROR",message:"the saved search configuration is an invalid class"});if(a.getCheckBoxField())throw new Celigo.Error({name:"CELIGO_3PL_CONFIGURATION_ERROR",
message:"checkBoxField cannot be used with line-level fulfillment processing"});if(!a.getIgnoreFilter()&&!_.isArray(a.getAdditionalFilters()))throw new Celigo.Error({name:"CELIGO_3PL_CONFIGURATION_ERROR",message:"invalid saved search configuration additionalFilters"});if(!_.isArray(a.getAdditionalColumns()))throw new Celigo.Error({name:"CELIGO_3PL_CONFIGURATION_ERROR",message:"invalid saved search configuration additionalColumns"});a.getAdditionalColumns().push(e.getQuantityExportedField(),e.getQuantityPendingExportField(),
e.getExportCount(),"tranid","line");var f=[];try{var g=$.search({type:"transaction",id:"customsearch_3pl_salesorder_shipcomp_exp"});b("ss results length ->",g.length);for(var h=0;g&&h<g.length;h++){b("result "+h,JSON.stringify(g[h]));var j=c(g[h].getValue("formulanumeric",null,"sum"));b("formulaValue -> ",j);if(j!==0){var o=g[h].getValue("internalid",null,"group");b("shcpsoId -> ",o);f.push(o)}}b("shcpResultSet -> ",f);f.length>0&&a.getAdditionalFilters().push(new nlobjSearchFilter("internalid",null,
"noneof",f))}catch(q){q.getCode()==="INVALID_SEARCH"&&$$.logExecution("error","message ->","3PL Ship Complete Sales Order Eport saved search does not exist!"),a.getAdditionalFilters().push("shipcomplete.null.is.F")}})}},{event:"BATCH_EXPORT:BEFORE_MAP_COLLECTION_TO_REQUEST_DOCUMENT",method:"on",handler:function(a,f){b("updateTransactionIdVersion collection",f);a.getCache().threepl={"export":{searchResults:[]}};var g=a.getCache().threepl["export"].searchResults;f.each(function(f){b("updateTransactionIdVersion entry",
f);var j=e.getQuantityExportedField(),m=e.getQuantityPendingExportField(),n=e.getExportCount(),o=c(f[0][n])+1;_.each(f,function(c){b("updateTransactionIdVersion line",c);c.tranid+="-EC-"+o;var e=a.getCache();if(_.isUndefined(e.reserved))b("reserved property undefined -> ","setting the export count number"),c.Number=c.tranid;else if(e.reserved.showSalesOrderNumber!==!1)b("reserved property defined-> ","setting the export count number"),c.Number=c.tranid;e={};e.id=c.id;e[j]=c[j];e[m]=c[m];e[n]=c[n];
e.line=c.line;g.push(e);delete c[j];delete c[m];delete c[n];delete c.tranid;delete c.line})});b("searchresult entry",g);b("updateTransactionIdVersion updated",f)}},{event:"BATCH_EXPORT:PROCESS_EACH_EXPORTED_RECORD_CONFIG",method:"on",handler:function(a,f){b("updateLineItems object",f);f.submitRecordOptions={ignoreMandatoryFields:!0};var g=a.getCache().threepl["export"].searchResults;b("updateLineItems searchResult before updating ->",g);var k=[],l=e.getQuantityExportedField(),m=e.getQuantityPendingExportField(),
n=e.getExportCount();_.each(g,function(a){if(f.id===a.id){b("id's ->","objectid:"+f.id+" - lineid:"+a.id);b("message ->","inside if");var g=c(a[m]),h={line:a.line};b("getQuantityExportedField ->",a[l]);b("newlyExportedQuantity ->",g);h[l]=c(a[l])+g;b("added ExportedQuantity ->",h[l]);k.push(h);b("current export count",c(a[n]));f.nlobjFieldIds[n]=c(a[n])+1;b("incremented export count",f.nlobjFieldIds[n]);a[e.getQuantityExportedField()]=h[e.getQuantityExportedField()]}});f.nlobjSublistIds.item=k;b("updateLineItems updated object ->",
f)}}];this.connect=function(){var a=Celigo.event.dispatcher.integrator.batch.ExportDispatcher;b("connect");_.each(g,function(b){a[b.method].call(a,b.event,b.handler)})};this.disconnect=function(){var a=Celigo.event.dispatcher.integrator.batch.ExportDispatcher;b("disconnect");_.each(g,function(b){a.removeListener(b.event,b.handler)})};this.setQuantityExportedField=function(b){a.quantityExportedField=b};this.getQuantityExportedField=function(){return a.quantityExportedField};this.setQuantityPendingExportField=
function(b){a.quantityPendingExportField=b};this.getQuantityPendingExportField=function(){return a.quantityPendingExportField};this.setExportCount=function(b){a.exportCount=b};this.getExportCount=function(){return a.exportCount};this.connect()};Celigo.products.thirdpartylogistics.batch.exportflow.OrderLineLevelExportPlugin.className="Celigo.products.thirdpartylogistics.batch.exportflow.OrderLineLevelExportPlugin";Celigo.products.thirdpartylogistics.batch.exportflow.OrderLineLevelExportPlugin.extend(Celigo.io.PrivateStateful);
$.namespace("Celigo.products.threepl.batch.import.inventoryadjustment");Celigo.products.threepl.batch["import"].inventoryadjustment.InventoryAdjustmentImportPlugin=function(a){function b(a,b,c){$$.logExecution(a,b,c)}this._super(a);var c={"BATCH_IMPORT:PROCESS_EACH_RECORD_CONFIG":function(a,c){b("debug","record before converted to $R -> ",JSON.stringify(c));for(var g=c.nlobjSublistIds.inventory.lines,h=g.length,j=0,i=0,j=0;j<h;j++){var k=(new $R({nlobjRecordType:"inventoryitem",id:g[j].item})).get("locations"),
l=k.length;b("debug","locations -> ",l);for(i=0;i<l;i++)if(g[j].location===k[i].location_display)g[j].isTotal?(g[j].adjustqtyby=g[j].quantityonhand-k[i].quantityonhand,b("debug","quantity to be adjusted by -> ",g[j].adjustqtyby)):b("debug","showing quantity on hand and doing nothing -> ",g[j].adjustqtyby),delete g[j].quantityonhand,delete g[j].isTotal}b("debug","adjusted items -> ",JSON.stringify(g));b("debug","record after submitted to $R -> ",JSON.stringify(c))},"BATCH_IMPORT:AFTER_MAP_RESPONSE_DOCUMENT_TO_RECORDS":function(a,
c){var g=c.getJsObjects().serialize(),h=0,j=0;b("debug","before editing the line items-> ",JSON.stringify(g));b("debug","numOfRecords -> ",g.data.length);for(h=0;h<g.data.length;h++)if(j=g.data[h].data.nlobjSublistIds.inventory,!_.isUndefined(j)){for(var i=j.lines,k=[],j=0;j<i.length;j++){i[j].isTotal=!0;if(_.isNaN(i[j].quantityonhand)||i[j].quantityonhand==="")i[j].quantityonhand="0",i[j].isTotal=!1;var l;a:{l=k;var m=i[j],n=l.length;b("debug","length -> ",n);b("debug","jsonObject -> ",m);for(var o=
0,o=0;o<n;o++)if(b("debug","jsonArray[p] -> ",l[o]),l[o].item===m.item&&l[o].location===m.location&&l[o].isTotal===m.isTotal){l=o;break a}l=-1}b("debug","index -> ",l);l!==-1?k[l].isTotal?(b("debug","aggregrated quantity on hand -> ",(parseInt(k[l].quantityonhand,10)+parseInt(i[j].quantityonhand,10)).toString()),k[l].quantityonhand=(parseInt(k[l].quantityonhand,10)+parseInt(i[j].quantityonhand,10)).toString()):(b("debug","aggregrated adjusted quantity -> ",(parseInt(k[l].adjustqtyby,10)+parseInt(i[j].adjustqtyby,
10)).toString()),k[l].adjustqtyby=(parseInt(k[l].adjustqtyby,10)+parseInt(i[j].adjustqtyby,10)).toString()):k.push(i[j])}b("debug","new line items-> ",JSON.stringify(k));g.data[h].data.nlobjSublistIds.inventory.lines=k}b("debug","after editing the line items-> ",JSON.stringify(g));b("debug","result before setting the jsobjects -> ",JSON.stringify(c.getJsObjects()));j=(h=a.getCache().reserved.chunkSizeForMaximumNoOfLinesForInventoryAdjustmentImport)?h:1E3;i=[];for(h=0;h<g.data.length;h++){k=g.data[h];
l=j;m=k.data.nlobjSublistIds.inventory.lines.length;n=[];if(m<l)n.push(k);else{var o=Math.ceil(m/l),q=0,r=0;b("debug","3PL ","chunks -> "+o);b("debug","3PL ","record -> "+JSON.stringify(k));for(q=1;q<=o;q++){var p={};p.celigoIsElement=k.celigoIsElement;p.data={};p.data.nlobjRecordType=k.data.nlobjRecordType;p.data.nlobjFieldIds=k.data.nlobjFieldIds;p.data.nlobjSublistIds={inventory:{lines:[]}};for(r=(q-1)*l;r<q*l;r++){b("debug","3PL ","i -> "+q+" :j-> "+r+" :limit-> "+l+" :chunks-> "+o);if(r>=m){b("debug",
"3PL ","j>>>>>>>>>>>>====limit");break}var w=k.data.nlobjSublistIds.inventory.lines[r];if(w)b("debug","3PL ","item -> "+JSON.stringify(w)),p.data.nlobjSublistIds.inventory.lines.push({item:w.item,description:w.description,location:w.location,adjustqtyby:w.adjustqtyby,unitcost:w.unitcost,memo:w.memo});else{b("debug","3PL "," ******item undefined");break}}n.push(p)}}k=n;b("debug","chunkedRecords -> ",JSON.stringify(k));i=i.concat(k);b("debug","resultRecords after concat-> ",i)}g.data=i;c.setJsObjects(new Celigo.oop.Collection(g));
b("debug","result after setting the jsobjects -> ",JSON.stringify(c.getJsObjects()))}};this.connect=function(){_.each(_.keys(c),function(a){Celigo.event.dispatcher.integrator.batch.ImportDispatcher.on(a,c[a])})};this.disconnect=function(){_.each(_.keys(c),function(a){Celigo.event.dispatcher.integrator.batch.ImportDispatcher.removeListener(a,c[a])})};this.connect()};Celigo.products.threepl.batch["import"].inventoryadjustment.InventoryAdjustmentImportPlugin.className="Celigo.products.threepl.batch.import.inventoryadjustment.InventoryAdjustmentImportPlugin";
Celigo.products.threepl.batch["import"].inventoryadjustment.InventoryAdjustmentImportPlugin.extend(Celigo.io.PrivateStateful);var Celigo_core_integrator_util_IntegratorUtil=function(){},Celigo_core_integrator_util_IntegratorUtil=Celigo.integrator.util.IntegratorUtil,Celigo_integrator_util_SalesOrderImportUtil=function(){},Celigo_integrator_util_SalesOrderImportUtil=Celigo.integrator.util.SalesOrderImportUtil};